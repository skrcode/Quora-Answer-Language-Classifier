
var Base=function(){};Base.extend=function(_instance,_static){var extend=Base.prototype.extend;Base._prototyping=true;var proto=new this;extend.call(proto,_instance);proto.base=function(){};delete Base._prototyping;var constructor=proto.constructor;var klass=proto.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==klass){this._constructing=true;constructor.apply(this,arguments);delete this._constructing;}else if(arguments[0]!=null){return(arguments[0].extend||extend).call(arguments[0],proto);}}};klass.ancestor=this;klass.extend=this.extend;klass.forEach=this.forEach;klass.implement=this.implement;klass.prototype=proto;klass.toString=this.toString;klass.valueOf=function(type){return(type=="object")?klass:constructor.valueOf();};extend.call(klass,_static);if(typeof klass.init=="function")klass.init();return klass;};Base.prototype={extend:function(source,value){if(arguments.length>1){var ancestor=this[source];if(ancestor&&(typeof value=="function")&&(!ancestor.valueOf||ancestor.valueOf()!=value.valueOf())&&/\bbase\b/.test(value)){var method=value.valueOf();value=function(){var previous=this.base||Base.prototype.base;this.base=ancestor;var returnValue=method.apply(this,arguments);this.base=previous;return returnValue;};value.valueOf=function(type){return(type=="object")?value:method;};value.toString=Base.toString;}
this[source]=value;}else if(source){var extend=Base.prototype.extend;if(!Base._prototyping&&typeof this!="function"){extend=this.extend||extend;}
var proto={toSource:null};var hidden=["constructor","toString","valueOf"];var i=Base._prototyping?0:1;while(key=hidden[i++]){if(source[key]!=proto[key]){extend.call(this,key,source[key]);}}
for(var key in source){if(!proto[key])extend.call(this,key,source[key]);}}
return this;}};Base=Base.extend({constructor:function(){this.extend(arguments[0]);}},{ancestor:Object,version:"1.1",forEach:function(object,block,context){for(var key in object){if(this.prototype[key]===undefined){block.call(context,object[key],key,object);}}},implement:function(){for(var i=0;i<arguments.length;i++){if(typeof arguments[i]=="function"){arguments[i](this.prototype);}else{this.prototype.extend(arguments[i]);}}
return this;},toString:function(){return String(this.valueOf());}});(function(window,undefined){var
rootjQuery,readyList,document=window.document,location=window.location,navigator=window.navigator,_jQuery=window.jQuery,_$=window.$,core_push=Array.prototype.push,core_slice=Array.prototype.slice,core_indexOf=Array.prototype.indexOf,core_toString=Object.prototype.toString,core_hasOwn=Object.prototype.hasOwnProperty,core_trim=String.prototype.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery);},core_pnum=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,core_rnotwhite=/\S/,core_rspace=/\s+/,rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rquickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return(letter+"").toUpperCase();},DOMContentLoaded=function(){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",DOMContentLoaded,false);jQuery.ready();}else if(document.readyState==="complete"){document.detachEvent("onreadystatechange",DOMContentLoaded);jQuery.ready();}},class2type={};jQuery.fn=jQuery.prototype={constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem,ret,doc;if(!selector){return this;}
if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this;}
if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null];}else{match=rquickExpr.exec(selector);}
if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;doc=(context&&context.nodeType?context.ownerDocument||context:document);selector=jQuery.parseHTML(match[1],doc,true);if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){this.attr.call(selector,context,true);}
return jQuery.merge(this,selector);}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2]){return rootjQuery.find(selector);}
this.length=1;this[0]=elem;}
this.context=document;this.selector=selector;return this;}}else if(!context||context.jquery){return(context||rootjQuery).find(selector);}else{return this.constructor(context).find(selector);}}else if(jQuery.isFunction(selector)){return rootjQuery.ready(selector);}
if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context;}
return jQuery.makeArray(selector,this);},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length;},toArray:function(){return core_slice.call(this);},get:function(num){return num==null?this.toArray():(num<0?this[this.length+num]:this[num]);},pushStack:function(elems,name,selector){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;if(name==="find"){ret.selector=this.selector+(this.selector?" ":"")+selector;}else if(name){ret.selector=this.selector+"."+name+"("+selector+")";}
return ret;},each:function(callback,args){return jQuery.each(this,callback,args);},ready:function(fn){jQuery.ready.promise().done(fn);return this;},eq:function(i){i=+i;return i===-1?this.slice(i):this.slice(i,i+1);},first:function(){return this.eq(0);},last:function(){return this.eq(-1);},slice:function(){return this.pushStack(core_slice.apply(this,arguments),"slice",core_slice.call(arguments).join(","));},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem);}));},end:function(){return this.prevObject||this.constructor(null);},push:core_push,sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2;}
if(typeof target!=="object"&&!jQuery.isFunction(target)){target={};}
if(length===i){target=this;--i;}
for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue;}
if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[];}else{clone=src&&jQuery.isPlainObject(src)?src:{};}
target[name]=jQuery.extend(deep,clone,copy);}else if(copy!==undefined){target[name]=copy;}}}}
return target;};jQuery.extend({noConflict:function(deep){if(window.$===jQuery){window.$=_$;}
if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery;}
return jQuery;},isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++;}else{jQuery.ready(true);}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return;}
if(!document.body){return setTimeout(jQuery.ready,1);}
jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return;}
readyList.resolveWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready");}},isFunction:function(obj){return jQuery.type(obj)==="function";},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array";},isWindow:function(obj){return obj!=null&&obj==obj.window;},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj);},type:function(obj){return obj==null?String(obj):class2type[core_toString.call(obj)]||"object";},isPlainObject:function(obj){if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false;}
try{if(obj.constructor&&!core_hasOwn.call(obj,"constructor")&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false;}}catch(e){return false;}
var key;for(key in obj){}
return key===undefined||core_hasOwn.call(obj,key);},isEmptyObject:function(obj){var name;for(name in obj){return false;}
return true;},error:function(msg){throw new Error(msg);},parseHTML:function(data,context,scripts){var parsed;if(!data||typeof data!=="string"){return null;}
if(typeof context==="boolean"){scripts=context;context=0;}
context=context||document;if((parsed=rsingleTag.exec(data))){return[context.createElement(parsed[1])];}
parsed=jQuery.buildFragment([data],context,scripts?null:[]);return jQuery.merge([],(parsed.cacheable?jQuery.clone(parsed.fragment):parsed.fragment).childNodes);},parseJSON:function(data){if(!data||typeof data!=="string"){return null;}
data=jQuery.trim(data);if(window.JSON&&window.JSON.parse){return window.JSON.parse(data);}
if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return(new Function("return "+data))();}
jQuery.error("Invalid JSON: "+data);},parseXML:function(data){var xml,tmp;if(!data||typeof data!=="string"){return null;}
try{if(window.DOMParser){tmp=new DOMParser();xml=tmp.parseFromString(data,"text/xml");}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data);}}catch(e){xml=undefined;}
if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data);}
return xml;},noop:function(){},globalEval:function(data){if(data&&core_rnotwhite.test(data)){(window.execScript||function(data){window["eval"].call(window,data);})(data);}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase);},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase();},each:function(obj,callback,args){var name,i=0,length=obj.length,isObj=length===undefined||jQuery.isFunction(obj);if(args){if(isObj){for(name in obj){if(callback.apply(obj[name],args)===false){break;}}}else{for(;i<length;){if(callback.apply(obj[i++],args)===false){break;}}}}else{if(isObj){for(name in obj){if(callback.call(obj[name],name,obj[name])===false){break;}}}else{for(;i<length;){if(callback.call(obj[i],i,obj[i++])===false){break;}}}}
return obj;},trim:core_trim&&!core_trim.call("\uFEFF\xA0")?function(text){return text==null?"":core_trim.call(text);}:function(text){return text==null?"":(text+"").replace(rtrim,"");},makeArray:function(arr,results){var type,ret=results||[];if(arr!=null){type=jQuery.type(arr);if(arr.length==null||type==="string"||type==="function"||type==="regexp"||jQuery.isWindow(arr)){core_push.call(ret,arr);}else{jQuery.merge(ret,arr);}}
return ret;},inArray:function(elem,arr,i){var len;if(arr){if(core_indexOf){return core_indexOf.call(arr,elem,i);}
len=arr.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in arr&&arr[i]===elem){return i;}}}
return-1;},merge:function(first,second){var l=second.length,i=first.length,j=0;if(typeof l==="number"){for(;j<l;j++){first[i++]=second[j];}}else{while(second[j]!==undefined){first[i++]=second[j++];}}
first.length=i;return first;},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;inv=!!inv;for(;i<length;i++){retVal=!!callback(elems[i],i);if(inv!==retVal){ret.push(elems[i]);}}
return ret;},map:function(elems,callback,arg){var value,key,ret=[],i=0,length=elems.length,isArray=elems instanceof jQuery||length!==undefined&&typeof length==="number"&&((length>0&&elems[0]&&elems[length-1])||length===0||jQuery.isArray(elems));if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value;}}}else{for(key in elems){value=callback(elems[key],key,arg);if(value!=null){ret[ret.length]=value;}}}
return ret.concat.apply([],ret);},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp;}
if(!jQuery.isFunction(fn)){return undefined;}
args=core_slice.call(arguments,2);proxy=function(){return fn.apply(context,args.concat(core_slice.call(arguments)));};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy;},access:function(elems,fn,key,value,chainable,emptyGet,pass){var exec,bulk=key==null,i=0,length=elems.length;if(key&&typeof key==="object"){for(i in key){jQuery.access(elems,fn,i,key[i],1,emptyGet,value);}
chainable=1;}else if(value!==undefined){exec=pass===undefined&&jQuery.isFunction(value);if(bulk){if(exec){exec=fn;fn=function(elem,key,value){return exec.call(jQuery(elem),value);};}else{fn.call(elems,value);fn=null;}}
if(fn){for(;i<length;i++){fn(elems[i],key,exec?value.call(elems[i],i,fn(elems[i],key)):value,pass);}}
chainable=1;}
return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet;},now:function(){return(new Date()).getTime();}});jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready,1);}else if(document.addEventListener){document.addEventListener("DOMContentLoaded",DOMContentLoaded,false);window.addEventListener("load",jQuery.ready,false);}else{document.attachEvent("onreadystatechange",DOMContentLoaded);window.attachEvent("onload",jQuery.ready);var top=false;try{top=window.frameElement==null&&document.documentElement;}catch(e){}
if(top&&top.doScroll){(function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left");}catch(e){return setTimeout(doScrollCheck,50);}
jQuery.ready();}})();}}}
return readyList.promise(obj);};jQuery.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase();});rootjQuery=jQuery(document);var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.split(core_rspace),function(_,flag){object[flag]=true;});return object;}
jQuery.Callbacks=function(options){options=typeof options==="string"?(optionsCache[options]||createOptions(options)):jQuery.extend({},options);var
memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break;}}
firing=false;if(list){if(stack){if(stack.length){fire(stack.shift());}}else if(memory){list=[];}else{self.disable();}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"){if(!options.unique||!self.has(arg)){list.push(arg);}}else if(arg&&arg.length&&type!=="string"){add(arg);}});})(arguments);if(firing){firingLength=list.length;}else if(memory){firingStart=start;fire(memory);}}
return this;},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--;}
if(index<=firingIndex){firingIndex--;}}}});}
return this;},has:function(fn){return jQuery.inArray(fn,list)>-1;},empty:function(){list=[];return this;},disable:function(){list=stack=memory=undefined;return this;},disabled:function(){return!list;},lock:function(){stack=undefined;if(!memory){self.disable();}
return this;},locked:function(){return!stack;},fireWith:function(context,args){args=args||[];args=[context,args.slice?args.slice():args];if(list&&(!fired||stack)){if(firing){stack.push(args);}else{fire(args);}}
return this;},fire:function(){self.fireWith(this,arguments);return this;},fired:function(){return!!fired;}};return self;};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state;},always:function(){deferred.done(arguments).fail(arguments);return this;},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=fns[i];deferred[tuple[1]](jQuery.isFunction(fn)?function(){var returned=fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify);}else{newDefer[action+"With"](this===deferred?newDefer:this,[returned]);}}:newDefer[action]);});fns=null;}).promise();},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise;}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString;},tuples[i^1][2].disable,tuples[2][2].lock);}
deferred[tuple[0]]=list.fire;deferred[tuple[0]+"With"]=list.fireWith;});promise.promise(deferred);if(func){func.call(deferred,deferred);}
return deferred;},when:function(subordinate){var i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=length!==1||(subordinate&&jQuery.isFunction(subordinate.promise))?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?core_slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values);}else if(!(--remaining)){deferred.resolveWith(contexts,values);}};},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues));}else{--remaining;}}}
if(!remaining){deferred.resolveWith(resolveContexts,resolveValues);}
return deferred.promise();}});jQuery.support=(function(){var support,all,a,select,opt,input,fragment,eventName,i,isSupported,clickFn,div=document.createElement("div");div.setAttribute("className","t");div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";all=div.getElementsByTagName("*");a=div.getElementsByTagName("a")[0];if(!all||!a||!all.length){return{};}
select=document.createElement("select");opt=select.appendChild(document.createElement("option"));input=div.getElementsByTagName("input")[0];a.style.cssText="top:1px;float:left;opacity:.5";support={leadingWhitespace:(div.firstChild.nodeType===3),tbody:!div.getElementsByTagName("tbody").length,htmlSerialize:!!div.getElementsByTagName("link").length,style:/top/.test(a.getAttribute("style")),hrefNormalized:(a.getAttribute("href")==="/a"),opacity:/^0.5/.test(a.style.opacity),cssFloat:!!a.style.cssFloat,checkOn:(input.value==="on"),optSelected:opt.selected,getSetAttribute:div.className!=="t",enctype:!!document.createElement("form").enctype,html5Clone:document.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>",boxModel:(document.compatMode==="CSS1Compat"),submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true,boxSizingReliable:true,pixelPosition:false};input.checked=true;support.noCloneChecked=input.cloneNode(true).checked;select.disabled=true;support.optDisabled=!opt.disabled;try{delete div.test;}catch(e){support.deleteExpando=false;}
if(!div.addEventListener&&div.attachEvent&&div.fireEvent){div.attachEvent("onclick",clickFn=function(){support.noCloneEvent=false;});div.cloneNode(true).fireEvent("onclick");div.detachEvent("onclick",clickFn);}
input=document.createElement("input");input.value="t";input.setAttribute("type","radio");support.radioValue=input.value==="t";input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);fragment=document.createDocumentFragment();fragment.appendChild(div.lastChild);support.checkClone=fragment.cloneNode(true).cloneNode(true).lastChild.checked;support.appendChecked=input.checked;fragment.removeChild(input);fragment.appendChild(div);if(div.attachEvent){for(i in{submit:true,change:true,focusin:true}){eventName="on"+i;isSupported=(eventName in div);if(!isSupported){div.setAttribute(eventName,"return;");isSupported=(typeof div[eventName]==="function");}
support[i+"Bubbles"]=isSupported;}}
jQuery(function(){var container,div,tds,marginDiv,divReset="padding:0;margin:0;border:0;display:block;overflow:hidden;",body=document.getElementsByTagName("body")[0];if(!body){return;}
container=document.createElement("div");container.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px";body.insertBefore(container,body.firstChild);div=document.createElement("div");container.appendChild(div);div.innerHTML="<table><tr><td></td><td>t</td></tr></table>";tds=div.getElementsByTagName("td");tds[0].style.cssText="padding:0;margin:0;border:0;display:none";isSupported=(tds[0].offsetHeight===0);tds[0].style.display="";tds[1].style.display="none";support.reliableHiddenOffsets=isSupported&&(tds[0].offsetHeight===0);div.innerHTML="";div.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";support.boxSizing=(div.offsetWidth===4);support.doesNotIncludeMarginInBodyOffset=(body.offsetTop!==1);if(window.getComputedStyle){support.pixelPosition=(window.getComputedStyle(div,null)||{}).top!=="1%";support.boxSizingReliable=(window.getComputedStyle(div,null)||{width:"4px"}).width==="4px";marginDiv=document.createElement("div");marginDiv.style.cssText=div.style.cssText=divReset;marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";div.appendChild(marginDiv);support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight);}
if(typeof div.style.zoom!=="undefined"){div.innerHTML="";div.style.cssText=divReset+"width:1px;padding:1px;display:inline;zoom:1";support.inlineBlockNeedsLayout=(div.offsetWidth===3);div.style.display="block";div.style.overflow="visible";div.innerHTML="<div></div>";div.firstChild.style.width="5px";support.shrinkWrapBlocks=(div.offsetWidth!==3);container.style.zoom=1;}
body.removeChild(container);container=div=tds=marginDiv=null;});fragment.removeChild(div);all=a=select=opt=input=fragment=div=null;return support;})();var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(jQuery.fn.jquery+Math.random()).replace(/\D/g,""),noData:{"embed":true,"object":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000","applet":true},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];return!!elem&&!isEmptyDataObject(elem);},data:function(elem,name,data,pvt){if(!jQuery.acceptData(elem)){return;}
var thisCache,ret,internalKey=jQuery.expando,getByName=typeof name==="string",isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if((!id||!cache[id]||(!pvt&&!cache[id].data))&&getByName&&data===undefined){return;}
if(!id){if(isNode){elem[internalKey]=id=jQuery.deletedIds.pop()||jQuery.guid++;}else{id=internalKey;}}
if(!cache[id]){cache[id]={};if(!isNode){cache[id].toJSON=jQuery.noop;}}
if(typeof name==="object"||typeof name==="function"){if(pvt){cache[id]=jQuery.extend(cache[id],name);}else{cache[id].data=jQuery.extend(cache[id].data,name);}}
thisCache=cache[id];if(!pvt){if(!thisCache.data){thisCache.data={};}
thisCache=thisCache.data;}
if(data!==undefined){thisCache[jQuery.camelCase(name)]=data;}
if(getByName){ret=thisCache[name];if(ret==null){ret=thisCache[jQuery.camelCase(name)];}}else{ret=thisCache;}
return ret;},removeData:function(elem,name,pvt){if(!jQuery.acceptData(elem)){return;}
var thisCache,i,l,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(!cache[id]){return;}
if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(!jQuery.isArray(name)){if(name in thisCache){name=[name];}else{name=jQuery.camelCase(name);if(name in thisCache){name=[name];}else{name=name.split(" ");}}}
for(i=0,l=name.length;i<l;i++){delete thisCache[name[i]];}
if(!(pvt?isEmptyDataObject:jQuery.isEmptyObject)(thisCache)){return;}}}
if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id])){return;}}
if(isNode){jQuery.cleanData([elem],true);}else if(jQuery.support.deleteExpando||cache!=cache.window){delete cache[id];}else{cache[id]=null;}},_data:function(elem,name,data){return jQuery.data(elem,name,data,true);},acceptData:function(elem){var noData=elem.nodeName&&jQuery.noData[elem.nodeName.toLowerCase()];return!noData||noData!==true&&elem.getAttribute("classid")===noData;}});jQuery.fn.extend({data:function(key,value){var parts,part,attr,name,l,elem=this[0],i=0,data=null;if(key===undefined){if(this.length){data=jQuery.data(elem);if(elem.nodeType===1&&!jQuery._data(elem,"parsedAttrs")){attr=elem.attributes;for(l=attr.length;i<l;i++){name=attr[i].name;if(!name.indexOf("data-")){name=jQuery.camelCase(name.substring(5));dataAttr(elem,name,data[name]);}}
jQuery._data(elem,"parsedAttrs",true);}}
return data;}
if(typeof key==="object"){return this.each(function(){jQuery.data(this,key);});}
parts=key.split(".",2);parts[1]=parts[1]?"."+parts[1]:"";part=parts[1]+"!";return jQuery.access(this,function(value){if(value===undefined){data=this.triggerHandler("getData"+part,[parts[0]]);if(data===undefined&&elem){data=jQuery.data(elem,key);data=dataAttr(elem,key,data);}
return data===undefined&&parts[1]?this.data(parts[0]):data;}
parts[1]=value;this.each(function(){var self=jQuery(this);self.triggerHandler("setData"+part,parts);jQuery.data(this,key,value);self.triggerHandler("changeData"+part,parts);});},null,value,arguments.length>1,null,false);},removeData:function(key){return this.each(function(){jQuery.removeData(this,key);});}});function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data;}catch(e){}
jQuery.data(elem,key,data);}else{data=undefined;}}
return data;}
function isEmptyDataObject(obj){var name;for(name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name])){continue;}
if(name!=="toJSON"){return false;}}
return true;}
jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=jQuery._data(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=jQuery._data(elem,type,jQuery.makeArray(data));}else{queue.push(data);}}
return queue||[];}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type);};if(fn==="inprogress"){fn=queue.shift();startLength--;}
if(fn){if(type==="fx"){queue.unshift("inprogress");}
delete hooks.stop;fn.call(elem,next,hooks);}
if(!startLength&&hooks){hooks.empty.fire();}},_queueHooks:function(elem,type){var key=type+"queueHooks";return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery.removeData(elem,type+"queue",true);jQuery.removeData(elem,key,true);})});}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--;}
if(arguments.length<setter){return jQuery.queue(this[0],type);}
return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type);}});},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type);});},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout);};});},clearQueue:function(type){return this.queue(type||"fx",[]);},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!(--count)){defer.resolveWith(elements,[elements]);}};if(typeof type!=="string"){obj=type;type=undefined;}
type=type||"fx";while(i--){tmp=jQuery._data(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve);}}
resolve();return defer.promise(obj);}});var nodeHook,boolHook,fixSpecified,rclass=/[\t\r\n]/g,rreturn=/\r/g,rtype=/^(?:button|input)$/i,rfocusable=/^(?:button|input|object|select|textarea)$/i,rclickable=/^a(?:rea|)$/i,rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,getSetAttribute=jQuery.support.getSetAttribute;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1);},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name);});},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1);},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;delete this[name];}catch(e){}});},addClass:function(value){var classNames,i,l,elem,setClass,c,cl;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className));});}
if(value&&typeof value==="string"){classNames=value.split(core_rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1){if(!elem.className&&classNames.length===1){elem.className=value;}else{setClass=" "+elem.className+" ";for(c=0,cl=classNames.length;c<cl;c++){if(setClass.indexOf(" "+classNames[c]+" ")<0){setClass+=classNames[c]+" ";}}
elem.className=jQuery.trim(setClass);}}}}
return this;},removeClass:function(value){var removes,className,elem,c,cl,i,l;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className));});}
if((value&&typeof value==="string")||value===undefined){removes=(value||"").split(core_rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1&&elem.className){className=(" "+elem.className+" ").replace(rclass," ");for(c=0,cl=removes.length;c<cl;c++){while(className.indexOf(" "+removes[c]+" ")>=0){className=className.replace(" "+removes[c]+" "," ");}}
elem.className=value?jQuery.trim(className):"";}}}
return this;},toggleClass:function(value,stateVal){var type=typeof value,isBool=typeof stateVal==="boolean";if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal);});}
return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),state=stateVal,classNames=value.split(core_rspace);while((className=classNames[i++])){state=isBool?state:!self.hasClass(className);self[state?"addClass":"removeClass"](className);}}else if(type==="undefined"||type==="boolean"){if(this.className){jQuery._data(this,"__className__",this.className);}
this.className=this.className||value===false?"":jQuery._data(this,"__className__")||"";}});},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true;}}
return false;},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret;}
ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret;}
return;}
isFunction=jQuery.isFunction(value);return this.each(function(i){var val,self=jQuery(this);if(this.nodeType!==1){return;}
if(isFunction){val=value.call(this,i,self.val());}else{val=value;}
if(val==null){val="";}else if(typeof val==="number"){val+="";}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+"";});}
hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val;}});}});jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return!val||val.specified?elem.value:elem.text;}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value;}
values.push(value);}}
return values;},set:function(elem,value){var values=jQuery.makeArray(value);jQuery(elem).find("option").each(function(){this.selected=jQuery.inArray(jQuery(this).val(),values)>=0;});if(!values.length){elem.selectedIndex=-1;}
return values;}}},attrFn:{},attr:function(elem,name,value,pass){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return;}
if(pass&&jQuery.isFunction(jQuery.fn[name])){return jQuery(elem)[name](value);}
if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value);}
notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(rboolean.test(name)?boolHook:nodeHook);}
if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return;}else if(hooks&&"set"in hooks&&notxml&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}else{elem.setAttribute(name,value+"");return value;}}else if(hooks&&"get"in hooks&&notxml&&(ret=hooks.get(elem,name))!==null){return ret;}else{ret=elem.getAttribute(name);return ret===null?undefined:ret;}},removeAttr:function(elem,value){var propName,attrNames,name,isBool,i=0;if(value&&elem.nodeType===1){attrNames=value.split(core_rspace);for(;i<attrNames.length;i++){name=attrNames[i];if(name){propName=jQuery.propFix[name]||name;isBool=rboolean.test(name);if(!isBool){jQuery.attr(elem,name,"");}
elem.removeAttribute(getSetAttribute?name:propName);if(isBool&&propName in elem){elem[propName]=false;}}}}},attrHooks:{type:{set:function(elem,value){if(rtype.test(elem.nodeName)&&elem.parentNode){jQuery.error("type property can't be changed");}else if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val;}
return value;}}},value:{get:function(elem,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.get(elem,name);}
return name in elem?elem.value:null;},set:function(elem,value,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.set(elem,value,name);}
elem.value=value;}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return;}
notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name];}
if(value!==undefined){if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}else{return(elem[name]=value);}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret;}else{return elem[name];}}},propHooks:{tabIndex:{get:function(elem){var attributeNode=elem.getAttributeNode("tabindex");return attributeNode&&attributeNode.specified?parseInt(attributeNode.value,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:undefined;}}}});boolHook={get:function(elem,name){var attrNode,property=jQuery.prop(elem,name);return property===true||typeof property!=="boolean"&&(attrNode=elem.getAttributeNode(name))&&attrNode.nodeValue!==false?name.toLowerCase():undefined;},set:function(elem,value,name){var propName;if(value===false){jQuery.removeAttr(elem,name);}else{propName=jQuery.propFix[name]||name;if(propName in elem){elem[propName]=true;}
elem.setAttribute(name,name.toLowerCase());}
return name;}};if(!getSetAttribute){fixSpecified={name:true,id:true,coords:true};nodeHook=jQuery.valHooks.button={get:function(elem,name){var ret;ret=elem.getAttributeNode(name);return ret&&(fixSpecified[name]?ret.value!=="":ret.specified)?ret.value:undefined;},set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(!ret){ret=document.createAttribute(name);elem.setAttributeNode(ret);}
return(ret.value=value+"");}};jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{set:function(elem,value){if(value===""){elem.setAttribute(name,"auto");return value;}}});});jQuery.attrHooks.contenteditable={get:nodeHook.get,set:function(elem,value,name){if(value===""){value="false";}
nodeHook.set(elem,value,name);}};}
if(!jQuery.support.hrefNormalized){jQuery.each(["href","src","width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{get:function(elem){var ret=elem.getAttribute(name,2);return ret===null?undefined:ret;}});});}
if(!jQuery.support.style){jQuery.attrHooks.style={get:function(elem){return elem.style.cssText.toLowerCase()||undefined;},set:function(elem,value){return(elem.style.cssText=value+"");}};}
if(!jQuery.support.optSelected){jQuery.propHooks.selected=jQuery.extend(jQuery.propHooks.selected,{get:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex;}}
return null;}});}
if(!jQuery.support.enctype){jQuery.propFix.enctype="encoding";}
if(!jQuery.support.checkOn){jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={get:function(elem){return elem.getAttribute("value")===null?"on":elem.value;}};});}
jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]=jQuery.extend(jQuery.valHooks[this],{set:function(elem,value){if(jQuery.isArray(value)){return(elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0);}}});});var rformElems=/^(?:textarea|input|select)$/i,rtypenamespace=/^([^\.]*|)(?:\.(.+)|)$/,rhoverHack=/(?:^|\s)hover(\.\S+|)\b/,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,hoverHack=function(events){return jQuery.event.special.hover?events:events.replace(rhoverHack,"mouseenter$1 mouseleave$1");};jQuery.event={add:function(elem,types,handler,data,selector){var elemData,eventHandle,events,t,tns,type,namespaces,handleObj,handleObjIn,handlers,special;if(elem.nodeType===3||elem.nodeType===8||!types||!handler||!(elemData=jQuery._data(elem))){return;}
if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector;}
if(!handler.guid){handler.guid=jQuery.guid++;}
events=elemData.events;if(!events){elemData.events=events={};}
eventHandle=elemData.handle;if(!eventHandle){elemData.handle=eventHandle=function(e){return typeof jQuery!=="undefined"&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined;};eventHandle.elem=elem;}
types=jQuery.trim(hoverHack(types)).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=tns[1];namespaces=(tns[2]||"").split(".").sort();special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:tns[1],data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);handlers=events[type];if(!handlers){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false);}else if(elem.attachEvent){elem.attachEvent("on"+type,eventHandle);}}}
if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid;}}
if(selector){handlers.splice(handlers.delegateCount++,0,handleObj);}else{handlers.push(handleObj);}
jQuery.event.global[type]=true;}
elem=null;},global:{},remove:function(elem,types,handler,selector,mappedTypes){var t,tns,type,origType,namespaces,origCount,j,events,special,eventType,handleObj,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(!elemData||!(events=elemData.events)){return;}
types=jQuery.trim(hoverHack(types||"")).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=origType=tns[1];namespaces=tns[2];if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true);}
continue;}
special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;eventType=events[type]||[];origCount=eventType.length;namespaces=namespaces?new RegExp("(^|\\.)"+namespaces.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(j=0;j<eventType.length;j++){handleObj=eventType[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!namespaces||namespaces.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){eventType.splice(j--,1);if(handleObj.selector){eventType.delegateCount--;}
if(special.remove){special.remove.call(elem,handleObj);}}}
if(eventType.length===0&&origCount!==eventType.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle);}
delete events[type];}}
if(jQuery.isEmptyObject(events)){delete elemData.handle;jQuery.removeData(elem,"events",true);}},customEvent:{"getData":true,"setData":true,"changeData":true},trigger:function(event,data,elem,onlyHandlers){if(elem&&(elem.nodeType===3||elem.nodeType===8)){return;}
var cache,exclusive,i,cur,old,ontype,special,handle,eventPath,bubbleType,type=event.type||event,namespaces=[];if(rfocusMorph.test(type+jQuery.event.triggered)){return;}
if(type.indexOf("!")>=0){type=type.slice(0,-1);exclusive=true;}
if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort();}
if((!elem||jQuery.event.customEvent[type])&&!jQuery.event.global[type]){return;}
event=typeof event==="object"?event[jQuery.expando]?event:new jQuery.Event(type,event):new jQuery.Event(type);event.type=type;event.isTrigger=true;event.exclusive=exclusive;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;ontype=type.indexOf(":")<0?"on"+type:"";if(!elem){cache=jQuery.cache;for(i in cache){if(cache[i].events&&cache[i].events[type]){jQuery.event.trigger(event,data,cache[i].handle.elem,true);}}
return;}
event.result=undefined;if(!event.target){event.target=elem;}
data=data!=null?jQuery.makeArray(data):[];data.unshift(event);special=jQuery.event.special[type]||{};if(special.trigger&&special.trigger.apply(elem,data)===false){return;}
eventPath=[[elem,special.bindType||type]];if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;cur=rfocusMorph.test(bubbleType+type)?elem:elem.parentNode;for(old=elem;cur;cur=cur.parentNode){eventPath.push([cur,bubbleType]);old=cur;}
if(old===(elem.ownerDocument||document)){eventPath.push([old.defaultView||old.parentWindow||window,bubbleType]);}}
for(i=0;i<eventPath.length&&!event.isPropagationStopped();i++){cur=eventPath[i][0];event.type=eventPath[i][1];handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle");if(handle){handle.apply(cur,data);}
handle=ontype&&cur[ontype];if(handle&&jQuery.acceptData(cur)&&handle.apply&&handle.apply(cur,data)===false){event.preventDefault();}}
event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(elem.ownerDocument,data)===false)&&!(type==="click"&&jQuery.nodeName(elem,"a"))&&jQuery.acceptData(elem)){if(ontype&&elem[type]&&((type!=="focus"&&type!=="blur")||event.target.offsetWidth!==0)&&!jQuery.isWindow(elem)){old=elem[ontype];if(old){elem[ontype]=null;}
jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(old){elem[ontype]=old;}}}}
return event.result;},dispatch:function(event){event=jQuery.event.fix(event||window.event);var i,j,cur,ret,selMatch,matched,matches,handleObj,sel,related,handlers=((jQuery._data(this,"events")||{})[event.type]||[]),delegateCount=handlers.delegateCount,args=core_slice.call(arguments),run_all=!event.exclusive&&!event.namespace,special=jQuery.event.special[event.type]||{},handlerQueue=[];args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return;}
if(delegateCount&&!(event.button&&event.type==="click")){for(cur=event.target;cur!=this;cur=cur.parentNode||this){if(cur.disabled!==true||event.type!=="click"){selMatch={};matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector;if(selMatch[sel]===undefined){selMatch[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length;}
if(selMatch[sel]){matches.push(handleObj);}}
if(matches.length){handlerQueue.push({elem:cur,matches:matches});}}}}
if(handlers.length>delegateCount){handlerQueue.push({elem:this,matches:handlers.slice(delegateCount)});}
for(i=0;i<handlerQueue.length&&!event.isPropagationStopped();i++){matched=handlerQueue[i];event.currentTarget=matched.elem;for(j=0;j<matched.matches.length&&!event.isImmediatePropagationStopped();j++){handleObj=matched.matches[j];if(run_all||(!event.namespace&&!handleObj.namespace)||event.namespace_re&&event.namespace_re.test(handleObj.namespace)){event.data=handleObj.data;event.handleObj=handleObj;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){event.result=ret;if(ret===false){event.preventDefault();event.stopPropagation();}}}}}
if(special.postDispatch){special.postDispatch.call(this,event);}
return event.result;},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode;}
return event;}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button,fromElement=original.fromElement;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0);}
if(!event.relatedTarget&&fromElement){event.relatedTarget=fromElement===event.target?original.toElement:fromElement;}
if(!event.which&&button!==undefined){event.which=(button&1?1:(button&2?3:(button&4?2:0)));}
return event;}},fix:function(event){if(event[jQuery.expando]){return event;}
var i,prop,originalEvent=event,fixHook=jQuery.event.fixHooks[event.type]||{},copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=jQuery.Event(originalEvent);for(i=copy.length;i;){prop=copy[--i];event[prop]=originalEvent[prop];}
if(!event.target){event.target=originalEvent.srcElement||document;}
if(event.target.nodeType===3){event.target=event.target.parentNode;}
event.metaKey=!!event.metaKey;return fixHook.filter?fixHook.filter(event,originalEvent):event;},special:{load:{noBubble:true},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(data,namespaces,eventHandle){if(jQuery.isWindow(this)){this.onbeforeunload=eventHandle;}},teardown:function(namespaces,eventHandle){if(this.onbeforeunload===eventHandle){this.onbeforeunload=null;}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event(),event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem);}else{jQuery.event.dispatch.call(elem,e);}
if(e.isDefaultPrevented()){event.preventDefault();}}};jQuery.event.handle=jQuery.event.dispatch;jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false);}}:function(elem,type,handle){var name="on"+type;if(elem.detachEvent){if(typeof elem[name]==="undefined"){elem[name]=null;}
elem.detachEvent(name,handle);}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props);}
if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=(src.defaultPrevented||src.returnValue===false||src.getPreventDefault&&src.getPreventDefault())?returnTrue:returnFalse;}else{this.type=src;}
if(props){jQuery.extend(this,props);}
this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true;};function returnFalse(){return false;}
function returnTrue(){return true;}
jQuery.Event.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e){return;}
if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e){return;}
if(e.stopPropagation){e.stopPropagation();}
e.cancelBubble=true;},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation();},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj,selector=handleObj.selector;if(!related||(related!==target&&!jQuery.contains(target,related))){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix;}
return ret;}};});if(!jQuery.support.submitBubbles){jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form")){return false;}
jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:undefined;if(form&&!jQuery._data(form,"_submit_attached")){jQuery.event.add(form,"submit._submit",function(event){event._submit_bubble=true;});jQuery._data(form,"_submit_attached",true);}});},postDispatch:function(event){if(event._submit_bubble){delete event._submit_bubble;if(this.parentNode&&!event.isTrigger){jQuery.event.simulate("submit",this.parentNode,event,true);}}},teardown:function(){if(jQuery.nodeName(this,"form")){return false;}
jQuery.event.remove(this,"._submit");}};}
if(!jQuery.support.changeBubbles){jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){jQuery.event.add(this,"propertychange._change",function(event){if(event.originalEvent.propertyName==="checked"){this._just_changed=true;}});jQuery.event.add(this,"click._change",function(event){if(this._just_changed&&!event.isTrigger){this._just_changed=false;}
jQuery.event.simulate("change",this,event,true);});}
return false;}
jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;if(rformElems.test(elem.nodeName)&&!jQuery._data(elem,"_change_attached")){jQuery.event.add(elem,"change._change",function(event){if(this.parentNode&&!event.isSimulated&&!event.isTrigger){jQuery.event.simulate("change",this.parentNode,event,true);}});jQuery._data(elem,"_change_attached",true);}});},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||(elem.type!=="radio"&&elem.type!=="checkbox")){return event.handleObj.handler.apply(this,arguments);}},teardown:function(){jQuery.event.remove(this,"._change");return!rformElems.test(this.nodeName);}};}
if(!jQuery.support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true);};jQuery.event.special[fix]={setup:function(){if(attaches++===0){document.addEventListener(orig,handler,true);}},teardown:function(){if(--attaches===0){document.removeEventListener(orig,handler,true);}}};});}
jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined;}
for(type in types){this.on(type,selector,data,types[type],one);}
return this;}
if(data==null&&fn==null){fn=selector;data=selector=undefined;}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined;}else{fn=data;data=selector;selector=undefined;}}
if(fn===false){fn=returnFalse;}else if(!fn){return this;}
if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments);};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++);}
return this.each(function(){jQuery.event.add(this,types,fn,data,selector);});},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1);},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this;}
if(typeof types==="object"){for(type in types){this.off(type,selector,types[type]);}
return this;}
if(selector===false||typeof selector==="function"){fn=selector;selector=undefined;}
if(fn===false){fn=returnFalse;}
return this.each(function(){jQuery.event.remove(this,types,fn,selector);});},bind:function(types,data,fn){return this.on(types,null,data,fn);},unbind:function(types,fn){return this.off(types,null,fn);},live:function(types,data,fn){jQuery(this.context).on(types,this.selector,data,fn);return this;},die:function(types,fn){jQuery(this.context).off(types,this.selector||"**",fn);return this;},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn);},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn);},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this);});},triggerHandler:function(type,data){if(this[0]){return jQuery.event.trigger(type,data,this[0],true);}},toggle:function(fn){var args=arguments,guid=fn.guid||jQuery.guid++,i=0,toggler=function(event){var lastToggle=(jQuery._data(this,"lastToggle"+fn.guid)||0)%i;jQuery._data(this,"lastToggle"+fn.guid,lastToggle+1);event.preventDefault();return args[lastToggle].apply(this,arguments)||false;};toggler.guid=guid;while(i<args.length){args[i++].guid=guid;}
return this.click(toggler);},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver);}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){if(fn==null){fn=data;data=null;}
return arguments.length>0?this.on(name,null,data,fn):this.trigger(name);};if(rkeyEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.keyHooks;}
if(rmouseEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.mouseHooks;}});(function(window,undefined){var cachedruns,assertGetIdNotName,Expr,getText,isXML,contains,compile,sortOrder,hasDuplicate,outermostContext,baseHasDuplicate=true,strundefined="undefined",expando=("sizcache"+Math.random()).replace(".",""),Token=String,document=window.document,docElem=document.documentElement,dirruns=0,done=0,pop=[].pop,push=[].push,slice=[].slice,indexOf=[].indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i;}}
return-1;},markFunction=function(fn,value){fn[expando]=value==null||value;return fn;},createCache=function(){var cache={},keys=[];return markFunction(function(key,value){if(keys.push(key)>Expr.cacheLength){delete cache[keys.shift()];}
return(cache[key+" "]=value);},cache);},classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),operators="([*^$|!~]?=)",attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:"+operators+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+attributes+")|[^:]|\\\\.)*|.*))\\)|)",pos=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([\\x20\\t\\r\\n\\f>+~])"+whitespace+"*"),rpseudo=new RegExp(pseudos),rquickExpr=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,rnot=/^:not/,rsibling=/[\x20\t\r\n\f]*[+~]/,rendsWithNot=/:not\($/,rheader=/h\d/i,rinputs=/input|select|textarea|button/i,rbackslash=/\\(?!\\)/g,matchExpr={"ID":new RegExp("^#("+characterEncoding+")"),"CLASS":new RegExp("^\\.("+characterEncoding+")"),"NAME":new RegExp("^\\[name=['\"]?("+characterEncoding+")['\"]?\\]"),"TAG":new RegExp("^("+characterEncoding.replace("w","w*")+")"),"ATTR":new RegExp("^"+attributes),"PSEUDO":new RegExp("^"+pseudos),"POS":new RegExp(pos,"i"),"CHILD":new RegExp("^:(only|nth|first|last)-child(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),"needsContext":new RegExp("^"+whitespace+"*[>+~]|"+pos,"i")},assert=function(fn){var div=document.createElement("div");try{return fn(div);}catch(e){return false;}finally{div=null;}},assertTagNameNoComments=assert(function(div){div.appendChild(document.createComment(""));return!div.getElementsByTagName("*").length;}),assertHrefNotNormalized=assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild&&typeof div.firstChild.getAttribute!==strundefined&&div.firstChild.getAttribute("href")==="#";}),assertAttributes=assert(function(div){div.innerHTML="<select></select>";var type=typeof div.lastChild.getAttribute("multiple");return type!=="boolean"&&type!=="string";}),assertUsableClassName=assert(function(div){div.innerHTML="<div class='hidden e'></div><div class='hidden'></div>";if(!div.getElementsByClassName||!div.getElementsByClassName("e").length){return false;}
div.lastChild.className="e";return div.getElementsByClassName("e").length===2;}),assertUsableName=assert(function(div){div.id=expando+0;div.innerHTML="<a name='"+expando+"'></a><div name='"+expando+"'></div>";docElem.insertBefore(div,docElem.firstChild);var pass=document.getElementsByName&&document.getElementsByName(expando).length===2+
document.getElementsByName(expando+0).length;assertGetIdNotName=!document.getElementById(expando);docElem.removeChild(div);return pass;});try{slice.call(docElem.childNodes,0)[0].nodeType;}catch(e){slice=function(i){var elem,results=[];for(;(elem=this[i]);i++){results.push(elem);}
return results;};}
function Sizzle(selector,context,results,seed){results=results||[];context=context||document;var match,elem,xml,m,nodeType=context.nodeType;if(!selector||typeof selector!=="string"){return results;}
if(nodeType!==1&&nodeType!==9){return[];}
xml=isXML(context);if(!xml&&!seed){if((match=rquickExpr.exec(selector))){if((m=match[1])){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results;}}else{return results;}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results;}}}else if(match[2]){push.apply(results,slice.call(context.getElementsByTagName(selector),0));return results;}else if((m=match[3])&&assertUsableClassName&&context.getElementsByClassName){push.apply(results,slice.call(context.getElementsByClassName(m),0));return results;}}}
return select(selector.replace(rtrim,"$1"),context,results,seed,xml);}
Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements);};Sizzle.matchesSelector=function(elem,expr){return Sizzle(expr,null,null,[elem]).length>0;};function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type;};}
function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type;};}
function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[(j=matchIndexes[i])]){seed[j]=!(matches[j]=seed[j]);}}});});}
getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent;}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem);}}}else if(nodeType===3||nodeType===4){return elem.nodeValue;}}else{for(;(node=elem[i]);i++){ret+=getText(node);}}
return ret;};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false;};contains=Sizzle.contains=docElem.contains?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&adown.contains&&adown.contains(bup));}:docElem.compareDocumentPosition?function(a,b){return b&&!!(a.compareDocumentPosition(b)&16);}:function(a,b){while((b=b.parentNode)){if(b===a){return true;}}
return false;};Sizzle.attr=function(elem,name){var val,xml=isXML(elem);if(!xml){name=name.toLowerCase();}
if((val=Expr.attrHandle[name])){return val(elem);}
if(xml||assertAttributes){return elem.getAttribute(name);}
val=elem.getAttributeNode(name);return val?typeof elem[name]==="boolean"?elem[name]?name:null:val.specified?val.value:null:null;};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:assertHrefNotNormalized?{}:{"href":function(elem){return elem.getAttribute("href",2);},"type":function(elem){return elem.getAttribute("type");}},find:{"ID":assertGetIdNotName?function(id,context,xml){if(typeof context.getElementById!==strundefined&&!xml){var m=context.getElementById(id);return m&&m.parentNode?[m]:[];}}:function(id,context,xml){if(typeof context.getElementById!==strundefined&&!xml){var m=context.getElementById(id);return m?m.id===id||typeof m.getAttributeNode!==strundefined&&m.getAttributeNode("id").value===id?[m]:undefined:[];}},"TAG":assertTagNameNoComments?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag);}}:function(tag,context){var results=context.getElementsByTagName(tag);if(tag==="*"){var elem,tmp=[],i=0;for(;(elem=results[i]);i++){if(elem.nodeType===1){tmp.push(elem);}}
return tmp;}
return results;},"NAME":assertUsableName&&function(tag,context){if(typeof context.getElementsByName!==strundefined){return context.getElementsByName(name);}},"CLASS":assertUsableClassName&&function(className,context,xml){if(typeof context.getElementsByClassName!==strundefined&&!xml){return context.getElementsByClassName(className);}}},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{"ATTR":function(match){match[1]=match[1].replace(rbackslash,"");match[3]=(match[4]||match[5]||"").replace(rbackslash,"");if(match[2]==="~="){match[3]=" "+match[3]+" ";}
return match.slice(0,4);},"CHILD":function(match){match[1]=match[1].toLowerCase();if(match[1]==="nth"){if(!match[2]){Sizzle.error(match[0]);}
match[3]=+(match[3]?match[4]+(match[5]||1):2*(match[2]==="even"||match[2]==="odd"));match[4]=+((match[6]+match[7])||match[2]==="odd");}else if(match[2]){Sizzle.error(match[0]);}
return match;},"PSEUDO":function(match){var unquoted,excess;if(matchExpr["CHILD"].test(match[0])){return null;}
if(match[3]){match[2]=match[3];}else if((unquoted=match[4])){if(rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){unquoted=unquoted.slice(0,excess);match[0]=match[0].slice(0,excess);}
match[2]=unquoted;}
return match.slice(0,3);}},filter:{"ID":assertGetIdNotName?function(id){id=id.replace(rbackslash,"");return function(elem){return elem.getAttribute("id")===id;};}:function(id){id=id.replace(rbackslash,"");return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===id;};},"TAG":function(nodeName){if(nodeName==="*"){return function(){return true;};}
nodeName=nodeName.replace(rbackslash,"").toLowerCase();return function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName;};},"CLASS":function(className){var pattern=classCache[expando][className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(elem.className||(typeof elem.getAttribute!==strundefined&&elem.getAttribute("class"))||"");});},"ATTR":function(name,operator,check){return function(elem,context){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!=";}
if(!operator){return true;}
result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.substr(result.length-check.length)===check:operator==="~="?(" "+result+" ").indexOf(check)>-1:operator==="|="?result===check||result.substr(0,check.length+1)===check+"-":false;};},"CHILD":function(type,argument,first,last){if(type==="nth"){return function(elem){var node,diff,parent=elem.parentNode;if(first===1&&last===0){return true;}
if(parent){diff=0;for(node=parent.firstChild;node;node=node.nextSibling){if(node.nodeType===1){diff++;if(elem===node){break;}}}}
diff-=last;return diff===first||(diff%first===0&&diff/first>=0);};}
return function(elem){var node=elem;switch(type){case"only":case"first":while((node=node.previousSibling)){if(node.nodeType===1){return false;}}
if(type==="first"){return true;}
node=elem;case"last":while((node=node.nextSibling)){if(node.nodeType===1){return false;}}
return true;}};},"PSEUDO":function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument);}
if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i]);}}):function(elem){return fn(elem,0,args);};}
return fn;}},pseudos:{"not":markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if((elem=unmatched[i])){seed[i]=!(matches[i]=elem);}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return!results.pop();};}),"has":markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0;};}),"contains":markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1;};}),"enabled":function(elem){return elem.disabled===false;},"disabled":function(elem){return elem.disabled===true;},"checked":function(elem){var nodeName=elem.nodeName.toLowerCase();return(nodeName==="input"&&!!elem.checked)||(nodeName==="option"&&!!elem.selected);},"selected":function(elem){if(elem.parentNode){elem.parentNode.selectedIndex;}
return elem.selected===true;},"parent":function(elem){return!Expr.pseudos["empty"](elem);},"empty":function(elem){var nodeType;elem=elem.firstChild;while(elem){if(elem.nodeName>"@"||(nodeType=elem.nodeType)===3||nodeType===4){return false;}
elem=elem.nextSibling;}
return true;},"header":function(elem){return rheader.test(elem.nodeName);},"text":function(elem){var type,attr;return elem.nodeName.toLowerCase()==="input"&&(type=elem.type)==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()===type);},"radio":createInputPseudo("radio"),"checkbox":createInputPseudo("checkbox"),"file":createInputPseudo("file"),"password":createInputPseudo("password"),"image":createInputPseudo("image"),"submit":createButtonPseudo("submit"),"reset":createButtonPseudo("reset"),"button":function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button";},"input":function(elem){return rinputs.test(elem.nodeName);},"focus":function(elem){var doc=elem.ownerDocument;return elem===doc.activeElement&&(!doc.hasFocus||doc.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex);},"active":function(elem){return elem===elem.ownerDocument.activeElement;},"first":createPositionalPseudo(function(){return[0];}),"last":createPositionalPseudo(function(matchIndexes,length){return[length-1];}),"eq":createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument];}),"even":createPositionalPseudo(function(matchIndexes,length){for(var i=0;i<length;i+=2){matchIndexes.push(i);}
return matchIndexes;}),"odd":createPositionalPseudo(function(matchIndexes,length){for(var i=1;i<length;i+=2){matchIndexes.push(i);}
return matchIndexes;}),"lt":createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;--i>=0;){matchIndexes.push(i);}
return matchIndexes;}),"gt":createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;){matchIndexes.push(i);}
return matchIndexes;})}};function siblingCheck(a,b,ret){if(a===b){return ret;}
var cur=a.nextSibling;while(cur){if(cur===b){return-1;}
cur=cur.nextSibling;}
return 1;}
sortOrder=docElem.compareDocumentPosition?function(a,b){if(a===b){hasDuplicate=true;return 0;}
return(!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition:a.compareDocumentPosition(b)&4)?-1:1;}:function(a,b){if(a===b){hasDuplicate=true;return 0;}else if(a.sourceIndex&&b.sourceIndex){return a.sourceIndex-b.sourceIndex;}
var al,bl,ap=[],bp=[],aup=a.parentNode,bup=b.parentNode,cur=aup;if(aup===bup){return siblingCheck(a,b);}else if(!aup){return-1;}else if(!bup){return 1;}
while(cur){ap.unshift(cur);cur=cur.parentNode;}
cur=bup;while(cur){bp.unshift(cur);cur=cur.parentNode;}
al=ap.length;bl=bp.length;for(var i=0;i<al&&i<bl;i++){if(ap[i]!==bp[i]){return siblingCheck(ap[i],bp[i]);}}
return i===al?siblingCheck(a,bp[i],-1):siblingCheck(ap[i],b,1);};[0,0].sort(sortOrder);baseHasDuplicate=!hasDuplicate;Sizzle.uniqueSort=function(results){var elem,duplicates=[],i=1,j=0;hasDuplicate=baseHasDuplicate;results.sort(sortOrder);if(hasDuplicate){for(;(elem=results[i]);i++){if(elem===results[i-1]){j=duplicates.push(i);}}
while(j--){results.splice(duplicates[j],1);}}
return results;};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg);};function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[expando][selector+" "];if(cached){return parseOnly?0:cached.slice(0);}
soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar;}
groups.push(tokens=[]);}
matched=false;if((match=rcombinators.exec(soFar))){tokens.push(matched=new Token(match.shift()));soFar=soFar.slice(matched.length);matched.type=match[0].replace(rtrim," ");}
for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){tokens.push(matched=new Token(match.shift()));soFar=soFar.slice(matched.length);matched.type=type;matched.matches=match;}}
if(!matched){break;}}
return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0);}
function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&combinator.dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while((elem=elem[dir])){if(checkNonElements||elem.nodeType===1){return matcher(elem,context,xml);}}}:function(elem,context,xml){if(!xml){var cache,dirkey=dirruns+" "+doneName+" ",cachedkey=dirkey+cachedruns;while((elem=elem[dir])){if(checkNonElements||elem.nodeType===1){if((cache=elem[expando])===cachedkey){return elem.sizset;}else if(typeof cache==="string"&&cache.indexOf(dirkey)===0){if(elem.sizset){return elem;}}else{elem[expando]=cachedkey;if(matcher(elem,context,xml)){elem.sizset=true;return elem;}
elem.sizset=false;}}}}else{while((elem=elem[dir])){if(checkNonElements||elem.nodeType===1){if(matcher(elem,context,xml)){return elem;}}}}};}
function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false;}}
return true;}:matchers[0];}
function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if((elem=unmatched[i])){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i);}}}}
return newUnmatched;}
function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter);}
if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector);}
return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml);}
if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if((elem=temp[i])){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem);}}}
if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if((elem=matcherOut[i])){temp.push((matcherIn[i]=elem));}}
postFinder(null,(matcherOut=[]),temp,xml);}
i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem);}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml);}else{push.apply(results,matcherOut);}}});}
function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext;},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1;},implicitRelative,true),matchers=[function(elem,context,xml){return(!leadingRelative&&(xml||context!==outermostContext))||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));}];for(;i<len;i++){if((matcher=Expr.relative[tokens[i].type])){matchers=[addCombinator(elementMatcher(matchers),matcher)];}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break;}}
return setMatcher(i>1&&elementMatcher(matchers),i>1&&tokens.slice(0,i-1).join("").replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens((tokens=tokens.slice(j))),j<len&&tokens.join(""));}
matchers.push(matcher);}}
return elementMatcher(matchers);}
function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,expandContext){var elem,j,matcher,setMatched=[],matchedCount=0,i="0",unmatched=seed&&[],outermost=expandContext!=null,contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",expandContext&&context.parentNode||context),dirrunsUnique=(dirruns+=contextBackup==null?1:Math.E);if(outermost){outermostContext=context!==document&&context;cachedruns=superMatcher.el;}
for(;(elem=elems[i])!=null;i++){if(byElement&&elem){for(j=0;(matcher=elementMatchers[j]);j++){if(matcher(elem,context,xml)){results.push(elem);break;}}
if(outermost){dirruns=dirrunsUnique;cachedruns=++superMatcher.el;}}
if(bySet){if((elem=!matcher&&elem)){matchedCount--;}
if(seed){unmatched.push(elem);}}}
matchedCount+=i;if(bySet&&i!==matchedCount){for(j=0;(matcher=setMatchers[j]);j++){matcher(unmatched,setMatched,context,xml);}
if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results);}}}
setMatched=condense(setMatched);}
push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&(matchedCount+setMatchers.length)>1){Sizzle.uniqueSort(results);}}
if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup;}
return unmatched;};superMatcher.el=0;return bySet?markFunction(superMatcher):superMatcher;}
compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[expando][selector+" "];if(!cached){if(!group){group=tokenize(selector);}
i=group.length;while(i--){cached=matcherFromTokens(group[i]);if(cached[expando]){setMatchers.push(cached);}else{elementMatchers.push(cached);}}
cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));}
return cached;};function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results);}
return results;}
function select(selector,context,results,seed,xml){var i,tokens,token,type,find,match=tokenize(selector),j=match.length;if(!seed){if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&context.nodeType===9&&!xml&&Expr.relative[tokens[1].type]){context=Expr.find["ID"](token.matches[0].replace(rbackslash,""),context,xml)[0];if(!context){return results;}
selector=selector.slice(tokens.shift().length);}
for(i=matchExpr["POS"].test(selector)?-1:tokens.length-1;i>=0;i--){token=tokens[i];if(Expr.relative[(type=token.type)]){break;}
if((find=Expr.find[type])){if((seed=find(token.matches[0].replace(rbackslash,""),rsibling.test(tokens[0].type)&&context.parentNode||context,xml))){tokens.splice(i,1);selector=seed.length&&tokens.join("");if(!selector){push.apply(results,slice.call(seed,0));return results;}
break;}}}}}
compile(selector,match)(seed,context,xml,results,rsibling.test(selector));return results;}
if(document.querySelectorAll){(function(){var disconnectedMatch,oldSelect=select,rescape=/'|\\/g,rattributeQuotes=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,rbuggyQSA=[":focus"],rbuggyMatches=[":active"],matches=docElem.matchesSelector||docElem.mozMatchesSelector||docElem.webkitMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector;assert(function(div){div.innerHTML="<select><option selected=''></option></select>";if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)");}
if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked");}});assert(function(div){div.innerHTML="<p test=''></p>";if(div.querySelectorAll("[test^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:\"\"|'')");}
div.innerHTML="<input type='hidden'/>";if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled");}});rbuggyQSA=new RegExp(rbuggyQSA.join("|"));select=function(selector,context,results,seed,xml){if(!seed&&!xml&&!rbuggyQSA.test(selector)){var groups,i,old=true,nid=expando,newContext=context,newSelector=context.nodeType===9&&selector;if(context.nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if((old=context.getAttribute("id"))){nid=old.replace(rescape,"\\$&");}else{context.setAttribute("id",nid);}
nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+groups[i].join("");}
newContext=rsibling.test(selector)&&context.parentNode||context;newSelector=groups.join(",");}
if(newSelector){try{push.apply(results,slice.call(newContext.querySelectorAll(newSelector),0));return results;}catch(qsaError){}finally{if(!old){context.removeAttribute("id");}}}}
return oldSelect(selector,context,results,seed,xml);};if(matches){assert(function(div){disconnectedMatch=matches.call(div,"div");try{matches.call(div,"[test!='']:sizzle");rbuggyMatches.push("!=",pseudos);}catch(e){}});rbuggyMatches=new RegExp(rbuggyMatches.join("|"));Sizzle.matchesSelector=function(elem,expr){expr=expr.replace(rattributeQuotes,"='$1']");if(!isXML(elem)&&!rbuggyMatches.test(expr)&&!rbuggyQSA.test(expr)){try{var ret=matches.call(elem,expr);if(ret||disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret;}}catch(e){}}
return Sizzle(expr,null,null,[elem]).length>0;};}})();}
Expr.pseudos["nth"]=Expr.pseudos["eq"];function setFilters(){}
Expr.filters=setFilters.prototype=Expr.pseudos;Expr.setFilters=new setFilters();Sizzle.attr=jQuery.attr;jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;})(window);var runtil=/Until$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,isSimple=/^.[^:#\[\.,]*$/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({find:function(selector){var i,l,length,n,r,ret,self=this;if(typeof selector!=="string"){return jQuery(selector).filter(function(){for(i=0,l=self.length;i<l;i++){if(jQuery.contains(self[i],this)){return true;}}});}
ret=this.pushStack("","find",selector);for(i=0,l=this.length;i<l;i++){length=ret.length;jQuery.find(selector,this[i],ret);if(i>0){for(n=length;n<ret.length;n++){for(r=0;r<length;r++){if(ret[r]===ret[n]){ret.splice(n--,1);break;}}}}}
return ret;},has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;i<len;i++){if(jQuery.contains(this,targets[i])){return true;}}});},not:function(selector){return this.pushStack(winnow(this,selector,false),"not",selector);},filter:function(selector){return this.pushStack(winnow(this,selector,true),"filter",selector);},is:function(selector){return!!selector&&(typeof selector==="string"?rneedsContext.test(selector)?jQuery(selector,this.context).index(this[0])>=0:jQuery.filter(selector,this).length>0:this.filter(selector).length>0);},closest:function(selectors,context){var cur,i=0,l=this.length,ret=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){cur=this[i];while(cur&&cur.ownerDocument&&cur!==context&&cur.nodeType!==11){if(pos?pos.index(cur)>-1:jQuery.find.matchesSelector(cur,selectors)){ret.push(cur);break;}
cur=cur.parentNode;}}
ret=ret.length>1?jQuery.unique(ret):ret;return this.pushStack(ret,"closest",selectors);},index:function(elem){if(!elem){return(this[0]&&this[0].parentNode)?this.prevAll().length:-1;}
if(typeof elem==="string"){return jQuery.inArray(this[0],jQuery(elem));}
return jQuery.inArray(elem.jquery?elem[0]:elem,this);},add:function(selector,context){var set=typeof selector==="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(isDisconnected(set[0])||isDisconnected(all[0])?all:jQuery.unique(all));},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));}});jQuery.fn.andSelf=jQuery.fn.addBack;function isDisconnected(node){return!node||!node.parentNode||node.parentNode.nodeType===11;}
function sibling(cur,dir){do{cur=cur[dir];}while(cur&&cur.nodeType!==1);return cur;}
jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null;},parents:function(elem){return jQuery.dir(elem,"parentNode");},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until);},next:function(elem){return sibling(elem,"nextSibling");},prev:function(elem){return sibling(elem,"previousSibling");},nextAll:function(elem){return jQuery.dir(elem,"nextSibling");},prevAll:function(elem){return jQuery.dir(elem,"previousSibling");},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until);},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until);},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem);},children:function(elem){return jQuery.sibling(elem.firstChild);},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes);}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);if(!runtil.test(name)){selector=until;}
if(selector&&typeof selector==="string"){ret=jQuery.filter(selector,ret);}
ret=this.length>1&&!guaranteedUnique[name]?jQuery.unique(ret):ret;if(this.length>1&&rparentsprev.test(name)){ret=ret.reverse();}
return this.pushStack(ret,name,core_slice.call(arguments).join(","));};});jQuery.extend({filter:function(expr,elems,not){if(not){expr=":not("+expr+")";}
return elems.length===1?jQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:jQuery.find.matches(expr,elems);},dir:function(elem,dir,until){var matched=[],cur=elem[dir];while(cur&&cur.nodeType!==9&&(until===undefined||cur.nodeType!==1||!jQuery(cur).is(until))){if(cur.nodeType===1){matched.push(cur);}
cur=cur[dir];}
return matched;},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){r.push(n);}}
return r;}});function winnow(elements,qualifier,keep){qualifier=qualifier||0;if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){var retVal=!!qualifier.call(elem,i,elem);return retVal===keep;});}else if(qualifier.nodeType){return jQuery.grep(elements,function(elem,i){return(elem===qualifier)===keep;});}else if(typeof qualifier==="string"){var filtered=jQuery.grep(elements,function(elem){return elem.nodeType===1;});if(isSimple.test(qualifier)){return jQuery.filter(qualifier,filtered,!keep);}else{qualifier=jQuery.filter(qualifier,filtered);}}
return jQuery.grep(elements,function(elem,i){return(jQuery.inArray(elem,qualifier)>=0)===keep;});}
function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement){while(list.length){safeFrag.createElement(list.pop());}}
return safeFrag;}
var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|"+"header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rnocache=/<(?:script|object|embed|option|style)/i,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rcheckableType=/^(?:checkbox|radio)$/,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/\/(java|ecma)script/i,rcleanScript=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;if(!jQuery.support.htmlSerialize){wrapMap._default=[1,"X<div>","</div>"];}
jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value));},null,value,arguments.length);},wrapAll:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i));});}
if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0]);}
wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1){elem=elem.firstChild;}
return elem;}).append(this);}
return this;},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i));});}
return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html);}else{self.append(html);}});},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html);});},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes);}}).end();},append:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1||this.nodeType===11){this.appendChild(elem);}});},prepend:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1||this.nodeType===11){this.insertBefore(elem,this.firstChild);}});},before:function(){if(!isDisconnected(this[0])){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this);});}
if(arguments.length){var set=jQuery.clean(arguments);return this.pushStack(jQuery.merge(set,this),"before",this.selector);}},after:function(){if(!isDisconnected(this[0])){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this.nextSibling);});}
if(arguments.length){var set=jQuery.clean(arguments);return this.pushStack(jQuery.merge(this,set),"after",this.selector);}},remove:function(selector,keepData){var elem,i=0;for(;(elem=this[i])!=null;i++){if(!selector||jQuery.filter(selector,[elem]).length){if(!keepData&&elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));jQuery.cleanData([elem]);}
if(elem.parentNode){elem.parentNode.removeChild(elem);}}}
return this;},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));}
while(elem.firstChild){elem.removeChild(elem.firstChild);}}
return this;},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents);});},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined){return elem.nodeType===1?elem.innerHTML.replace(rinlinejQuery,""):undefined;}
if(typeof value==="string"&&!rnoInnerhtml.test(value)&&(jQuery.support.htmlSerialize||!rnoshimcache.test(value))&&(jQuery.support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));elem.innerHTML=value;}}
elem=0;}catch(e){}}
if(elem){this.empty().append(value);}},null,value,arguments.length);},replaceWith:function(value){if(!isDisconnected(this[0])){if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this),old=self.html();self.replaceWith(value.call(this,i,old));});}
if(typeof value!=="string"){value=jQuery(value).detach();}
return this.each(function(){var next=this.nextSibling,parent=this.parentNode;jQuery(this).remove();if(next){jQuery(next).before(value);}else{jQuery(parent).append(value);}});}
return this.length?this.pushStack(jQuery(jQuery.isFunction(value)?value():value),"replaceWith",value):this;},detach:function(selector){return this.remove(selector,true);},domManip:function(args,table,callback){args=[].concat.apply([],args);var results,first,fragment,iNoClone,i=0,value=args[0],scripts=[],l=this.length;if(!jQuery.support.checkClone&&l>1&&typeof value==="string"&&rchecked.test(value)){return this.each(function(){jQuery(this).domManip(args,table,callback);});}
if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this);args[0]=value.call(this,i,table?self.html():undefined);self.domManip(args,table,callback);});}
if(this[0]){results=jQuery.buildFragment(args,this,scripts);fragment=results.fragment;first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first;}
if(first){table=table&&jQuery.nodeName(first,"tr");for(iNoClone=results.cacheable||l-1;i<l;i++){callback.call(table&&jQuery.nodeName(this[i],"table")?findOrAppend(this[i],"tbody"):this[i],i===iNoClone?fragment:jQuery.clone(fragment,true,true));}}
fragment=first=null;if(scripts.length){jQuery.each(scripts,function(i,elem){if(elem.src){if(jQuery.ajax){jQuery.ajax({url:elem.src,type:"GET",dataType:"script",async:false,global:false,"throws":true});}else{jQuery.error("no ajax");}}else{jQuery.globalEval((elem.text||elem.textContent||elem.innerHTML||"").replace(rcleanScript,""));}
if(elem.parentNode){elem.parentNode.removeChild(elem);}});}}
return this;}});function findOrAppend(elem,tag){return elem.getElementsByTagName(tag)[0]||elem.appendChild(elem.ownerDocument.createElement(tag));}
function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src)){return;}
var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;curData.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i]);}}}
if(curData.data){curData.data=jQuery.extend({},curData.data);}}
function cloneFixAttributes(src,dest){var nodeName;if(dest.nodeType!==1){return;}
if(dest.clearAttributes){dest.clearAttributes();}
if(dest.mergeAttributes){dest.mergeAttributes(src);}
nodeName=dest.nodeName.toLowerCase();if(nodeName==="object"){if(dest.parentNode){dest.outerHTML=src.outerHTML;}
if(jQuery.support.html5Clone&&(src.innerHTML&&!jQuery.trim(dest.innerHTML))){dest.innerHTML=src.innerHTML;}}else if(nodeName==="input"&&rcheckableType.test(src.type)){dest.defaultChecked=dest.checked=src.checked;if(dest.value!==src.value){dest.value=src.value;}}else if(nodeName==="option"){dest.selected=src.defaultSelected;}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue;}else if(nodeName==="script"&&dest.text!==src.text){dest.text=src.text;}
dest.removeAttribute(jQuery.expando);}
jQuery.buildFragment=function(args,context,scripts){var fragment,cacheable,cachehit,first=args[0];context=context||document;context=!context.nodeType&&context[0]||context;context=context.ownerDocument||context;if(args.length===1&&typeof first==="string"&&first.length<512&&context===document&&first.charAt(0)==="<"&&!rnocache.test(first)&&(jQuery.support.checkClone||!rchecked.test(first))&&(jQuery.support.html5Clone||!rnoshimcache.test(first))){cacheable=true;fragment=jQuery.fragments[first];cachehit=fragment!==undefined;}
if(!fragment){fragment=context.createDocumentFragment();jQuery.clean(args,context,fragment,scripts);if(cacheable){jQuery.fragments[first]=cachehit&&fragment;}}
return{fragment:fragment,cacheable:cacheable};};jQuery.fragments={};jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,i=0,ret=[],insert=jQuery(selector),l=insert.length,parent=this.length===1&&this[0].parentNode;if((parent==null||parent&&parent.nodeType===11&&parent.childNodes.length===1)&&l===1){insert[original](this[0]);return this;}else{for(;i<l;i++){elems=(i>0?this.clone(true):this).get();jQuery(insert[i])[original](elems);ret=ret.concat(elems);}
return this.pushStack(ret,name,insert.selector);}};});function getAll(elem){if(typeof elem.getElementsByTagName!=="undefined"){return elem.getElementsByTagName("*");}else if(typeof elem.querySelectorAll!=="undefined"){return elem.querySelectorAll("*");}else{return[];}}
function fixDefaultChecked(elem){if(rcheckableType.test(elem.type)){elem.defaultChecked=elem.checked;}}
jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var srcElements,destElements,i,clone;if(jQuery.support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")){clone=elem.cloneNode(true);}else{fragmentDiv.innerHTML=elem.outerHTML;fragmentDiv.removeChild(clone=fragmentDiv.firstChild);}
if((!jQuery.support.noCloneEvent||!jQuery.support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){cloneFixAttributes(elem,clone);srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){if(destElements[i]){cloneFixAttributes(srcElements[i],destElements[i]);}}}
if(dataAndEvents){cloneCopyEvent(elem,clone);if(deepDataAndEvents){srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){cloneCopyEvent(srcElements[i],destElements[i]);}}}
srcElements=destElements=null;return clone;},clean:function(elems,context,fragment,scripts){var i,j,elem,tag,wrap,depth,div,hasBody,tbody,len,handleScript,jsTags,safe=context===document&&safeFragment,ret=[];if(!context||typeof context.createDocumentFragment==="undefined"){context=document;}
for(i=0;(elem=elems[i])!=null;i++){if(typeof elem==="number"){elem+="";}
if(!elem){continue;}
if(typeof elem==="string"){if(!rhtml.test(elem)){elem=context.createTextNode(elem);}else{safe=safe||createSafeFragment(context);div=context.createElement("div");safe.appendChild(div);elem=elem.replace(rxhtmlTag,"<$1></$2>");tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;depth=wrap[0];div.innerHTML=wrap[1]+elem+wrap[2];while(depth--){div=div.lastChild;}
if(!jQuery.support.tbody){hasBody=rtbody.test(elem);tbody=tag==="table"&&!hasBody?div.firstChild&&div.firstChild.childNodes:wrap[1]==="<table>"&&!hasBody?div.childNodes:[];for(j=tbody.length-1;j>=0;--j){if(jQuery.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length){tbody[j].parentNode.removeChild(tbody[j]);}}}
if(!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(elem)){div.insertBefore(context.createTextNode(rleadingWhitespace.exec(elem)[0]),div.firstChild);}
elem=div.childNodes;div.parentNode.removeChild(div);}}
if(elem.nodeType){ret.push(elem);}else{jQuery.merge(ret,elem);}}
if(div){elem=div=safe=null;}
if(!jQuery.support.appendChecked){for(i=0;(elem=ret[i])!=null;i++){if(jQuery.nodeName(elem,"input")){fixDefaultChecked(elem);}else if(typeof elem.getElementsByTagName!=="undefined"){jQuery.grep(elem.getElementsByTagName("input"),fixDefaultChecked);}}}
if(fragment){handleScript=function(elem){if(!elem.type||rscriptType.test(elem.type)){return scripts?scripts.push(elem.parentNode?elem.parentNode.removeChild(elem):elem):fragment.appendChild(elem);}};for(i=0;(elem=ret[i])!=null;i++){if(!(jQuery.nodeName(elem,"script")&&handleScript(elem))){fragment.appendChild(elem);if(typeof elem.getElementsByTagName!=="undefined"){jsTags=jQuery.grep(jQuery.merge([],elem.getElementsByTagName("script")),handleScript);ret.splice.apply(ret,[i+1,0].concat(jsTags));i+=jsTags.length;}}}}
return ret;},cleanData:function(elems,acceptData){var data,id,elem,type,i=0,internalKey=jQuery.expando,cache=jQuery.cache,deleteExpando=jQuery.support.deleteExpando,special=jQuery.event.special;for(;(elem=elems[i])!=null;i++){if(acceptData||jQuery.acceptData(elem)){id=elem[internalKey];data=id&&cache[id];if(data){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type);}else{jQuery.removeEvent(elem,type,data.handle);}}}
if(cache[id]){delete cache[id];if(deleteExpando){delete elem[internalKey];}else if(elem.removeAttribute){elem.removeAttribute(internalKey);}else{elem[internalKey]=null;}
jQuery.deletedIds.push(id);}}}}}});(function(){var matched,browser;jQuery.uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"};};matched=jQuery.uaMatch(navigator.userAgent);browser={};if(matched.browser){browser[matched.browser]=true;browser.version=matched.version;}
if(browser.chrome){browser.webkit=true;}else if(browser.webkit){browser.safari=true;}
jQuery.browser=browser;jQuery.sub=function(){function jQuerySub(selector,context){return new jQuerySub.fn.init(selector,context);}
jQuery.extend(true,jQuerySub,this);jQuerySub.superclass=this;jQuerySub.fn=jQuerySub.prototype=this();jQuerySub.fn.constructor=jQuerySub;jQuerySub.sub=this.sub;jQuerySub.fn.init=function init(selector,context){if(context&&context instanceof jQuery&&!(context instanceof jQuerySub)){context=jQuerySub(context);}
return jQuery.fn.init.call(this,selector,context,rootjQuerySub);};jQuerySub.fn.init.prototype=jQuerySub.fn;var rootjQuerySub=jQuerySub(document);return jQuerySub;};})();var curCSS,iframe,iframeDoc,ralpha=/alpha\([^)]*\)/i,ropacity=/opacity=([^)]*)/,rposition=/^(top|right|bottom|left)$/,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([-+])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"],eventsToggle=jQuery.fn.toggle;function vendorPropName(style,name){if(name in style){return name;}
var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name;}}
return origName;}
function isHidden(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem);}
function showHide(elements,show){var elem,display,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue;}
values[index]=jQuery._data(elem,"olddisplay");if(show){if(!values[index]&&elem.style.display==="none"){elem.style.display="";}
if(elem.style.display===""&&isHidden(elem)){values[index]=jQuery._data(elem,"olddisplay",css_defaultDisplay(elem.nodeName));}}else{display=curCSS(elem,"display");if(!values[index]&&display!=="none"){jQuery._data(elem,"olddisplay",display);}}}
for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue;}
if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none";}}
return elements;}
jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name);},name,value,arguments.length>1);},show:function(){return showHide(this,true);},hide:function(){return showHide(this);},toggle:function(state,fn2){var bool=typeof state==="boolean";if(jQuery.isFunction(state)&&jQuery.isFunction(fn2)){return eventsToggle.apply(this,arguments);}
return this.each(function(){if(bool?state:isHidden(this)){jQuery(this).show();}else{jQuery(this).hide();}});}});jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret;}}}},cssNumber:{"fillOpacity":true,"fontWeight":true,"lineHeight":true,"opacity":true,"orphans":true,"widows":true,"zIndex":true,"zoom":true},cssProps:{"float":jQuery.support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return;}
var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number";}
if(value==null||type==="number"&&isNaN(value)){return;}
if(type==="number"&&!jQuery.cssNumber[origName]){value+="px";}
if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){try{style[name]=value;}catch(e){}}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret;}
return style[name];}},css:function(elem,name,numeric,extra){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra);}
if(val===undefined){val=curCSS(elem,name);}
if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name];}
if(numeric||extra!==undefined){num=parseFloat(val);return numeric||jQuery.isNumeric(num)?num||0:val;}
return val;},swap:function(elem,options,callback){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name];}
ret=callback.call(elem);for(name in options){elem.style[name]=old[name];}
return ret;}});if(window.getComputedStyle){curCSS=function(elem,name){var ret,width,minWidth,maxWidth,computed=window.getComputedStyle(elem,null),style=elem.style;if(computed){ret=computed.getPropertyValue(name)||computed[name];if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name);}
if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth;}}
return ret;};}else if(document.documentElement.currentStyle){curCSS=function(elem,name){var left,rsLeft,ret=elem.currentStyle&&elem.currentStyle[name],style=elem.style;if(ret==null&&style&&style[name]){ret=style[name];}
if(rnumnonpx.test(ret)&&!rposition.test(name)){left=style.left;rsLeft=elem.runtimeStyle&&elem.runtimeStyle.left;if(rsLeft){elem.runtimeStyle.left=elem.currentStyle.left;}
style.left=name==="fontSize"?"1em":ret;ret=style.pixelLeft+"px";style.left=left;if(rsLeft){elem.runtimeStyle.left=rsLeft;}}
return ret===""?"auto":ret;};}
function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value;}
function augmentWidthOrHeight(elem,name,extra,isBorderBox){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true);}
if(isBorderBox){if(extra==="content"){val-=parseFloat(curCSS(elem,"padding"+cssExpand[i]))||0;}
if(extra!=="margin"){val-=parseFloat(curCSS(elem,"border"+cssExpand[i]+"Width"))||0;}}else{val+=parseFloat(curCSS(elem,"padding"+cssExpand[i]))||0;if(extra!=="padding"){val+=parseFloat(curCSS(elem,"border"+cssExpand[i]+"Width"))||0;}}}
return val;}
function getWidthOrHeight(elem,name,extra){var val=name==="width"?elem.offsetWidth:elem.offsetHeight,valueIsBorderBox=true,isBorderBox=jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing")==="border-box";if(val<=0||val==null){val=curCSS(elem,name);if(val<0||val==null){val=elem.style[name];}
if(rnumnonpx.test(val)){return val;}
valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]);val=parseFloat(val)||0;}
return(val+
augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox))+"px";}
function css_defaultDisplay(nodeName){if(elemdisplay[nodeName]){return elemdisplay[nodeName];}
var elem=jQuery("<"+nodeName+">").appendTo(document.body),display=elem.css("display");elem.remove();if(display==="none"||display===""){iframe=document.body.appendChild(iframe||jQuery.extend(document.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!iframeDoc||!iframe.createElement){iframeDoc=(iframe.contentWindow||iframe.contentDocument).document;iframeDoc.write("<!doctype html><html><body>");iframeDoc.close();}
elem=iframeDoc.body.appendChild(iframeDoc.createElement(nodeName));display=curCSS(elem,"display");document.body.removeChild(iframe);}
elemdisplay[nodeName]=display;return display;}
jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){if(elem.offsetWidth===0&&rdisplayswap.test(curCSS(elem,"display"))){return jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra);});}else{return getWidthOrHeight(elem,name,extra);}}},set:function(elem,value,extra){return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing")==="border-box"):0);}};});if(!jQuery.support.opacity){jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?(0.01*parseFloat(RegExp.$1))+"":computed?"1":"";},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if(value>=1&&jQuery.trim(filter.replace(ralpha,""))===""&&style.removeAttribute){style.removeAttribute("filter");if(currentStyle&&!currentStyle.filter){return;}}
style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity;}};}
jQuery(function(){if(!jQuery.support.reliableMarginRight){jQuery.cssHooks.marginRight={get:function(elem,computed){return jQuery.swap(elem,{"display":"inline-block"},function(){if(computed){return curCSS(elem,"marginRight");}});}};}
if(!jQuery.support.pixelPosition&&jQuery.fn.position){jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){if(computed){var ret=curCSS(elem,prop);return rnumnonpx.test(ret)?jQuery(elem).position()[prop]+"px":ret;}}};});}});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){return(elem.offsetWidth===0&&elem.offsetHeight===0)||(!jQuery.support.reliableHiddenOffsets&&((elem.style&&elem.style.display)||curCSS(elem,"display"))==="none");};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem);};}
jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i,parts=typeof value==="string"?value.split(" "):[value],expanded={};for(i=0;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];}
return expanded;}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber;}});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rinput=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,rselectTextarea=/^(?:select|textarea)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray());},serializeArray:function(){return this.map(function(){return this.elements?jQuery.makeArray(this.elements):this;}).filter(function(){return this.name&&!this.disabled&&(this.checked||rselectTextarea.test(this.nodeName)||rinput.test(this.type));}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val,i){return{name:elem.name,value:val.replace(rCRLF,"\r\n")};}):{name:elem.name,value:val.replace(rCRLF,"\r\n")};}).get();}});jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():(value==null?"":value);s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value);};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional;}
if(jQuery.isArray(a)||(a.jquery&&!jQuery.isPlainObject(a))){jQuery.each(a,function(){add(this.name,this.value);});}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add);}}
return s.join("&").replace(r20,"+");};function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v);}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add);}});}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add);}}else{add(prefix,obj);}}
var
ajaxLocParts,ajaxLocation,rhash=/#.*$/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,rlocalProtocol=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rquery=/\?/,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,rts=/([?&])_=[^&]*/,rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes=["*/"]+["*"];try{ajaxLocation=location.href;}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href;}
ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*";}
var dataType,list,placeBefore,dataTypes=dataTypeExpression.toLowerCase().split(core_rspace),i=0,length=dataTypes.length;if(jQuery.isFunction(func)){for(;i<length;i++){dataType=dataTypes[i];placeBefore=/^\+/.test(dataType);if(placeBefore){dataType=dataType.substr(1)||"*";}
list=structure[dataType]=structure[dataType]||[];list[placeBefore?"unshift":"push"](func);}}};}
function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,dataType,inspected){dataType=dataType||options.dataTypes[0];inspected=inspected||{};inspected[dataType]=true;var selection,list=structure[dataType],i=0,length=list?list.length:0,executeOnly=(structure===prefilters);for(;i<length&&(executeOnly||!selection);i++){selection=list[i](options,originalOptions,jqXHR);if(typeof selection==="string"){if(!executeOnly||inspected[selection]){selection=undefined;}else{options.dataTypes.unshift(selection);selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,selection,inspected);}}}
if((executeOnly||!selection)&&!inspected["*"]){selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,"*",inspected);}
return selection;}
function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key];}}
if(deep){jQuery.extend(true,target,deep);}}
jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments);}
if(!this.length){return this;}
var selector,type,response,self=this,off=url.indexOf(" ");if(off>=0){selector=url.slice(off,url.length);url=url.slice(0,off);}
if(jQuery.isFunction(params)){callback=params;params=undefined;}else if(params&&typeof params==="object"){type="POST";}
jQuery.ajax({url:url,type:type,dataType:"html",data:params,complete:function(jqXHR,status){if(callback){self.each(callback,response||[jqXHR.responseText,status,jqXHR]);}}}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(responseText.replace(rscript,"")).find(selector):responseText);});return this;};jQuery.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(i,o){jQuery.fn[o]=function(f){return this.on(o,f);};});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined;}
return jQuery.ajax({type:method,url:url,data:data,success:callback,dataType:type});};});jQuery.extend({getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script");},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json");},ajaxSetup:function(target,settings){if(settings){ajaxExtend(target,jQuery.ajaxSettings);}else{settings=target;target=jQuery.ajaxSettings;}
ajaxExtend(target,settings);return target;},ajaxSettings:{url:ajaxLocation,isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":allTypes},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":window.String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{context:true,url:true}},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined;}
options=options||{};var
ifModifiedKey,responseHeadersString,responseHeaders,transport,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=callbackContext!==s&&(callbackContext.nodeType||callbackContext instanceof jQuery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,setRequestHeader:function(name,value){if(!state){var lname=name.toLowerCase();name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value;}
return this;},getAllResponseHeaders:function(){return state===2?responseHeadersString:null;},getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()]=match[2];}}
match=responseHeaders[key.toLowerCase()];}
return match===undefined?null:match;},overrideMimeType:function(type){if(!state){s.mimeType=type;}
return this;},abort:function(statusText){statusText=statusText||strAbort;if(transport){transport.abort(statusText);}
done(0,statusText);return this;}};function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return;}
state=2;if(timeoutTimer){clearTimeout(timeoutTimer);}
transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;if(responses){response=ajaxHandleResponses(s,jqXHR,responses);}
if(status>=200&&status<300||status===304){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[ifModifiedKey]=modified;}
modified=jqXHR.getResponseHeader("Etag");if(modified){jQuery.etag[ifModifiedKey]=modified;}}
if(status===304){statusText="notmodified";isSuccess=true;}else{isSuccess=ajaxConvert(s,response);statusText=isSuccess.state;success=isSuccess.data;error=isSuccess.error;isSuccess=!error;}}else{error=statusText;if(!statusText||status){statusText="error";if(status<0){status=0;}}}
jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR]);}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error]);}
jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger("ajax"+(isSuccess?"Success":"Error"),[jqXHR,s,isSuccess?success:error]);}
completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!(--jQuery.active)){jQuery.event.trigger("ajaxStop");}}}
deferred.promise(jqXHR);jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;jqXHR.complete=completeDeferred.add;jqXHR.statusCode=function(map){if(map){var tmp;if(state<2){for(tmp in map){statusCode[tmp]=[statusCode[tmp],map[tmp]];}}else{tmp=map[jqXHR.status];jqXHR.always(tmp);}}
return this;};s.url=((url||s.url)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().split(core_rspace);if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?80:443))!=(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?80:443))));}
if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional);}
inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR;}
fireGlobals=s.global;s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart");}
if(!s.hasContent){if(s.data){s.url+=(rquery.test(s.url)?"&":"?")+s.data;delete s.data;}
ifModifiedKey=s.url;if(s.cache===false){var ts=jQuery.now(),ret=s.url.replace(rts,"$1_="+ts);s.url=ret+((ret===s.url)?(rquery.test(s.url)?"&":"?")+"_="+ts:"");}}
if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType);}
if(s.ifModified){ifModifiedKey=ifModifiedKey||s.url;if(jQuery.lastModified[ifModifiedKey]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[ifModifiedKey]);}
if(jQuery.etag[ifModifiedKey]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[ifModifiedKey]);}}
jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i]);}
if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort();}
strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i]);}
transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport");}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s]);}
if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout");},s.timeout);}
try{state=1;transport.send(requestHeaders,done);}catch(e){if(state<2){done(-1,e);}else{throw e;}}}
return jqXHR;},active:0,lastModified:{},etag:{}});function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes,responseFields=s.responseFields;for(type in responseFields){if(type in responses){jqXHR[responseFields[type]]=responses[type];}}
while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("content-type");}}
if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break;}}}
if(dataTypes[0]in responses){finalDataType=dataTypes[0];}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break;}
if(!firstDataType){firstDataType=type;}}
finalDataType=finalDataType||firstDataType;}
if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType);}
return responses[finalDataType];}}
function ajaxConvert(s,response){var conv,conv2,current,tmp,dataTypes=s.dataTypes.slice(),prev=dataTypes[0],converters={},i=0;if(s.dataFilter){response=s.dataFilter(response,s.dataType);}
if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv];}}
for(;(current=dataTypes[++i]);){if(current!=="*"){if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2];}else if(converters[conv2]!==true){current=tmp[0];dataTypes.splice(i--,0,current);}
break;}}}}
if(conv!==true){if(conv&&s["throws"]){response=conv(response);}else{try{response=conv(response);}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current};}}}}
prev=current;}}
return{state:"success",data:response};}
var oldCallbacks=[],rquestion=/\?/,rjsonp=/(=)\?(?=&|$)|\?\?/,nonce=jQuery.now();jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||(jQuery.expando+"_"+(nonce++));this[callback]=true;return callback;}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,data=s.data,url=s.url,hasCallback=s.jsonp!==false,replaceInUrl=hasCallback&&rjsonp.test(url),replaceInData=hasCallback&&!replaceInUrl&&typeof data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(data);if(s.dataTypes[0]==="jsonp"||replaceInUrl||replaceInData){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;overwritten=window[callbackName];if(replaceInUrl){s.url=url.replace(rjsonp,"$1"+callbackName);}else if(replaceInData){s.data=data.replace(rjsonp,"$1"+callbackName);}else if(hasCallback){s.url+=(rquestion.test(url)?"&":"?")+s.jsonp+"="+callbackName;}
s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called");}
return responseContainer[0];};s.dataTypes[0]="json";window[callbackName]=function(){responseContainer=arguments;};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName);}
if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0]);}
responseContainer=overwritten=undefined;});return"script";}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(text){jQuery.globalEval(text);return text;}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false;}
if(s.crossDomain){s.type="GET";s.global=false;}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script");script.async="async";if(s.scriptCharset){script.charset=s.scriptCharset;}
script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script);}
script=undefined;if(!isAbort){callback(200,"success");}}};head.insertBefore(script,head.firstChild);},abort:function(){if(script){script.onload(0,1);}}};}});var xhrCallbacks,xhrOnUnloadAbort=window.ActiveXObject?function(){for(var key in xhrCallbacks){xhrCallbacks[key](0,1);}}:false,xhrId=0;function createStandardXHR(){try{return new window.XMLHttpRequest();}catch(e){}}
function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP");}catch(e){}}
jQuery.ajaxSettings.xhr=window.ActiveXObject?function(){return!this.isLocal&&createStandardXHR()||createActiveXHR();}:createStandardXHR;(function(xhr){jQuery.extend(jQuery.support,{ajax:!!xhr,cors:!!xhr&&("withCredentials"in xhr)});})(jQuery.ajaxSettings.xhr());if(jQuery.support.ajax){jQuery.ajaxTransport(function(s){if(!s.crossDomain||jQuery.support.cors){var callback;return{send:function(headers,complete){var handle,i,xhr=s.xhr();if(s.username){xhr.open(s.type,s.url,s.async,s.username,s.password);}else{xhr.open(s.type,s.url,s.async);}
if(s.xhrFields){for(i in s.xhrFields){xhr[i]=s.xhrFields[i];}}
if(s.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(s.mimeType);}
if(!s.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest";}
try{for(i in headers){xhr.setRequestHeader(i,headers[i]);}}catch(_){}
xhr.send((s.hasContent&&s.data)||null);callback=function(_,isAbort){var status,statusText,responseHeaders,responses,xml;try{if(callback&&(isAbort||xhr.readyState===4)){callback=undefined;if(handle){xhr.onreadystatechange=jQuery.noop;if(xhrOnUnloadAbort){delete xhrCallbacks[handle];}}
if(isAbort){if(xhr.readyState!==4){xhr.abort();}}else{status=xhr.status;responseHeaders=xhr.getAllResponseHeaders();responses={};xml=xhr.responseXML;if(xml&&xml.documentElement){responses.xml=xml;}
try{responses.text=xhr.responseText;}catch(e){}
try{statusText=xhr.statusText;}catch(e){statusText="";}
if(!status&&s.isLocal&&!s.crossDomain){status=responses.text?200:404;}else if(status===1223){status=204;}}}}catch(firefoxAccessException){if(!isAbort){complete(-1,firefoxAccessException);}}
if(responses){complete(status,statusText,responses,responseHeaders);}};if(!s.async){callback();}else if(xhr.readyState===4){setTimeout(callback,0);}else{handle=++xhrId;if(xhrOnUnloadAbort){if(!xhrCallbacks){xhrCallbacks={};jQuery(window).unload(xhrOnUnloadAbort);}
xhrCallbacks[handle]=callback;}
xhr.onreadystatechange=callback;}},abort:function(){if(callback){callback(0,1);}}};}});}
var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([-+])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var end,unit,tween=this.createTween(prop,value),parts=rfxnum.exec(value),target=tween.cur(),start=+target||0,scale=1,maxIterations=20;if(parts){end=+parts[2];unit=parts[3]||(jQuery.cssNumber[prop]?"":"px");if(unit!=="px"&&start){start=jQuery.css(tween.elem,prop,true)||end||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit);}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations);}
tween.unit=unit;tween.start=start;tween.end=parts[1]?start+(parts[1]+1)*end:end;}
return tween;}]};function createFxNow(){setTimeout(function(){fxNow=undefined;},0);return(fxNow=jQuery.now());}
function createTweens(animation,props){jQuery.each(props,function(prop,value){var collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(collection[index].call(animation,prop,value)){return;}}});}
function Animation(elem,properties,options){var result,index=0,tweenerIndex=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem;}),tick=function(){var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent);}
deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining;}else{deferred.resolveWith(elem,[animation]);return false;}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end,easing){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween;},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;for(;index<length;index++){animation.tweens[index].run(1);}
if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd]);}else{deferred.rejectWith(elem,[animation,gotoEnd]);}
return this;}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result;}}
createTweens(animation,props);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation);}
jQuery.fx.timer(jQuery.extend(tick,{anim:animation,queue:animation.opts.queue,elem:elem}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always);}
function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0];}
if(index!==name){props[name]=value;delete props[index];}
hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing;}}}else{specialEasing[name]=easing;}}}
jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"];}else{props=props.split(" ");}
var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback);}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback);}else{animationPrefilters.push(callback);}}});function defaultPrefilter(elem,props,opts){var index,prop,value,length,dataShow,toggle,tween,hooks,oldfire,anim=this,style=elem.style,orig={},handled=[],hidden=elem.nodeType&&isHidden(elem);if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire();}};}
hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire();}});});}
if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];if(jQuery.css(elem,"display")==="inline"&&jQuery.css(elem,"float")==="none"){if(!jQuery.support.inlineBlockNeedsLayout||css_defaultDisplay(elem.nodeName)==="inline"){style.display="inline-block";}else{style.zoom=1;}}}
if(opts.overflow){style.overflow="hidden";if(!jQuery.support.shrinkWrapBlocks){anim.done(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2];});}}
for(index in props){value=props[index];if(rfxtypes.exec(value)){delete props[index];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){continue;}
handled.push(index);}}
length=handled.length;if(length){dataShow=jQuery._data(elem,"fxshow")||jQuery._data(elem,"fxshow",{});if("hidden"in dataShow){hidden=dataShow.hidden;}
if(toggle){dataShow.hidden=!hidden;}
if(hidden){jQuery(elem).show();}else{anim.done(function(){jQuery(elem).hide();});}
anim.done(function(){var prop;jQuery.removeData(elem,"fxshow",true);for(prop in orig){jQuery.style(elem,prop,orig[prop]);}});for(index=0;index<length;index++){prop=handled[index];tween=anim.createTween(prop,hidden?dataShow[prop]:0);orig[prop]=dataShow[prop]||jQuery.style(elem,prop);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0;}}}}}
function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing);}
jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px");},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this);},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration);}else{this.pos=eased=percent;}
this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this);}
if(hooks&&hooks.set){hooks.set(this);}else{Tween.propHooks._default.set(this);}
return this;}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop];}
result=jQuery.css(tween.elem,tween.prop,false,"");return!result||result==="auto"?0:result;},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween);}else if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit);}else{tween.elem[tween.prop]=tween.now;}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now;}}};jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"||(!i&&jQuery.isFunction(speed)&&jQuery.isFunction(easing))?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback);};});jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback);},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty){anim.stop(true);}};return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation);},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd);};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined;}
if(clearQueue&&type!==false){this.queue(type||"fx",[]);}
return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index]);}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index]);}}}
for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1);}}
if(dequeue||!gotoEnd){jQuery.dequeue(this,type);}});}});function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type;}
if(includeWidth){attrs.opacity=attrs.width=type;}
return attrs;}
jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback);};});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx";}
opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this);}
if(opt.queue){jQuery.dequeue(this,opt.queue);}};return opt;};jQuery.easing={linear:function(p){return p;},swing:function(p){return 0.5-Math.cos(p*Math.PI)/2;}};jQuery.timers=[];jQuery.fx=Tween.prototype.init;jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1);}}
if(!timers.length){jQuery.fx.stop();}
fxNow=undefined;};jQuery.fx.timer=function(timer){if(timer()&&jQuery.timers.push(timer)&&!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval);}};jQuery.fx.interval=13;jQuery.fx.stop=function(){clearInterval(timerId);timerId=null;};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fx.step={};if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem;}).length;};}
var rroot=/^(?:body|html)$/i;jQuery.fn.offset=function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i);});}
var docElem,body,win,clientTop,clientLeft,scrollTop,scrollLeft,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(!doc){return;}
if((body=doc.body)===elem){return jQuery.offset.bodyOffset(elem);}
docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box;}
if(typeof elem.getBoundingClientRect!=="undefined"){box=elem.getBoundingClientRect();}
win=getWindow(doc);clientTop=docElem.clientTop||body.clientTop||0;clientLeft=docElem.clientLeft||body.clientLeft||0;scrollTop=win.pageYOffset||docElem.scrollTop;scrollLeft=win.pageXOffset||docElem.scrollLeft;return{top:box.top+scrollTop-clientTop,left:box.left+scrollLeft-clientLeft};};jQuery.offset={bodyOffset:function(body){var top=body.offsetTop,left=body.offsetLeft;if(jQuery.support.doesNotIncludeMarginInBodyOffset){top+=parseFloat(jQuery.css(body,"marginTop"))||0;left+=parseFloat(jQuery.css(body,"marginLeft"))||0;}
return{top:top,left:left};},setOffset:function(elem,options,i){var position=jQuery.css(elem,"position");if(position==="static"){elem.style.position="relative";}
var curElem=jQuery(elem),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,props={},curPosition={},curTop,curLeft;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left;}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0;}
if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset);}
if(options.top!=null){props.top=(options.top-curOffset.top)+curTop;}
if(options.left!=null){props.left=(options.left-curOffset.left)+curLeft;}
if("using"in options){options.using.call(elem,props);}else{curElem.css(props);}}};jQuery.fn.extend({position:function(){if(!this[0]){return;}
var elem=this[0],offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=rroot.test(offsetParent[0].nodeName)?{top:0,left:0}:offsetParent.offset();offset.top-=parseFloat(jQuery.css(elem,"marginTop"))||0;offset.left-=parseFloat(jQuery.css(elem,"marginLeft"))||0;parentOffset.top+=parseFloat(jQuery.css(offsetParent[0],"borderTopWidth"))||0;parentOffset.left+=parseFloat(jQuery.css(offsetParent[0],"borderLeftWidth"))||0;return{top:offset.top-parentOffset.top,left:offset.left-parentOffset.left};},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||document.body;while(offsetParent&&(!rroot.test(offsetParent.nodeName)&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent;}
return offsetParent||document.body;});}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?(prop in win)?win[prop]:win.document.documentElement[method]:elem[method];}
if(win){win.scrollTo(!top?val:jQuery(win).scrollLeft(),top?val:jQuery(win).scrollTop());}else{elem[method]=val;}},method,val,arguments.length,null);};});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false;}
jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return jQuery.access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name];}
if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name]);}
return value===undefined?jQuery.css(elem,type,value,extra):jQuery.style(elem,type,value,extra);},type,chainable?margin:undefined,chainable,null);};});});window.jQuery=window.$=jQuery;if(typeof define==="function"&&define.amd&&define.amd.jQuery){define("jquery",[],function(){return jQuery;});}})(window);window['rangy']=(function(){var OBJECT="object",FUNCTION="function",UNDEFINED="undefined";var domRangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"];var domRangeMethods=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var textRangeProperties=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var textRangeMethods=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"];function isHostMethod(o,p){var t=typeof o[p];return t==FUNCTION||(!!(t==OBJECT&&o[p]))||t=="unknown";}
function isHostObject(o,p){return!!(typeof o[p]==OBJECT&&o[p]);}
function isHostProperty(o,p){return typeof o[p]!=UNDEFINED;}
function createMultiplePropertyTest(testFunc){return function(o,props){var i=props.length;while(i--){if(!testFunc(o,props[i])){return false;}}
return true;};}
var areHostMethods=createMultiplePropertyTest(isHostMethod);var areHostObjects=createMultiplePropertyTest(isHostObject);var areHostProperties=createMultiplePropertyTest(isHostProperty);function isTextRange(range){return range&&areHostMethods(range,textRangeMethods)&&areHostProperties(range,textRangeProperties);}
var api={version:"1.2.3",initialized:false,supported:true,util:{isHostMethod:isHostMethod,isHostObject:isHostObject,isHostProperty:isHostProperty,areHostMethods:areHostMethods,areHostObjects:areHostObjects,areHostProperties:areHostProperties,isTextRange:isTextRange},features:{},modules:{},config:{alertOnWarn:false,preferTextRange:false}};function fail(reason){window.alert("Rangy not supported in your browser. Reason: "+reason);api.initialized=true;api.supported=false;}
api.fail=fail;function warn(msg){var warningMessage="Rangy warning: "+msg;if(api.config.alertOnWarn){window.alert(warningMessage);}else if(typeof window.console!=UNDEFINED&&typeof window.console.log!=UNDEFINED){window.console.log(warningMessage);}}
api.warn=warn;if({}.hasOwnProperty){api.util.extend=function(o,props){for(var i in props){if(props.hasOwnProperty(i)){o[i]=props[i];}}};}else{fail("hasOwnProperty not supported");}
var initListeners=[];var moduleInitializers=[];function init(){if(api.initialized){return;}
var testRange;var implementsDomRange=false,implementsTextRange=false;if(isHostMethod(document,"createRange")){testRange=document.createRange();if(areHostMethods(testRange,domRangeMethods)&&areHostProperties(testRange,domRangeProperties)){implementsDomRange=true;}
testRange.detach();}
var body=isHostObject(document,"body")?document.body:document.getElementsByTagName("body")[0];if(body&&isHostMethod(body,"createTextRange")){testRange=body.createTextRange();if(isTextRange(testRange)){implementsTextRange=true;}}
if(!implementsDomRange&&!implementsTextRange){fail("Neither Range nor TextRange are implemented");}
api.initialized=true;api.features={implementsDomRange:implementsDomRange,implementsTextRange:implementsTextRange};var allListeners=moduleInitializers.concat(initListeners);for(var i=0,len=allListeners.length;i<len;++i){try{allListeners[i](api);}catch(ex){if(isHostObject(window,"console")&&isHostMethod(window.console,"log")){window.console.log("Init listener threw an exception. Continuing.",ex);}}}}
api.init=init;api.addInitListener=function(listener){if(api.initialized){listener(api);}else{initListeners.push(listener);}};var createMissingNativeApiListeners=[];api.addCreateMissingNativeApiListener=function(listener){createMissingNativeApiListeners.push(listener);};function createMissingNativeApi(win){win=win||window;init();for(var i=0,len=createMissingNativeApiListeners.length;i<len;++i){createMissingNativeApiListeners[i](win);}}
api.createMissingNativeApi=createMissingNativeApi;function Module(name){this.name=name;this.initialized=false;this.supported=false;}
Module.prototype.fail=function(reason){this.initialized=true;this.supported=false;throw new Error("Module '"+this.name+"' failed to load: "+reason);};Module.prototype.warn=function(msg){api.warn("Module "+this.name+": "+msg);};Module.prototype.createError=function(msg){return new Error("Error in Rangy "+this.name+" module: "+msg);};api.createModule=function(name,initFunc){var module=new Module(name);api.modules[name]=module;moduleInitializers.push(function(api){initFunc(api,module);module.initialized=true;module.supported=true;});};api.requireModules=function(modules){for(var i=0,len=modules.length,module,moduleName;i<len;++i){moduleName=modules[i];module=api.modules[moduleName];if(!module||!(module instanceof Module)){throw new Error("Module '"+moduleName+"' not found");}
if(!module.supported){throw new Error("Module '"+moduleName+"' not supported");}}};var docReady=false;var loadHandler=function(e){if(!docReady){docReady=true;if(!api.initialized){init();}}};if(typeof window==UNDEFINED){fail("No window found");return;}
if(typeof document==UNDEFINED){fail("No document found");return;}
if(isHostMethod(document,"addEventListener")){document.addEventListener("DOMContentLoaded",loadHandler,false);}
if(isHostMethod(window,"addEventListener")){window.addEventListener("load",loadHandler,false);}else if(isHostMethod(window,"attachEvent")){window.attachEvent("onload",loadHandler);}else{fail("Window does not have required addEventListener or attachEvent method");}
return api;})();rangy.createModule("DomUtil",function(api,module){var UNDEF="undefined";var util=api.util;if(!util.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){module.fail("document missing a Node creation method");}
if(!util.isHostMethod(document,"getElementsByTagName")){module.fail("document missing getElementsByTagName method");}
var el=document.createElement("div");if(!util.areHostMethods(el,["insertBefore","appendChild","cloneNode"]||!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"]))){module.fail("Incomplete Element implementation");}
if(!util.isHostProperty(el,"innerHTML")){module.fail("Element is missing innerHTML property");}
var textNode=document.createTextNode("test");if(!util.areHostMethods(textNode,["splitText","deleteData","insertData","appendData","cloneNode"]||!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"])||!util.areHostProperties(textNode,["data"]))){module.fail("Incomplete Text Node implementation");}
var arrayContains=function(arr,val){var i=arr.length;while(i--){if(arr[i]===val){return true;}}
return false;};function isHtmlNamespace(node){var ns;return typeof node.namespaceURI==UNDEF||((ns=node.namespaceURI)===null||ns=="http://www.w3.org/1999/xhtml");}
function parentElement(node){var parent=node.parentNode;return(parent.nodeType==1)?parent:null;}
function getNodeIndex(node){var i=0;while((node=node.previousSibling)){i++;}
return i;}
function getNodeLength(node){var childNodes;return isCharacterDataNode(node)?node.length:((childNodes=node.childNodes)?childNodes.length:0);}
function getCommonAncestor(node1,node2){var ancestors=[],n;for(n=node1;n;n=n.parentNode){ancestors.push(n);}
for(n=node2;n;n=n.parentNode){if(arrayContains(ancestors,n)){return n;}}
return null;}
function isAncestorOf(ancestor,descendant,selfIsAncestor){var n=selfIsAncestor?descendant:descendant.parentNode;while(n){if(n===ancestor){return true;}else{n=n.parentNode;}}
return false;}
function getClosestAncestorIn(node,ancestor,selfIsAncestor){var p,n=selfIsAncestor?node:node.parentNode;while(n){p=n.parentNode;if(p===ancestor){return n;}
n=p;}
return null;}
function isCharacterDataNode(node){var t=node.nodeType;return t==3||t==4||t==8;}
function insertAfter(node,precedingNode){var nextNode=precedingNode.nextSibling,parent=precedingNode.parentNode;if(nextNode){parent.insertBefore(node,nextNode);}else{parent.appendChild(node);}
return node;}
function splitDataNode(node,index){var newNode=node.cloneNode(false);newNode.deleteData(0,index);node.deleteData(index,node.length-index);insertAfter(newNode,node);return newNode;}
function getDocument(node){if(node.nodeType==9){return node;}else if(typeof node.ownerDocument!=UNDEF){return node.ownerDocument;}else if(typeof node.document!=UNDEF){return node.document;}else if(node.parentNode){return getDocument(node.parentNode);}else{throw new Error("getDocument: no document found for node");}}
function getWindow(node){var doc=getDocument(node);if(typeof doc.defaultView!=UNDEF){return doc.defaultView;}else if(typeof doc.parentWindow!=UNDEF){return doc.parentWindow;}else{throw new Error("Cannot get a window object for node");}}
function getIframeDocument(iframeEl){if(typeof iframeEl.contentDocument!=UNDEF){return iframeEl.contentDocument;}else if(typeof iframeEl.contentWindow!=UNDEF){return iframeEl.contentWindow.document;}else{throw new Error("getIframeWindow: No Document object found for iframe element");}}
function getIframeWindow(iframeEl){if(typeof iframeEl.contentWindow!=UNDEF){return iframeEl.contentWindow;}else if(typeof iframeEl.contentDocument!=UNDEF){return iframeEl.contentDocument.defaultView;}else{throw new Error("getIframeWindow: No Window object found for iframe element");}}
function getBody(doc){return util.isHostObject(doc,"body")?doc.body:doc.getElementsByTagName("body")[0];}
function getRootContainer(node){var parent;while((parent=node.parentNode)){node=parent;}
return node;}
function comparePoints(nodeA,offsetA,nodeB,offsetB){var nodeC,root,childA,childB,n;if(nodeA==nodeB){return offsetA===offsetB?0:(offsetA<offsetB)?-1:1;}else if((nodeC=getClosestAncestorIn(nodeB,nodeA,true))){return offsetA<=getNodeIndex(nodeC)?-1:1;}else if((nodeC=getClosestAncestorIn(nodeA,nodeB,true))){return getNodeIndex(nodeC)<offsetB?-1:1;}else{root=getCommonAncestor(nodeA,nodeB);childA=(nodeA===root)?root:getClosestAncestorIn(nodeA,root,true);childB=(nodeB===root)?root:getClosestAncestorIn(nodeB,root,true);if(childA===childB){throw new Error("comparePoints got to case 4 and childA and childB are the same!");}else{n=root.firstChild;while(n){if(n===childA){return-1;}else if(n===childB){return 1;}
n=n.nextSibling;}
throw new Error("Should not be here!");}}}
function fragmentFromNodeChildren(node){var fragment=getDocument(node).createDocumentFragment(),child;while((child=node.firstChild)){fragment.appendChild(child);}
return fragment;}
function inspectNode(node){if(!node){return"[No node]";}
if(isCharacterDataNode(node)){return'"'+node.data+'"';}else if(node.nodeType==1){var idAttr=node.id?' id="'+node.id+'"':"";return"<"+node.nodeName+idAttr+">["+node.childNodes.length+"]";}else{return node.nodeName;}}
function NodeIterator(root){this.root=root;this._next=root;}
NodeIterator.prototype={_current:null,hasNext:function(){return!!this._next;},next:function(){var n=this._current=this._next;var child,next;if(this._current){child=n.firstChild;if(child){this._next=child;}else{next=null;while((n!==this.root)&&!(next=n.nextSibling)){n=n.parentNode;}
this._next=next;}}
return this._current;},detach:function(){this._current=this._next=this.root=null;}};function createIterator(root){return new NodeIterator(root);}
function DomPosition(node,offset){this.node=node;this.offset=offset;}
DomPosition.prototype={equals:function(pos){return this.node===pos.node&this.offset==pos.offset;},inspect:function(){return"[DomPosition("+inspectNode(this.node)+":"+this.offset+")]";}};function DOMException(codeName){this.code=this[codeName];this.codeName=codeName;this.message="DOMException: "+this.codeName;}
DOMException.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};DOMException.prototype.toString=function(){return this.message;};api.dom={arrayContains:arrayContains,isHtmlNamespace:isHtmlNamespace,parentElement:parentElement,getNodeIndex:getNodeIndex,getNodeLength:getNodeLength,getCommonAncestor:getCommonAncestor,isAncestorOf:isAncestorOf,getClosestAncestorIn:getClosestAncestorIn,isCharacterDataNode:isCharacterDataNode,insertAfter:insertAfter,splitDataNode:splitDataNode,getDocument:getDocument,getWindow:getWindow,getIframeWindow:getIframeWindow,getIframeDocument:getIframeDocument,getBody:getBody,getRootContainer:getRootContainer,comparePoints:comparePoints,inspectNode:inspectNode,fragmentFromNodeChildren:fragmentFromNodeChildren,createIterator:createIterator,DomPosition:DomPosition};api.DOMException=DOMException;});rangy.createModule("DomRange",function(api,module){api.requireModules(["DomUtil"]);var dom=api.dom;var DomPosition=dom.DomPosition;var DOMException=api.DOMException;function isNonTextPartiallySelected(node,range){return(node.nodeType!=3)&&(dom.isAncestorOf(node,range.startContainer,true)||dom.isAncestorOf(node,range.endContainer,true));}
function getRangeDocument(range){return dom.getDocument(range.startContainer);}
function dispatchEvent(range,type,args){var listeners=range._listeners[type];if(listeners){for(var i=0,len=listeners.length;i<len;++i){listeners[i].call(range,{target:range,args:args});}}}
function getBoundaryBeforeNode(node){return new DomPosition(node.parentNode,dom.getNodeIndex(node));}
function getBoundaryAfterNode(node){return new DomPosition(node.parentNode,dom.getNodeIndex(node)+1);}
function insertNodeAtPosition(node,n,o){var firstNodeInserted=node.nodeType==11?node.firstChild:node;if(dom.isCharacterDataNode(n)){if(o==n.length){dom.insertAfter(node,n);}else{n.parentNode.insertBefore(node,o==0?n:dom.splitDataNode(n,o));}}else if(o>=n.childNodes.length){n.appendChild(node);}else{n.insertBefore(node,n.childNodes[o]);}
return firstNodeInserted;}
function cloneSubtree(iterator){var partiallySelected;for(var node,frag=getRangeDocument(iterator.range).createDocumentFragment(),subIterator;node=iterator.next();){partiallySelected=iterator.isPartiallySelectedSubtree();node=node.cloneNode(!partiallySelected);if(partiallySelected){subIterator=iterator.getSubtreeIterator();node.appendChild(cloneSubtree(subIterator));subIterator.detach(true);}
if(node.nodeType==10){throw new DOMException("HIERARCHY_REQUEST_ERR");}
frag.appendChild(node);}
return frag;}
function iterateSubtree(rangeIterator,func,iteratorState){var it,n;iteratorState=iteratorState||{stop:false};for(var node,subRangeIterator;node=rangeIterator.next();){if(rangeIterator.isPartiallySelectedSubtree()){if(func(node)===false){iteratorState.stop=true;return;}else{subRangeIterator=rangeIterator.getSubtreeIterator();iterateSubtree(subRangeIterator,func,iteratorState);subRangeIterator.detach(true);if(iteratorState.stop){return;}}}else{it=dom.createIterator(node);while((n=it.next())){if(func(n)===false){iteratorState.stop=true;return;}}}}}
function deleteSubtree(iterator){var subIterator;while(iterator.next()){if(iterator.isPartiallySelectedSubtree()){subIterator=iterator.getSubtreeIterator();deleteSubtree(subIterator);subIterator.detach(true);}else{iterator.remove();}}}
function extractSubtree(iterator){for(var node,frag=getRangeDocument(iterator.range).createDocumentFragment(),subIterator;node=iterator.next();){if(iterator.isPartiallySelectedSubtree()){node=node.cloneNode(false);subIterator=iterator.getSubtreeIterator();node.appendChild(extractSubtree(subIterator));subIterator.detach(true);}else{iterator.remove();}
if(node.nodeType==10){throw new DOMException("HIERARCHY_REQUEST_ERR");}
frag.appendChild(node);}
return frag;}
function getNodesInRange(range,nodeTypes,filter){var filterNodeTypes=!!(nodeTypes&&nodeTypes.length),regex;var filterExists=!!filter;if(filterNodeTypes){regex=new RegExp("^("+nodeTypes.join("|")+")$");}
var nodes=[];iterateSubtree(new RangeIterator(range,false),function(node){if((!filterNodeTypes||regex.test(node.nodeType))&&(!filterExists||filter(node))){nodes.push(node);}});return nodes;}
function inspect(range){var name=(typeof range.getName=="undefined")?"Range":range.getName();return"["+name+"("+dom.inspectNode(range.startContainer)+":"+range.startOffset+", "+
dom.inspectNode(range.endContainer)+":"+range.endOffset+")]";}
function RangeIterator(range,clonePartiallySelectedTextNodes){this.range=range;this.clonePartiallySelectedTextNodes=clonePartiallySelectedTextNodes;if(!range.collapsed){this.sc=range.startContainer;this.so=range.startOffset;this.ec=range.endContainer;this.eo=range.endOffset;var root=range.commonAncestorContainer;if(this.sc===this.ec&&dom.isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc;}else{this._first=this._next=(this.sc===root&&!dom.isCharacterDataNode(this.sc))?this.sc.childNodes[this.so]:dom.getClosestAncestorIn(this.sc,root,true);this._last=(this.ec===root&&!dom.isCharacterDataNode(this.ec))?this.ec.childNodes[this.eo-1]:dom.getClosestAncestorIn(this.ec,root,true);}}}
RangeIterator.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first;},hasNext:function(){return!!this._next;},next:function(){var current=this._current=this._next;if(current){this._next=(current!==this._last)?current.nextSibling:null;if(dom.isCharacterDataNode(current)&&this.clonePartiallySelectedTextNodes){if(current===this.ec){(current=current.cloneNode(true)).deleteData(this.eo,current.length-this.eo);}
if(this._current===this.sc){(current=current.cloneNode(true)).deleteData(0,this.so);}}}
return current;},remove:function(){var current=this._current,start,end;if(dom.isCharacterDataNode(current)&&(current===this.sc||current===this.ec)){start=(current===this.sc)?this.so:0;end=(current===this.ec)?this.eo:current.length;if(start!=end){current.deleteData(start,end-start);}}else{if(current.parentNode){current.parentNode.removeChild(current);}else{}}},isPartiallySelectedSubtree:function(){var current=this._current;return isNonTextPartiallySelected(current,this.range);},getSubtreeIterator:function(){var subRange;if(this.isSingleCharacterDataNode){subRange=this.range.cloneRange();subRange.collapse();}else{subRange=new Range(getRangeDocument(this.range));var current=this._current;var startContainer=current,startOffset=0,endContainer=current,endOffset=dom.getNodeLength(current);if(dom.isAncestorOf(current,this.sc,true)){startContainer=this.sc;startOffset=this.so;}
if(dom.isAncestorOf(current,this.ec,true)){endContainer=this.ec;endOffset=this.eo;}
updateBoundaries(subRange,startContainer,startOffset,endContainer,endOffset);}
return new RangeIterator(subRange,this.clonePartiallySelectedTextNodes);},detach:function(detachRange){if(detachRange){this.range.detach();}
this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null;}};function RangeException(codeName){this.code=this[codeName];this.codeName=codeName;this.message="RangeException: "+this.codeName;}
RangeException.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};RangeException.prototype.toString=function(){return this.message;};function RangeNodeIterator(range,nodeTypes,filter){this.nodes=getNodesInRange(range,nodeTypes,filter);this._next=this.nodes[0];this._position=0;}
RangeNodeIterator.prototype={_current:null,hasNext:function(){return!!this._next;},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current;},detach:function(){this._current=this._next=this.nodes=null;}};var beforeAfterNodeTypes=[1,3,4,5,7,8,10];var rootContainerNodeTypes=[2,9,11];var readonlyNodeTypes=[5,6,10,12];var insertableNodeTypes=[1,3,4,5,7,8,10,11];var surroundNodeTypes=[1,3,4,5,7,8];function createAncestorFinder(nodeTypes){return function(node,selfIsAncestor){var t,n=selfIsAncestor?node:node.parentNode;while(n){t=n.nodeType;if(dom.arrayContains(nodeTypes,t)){return n;}
n=n.parentNode;}
return null;};}
var getRootContainer=dom.getRootContainer;var getDocumentOrFragmentContainer=createAncestorFinder([9,11]);var getReadonlyAncestor=createAncestorFinder(readonlyNodeTypes);var getDocTypeNotationEntityAncestor=createAncestorFinder([6,10,12]);function assertNoDocTypeNotationEntityAncestor(node,allowSelf){if(getDocTypeNotationEntityAncestor(node,allowSelf)){throw new RangeException("INVALID_NODE_TYPE_ERR");}}
function assertNotDetached(range){if(!range.startContainer){throw new DOMException("INVALID_STATE_ERR");}}
function assertValidNodeType(node,invalidTypes){if(!dom.arrayContains(invalidTypes,node.nodeType)){throw new RangeException("INVALID_NODE_TYPE_ERR");}}
function assertValidOffset(node,offset){if(offset<0||offset>(dom.isCharacterDataNode(node)?node.length:node.childNodes.length)){throw new DOMException("INDEX_SIZE_ERR");}}
function assertSameDocumentOrFragment(node1,node2){if(getDocumentOrFragmentContainer(node1,true)!==getDocumentOrFragmentContainer(node2,true)){throw new DOMException("WRONG_DOCUMENT_ERR");}}
function assertNodeNotReadOnly(node){if(getReadonlyAncestor(node,true)){throw new DOMException("NO_MODIFICATION_ALLOWED_ERR");}}
function assertNode(node,codeName){if(!node){throw new DOMException(codeName);}}
function isOrphan(node){return!dom.arrayContains(rootContainerNodeTypes,node.nodeType)&&!getDocumentOrFragmentContainer(node,true);}
function isValidOffset(node,offset){return offset<=(dom.isCharacterDataNode(node)?node.length:node.childNodes.length);}
function isRangeValid(range){return(!!range.startContainer&&!!range.endContainer&&!isOrphan(range.startContainer)&&!isOrphan(range.endContainer)&&isValidOffset(range.startContainer,range.startOffset)&&isValidOffset(range.endContainer,range.endOffset));}
function assertRangeValid(range){assertNotDetached(range);if(!isRangeValid(range)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+range.inspect()+")");}}
var styleEl=document.createElement("style");var htmlParsingConforms=false;try{styleEl.innerHTML="<b>x</b>";htmlParsingConforms=(styleEl.firstChild.nodeType==3);}catch(e){}
api.features.htmlParsingConforms=htmlParsingConforms;var createContextualFragment=htmlParsingConforms?function(fragmentStr){var node=this.startContainer;var doc=dom.getDocument(node);if(!node){throw new DOMException("INVALID_STATE_ERR");}
var el=null;if(node.nodeType==1){el=node;}else if(dom.isCharacterDataNode(node)){el=dom.parentElement(node);}
if(el===null||(el.nodeName=="HTML"&&dom.isHtmlNamespace(dom.getDocument(el).documentElement)&&dom.isHtmlNamespace(el))){el=doc.createElement("body");}else{el=el.cloneNode(false);}
el.innerHTML=fragmentStr;return dom.fragmentFromNodeChildren(el);}:function(fragmentStr){assertNotDetached(this);var doc=getRangeDocument(this);var el=doc.createElement("body");el.innerHTML=fragmentStr;return dom.fragmentFromNodeChildren(el);};var rangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var s2s=0,s2e=1,e2e=2,e2s=3;var n_b=0,n_a=1,n_b_a=2,n_i=3;function RangePrototype(){}
RangePrototype.prototype={attachListener:function(type,listener){this._listeners[type].push(listener);},compareBoundaryPoints:function(how,range){assertRangeValid(this);assertSameDocumentOrFragment(this.startContainer,range.startContainer);var nodeA,offsetA,nodeB,offsetB;var prefixA=(how==e2s||how==s2s)?"start":"end";var prefixB=(how==s2e||how==s2s)?"start":"end";nodeA=this[prefixA+"Container"];offsetA=this[prefixA+"Offset"];nodeB=range[prefixB+"Container"];offsetB=range[prefixB+"Offset"];return dom.comparePoints(nodeA,offsetA,nodeB,offsetB);},insertNode:function(node){assertRangeValid(this);assertValidNodeType(node,insertableNodeTypes);assertNodeNotReadOnly(this.startContainer);if(dom.isAncestorOf(node,this.startContainer,true)){throw new DOMException("HIERARCHY_REQUEST_ERR");}
var firstNodeInserted=insertNodeAtPosition(node,this.startContainer,this.startOffset);this.setStartBefore(firstNodeInserted);},cloneContents:function(){assertRangeValid(this);var clone,frag;if(this.collapsed){return getRangeDocument(this).createDocumentFragment();}else{if(this.startContainer===this.endContainer&&dom.isCharacterDataNode(this.startContainer)){clone=this.startContainer.cloneNode(true);clone.data=clone.data.slice(this.startOffset,this.endOffset);frag=getRangeDocument(this).createDocumentFragment();frag.appendChild(clone);return frag;}else{var iterator=new RangeIterator(this,true);clone=cloneSubtree(iterator);iterator.detach();}
return clone;}},canSurroundContents:function(){assertRangeValid(this);assertNodeNotReadOnly(this.startContainer);assertNodeNotReadOnly(this.endContainer);var iterator=new RangeIterator(this,true);var boundariesInvalid=(iterator._first&&(isNonTextPartiallySelected(iterator._first,this))||(iterator._last&&isNonTextPartiallySelected(iterator._last,this)));iterator.detach();return!boundariesInvalid;},surroundContents:function(node){assertValidNodeType(node,surroundNodeTypes);if(!this.canSurroundContents()){throw new RangeException("BAD_BOUNDARYPOINTS_ERR");}
var content=this.extractContents();if(node.hasChildNodes()){while(node.lastChild){node.removeChild(node.lastChild);}}
insertNodeAtPosition(node,this.startContainer,this.startOffset);node.appendChild(content);this.selectNode(node);},cloneRange:function(){assertRangeValid(this);var range=new Range(getRangeDocument(this));var i=rangeProperties.length,prop;while(i--){prop=rangeProperties[i];range[prop]=this[prop];}
return range;},toString:function(){assertRangeValid(this);var sc=this.startContainer;if(sc===this.endContainer&&dom.isCharacterDataNode(sc)){return(sc.nodeType==3||sc.nodeType==4)?sc.data.slice(this.startOffset,this.endOffset):"";}else{var textBits=[],iterator=new RangeIterator(this,true);iterateSubtree(iterator,function(node){if(node.nodeType==3||node.nodeType==4){textBits.push(node.data);}});iterator.detach();return textBits.join("");}},compareNode:function(node){assertRangeValid(this);var parent=node.parentNode;var nodeIndex=dom.getNodeIndex(node);if(!parent){throw new DOMException("NOT_FOUND_ERR");}
var startComparison=this.comparePoint(parent,nodeIndex),endComparison=this.comparePoint(parent,nodeIndex+1);if(startComparison<0){return(endComparison>0)?n_b_a:n_b;}else{return(endComparison>0)?n_a:n_i;}},comparePoint:function(node,offset){assertRangeValid(this);assertNode(node,"HIERARCHY_REQUEST_ERR");assertSameDocumentOrFragment(node,this.startContainer);if(dom.comparePoints(node,offset,this.startContainer,this.startOffset)<0){return-1;}else if(dom.comparePoints(node,offset,this.endContainer,this.endOffset)>0){return 1;}
return 0;},createContextualFragment:createContextualFragment,toHtml:function(){assertRangeValid(this);var container=getRangeDocument(this).createElement("div");container.appendChild(this.cloneContents());return container.innerHTML;},intersectsNode:function(node,touchingIsIntersecting){assertRangeValid(this);assertNode(node,"NOT_FOUND_ERR");if(dom.getDocument(node)!==getRangeDocument(this)){return false;}
var parent=node.parentNode,offset=dom.getNodeIndex(node);assertNode(parent,"NOT_FOUND_ERR");var startComparison=dom.comparePoints(parent,offset,this.endContainer,this.endOffset),endComparison=dom.comparePoints(parent,offset+1,this.startContainer,this.startOffset);return touchingIsIntersecting?startComparison<=0&&endComparison>=0:startComparison<0&&endComparison>0;},isPointInRange:function(node,offset){assertRangeValid(this);assertNode(node,"HIERARCHY_REQUEST_ERR");assertSameDocumentOrFragment(node,this.startContainer);return(dom.comparePoints(node,offset,this.startContainer,this.startOffset)>=0)&&(dom.comparePoints(node,offset,this.endContainer,this.endOffset)<=0);},intersectsRange:function(range,touchingIsIntersecting){assertRangeValid(this);if(getRangeDocument(range)!=getRangeDocument(this)){throw new DOMException("WRONG_DOCUMENT_ERR");}
var startComparison=dom.comparePoints(this.startContainer,this.startOffset,range.endContainer,range.endOffset),endComparison=dom.comparePoints(this.endContainer,this.endOffset,range.startContainer,range.startOffset);return touchingIsIntersecting?startComparison<=0&&endComparison>=0:startComparison<0&&endComparison>0;},intersection:function(range){if(this.intersectsRange(range)){var startComparison=dom.comparePoints(this.startContainer,this.startOffset,range.startContainer,range.startOffset),endComparison=dom.comparePoints(this.endContainer,this.endOffset,range.endContainer,range.endOffset);var intersectionRange=this.cloneRange();if(startComparison==-1){intersectionRange.setStart(range.startContainer,range.startOffset);}
if(endComparison==1){intersectionRange.setEnd(range.endContainer,range.endOffset);}
return intersectionRange;}
return null;},union:function(range){if(this.intersectsRange(range,true)){var unionRange=this.cloneRange();if(dom.comparePoints(range.startContainer,range.startOffset,this.startContainer,this.startOffset)==-1){unionRange.setStart(range.startContainer,range.startOffset);}
if(dom.comparePoints(range.endContainer,range.endOffset,this.endContainer,this.endOffset)==1){unionRange.setEnd(range.endContainer,range.endOffset);}
return unionRange;}else{throw new RangeException("Ranges do not intersect");}},containsNode:function(node,allowPartial){if(allowPartial){return this.intersectsNode(node,false);}else{return this.compareNode(node)==n_i;}},containsNodeContents:function(node){return this.comparePoint(node,0)>=0&&this.comparePoint(node,dom.getNodeLength(node))<=0;},containsRange:function(range){return this.intersection(range).equals(range);},containsNodeText:function(node){var nodeRange=this.cloneRange();nodeRange.selectNode(node);var textNodes=nodeRange.getNodes([3]);if(textNodes.length>0){nodeRange.setStart(textNodes[0],0);var lastTextNode=textNodes.pop();nodeRange.setEnd(lastTextNode,lastTextNode.length);var contains=this.containsRange(nodeRange);nodeRange.detach();return contains;}else{return this.containsNodeContents(node);}},createNodeIterator:function(nodeTypes,filter){assertRangeValid(this);return new RangeNodeIterator(this,nodeTypes,filter);},getNodes:function(nodeTypes,filter){assertRangeValid(this);return getNodesInRange(this,nodeTypes,filter);},getDocument:function(){return getRangeDocument(this);},collapseBefore:function(node){assertNotDetached(this);this.setEndBefore(node);this.collapse(false);},collapseAfter:function(node){assertNotDetached(this);this.setStartAfter(node);this.collapse(true);},getName:function(){return"DomRange";},equals:function(range){return Range.rangesEqual(this,range);},isValid:function(){return isRangeValid(this);},inspect:function(){return inspect(this);}};function copyComparisonConstantsToObject(obj){obj.START_TO_START=s2s;obj.START_TO_END=s2e;obj.END_TO_END=e2e;obj.END_TO_START=e2s;obj.NODE_BEFORE=n_b;obj.NODE_AFTER=n_a;obj.NODE_BEFORE_AND_AFTER=n_b_a;obj.NODE_INSIDE=n_i;}
function copyComparisonConstants(constructor){copyComparisonConstantsToObject(constructor);copyComparisonConstantsToObject(constructor.prototype);}
function createRangeContentRemover(remover,boundaryUpdater){return function(){assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,root=this.commonAncestorContainer;var iterator=new RangeIterator(this,true);var node,boundary;if(sc!==root){node=dom.getClosestAncestorIn(sc,root,true);boundary=getBoundaryAfterNode(node);sc=boundary.node;so=boundary.offset;}
iterateSubtree(iterator,assertNodeNotReadOnly);iterator.reset();var returnValue=remover(iterator);iterator.detach();boundaryUpdater(this,sc,so,sc,so);return returnValue;};}
function createPrototypeRange(constructor,boundaryUpdater,detacher){function createBeforeAfterNodeSetter(isBefore,isStart){return function(node){assertNotDetached(this);assertValidNodeType(node,beforeAfterNodeTypes);assertValidNodeType(getRootContainer(node),rootContainerNodeTypes);var boundary=(isBefore?getBoundaryBeforeNode:getBoundaryAfterNode)(node);(isStart?setRangeStart:setRangeEnd)(this,boundary.node,boundary.offset);};}
function setRangeStart(range,node,offset){var ec=range.endContainer,eo=range.endOffset;if(node!==range.startContainer||offset!==range.startOffset){if(getRootContainer(node)!=getRootContainer(ec)||dom.comparePoints(node,offset,ec,eo)==1){ec=node;eo=offset;}
boundaryUpdater(range,node,offset,ec,eo);}}
function setRangeEnd(range,node,offset){var sc=range.startContainer,so=range.startOffset;if(node!==range.endContainer||offset!==range.endOffset){if(getRootContainer(node)!=getRootContainer(sc)||dom.comparePoints(node,offset,sc,so)==-1){sc=node;so=offset;}
boundaryUpdater(range,sc,so,node,offset);}}
function setRangeStartAndEnd(range,node,offset){if(node!==range.startContainer||offset!==range.startOffset||node!==range.endContainer||offset!==range.endOffset){boundaryUpdater(range,node,offset,node,offset);}}
constructor.prototype=new RangePrototype();api.util.extend(constructor.prototype,{setStart:function(node,offset){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);setRangeStart(this,node,offset);},setEnd:function(node,offset){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);setRangeEnd(this,node,offset);},setStartBefore:createBeforeAfterNodeSetter(true,true),setStartAfter:createBeforeAfterNodeSetter(false,true),setEndBefore:createBeforeAfterNodeSetter(true,false),setEndAfter:createBeforeAfterNodeSetter(false,false),collapse:function(isStart){assertRangeValid(this);if(isStart){boundaryUpdater(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset);}else{boundaryUpdater(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset);}},selectNodeContents:function(node){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);boundaryUpdater(this,node,0,node,dom.getNodeLength(node));},selectNode:function(node){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,false);assertValidNodeType(node,beforeAfterNodeTypes);var start=getBoundaryBeforeNode(node),end=getBoundaryAfterNode(node);boundaryUpdater(this,start.node,start.offset,end.node,end.offset);},extractContents:createRangeContentRemover(extractSubtree,boundaryUpdater),deleteContents:createRangeContentRemover(deleteSubtree,boundaryUpdater),canSurroundContents:function(){assertRangeValid(this);assertNodeNotReadOnly(this.startContainer);assertNodeNotReadOnly(this.endContainer);var iterator=new RangeIterator(this,true);var boundariesInvalid=(iterator._first&&(isNonTextPartiallySelected(iterator._first,this))||(iterator._last&&isNonTextPartiallySelected(iterator._last,this)));iterator.detach();return!boundariesInvalid;},detach:function(){detacher(this);},splitBoundaries:function(){assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,ec=this.endContainer,eo=this.endOffset;var startEndSame=(sc===ec);if(dom.isCharacterDataNode(ec)&&eo>0&&eo<ec.length){dom.splitDataNode(ec,eo);}
if(dom.isCharacterDataNode(sc)&&so>0&&so<sc.length){sc=dom.splitDataNode(sc,so);if(startEndSame){eo-=so;ec=sc;}else if(ec==sc.parentNode&&eo>=dom.getNodeIndex(sc)){eo++;}
so=0;}
boundaryUpdater(this,sc,so,ec,eo);},normalizeBoundaries:function(){assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,ec=this.endContainer,eo=this.endOffset;var mergeForward=function(node){var sibling=node.nextSibling;if(sibling&&sibling.nodeType==node.nodeType){ec=node;eo=node.length;node.appendData(sibling.data);sibling.parentNode.removeChild(sibling);}};var mergeBackward=function(node){var sibling=node.previousSibling;if(sibling&&sibling.nodeType==node.nodeType){sc=node;var nodeLength=node.length;so=sibling.length;node.insertData(0,sibling.data);sibling.parentNode.removeChild(sibling);if(sc==ec){eo+=so;ec=sc;}else if(ec==node.parentNode){var nodeIndex=dom.getNodeIndex(node);if(eo==nodeIndex){ec=node;eo=nodeLength;}else if(eo>nodeIndex){eo--;}}}};var normalizeStart=true;if(dom.isCharacterDataNode(ec)){if(ec.length==eo){mergeForward(ec);}}else{if(eo>0){var endNode=ec.childNodes[eo-1];if(endNode&&dom.isCharacterDataNode(endNode)){mergeForward(endNode);}}
normalizeStart=!this.collapsed;}
if(normalizeStart){if(dom.isCharacterDataNode(sc)){if(so==0){mergeBackward(sc);}}else{if(so<sc.childNodes.length){var startNode=sc.childNodes[so];if(startNode&&dom.isCharacterDataNode(startNode)){mergeBackward(startNode);}}}}else{sc=ec;so=eo;}
boundaryUpdater(this,sc,so,ec,eo);},collapseToPoint:function(node,offset){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);setRangeStartAndEnd(this,node,offset);}});copyComparisonConstants(constructor);}
function updateCollapsedAndCommonAncestor(range){range.collapsed=(range.startContainer===range.endContainer&&range.startOffset===range.endOffset);range.commonAncestorContainer=range.collapsed?range.startContainer:dom.getCommonAncestor(range.startContainer,range.endContainer);}
function updateBoundaries(range,startContainer,startOffset,endContainer,endOffset){var startMoved=(range.startContainer!==startContainer||range.startOffset!==startOffset);var endMoved=(range.endContainer!==endContainer||range.endOffset!==endOffset);range.startContainer=startContainer;range.startOffset=startOffset;range.endContainer=endContainer;range.endOffset=endOffset;updateCollapsedAndCommonAncestor(range);dispatchEvent(range,"boundarychange",{startMoved:startMoved,endMoved:endMoved});}
function detach(range){assertNotDetached(range);range.startContainer=range.startOffset=range.endContainer=range.endOffset=null;range.collapsed=range.commonAncestorContainer=null;dispatchEvent(range,"detach",null);range._listeners=null;}
function Range(doc){this.startContainer=doc;this.startOffset=0;this.endContainer=doc;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};updateCollapsedAndCommonAncestor(this);}
createPrototypeRange(Range,updateBoundaries,detach);api.rangePrototype=RangePrototype.prototype;Range.rangeProperties=rangeProperties;Range.RangeIterator=RangeIterator;Range.copyComparisonConstants=copyComparisonConstants;Range.createPrototypeRange=createPrototypeRange;Range.inspect=inspect;Range.getRangeDocument=getRangeDocument;Range.rangesEqual=function(r1,r2){return r1.startContainer===r2.startContainer&&r1.startOffset===r2.startOffset&&r1.endContainer===r2.endContainer&&r1.endOffset===r2.endOffset;};api.DomRange=Range;api.RangeException=RangeException;});rangy.createModule("WrappedRange",function(api,module){api.requireModules(["DomUtil","DomRange"]);var WrappedRange;var dom=api.dom;var DomPosition=dom.DomPosition;var DomRange=api.DomRange;function getTextRangeContainerElement(textRange){var parentEl=textRange.parentElement();var range=textRange.duplicate();range.collapse(true);var startEl=range.parentElement();range=textRange.duplicate();range.collapse(false);var endEl=range.parentElement();var startEndContainer=(startEl==endEl)?startEl:dom.getCommonAncestor(startEl,endEl);return startEndContainer==parentEl?startEndContainer:dom.getCommonAncestor(parentEl,startEndContainer);}
function textRangeIsCollapsed(textRange){return textRange.compareEndPoints("StartToEnd",textRange)==0;}
function getTextRangeBoundaryPosition(textRange,wholeRangeContainerElement,isStart,isCollapsed){var workingRange=textRange.duplicate();workingRange.collapse(isStart);var containerElement=workingRange.parentElement();if(!dom.isAncestorOf(wholeRangeContainerElement,containerElement,true)){containerElement=wholeRangeContainerElement;}
if(!containerElement.canHaveHTML){return new DomPosition(containerElement.parentNode,dom.getNodeIndex(containerElement));}
var workingNode=dom.getDocument(containerElement).createElement("span");var comparison,workingComparisonType=isStart?"StartToStart":"StartToEnd";var previousNode,nextNode,boundaryPosition,boundaryNode;do{containerElement.insertBefore(workingNode,workingNode.previousSibling);workingRange.moveToElementText(workingNode);}while((comparison=workingRange.compareEndPoints(workingComparisonType,textRange))>0&&workingNode.previousSibling);boundaryNode=workingNode.nextSibling;if(comparison==-1&&boundaryNode&&dom.isCharacterDataNode(boundaryNode)){workingRange.setEndPoint(isStart?"EndToStart":"EndToEnd",textRange);var offset;if(/[\r\n]/.test(boundaryNode.data)){var tempRange=workingRange.duplicate();var rangeLength=tempRange.text.replace(/\r\n/g,"\r").length;offset=tempRange.moveStart("character",rangeLength);while((comparison=tempRange.compareEndPoints("StartToEnd",tempRange))==-1){offset++;tempRange.moveStart("character",1);}}else{offset=workingRange.text.length;}
boundaryPosition=new DomPosition(boundaryNode,offset);}else{previousNode=(isCollapsed||!isStart)&&workingNode.previousSibling;nextNode=(isCollapsed||isStart)&&workingNode.nextSibling;if(nextNode&&dom.isCharacterDataNode(nextNode)){boundaryPosition=new DomPosition(nextNode,0);}else if(previousNode&&dom.isCharacterDataNode(previousNode)){boundaryPosition=new DomPosition(previousNode,previousNode.length);}else{boundaryPosition=new DomPosition(containerElement,dom.getNodeIndex(workingNode));}}
workingNode.parentNode.removeChild(workingNode);return boundaryPosition;}
function createBoundaryTextRange(boundaryPosition,isStart){var boundaryNode,boundaryParent,boundaryOffset=boundaryPosition.offset;var doc=dom.getDocument(boundaryPosition.node);var workingNode,childNodes,workingRange=doc.body.createTextRange();var nodeIsDataNode=dom.isCharacterDataNode(boundaryPosition.node);if(nodeIsDataNode){boundaryNode=boundaryPosition.node;boundaryParent=boundaryNode.parentNode;}else{childNodes=boundaryPosition.node.childNodes;boundaryNode=(boundaryOffset<childNodes.length)?childNodes[boundaryOffset]:null;boundaryParent=boundaryPosition.node;}
workingNode=doc.createElement("span");workingNode.innerHTML="&#feff;";if(boundaryNode){boundaryParent.insertBefore(workingNode,boundaryNode);}else{boundaryParent.appendChild(workingNode);}
workingRange.moveToElementText(workingNode);workingRange.collapse(!isStart);boundaryParent.removeChild(workingNode);if(nodeIsDataNode){workingRange[isStart?"moveStart":"moveEnd"]("character",boundaryOffset);}
return workingRange;}
if(api.features.implementsDomRange&&(!api.features.implementsTextRange||!api.config.preferTextRange)){(function(){var rangeProto;var rangeProperties=DomRange.rangeProperties;var canSetRangeStartAfterEnd;function updateRangeProperties(range){var i=rangeProperties.length,prop;while(i--){prop=rangeProperties[i];range[prop]=range.nativeRange[prop];}}
function updateNativeRange(range,startContainer,startOffset,endContainer,endOffset){var startMoved=(range.startContainer!==startContainer||range.startOffset!=startOffset);var endMoved=(range.endContainer!==endContainer||range.endOffset!=endOffset);if(startMoved||endMoved){range.setEnd(endContainer,endOffset);range.setStart(startContainer,startOffset);}}
function detach(range){range.nativeRange.detach();range.detached=true;var i=rangeProperties.length,prop;while(i--){prop=rangeProperties[i];range[prop]=null;}}
var createBeforeAfterNodeSetter;WrappedRange=function(range){if(!range){throw new Error("Range must be specified");}
this.nativeRange=range;updateRangeProperties(this);};DomRange.createPrototypeRange(WrappedRange,updateNativeRange,detach);rangeProto=WrappedRange.prototype;rangeProto.selectNode=function(node){this.nativeRange.selectNode(node);updateRangeProperties(this);};rangeProto.deleteContents=function(){this.nativeRange.deleteContents();updateRangeProperties(this);};rangeProto.extractContents=function(){var frag=this.nativeRange.extractContents();updateRangeProperties(this);return frag;};rangeProto.cloneContents=function(){return this.nativeRange.cloneContents();};rangeProto.surroundContents=function(node){this.nativeRange.surroundContents(node);updateRangeProperties(this);};rangeProto.collapse=function(isStart){this.nativeRange.collapse(isStart);updateRangeProperties(this);};rangeProto.cloneRange=function(){return new WrappedRange(this.nativeRange.cloneRange());};rangeProto.refresh=function(){updateRangeProperties(this);};rangeProto.toString=function(){return this.nativeRange.toString();};var testTextNode=document.createTextNode("test");dom.getBody(document).appendChild(testTextNode);var range=document.createRange();range.setStart(testTextNode,0);range.setEnd(testTextNode,0);try{range.setStart(testTextNode,1);canSetRangeStartAfterEnd=true;rangeProto.setStart=function(node,offset){this.nativeRange.setStart(node,offset);updateRangeProperties(this);};rangeProto.setEnd=function(node,offset){this.nativeRange.setEnd(node,offset);updateRangeProperties(this);};createBeforeAfterNodeSetter=function(name){return function(node){this.nativeRange[name](node);updateRangeProperties(this);};};}catch(ex){canSetRangeStartAfterEnd=false;rangeProto.setStart=function(node,offset){try{this.nativeRange.setStart(node,offset);}catch(ex){this.nativeRange.setEnd(node,offset);this.nativeRange.setStart(node,offset);}
updateRangeProperties(this);};rangeProto.setEnd=function(node,offset){try{this.nativeRange.setEnd(node,offset);}catch(ex){this.nativeRange.setStart(node,offset);this.nativeRange.setEnd(node,offset);}
updateRangeProperties(this);};createBeforeAfterNodeSetter=function(name,oppositeName){return function(node){try{this.nativeRange[name](node);}catch(ex){this.nativeRange[oppositeName](node);this.nativeRange[name](node);}
updateRangeProperties(this);};};}
rangeProto.setStartBefore=createBeforeAfterNodeSetter("setStartBefore","setEndBefore");rangeProto.setStartAfter=createBeforeAfterNodeSetter("setStartAfter","setEndAfter");rangeProto.setEndBefore=createBeforeAfterNodeSetter("setEndBefore","setStartBefore");rangeProto.setEndAfter=createBeforeAfterNodeSetter("setEndAfter","setStartAfter");range.selectNodeContents(testTextNode);if(range.startContainer==testTextNode&&range.endContainer==testTextNode&&range.startOffset==0&&range.endOffset==testTextNode.length){rangeProto.selectNodeContents=function(node){this.nativeRange.selectNodeContents(node);updateRangeProperties(this);};}else{rangeProto.selectNodeContents=function(node){this.setStart(node,0);this.setEnd(node,DomRange.getEndOffset(node));};}
range.selectNodeContents(testTextNode);range.setEnd(testTextNode,3);var range2=document.createRange();range2.selectNodeContents(testTextNode);range2.setEnd(testTextNode,4);range2.setStart(testTextNode,2);if(range.compareBoundaryPoints(range.START_TO_END,range2)==-1&range.compareBoundaryPoints(range.END_TO_START,range2)==1){rangeProto.compareBoundaryPoints=function(type,range){range=range.nativeRange||range;if(type==range.START_TO_END){type=range.END_TO_START;}else if(type==range.END_TO_START){type=range.START_TO_END;}
return this.nativeRange.compareBoundaryPoints(type,range);};}else{rangeProto.compareBoundaryPoints=function(type,range){return this.nativeRange.compareBoundaryPoints(type,range.nativeRange||range);};}
if(api.util.isHostMethod(range,"createContextualFragment")){rangeProto.createContextualFragment=function(fragmentStr){return this.nativeRange.createContextualFragment(fragmentStr);};}
dom.getBody(document).removeChild(testTextNode);range.detach();range2.detach();})();api.createNativeRange=function(doc){doc=doc||document;return doc.createRange();};}else if(api.features.implementsTextRange){WrappedRange=function(textRange){this.textRange=textRange;this.refresh();};WrappedRange.prototype=new DomRange(document);WrappedRange.prototype.refresh=function(){var start,end;var rangeContainerElement=getTextRangeContainerElement(this.textRange);if(textRangeIsCollapsed(this.textRange)){end=start=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,true,true);}else{start=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,true,false);end=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,false,false);}
this.setStart(start.node,start.offset);this.setEnd(end.node,end.offset);};DomRange.copyComparisonConstants(WrappedRange);var globalObj=(function(){return this;})();if(typeof globalObj.Range=="undefined"){globalObj.Range=WrappedRange;}
api.createNativeRange=function(doc){doc=doc||document;return doc.body.createTextRange();};}
if(api.features.implementsTextRange){WrappedRange.rangeToTextRange=function(range){if(range.collapsed){var tr=createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),true);return tr;}else{var startRange=createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),true);var endRange=createBoundaryTextRange(new DomPosition(range.endContainer,range.endOffset),false);var textRange=dom.getDocument(range.startContainer).body.createTextRange();textRange.setEndPoint("StartToStart",startRange);textRange.setEndPoint("EndToEnd",endRange);return textRange;}};}
WrappedRange.prototype.getName=function(){return"WrappedRange";};api.WrappedRange=WrappedRange;api.createRange=function(doc){doc=doc||document;return new WrappedRange(api.createNativeRange(doc));};api.createRangyRange=function(doc){doc=doc||document;return new DomRange(doc);};api.createIframeRange=function(iframeEl){return api.createRange(dom.getIframeDocument(iframeEl));};api.createIframeRangyRange=function(iframeEl){return api.createRangyRange(dom.getIframeDocument(iframeEl));};api.addCreateMissingNativeApiListener(function(win){var doc=win.document;if(typeof doc.createRange=="undefined"){doc.createRange=function(){return api.createRange(this);};}
doc=win=null;});});rangy.createModule("WrappedSelection",function(api,module){api.requireModules(["DomUtil","DomRange","WrappedRange"]);api.config.checkSelectionRanges=true;var BOOLEAN="boolean",windowPropertyName="_rangySelection",dom=api.dom,util=api.util,DomRange=api.DomRange,WrappedRange=api.WrappedRange,DOMException=api.DOMException,DomPosition=dom.DomPosition,getSelection,selectionIsCollapsed,CONTROL="Control";function getWinSelection(winParam){return(winParam||window).getSelection();}
function getDocSelection(winParam){return(winParam||window).document.selection;}
var implementsWinGetSelection=api.util.isHostMethod(window,"getSelection"),implementsDocSelection=api.util.isHostObject(document,"selection");var useDocumentSelection=implementsDocSelection&&(!implementsWinGetSelection||api.config.preferTextRange);if(useDocumentSelection){getSelection=getDocSelection;api.isSelectionValid=function(winParam){var doc=(winParam||window).document,nativeSel=doc.selection;return(nativeSel.type!="None"||dom.getDocument(nativeSel.createRange().parentElement())==doc);};}else if(implementsWinGetSelection){getSelection=getWinSelection;api.isSelectionValid=function(){return true;};}else{module.fail("Neither document.selection or window.getSelection() detected.");}
api.getNativeSelection=getSelection;var testSelection=getSelection();var testRange=api.createNativeRange(document);var body=dom.getBody(document);var selectionHasAnchorAndFocus=util.areHostObjects(testSelection,["anchorNode","focusNode"]&&util.areHostProperties(testSelection,["anchorOffset","focusOffset"]));api.features.selectionHasAnchorAndFocus=selectionHasAnchorAndFocus;var selectionHasExtend=util.isHostMethod(testSelection,"extend");api.features.selectionHasExtend=selectionHasExtend;var selectionHasRangeCount=(typeof testSelection.rangeCount=="number");api.features.selectionHasRangeCount=selectionHasRangeCount;var selectionSupportsMultipleRanges=false;var collapsedNonEditableSelectionsSupported=true;if(util.areHostMethods(testSelection,["addRange","getRangeAt","removeAllRanges"])&&typeof testSelection.rangeCount=="number"&&api.features.implementsDomRange){(function(){var iframe=document.createElement("iframe");iframe.frameBorder=0;iframe.style.position="absolute";iframe.style.left="-10000px";body.appendChild(iframe);var iframeDoc=dom.getIframeDocument(iframe);iframeDoc.open();iframeDoc.write("<html><head></head><body>12</body></html>");iframeDoc.close();var sel=dom.getIframeWindow(iframe).getSelection();var docEl=iframeDoc.documentElement;var iframeBody=docEl.lastChild,textNode=iframeBody.firstChild;var r1=iframeDoc.createRange();r1.setStart(textNode,1);r1.collapse(true);sel.addRange(r1);collapsedNonEditableSelectionsSupported=(sel.rangeCount==1);sel.removeAllRanges();var r2=r1.cloneRange();r1.setStart(textNode,0);r2.setEnd(textNode,2);sel.addRange(r1);sel.addRange(r2);selectionSupportsMultipleRanges=(sel.rangeCount==2);r1.detach();r2.detach();body.removeChild(iframe);})();}
api.features.selectionSupportsMultipleRanges=selectionSupportsMultipleRanges;api.features.collapsedNonEditableSelectionsSupported=collapsedNonEditableSelectionsSupported;var implementsControlRange=false,testControlRange;if(body&&util.isHostMethod(body,"createControlRange")){testControlRange=body.createControlRange();if(util.areHostProperties(testControlRange,["item","add"])){implementsControlRange=true;}}
api.features.implementsControlRange=implementsControlRange;if(selectionHasAnchorAndFocus){selectionIsCollapsed=function(sel){return sel.anchorNode===sel.focusNode&&sel.anchorOffset===sel.focusOffset;};}else{selectionIsCollapsed=function(sel){return sel.rangeCount?sel.getRangeAt(sel.rangeCount-1).collapsed:false;};}
function updateAnchorAndFocusFromRange(sel,range,backwards){var anchorPrefix=backwards?"end":"start",focusPrefix=backwards?"start":"end";sel.anchorNode=range[anchorPrefix+"Container"];sel.anchorOffset=range[anchorPrefix+"Offset"];sel.focusNode=range[focusPrefix+"Container"];sel.focusOffset=range[focusPrefix+"Offset"];}
function updateAnchorAndFocusFromNativeSelection(sel){var nativeSel=sel.nativeSelection;sel.anchorNode=nativeSel.anchorNode;sel.anchorOffset=nativeSel.anchorOffset;sel.focusNode=nativeSel.focusNode;sel.focusOffset=nativeSel.focusOffset;}
function updateEmptySelection(sel){sel.anchorNode=sel.focusNode=null;sel.anchorOffset=sel.focusOffset=0;sel.rangeCount=0;sel.isCollapsed=true;sel._ranges.length=0;}
function getNativeRange(range){var nativeRange;if(range instanceof DomRange){nativeRange=range._selectionNativeRange;if(!nativeRange){nativeRange=api.createNativeRange(dom.getDocument(range.startContainer));nativeRange.setEnd(range.endContainer,range.endOffset);nativeRange.setStart(range.startContainer,range.startOffset);range._selectionNativeRange=nativeRange;range.attachListener("detach",function(){this._selectionNativeRange=null;});}}else if(range instanceof WrappedRange){nativeRange=range.nativeRange;}else if(api.features.implementsDomRange&&(range instanceof dom.getWindow(range.startContainer).Range)){nativeRange=range;}
return nativeRange;}
function rangeContainsSingleElement(rangeNodes){if(!rangeNodes.length||rangeNodes[0].nodeType!=1){return false;}
for(var i=1,len=rangeNodes.length;i<len;++i){if(!dom.isAncestorOf(rangeNodes[0],rangeNodes[i])){return false;}}
return true;}
function getSingleElementFromRange(range){var nodes=range.getNodes();if(!rangeContainsSingleElement(nodes)){throw new Error("getSingleElementFromRange: range "+range.inspect()+" did not consist of a single element");}
return nodes[0];}
function isTextRange(range){return!!range&&typeof range.text!="undefined";}
function updateFromTextRange(sel,range){var wrappedRange=new WrappedRange(range);sel._ranges=[wrappedRange];updateAnchorAndFocusFromRange(sel,wrappedRange,false);sel.rangeCount=1;sel.isCollapsed=wrappedRange.collapsed;}
function updateControlSelection(sel){sel._ranges.length=0;if(sel.docSelection.type=="None"){updateEmptySelection(sel);}else{var controlRange=sel.docSelection.createRange();if(isTextRange(controlRange)){updateFromTextRange(sel,controlRange);}else{sel.rangeCount=controlRange.length;var range,doc=dom.getDocument(controlRange.item(0));for(var i=0;i<sel.rangeCount;++i){range=api.createRange(doc);range.selectNode(controlRange.item(i));sel._ranges.push(range);}
sel.isCollapsed=sel.rangeCount==1&&sel._ranges[0].collapsed;updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],false);}}}
function addRangeToControlSelection(sel,range){var controlRange=sel.docSelection.createRange();var rangeElement=getSingleElementFromRange(range);var doc=dom.getDocument(controlRange.item(0));var newControlRange=dom.getBody(doc).createControlRange();for(var i=0,len=controlRange.length;i<len;++i){newControlRange.add(controlRange.item(i));}
try{newControlRange.add(rangeElement);}catch(ex){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}
newControlRange.select();updateControlSelection(sel);}
var getSelectionRangeAt;if(util.isHostMethod(testSelection,"getRangeAt")){getSelectionRangeAt=function(sel,index){try{return sel.getRangeAt(index);}catch(ex){return null;}};}else if(selectionHasAnchorAndFocus){getSelectionRangeAt=function(sel){var doc=dom.getDocument(sel.anchorNode);var range=api.createRange(doc);range.setStart(sel.anchorNode,sel.anchorOffset);range.setEnd(sel.focusNode,sel.focusOffset);if(range.collapsed!==this.isCollapsed){range.setStart(sel.focusNode,sel.focusOffset);range.setEnd(sel.anchorNode,sel.anchorOffset);}
return range;};}
function WrappedSelection(selection,docSelection,win){this.nativeSelection=selection;this.docSelection=docSelection;this._ranges=[];this.win=win;this.refresh();}
api.getSelection=function(win){win=win||window;var sel=win[windowPropertyName];var nativeSel=getSelection(win),docSel=implementsDocSelection?getDocSelection(win):null;if(sel){sel.nativeSelection=nativeSel;sel.docSelection=docSel;sel.refresh(win);}else{sel=new WrappedSelection(nativeSel,docSel,win);win[windowPropertyName]=sel;}
return sel;};api.getIframeSelection=function(iframeEl){return api.getSelection(dom.getIframeWindow(iframeEl));};var selProto=WrappedSelection.prototype;function createControlSelection(sel,ranges){var doc=dom.getDocument(ranges[0].startContainer);var controlRange=dom.getBody(doc).createControlRange();for(var i=0,el;i<rangeCount;++i){el=getSingleElementFromRange(ranges[i]);try{controlRange.add(el);}catch(ex){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}
controlRange.select();updateControlSelection(sel);}
if(!useDocumentSelection&&selectionHasAnchorAndFocus&&util.areHostMethods(testSelection,["removeAllRanges","addRange"])){selProto.removeAllRanges=function(){this.nativeSelection.removeAllRanges();updateEmptySelection(this);};var addRangeBackwards=function(sel,range){var doc=DomRange.getRangeDocument(range);var endRange=api.createRange(doc);endRange.collapseToPoint(range.endContainer,range.endOffset);sel.nativeSelection.addRange(getNativeRange(endRange));sel.nativeSelection.extend(range.startContainer,range.startOffset);sel.refresh();};if(selectionHasRangeCount){selProto.addRange=function(range,backwards){if(implementsControlRange&&implementsDocSelection&&this.docSelection.type==CONTROL){addRangeToControlSelection(this,range);}else{if(backwards&&selectionHasExtend){addRangeBackwards(this,range);}else{var previousRangeCount;if(selectionSupportsMultipleRanges){previousRangeCount=this.rangeCount;}else{this.removeAllRanges();previousRangeCount=0;}
this.nativeSelection.addRange(getNativeRange(range));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==previousRangeCount+1){if(api.config.checkSelectionRanges){var nativeRange=getSelectionRangeAt(this.nativeSelection,this.rangeCount-1);if(nativeRange&&!DomRange.rangesEqual(nativeRange,range)){range=new WrappedRange(nativeRange);}}
this._ranges[this.rangeCount-1]=range;updateAnchorAndFocusFromRange(this,range,selectionIsBackwards(this.nativeSelection));this.isCollapsed=selectionIsCollapsed(this);}else{this.refresh();}}}};}else{selProto.addRange=function(range,backwards){if(backwards&&selectionHasExtend){addRangeBackwards(this,range);}else{this.nativeSelection.addRange(getNativeRange(range));this.refresh();}};}
selProto.setRanges=function(ranges){if(implementsControlRange&&ranges.length>1){createControlSelection(this,ranges);}else{this.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){this.addRange(ranges[i]);}}};}else if(util.isHostMethod(testSelection,"empty")&&util.isHostMethod(testRange,"select")&&implementsControlRange&&useDocumentSelection){selProto.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var doc;if(this.anchorNode){doc=dom.getDocument(this.anchorNode);}else if(this.docSelection.type==CONTROL){var controlRange=this.docSelection.createRange();if(controlRange.length){doc=dom.getDocument(controlRange.item(0)).body.createTextRange();}}
if(doc){var textRange=doc.body.createTextRange();textRange.select();this.docSelection.empty();}}}catch(ex){}
updateEmptySelection(this);};selProto.addRange=function(range){if(this.docSelection.type==CONTROL){addRangeToControlSelection(this,range);}else{WrappedRange.rangeToTextRange(range).select();this._ranges[0]=range;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;updateAnchorAndFocusFromRange(this,range,false);}};selProto.setRanges=function(ranges){this.removeAllRanges();var rangeCount=ranges.length;if(rangeCount>1){createControlSelection(this,ranges);}else if(rangeCount){this.addRange(ranges[0]);}};}else{module.fail("No means of selecting a Range or TextRange was found");return false;}
selProto.getRangeAt=function(index){if(index<0||index>=this.rangeCount){throw new DOMException("INDEX_SIZE_ERR");}else{return this._ranges[index];}};var refreshSelection;if(useDocumentSelection){refreshSelection=function(sel){var range;if(api.isSelectionValid(sel.win)){range=sel.docSelection.createRange();}else{range=dom.getBody(sel.win.document).createTextRange();range.collapse(true);}
if(sel.docSelection.type==CONTROL){updateControlSelection(sel);}else if(isTextRange(range)){updateFromTextRange(sel,range);}else{updateEmptySelection(sel);}};}else if(util.isHostMethod(testSelection,"getRangeAt")&&typeof testSelection.rangeCount=="number"){refreshSelection=function(sel){if(implementsControlRange&&implementsDocSelection&&sel.docSelection.type==CONTROL){updateControlSelection(sel);}else{sel._ranges.length=sel.rangeCount=sel.nativeSelection.rangeCount;if(sel.rangeCount){for(var i=0,len=sel.rangeCount;i<len;++i){sel._ranges[i]=new api.WrappedRange(sel.nativeSelection.getRangeAt(i));}
updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],selectionIsBackwards(sel.nativeSelection));sel.isCollapsed=selectionIsCollapsed(sel);}else{updateEmptySelection(sel);}}};}else if(selectionHasAnchorAndFocus&&typeof testSelection.isCollapsed==BOOLEAN&&typeof testRange.collapsed==BOOLEAN&&api.features.implementsDomRange){refreshSelection=function(sel){var range,nativeSel=sel.nativeSelection;if(nativeSel.anchorNode){range=getSelectionRangeAt(nativeSel,0);sel._ranges=[range];sel.rangeCount=1;updateAnchorAndFocusFromNativeSelection(sel);sel.isCollapsed=selectionIsCollapsed(sel);}else{updateEmptySelection(sel);}};}else{module.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false;}
selProto.refresh=function(checkForChanges){var oldRanges=checkForChanges?this._ranges.slice(0):null;refreshSelection(this);if(checkForChanges){var i=oldRanges.length;if(i!=this._ranges.length){return false;}
while(i--){if(!DomRange.rangesEqual(oldRanges[i],this._ranges[i])){return false;}}
return true;}};var removeRangeManually=function(sel,range){var ranges=sel.getAllRanges(),removed=false;sel.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){if(removed||range!==ranges[i]){sel.addRange(ranges[i]);}else{removed=true;}}
if(!sel.rangeCount){updateEmptySelection(sel);}};if(implementsControlRange){selProto.removeRange=function(range){if(this.docSelection.type==CONTROL){var controlRange=this.docSelection.createRange();var rangeElement=getSingleElementFromRange(range);var doc=dom.getDocument(controlRange.item(0));var newControlRange=dom.getBody(doc).createControlRange();var el,removed=false;for(var i=0,len=controlRange.length;i<len;++i){el=controlRange.item(i);if(el!==rangeElement||removed){newControlRange.add(controlRange.item(i));}else{removed=true;}}
newControlRange.select();updateControlSelection(this);}else{removeRangeManually(this,range);}};}else{selProto.removeRange=function(range){removeRangeManually(this,range);};}
var selectionIsBackwards;if(!useDocumentSelection&&selectionHasAnchorAndFocus&&api.features.implementsDomRange){selectionIsBackwards=function(sel){var backwards=false;if(sel.anchorNode){backwards=(dom.comparePoints(sel.anchorNode,sel.anchorOffset,sel.focusNode,sel.focusOffset)==1);}
return backwards;};selProto.isBackwards=function(){return selectionIsBackwards(this);};}else{selectionIsBackwards=selProto.isBackwards=function(){return false;};}
selProto.toString=function(){var rangeTexts=[];for(var i=0,len=this.rangeCount;i<len;++i){rangeTexts[i]=""+this._ranges[i];}
return rangeTexts.join("");};function assertNodeInSameDocument(sel,node){if(sel.anchorNode&&(dom.getDocument(sel.anchorNode)!==dom.getDocument(node))){throw new DOMException("WRONG_DOCUMENT_ERR");}}
selProto.collapse=function(node,offset){assertNodeInSameDocument(this,node);var range=api.createRange(dom.getDocument(node));range.collapseToPoint(node,offset);this.removeAllRanges();this.addRange(range);this.isCollapsed=true;};selProto.collapseToStart=function(){if(this.rangeCount){var range=this._ranges[0];this.collapse(range.startContainer,range.startOffset);}else{throw new DOMException("INVALID_STATE_ERR");}};selProto.collapseToEnd=function(){if(this.rangeCount){var range=this._ranges[this.rangeCount-1];this.collapse(range.endContainer,range.endOffset);}else{throw new DOMException("INVALID_STATE_ERR");}};selProto.selectAllChildren=function(node){assertNodeInSameDocument(this,node);var range=api.createRange(dom.getDocument(node));range.selectNodeContents(node);this.removeAllRanges();this.addRange(range);};selProto.deleteFromDocument=function(){if(implementsControlRange&&implementsDocSelection&&this.docSelection.type==CONTROL){var controlRange=this.docSelection.createRange();var element;while(controlRange.length){element=controlRange.item(0);controlRange.remove(element);element.parentNode.removeChild(element);}
this.refresh();}else if(this.rangeCount){var ranges=this.getAllRanges();this.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){ranges[i].deleteContents();}
this.addRange(ranges[len-1]);}};selProto.getAllRanges=function(){return this._ranges.slice(0);};selProto.setSingleRange=function(range){this.setRanges([range]);};selProto.containsNode=function(node,allowPartial){for(var i=0,len=this._ranges.length;i<len;++i){if(this._ranges[i].containsNode(node,allowPartial)){return true;}}
return false;};selProto.toHtml=function(){var html="";if(this.rangeCount){var container=DomRange.getRangeDocument(this._ranges[0]).createElement("div");for(var i=0,len=this._ranges.length;i<len;++i){container.appendChild(this._ranges[i].cloneContents());}
html=container.innerHTML;}
return html;};function inspect(sel){var rangeInspects=[];var anchor=new DomPosition(sel.anchorNode,sel.anchorOffset);var focus=new DomPosition(sel.focusNode,sel.focusOffset);var name=(typeof sel.getName=="function")?sel.getName():"Selection";if(typeof sel.rangeCount!="undefined"){for(var i=0,len=sel.rangeCount;i<len;++i){rangeInspects[i]=DomRange.inspect(sel.getRangeAt(i));}}
return"["+name+"(Ranges: "+rangeInspects.join(", ")+")(anchor: "+anchor.inspect()+", focus: "+focus.inspect()+"]";}
selProto.getName=function(){return"WrappedSelection";};selProto.inspect=function(){return inspect(this);};selProto.detach=function(){this.win[windowPropertyName]=null;this.win=this.anchorNode=this.focusNode=null;};WrappedSelection.inspect=inspect;api.Selection=WrappedSelection;api.selectionPrototype=selProto;api.addCreateMissingNativeApiListener(function(win){if(typeof win.getSelection=="undefined"){win.getSelection=function(){return api.getSelection(this);};}
win=null;});});$j=$;(function($){$.ajaxSetup({dataFilter:function(data,dataType){if(dataType=='json')
{if(data.substr(9,5)=='unidb')
{var unidb=Box.Application.getService('unidb');return unidb.decode($.parseJSON(data));}}
return data;},beforeSend:function(xhr,settings)
{settings.converters['text json']=$.parseJSON;if(settings.type.toLowerCase()!='post')return true;if(typeof settings.data=='string')
{if(settings.data.indexOf('request_token=')==-1)
{if(settings.data.length>0)settings.data+='&';settings.data+='request_token='+window.request_token;}
if(settings.data.length>0)settings.data+='&';if(typeof(Realtime_Notification)!='undefined')
{settings.data+='realtime_subscriber_id='+Realtime_Notification.subscriber_id;}}
else
{if(!settings.data)settings.data={};if(!settings.data.request_token)settings.data.request_token=window.request_token;if(typeof(Realtime_Notification)!='undefined')
{settings.data.realtime_subscriber_id=Realtime_Notification.subscriber_id;}}
return true;}});var create_ajax_function=function(function_type,function_data_type)
{return function(url,data,callback,data_type,params)
{if(function_data_type!='')
{params=data_type;data_type=function_data_type;}
if(jQuery.isFunction(data)){params=callback;callback=data;data=null;}
params=$.extend({},params,{type:function_type,url:url,data:data,success:callback,dataType:data_type});return $.ajax(params);};};var __convert_to_text_div;var originalParseJSON=$.parseJSON;$.extend({parseJSON:function(value){return(typeof value==='object')?value:originalParseJSON.call(this,value);},get:create_ajax_function('GET',''),getJSON:create_ajax_function('GET','json'),getCrossDomain:(function(){if($.support.cors){return create_ajax_function('GET','json');}
return create_ajax_function('GET','jsonp');}()),arrayDiff:function(a1,a2){if(a1.length==0&&a2.length==0)return false;var array,other;if(a1.length-a2.length>=0)
{array=a1;other=a2;}
else
{array=a2;other=a1;}
for(var i=0;i<array.length;i++)
{if($.inArray(array[i],other)==-1)return true;}
return false;},post:create_ajax_function('POST',''),postJSON:create_ajax_function('POST','json'),box:{formatQuery:function(query){function toURIComponents(obj,prefix,data){prefix=prefix||'';data=data||[];if(typeof obj=='string'||typeof obj=='number'){data.push(prefix+'='+encodeURIComponent(obj));}else if(typeof obj=='boolean'){data.push(prefix+'='+(obj?1:0));}else{for(var p in obj){data=toURIComponents(obj[p],prefix+'['+p+']',data);}}
return data;}
return toURIComponents(query,'q').join('&');},isEmail:function(str){var email_regex=new RegExp('^[^\\s<>@,]+@[^\\s<>@,\\\\\/]+\\.[^\\s<>@,\\\\\/]+$','i');return email_regex.exec(str.split('\\').join('\\'))?true:false;},test_password_strength:function(j_strength_meter_container,j_password_field,options)
{options=options||{};$j.postJSON('/index.php?rm=box_password_strength_meter',{password:j_password_field.val()},function password_strength_callback(json)
{j_strength_meter_container.html(json.html);if($.isFunction(options.password_callback))
{options.password_callback.apply(j_password_field,[json.strong_enough]);}});},escapeHTML:function(text){if(text===null||typeof text==='undefined'){text='';}
if(!__convert_to_text_div)__convert_to_text_div=document.createElement('div');if('innerText'in __convert_to_text_div){__convert_to_text_div.innerText=text;}else{__convert_to_text_div.textContent=text;}
var prefiltered_text=__convert_to_text_div.innerHTML.replace(/"/g,'&quot;').replace(/'/g,'&#039;');return prefiltered_text;},purifyHTML:function(text)
{var skip_closing_tag=false;var MAX_PAYLOAD_SIZE=4194304;if(typeof text!='string')return text;var replace_tags_function=function(matched,substring1,substring2,substring3)
{return substring1+'s'+substring3;};var replace_script_tag_function=function(matched,substring1,substring2,substring3)
{var return_val;if(substring3.indexOf(' type="text/x-template"')>=0||substring3.indexOf(' type="text/x-config"')>=0)
{skip_closing_tag=true;return matched;}
return_val=substring1+'s'+substring3;if(substring1=='</')
{if(skip_closing_tag)
{return_val=matched;}
skip_closing_tag=false;}
return return_val;};var replace_javascript_colon_function=function(matched,substring1,substring2,substring3)
{if(substring1==='application/x-')
{return matched;}
return matched.replace(substring2,'x');};var regex=[{pattern:'(^|(?:application\\/x)?[^>\\s\\w]+)\\s*(javascript:)',replacement:replace_javascript_colon_function,enabled:true},{pattern:'on(click|mouseover|mouseout|mousedown|mouseup|mouseenter|mouseleave|mousemove|keydown|keyup|keypress|error|load|blur|change|dblclick|focus|focusin|focusout|reset|resize|scroll|select|submit|unload|start|bounce|finish)[\\s]*=[\\s]*["]*[^>|^"|^\\s]*["]*',replacement:'',enabled:true},{pattern:'(<[\\/]*)(style)([^>]*>)',replacement:replace_tags_function,enabled:true},{pattern:'(<[\\/]*)(script)([^>]*>)',replacement:replace_script_tag_function,enabled:true}];var regex_patterns=[{regex:new RegExp(regex[0].pattern,'gi'),log:new RegExp(regex[0].pattern+'[^<>]*','gi')},{regex:new RegExp(regex[1].pattern,'gi'),log:new RegExp(regex[1].pattern+'[^<>]*','gi')},{regex:new RegExp(regex[2].pattern,'gi'),log:new RegExp(regex[2].pattern+'[^<>]*','gi')},{regex:new RegExp(regex[3].pattern,'gi'),log:new RegExp(regex[3].pattern+'[^<>]*','gi')}];var result=text;for(var i=0,length=regex.length;i<length;i++)
{var regex_pattern=regex_patterns[i].regex;var pre_regex_text=result;if(regex[i].enabled)
{result=pre_regex_text.replace(regex_pattern,regex[i].replacement);}
if(result!==pre_regex_text||!regex[i].enabled)
{var matched=text.match(regex_patterns[i].log);if(matched&&matched.length>0)
{if((typeof(live_site)=='undefined'||!live_site))
{$j.error('Purifier matches found!\nThe regex is: '+regex_pattern+'\nThe problematic string is:\n'+matched+'\nThe escaped version is:\n'+$.box.escapeHTML(matched)+'\n');}
else
{try
{throw new Error('Purifier regex matched!');}
catch(e)
{var url_service=Box.Application.getService('url');var payload_size=pre_regex_text.length;var params={regex:regex_pattern,matched_string:matched,original_string:payload_size<MAX_PAYLOAD_SIZE?pre_regex_text:pre_regex_text.substring(0,MAX_PAYLOAD_SIZE),current_url:(url_service?url_service.getCurrentWindowUrl():window.location.href),stack_trace:e.stack?e.stack.substring(0,1000):'',payload_size:payload_size};var logService=Box.Application.getService('logger');logService.sendLog('security_xss','xss_regex_matched',params);}}}}}
return result;}},log:function()
{if((typeof(live_site)=='undefined'||!live_site)&&typeof(console)!='undefined'&&console.log&&console.log.constructor==Function)
{console.log.apply(console,arguments);}},error:function()
{if((typeof(live_site)=='undefined'||!live_site)&&typeof(console)!='undefined'&&console.error&&console.error.constructor==Function)
{console.error.apply(console,arguments);}},throw_error:function()
{var error_arguments=$j.makeArray(arguments);error_arguments.unshift('Uncaught Error:');$j.log.apply($j,error_arguments);},not_implemented:function(message)
{$j.throw_error('not implement yet',message);},abstract_function:function()
{$j.throw_error('Abstract function not defined in',this);},size:function(object)
{if(object.hasOwnProperty('length'))return object.length;var length=0,i;for(i in object)length++;return length;},in_array:function(elem,array)
{return $j.inArray(elem,array)!=-1;},elementIsDescendent:function(elem,container)
{var parent=elem;while(parent&&parent!=container)
{try
{parent=parent.parentNode;}
catch(error)
{parent=container;}}
return parent==container;}});$.extend($.expr[':'],{focus:function(element){return element==document.activeElement;}});var original={$:$,html:$.fn.html,before:$.fn.before,after:$.fn.after,append:$.fn.append,prepend:$.fn.prepend,init:$.fn.init,attr:$.fn.attr};function purifyArray(values){var purified=[];for(var i=0,len=values.length;i<len;i++){if($.isArray(values[i])){purified.push(purifyArray(values[i]));}else{purified.push((typeof values[i]==='string')?$.box.purifyHTML(values[i]):values[i]);}}
return purified;}
function createPurifiedFunction(originalName){return function(){return original[originalName].apply(this,purifyArray(arguments));};}
$.fn.extend({html:createPurifiedFunction('html'),before:createPurifiedFunction('before'),after:createPurifiedFunction('after'),append:createPurifiedFunction('append'),prepend:createPurifiedFunction('prepend'),init:function(text,context,rootjQuery){if(typeof text==='string'&&text.indexOf('<')>-1){text=$.box.purifyHTML(text);}
return new original.init(text,context,rootjQuery);},unsafeAppend:function(text){if(typeof text!=='string'||arguments.length>1){throw new Error('unsafeAppend() requires a single string argument.');}
return original.append.call(this,text);},attr:function(name,value){var newArgs=$.makeArray(arguments);if(newArgs.length>1){newArgs[1]=$.box.purifyHTML(value);}
return original.attr.apply(this,newArgs);},attach:function(element){var offset=$j(this).offset();var height=$j(this).outerHeight();$j(element).css({position:'absolute',top:offset.top+height,left:offset.left});return this;},boxDatePicker:function(settings){var box_settings=$.extend({},$.DATEPICKER_DEFAULTS,{mandatory:true},settings);this.datepicker(box_settings);},fastText:function(str){if(!str)return this.text();return this.each(function(){(typeof this.innerText!='undefined')?this.innerText=str:this.textContent=str;});},hasParent:function(str){return(this.parents(str).length>0);}});$.box.appendRequestToken=function(form){var j_request_token=$(form).find('input[name="request_token"]');if(j_request_token.length>0)
{j_request_token.val(window.request_token);}
else
{$('<input type="hidden" name="request_token" style="display: none;" />').val(window.request_token).appendTo(form);}};$.addRequestTokens=function(o){$('form').each(function(){var j_this=$(this);if(j_this.prop('method').toLowerCase()!='post')return;if(j_this.find('input[name="request_token"]').length>0)return;$.box.appendRequestToken(this);});};$(function(){$.addRequestTokens();if($.validator)
{$.validator.setDefaults({errorElement:'span',errorPlacement:function(error,element){error.addClass('img icon sprite_16x16_error').css('position','absolute').text('').insertAfter(element);var el_position=element.position();var el_outer_height=element.outerHeight();var top_margin=(el_outer_height-error.outerHeight())/2;var el_margin_top=element.css('margin-top')?parseInt(element.css('margin-top').replace('px','')):0,el_margin_left=element.css('margin-left')?parseInt(element.css('margin-left').replace('px','')):0;var error_margin_right=error.css('margin-right');error_margin_right=error_margin_right.substring(0,error_margin_right.length-2);var error_margin_top=error.css('margin-top');error_margin_top=error_margin_top.substring(0,error_margin_top.length-2);if(isNaN(parseInt(error_margin_right)))error_margin_right=0;if(isNaN(parseInt(error_margin_top)))error_margin_top=0;error_margin_top=parseInt(error_margin_top);var left=el_position.left+element.outerWidth()-error.outerWidth()-error_margin_right+el_margin_left;var pos_top=el_position.top+top_margin+error_margin_top+el_margin_top;error.css('left',left+'px').css('top',pos_top+'px');if($j('.error_msg').is(':visible'))
{error.data('position_fixed',true);}
error.removeClass('img icon sprite_16x16_error');},showErrors:function(errorMap,errorList){this.defaultShowErrors();var list_length=errorList.length;for(var i=0;this.errorList[i];i++){var error_info=this.errorList[i];var element=error_info.element;var error=this.errorsFor(element);var showTooltipOnErrorIcon=false;this.settings.errorPlacement(error,$j(element));error.addClass('img icon sprite_16x16_error').text('').attr({'data-hover':'tooltip','aria-label':error_info.message});showTooltipOnErrorIcon=true;var j_error_msg=$j('.error_msg');if(j_error_msg.is(':visible')&&!error.data('position_fixed'))
{if(typeof(Tombstone)!='undefined')Tombstone.marker('./js/plugins/jquery/jquery.box.js:13490','2013-05-15','auto tombstoned');error.css('top',error.position().top+j_error_msg.outerHeight()).data('position_fixed',true);}
$j(element).parent().children('label').addClass('error');$j(element).parent().children('label').contents().filter(function(){return this.nodeType==3;}).wrap('<span></span>');$j(element).parent().children('label').children('span').attr({'data-hover':'tooltip','aria-label':error_info.message});if(list_length==1&&!$j(element).is(':focus'))
{var error_element=error;if(error.attr('generated')&&!showTooltipOnErrorIcon)
{error_element=error.parent().find('input');}
var tooltips=Box.Application.getService('tooltips');if(tooltips)
{tooltips.showTooltips({element:error_element.get(0),duration:(this.settings.tip_delay?this.settings.tip_delay:1200)});}}}
var resize_timer;$j(window).resize(function(){clearTimeout(resize_timer);resize_timer=setTimeout(function(){$j('.error.icon').remove();},200);});},unhighlight:function(element,errorClass,validClass)
{$j(element).removeClass(errorClass).addClass(validClass);$j(element).removeAttr('title data-hover aria-label');$j(element).parent().children('label').removeClass('error');$j(element).parent().children('label').children('span').removeAttr('title data-hover aria-label');}});}});$.in_error=0;$.oldAjax=$.ajax;$.ajax=function(s){var oldSuccess=s.success;s.success=function(response){$.in_error=0;if(typeof response=='object'&&response)
{if(response.e_session)
{var url_service=Box.Application.getService('url');var path_prefix=window.path_prefix?window.path_prefix:'';var v5=Box.Application.getService('v5');window.onbeforeunload=null;if(response.errormessage=='session limit reached')
{url_service.goToUrl('/'+path_prefix+'logout');}
else if(window.widget_original_url&&(response.errormessage=='request token invalid'||response.errormessage=='redirect required'||response.errormessage=='session expired'))
{url_service.goToUrl(window.widget_original_url+'&session_expired=1');}
else if(response.errormessage=='request token invalid'||response.errormessage=='redirect required')
{alert($t('The page you were viewing has expired. Please try your request again.','page_expired_error_message'));window.location.reload();}
else if(response.errormessage=='feature access not allowed')
{if(typeof(Tombstone)!='undefined')Tombstone.marker('./js/plugins/jquery/jquery.box.js:13502','2013-05-15','auto tombstoned');url_service.goToUrl('/master/settings/account');}
else if(response.errormessage==='ip blocked')
{var win=v5.get('window');win.location.reload();}
else
{url_service.goToUrl('/'+path_prefix+'login');}
return false;}}
if($.isFunction(oldSuccess))oldSuccess.apply(this,arguments);};var oldError=s.error;s.error=function(xhr,error,exception){if($.popup&&$.popup.get().is(':visible')){$.popup.revert();}
if($.in_error==0){$.in_error=1;var url='/index.php?rm=box_ajax_log_response_error',code,response,statustext;if(error&&error!='timeout')
{code=xhr.status;response=xhr.responseText;try
{statustext=xhr.statusText;}
catch(e)
{if(typeof(Tombstone)!='undefined')Tombstone.marker('./js/plugins/jquery/jquery.box.js:13504','2013-05-15','auto tombstoned');statustext='';}}
var data={error:error,code:typeof code=='undefined'?'':code,response:typeof response=='undefined'?'':response,statustext:typeof statustext=='undefined'?'':statustext,exception:typeof exception=='undefined'?'':exception,request_url:s.url,request_type:s.type,request_data:s.data,current_location:window.location.href};var is_dead_long_poll=(xhr.status==0&&xhr.readyState==0);if(!is_dead_long_poll)
{$.post(url,data);}}
if($.isFunction(oldError))oldError.apply(this,arguments);};var is_embed_widget=!!window.is_embed_widget;if(!s.no_context&&(typeof window.current_rm!='undefined'&&((current_rm=='box_shared_show'||current_rm=='box_shared_show_by_name'||current_rm=='box_view_vanity_url')||(is_embed_widget&&current_rm=='box_files'))))
{var query_params={};var context=Canvas.get().context();if(context.shared_item)
{query_params.shared_item=context.shared_item;}
if(window.Features&&window.additional_context)
{query_params.additional_context=window.additional_context;}
var query=$j.box.formatQuery(query_params);if(typeof s.data=='string')
{s.data+=(s.data?'&':'')+query;}
else
{s.url+=(s.url.indexOf('?')>0?'&':'?')+query;}}
if(!s.no_context&&is_embed_widget)
{var navState=Box.Application.getService('nav-state'),state=navState.get();var sort=state.sort?state.sort:window.widget_sort;var sort_direction=state.sortDirection?state.sortDirection:window.widget_direction;var widget_config_query_string='&widget_config[view]='+encodeURIComponent(window.widget_view)+'&widget_config[sort]='+encodeURIComponent(sort)+'&widget_config[direction]='+encodeURIComponent(sort_direction)+'&widget_config[theme]='+encodeURIComponent(window.widget_theme)+'&widget_config[show_item_feed_actions]='+encodeURIComponent(window.widget_show_item_feed_actions)+'&widget_config[show_parent_path]='+encodeURIComponent(window.widget_show_parent_path)+'&widget_config[root_folder_id]='+encodeURIComponent(window.widget_root_folder_id)+'&widget_config[view_file_only]='+encodeURIComponent(window.widget_view_file_only)+'&widget_config[shared_name]='+encodeURIComponent(window.widget_shared_name);if(typeof s.data=='string')
{s.data+=(s.data?'&':'')+'is_embed_widget='+encodeURIComponent(navState.isEmbedWidget());s.data+=widget_config_query_string;}
else
{s.url+=(s.url.indexOf('?')>0?'&':'?')+'is_embed_widget='+encodeURIComponent(navState.isEmbedWidget());s.url+=widget_config_query_string;}}
var progress_callback=s.progress_callback,get_progress_results;if(progress_callback&&$.isFunction(progress_callback))
{var request_key=Math.random();if(typeof s.data!=='string')
{s.data.request_key_for_adding_progress_results=request_key;}
else
{s.data+=(s.data?'&':'')+'request_key_for_adding_progress_results='+encodeURIComponent(request_key);}
var request_finished=false;var failed_attempt_count=0;get_progress_results=function()
{$.getJSON('/index.php?rm=box_get_progress_results_percentage',{request_key:request_key},function(json)
{var progress_finished=json.status=='finished';if(progress_finished||request_finished)
{progress_callback(json.progress_results,request_finished);return;}
else if(json.status=='progressing')
{progress_callback(json.progress_results);setTimeout(get_progress_results,500);}
else if(json.status=='not_started'||json.status=='empty_progress_results')
{failed_attempt_count++;if(failed_attempt_count>=50)return;setTimeout(get_progress_results,500);}});};var old_success=s.success;s.success=function(json)
{request_finished=true;var progress_results=[];progress_callback(progress_results,request_finished);old_success(json);};}
var newSettings=$.extend({},s),beforeSend=s.beforeSend;if(beforeSend){newSettings.beforeSend=function(){return $.ajaxSettings.beforeSend.apply(this,arguments)&&beforeSend.apply(this,arguments);};}
var promise=$.oldAjax(newSettings);if(get_progress_results)
{get_progress_results();}
return promise;};$.oldPost=$.post;$.post=function(url,data,callback,type,progress_callback)
{if(jQuery.isEmptyObject(data))
{if(typeof data!=='string')
{data={'dummy_variable_that_wont_have_namespace_conflict':'true'};}}
return $.oldPost(url,data,callback,type,progress_callback);};$.ps_timeout_id=null;$.fn.password_strength=function(j_strength_meter_container,options){options=options||{};var me=this;if(this.val())
{$j.box.test_password_strength(j_strength_meter_container,me,options);}
this.on('keyup blur',function()
{if($._ps_timeout_id)
{clearTimeout($._ps_timeout_id);$._ps_timeout_id=null;}
$._ps_timeout_id=setTimeout(function(){$j.box.test_password_strength(j_strength_meter_container,me,options);},150);});};$.fn.copyCSS=function(src,properties){src=$(src);var dest=$(this);var length=properties.length;var arr=[];for(var i=0;i<length;i++)
{var prop=properties[i];if({padding:1,margin:1}[prop])
{arr=[prop+'-top',prop+'-right',prop+'-bottom',prop+'-left'];copyCSSFromArray(dest,src,arr);}
else if(prop=='font')
{arr=[prop+'-size',prop+'-family',prop+'-style',prop+'-weight'];copyCSSFromArray(dest,src,arr);}
else
{dest.css(prop,src.css(prop));}}
function copyCSSFromArray(dest,src,arr)
{var length=arr.length;for(var i=0;i<length;i++)
{var currArr=arr[i];dest.css(currArr,src.css(currArr));}}
return dest;};}(jQuery));var $t=(function(){'use strict';function replacePlaceholders(string,placeholders){var numArgs=placeholders.length,regex=/%\d+/g,replacedText;if(!string||!numArgs){return string;}
replacedText=string.replace(regex,function(match){var placeholderIndex=match.substr(1)-1;return(placeholderIndex in placeholders)?placeholders[placeholderIndex]:match;});return replacedText;}
function shouldTranslate(alpha3Code,tag){return(alpha3Code!=='eng'&&TRANSLATIONS[tag]);}
function shouldEmitTranslationTags(){var emitTranslationTags=false,config;window.Box=window.Box||{};config=window.initialConfig||Box.config;if(config){emitTranslationTags=config.emitTranslationTags;}
return emitTranslationTags;}
return function(english,tag){var placeholders=Array.prototype.slice.call(arguments);placeholders=(placeholders.length>2)?placeholders.slice(2):[];if(shouldEmitTranslationTags()){return tag;}
if(typeof PseudoLocalization!=='undefined'&&PseudoLocalization.isEnabledFromCookie()){var pseudoStr=PseudoLocalization.translate(english);return replacePlaceholders(pseudoStr,placeholders);}
if(typeof(LANGUAGE)==='undefined'||!shouldTranslate(LANGUAGE,tag)){return replacePlaceholders(english,placeholders);}
return replacePlaceholders(TRANSLATIONS[tag]||english,placeholders);};}());(function($,undefined){var uuid=0,runiqueId=/^ui-id-\d+$/;$.ui=$.ui||{};$.extend($.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});$.fn.extend({focus:(function(orig){return function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem);}},delay);}):orig.apply(this,arguments);};})($.fn.focus),scrollParent:function(){var scrollParent;if(($.ui.ie&&(/(static|relative)/).test(this.css("position")))||(/absolute/).test(this.css("position"))){scrollParent=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test($.css(this,"position"))&&(/(auto|scroll)/).test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"));}).eq(0);}else{scrollParent=this.parents().filter(function(){return(/(auto|scroll)/).test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"));}).eq(0);}
return(/fixed/).test(this.css("position"))||!scrollParent.length?$(document):scrollParent;},zIndex:function(zIndex){if(zIndex!==undefined){return this.css("zIndex",zIndex);}
if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value;}}
elem=elem.parent();}}
return 0;},uniqueId:function(){return this.each(function(){if(!this.id){this.id="ui-id-"+(++uuid);}});},removeUniqueId:function(){return this.each(function(){if(runiqueId.test(this.id)){$(this).removeAttr("id");}});}});function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false;}
img=$("img[usemap=#"+mapName+"]")[0];return!!img&&visible(img);}
return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element);}
function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return $.css(this,"visibility")==="hidden";}).length;}
$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName);};}):function(elem,i,match){return!!$.data(elem,match[3]);},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")));},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN);}});if(!$("<a>").outerWidth(1).jquery){$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;if(border){size-=parseFloat($.css(elem,"border"+this+"Width"))||0;}
if(margin){size-=parseFloat($.css(elem,"margin"+this))||0;}});return size;}
$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this);}
return this.each(function(){$(this).css(type,reduce(this,size)+"px");});};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size);}
return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px");});};});}
if(!$.fn.addBack){$.fn.addBack=function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));};}
if($("<a>").data("a-b","a").removeData("a-b").data("a-b")){$.fn.removeData=(function(removeData){return function(key){if(arguments.length){return removeData.call(this,$.camelCase(key));}else{return removeData.call(this);}};})($.fn.removeData);}
$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());$.support.selectstart="onselectstart"in document.createElement("div");$.fn.extend({disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault();});},enableSelection:function(){return this.unbind(".ui-disableSelection");}});$.extend($.ui,{plugin:{add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]]);}},call:function(instance,name,args){var i,set=instance.plugins[name];if(!set||!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11){return;}
for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args);}}}},hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false;}
var scroll=(a&&a==="left")?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true;}
el[scroll]=1;has=(el[scroll]>0);el[scroll]=0;return has;}});})(jQuery);(function($,undefined){$.extend($.ui,{datepicker:{version:"1.10.4"}});var PROP_NAME="datepicker",instActive;function Datepicker(){this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass="ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:"c-10:c+10",showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:true,showButtonPanel:false,autoSize:false,disabled:false};$.extend(this._defaults,this.regional[""]);this.dpDiv=bindHover($("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"));}
$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv;},setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this;},_attachDatepicker:function(target,settings){var nodeName,inline,inst;nodeName=target.nodeName.toLowerCase();inline=(nodeName==="div"||nodeName==="span");if(!target.id){this.uuid+=1;target.id="dp"+this.uuid;}
inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{});if(nodeName==="input"){this._connectDatepicker(target,inst);}else if(inline){this._inlineDatepicker(target,inst);}},_newInst:function(target,inline){var id=target[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:(!inline?this.dpDiv:bindHover($("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")))};},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]);inst.trigger=$([]);if(input.hasClass(this.markerClassName)){return;}
this._attachments(input,inst);input.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp);this._autoSize(inst);$.data(target,PROP_NAME,inst);if(inst.settings.disabled){this._disableDatepicker(target);}},_attachments:function(input,inst){var showOn,buttonText,buttonImage,appendText=this._get(inst,"appendText"),isRTL=this._get(inst,"isRTL");if(inst.append){inst.append.remove();}
if(appendText){inst.append=$("<span class='"+this._appendClass+"'>"+appendText+"</span>");input[isRTL?"before":"after"](inst.append);}
input.unbind("focus",this._showDatepicker);if(inst.trigger){inst.trigger.remove();}
showOn=this._get(inst,"showOn");if(showOn==="focus"||showOn==="both"){input.focus(this._showDatepicker);}
if(showOn==="button"||showOn==="both"){buttonText=this._get(inst,"buttonText");buttonImage=this._get(inst,"buttonImage");inst.trigger=$(this._get(inst,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText}):$("<button type='button'></button>").addClass(this._triggerClass).html(!buttonImage?buttonText:$("<img/>").attr({src:buttonImage,alt:buttonText,title:buttonText})));input[isRTL?"before":"after"](inst.trigger);inst.trigger.click(function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput===input[0]){$.datepicker._hideDatepicker();}else if($.datepicker._datepickerShowing&&$.datepicker._lastInput!==input[0]){$.datepicker._hideDatepicker();$.datepicker._showDatepicker(input[0]);}else{$.datepicker._showDatepicker(input[0]);}
return false;});}},_autoSize:function(inst){if(this._get(inst,"autoSize")&&!inst.inline){var findMax,max,maxI,i,date=new Date(2009,12-1,20),dateFormat=this._get(inst,"dateFormat");if(dateFormat.match(/[DM]/)){findMax=function(names){max=0;maxI=0;for(i=0;i<names.length;i++){if(names[i].length>max){max=names[i].length;maxI=i;}}
return maxI;};date.setMonth(findMax(this._get(inst,(dateFormat.match(/MM/)?"monthNames":"monthNamesShort"))));date.setDate(findMax(this._get(inst,(dateFormat.match(/DD/)?"dayNames":"dayNamesShort")))+20-date.getDay());}
inst.input.attr("size",this._formatDate(inst,date).length);}},_inlineDatepicker:function(target,inst){var divSpan=$(target);if(divSpan.hasClass(this.markerClassName)){return;}
divSpan.addClass(this.markerClassName).append(inst.dpDiv);$.data(target,PROP_NAME,inst);this._setDate(inst,this._getDefaultDate(inst),true);this._updateDatepicker(inst);this._updateAlternate(inst);if(inst.settings.disabled){this._disableDatepicker(target);}
inst.dpDiv.css("display","block");},_dialogDatepicker:function(input,date,onSelect,settings,pos){var id,browserWidth,browserHeight,scrollX,scrollY,inst=this._dialogInst;if(!inst){this.uuid+=1;id="dp"+this.uuid;this._dialogInput=$("<input type='text' id='"+id+"' style='position: absolute; top: -100px; width: 0px;'/>");this._dialogInput.keydown(this._doKeyDown);$("body").append(this._dialogInput);inst=this._dialogInst=this._newInst(this._dialogInput,false);inst.settings={};$.data(this._dialogInput[0],PROP_NAME,inst);}
extendRemove(inst.settings,settings||{});date=(date&&date.constructor===Date?this._formatDate(inst,date):date);this._dialogInput.val(date);this._pos=(pos?(pos.length?pos:[pos.pageX,pos.pageY]):null);if(!this._pos){browserWidth=document.documentElement.clientWidth;browserHeight=document.documentElement.clientHeight;scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;scrollY=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[(browserWidth/2)-100+scrollX,(browserHeight/2)-150+scrollY];}
this._dialogInput.css("left",(this._pos[0]+20)+"px").css("top",this._pos[1]+"px");inst.settings.onSelect=onSelect;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if($.blockUI){$.blockUI(this.dpDiv);}
$.data(this._dialogInput[0],PROP_NAME,inst);return this;},_destroyDatepicker:function(target){var nodeName,$target=$(target),inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
nodeName=target.nodeName.toLowerCase();$.removeData(target,PROP_NAME);if(nodeName==="input"){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp);}else if(nodeName==="div"||nodeName==="span"){$target.removeClass(this.markerClassName).empty();}},_enableDatepicker:function(target){var nodeName,inline,$target=$(target),inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
nodeName=target.nodeName.toLowerCase();if(nodeName==="input"){target.disabled=false;inst.trigger.filter("button").each(function(){this.disabled=false;}).end().filter("img").css({opacity:"1.0",cursor:""});}else if(nodeName==="div"||nodeName==="span"){inline=$target.children("."+this._inlineClass);inline.children().removeClass("ui-state-disabled");inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",false);}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value===target?null:value);});},_disableDatepicker:function(target){var nodeName,inline,$target=$(target),inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
nodeName=target.nodeName.toLowerCase();if(nodeName==="input"){target.disabled=true;inst.trigger.filter("button").each(function(){this.disabled=true;}).end().filter("img").css({opacity:"0.5",cursor:"default"});}else if(nodeName==="div"||nodeName==="span"){inline=$target.children("."+this._inlineClass);inline.children().addClass("ui-state-disabled");inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",true);}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value===target?null:value);});this._disabledInputs[this._disabledInputs.length]=target;},_isDisabledDatepicker:function(target){if(!target){return false;}
for(var i=0;i<this._disabledInputs.length;i++){if(this._disabledInputs[i]===target){return true;}}
return false;},_getInst:function(target){try{return $.data(target,PROP_NAME);}
catch(err){throw"Missing instance data for this datepicker";}},_optionDatepicker:function(target,name,value){var settings,date,minDate,maxDate,inst=this._getInst(target);if(arguments.length===2&&typeof name==="string"){return(name==="defaults"?$.extend({},$.datepicker._defaults):(inst?(name==="all"?$.extend({},inst.settings):this._get(inst,name)):null));}
settings=name||{};if(typeof name==="string"){settings={};settings[name]=value;}
if(inst){if(this._curInst===inst){this._hideDatepicker();}
date=this._getDateDatepicker(target,true);minDate=this._getMinMaxDate(inst,"min");maxDate=this._getMinMaxDate(inst,"max");extendRemove(inst.settings,settings);if(minDate!==null&&settings.dateFormat!==undefined&&settings.minDate===undefined){inst.settings.minDate=this._formatDate(inst,minDate);}
if(maxDate!==null&&settings.dateFormat!==undefined&&settings.maxDate===undefined){inst.settings.maxDate=this._formatDate(inst,maxDate);}
if("disabled"in settings){if(settings.disabled){this._disableDatepicker(target);}else{this._enableDatepicker(target);}}
this._attachments($(target),inst);this._autoSize(inst);this._setDate(inst,date);this._updateAlternate(inst);this._updateDatepicker(inst);}},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value);},_refreshDatepicker:function(target){var inst=this._getInst(target);if(inst){this._updateDatepicker(inst);}},_setDateDatepicker:function(target,date){var inst=this._getInst(target);if(inst){this._setDate(inst,date);this._updateDatepicker(inst);this._updateAlternate(inst);}},_getDateDatepicker:function(target,noDefault){var inst=this._getInst(target);if(inst&&!inst.inline){this._setDateFromField(inst,noDefault);}
return(inst?this._getDate(inst):null);},_doKeyDown:function(event){var onSelect,dateStr,sel,inst=$.datepicker._getInst(event.target),handled=true,isRTL=inst.dpDiv.is(".ui-datepicker-rtl");inst._keyEvent=true;if($.datepicker._datepickerShowing){switch(event.keyCode){case 9:$.datepicker._hideDatepicker();handled=false;break;case 13:sel=$("td."+$.datepicker._dayOverClass+":not(."+
$.datepicker._currentClass+")",inst.dpDiv);if(sel[0]){$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0]);}
onSelect=$.datepicker._get(inst,"onSelect");if(onSelect){dateStr=$.datepicker._formatDate(inst);onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);}else{$.datepicker._hideDatepicker();}
return false;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths")),"M");break;case 34:$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths")),"M");break;case 35:if(event.ctrlKey||event.metaKey){$.datepicker._clearDate(event.target);}
handled=event.ctrlKey||event.metaKey;break;case 36:if(event.ctrlKey||event.metaKey){$.datepicker._gotoToday(event.target);}
handled=event.ctrlKey||event.metaKey;break;case 37:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,(isRTL?+1:-1),"D");}
handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths")),"M");}
break;case 38:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,-7,"D");}
handled=event.ctrlKey||event.metaKey;break;case 39:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,(isRTL?-1:+1),"D");}
handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths")),"M");}
break;case 40:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,+7,"D");}
handled=event.ctrlKey||event.metaKey;break;default:handled=false;}}else if(event.keyCode===36&&event.ctrlKey){$.datepicker._showDatepicker(this);}else{handled=false;}
if(handled){event.preventDefault();event.stopPropagation();}},_doKeyPress:function(event){var chars,chr,inst=$.datepicker._getInst(event.target);if($.datepicker._get(inst,"constrainInput")){chars=$.datepicker._possibleChars($.datepicker._get(inst,"dateFormat"));chr=String.fromCharCode(event.charCode==null?event.keyCode:event.charCode);return event.ctrlKey||event.metaKey||(chr<" "||!chars||chars.indexOf(chr)>-1);}},_doKeyUp:function(event){var date,inst=$.datepicker._getInst(event.target);if(inst.input.val()!==inst.lastVal){try{date=$.datepicker.parseDate($.datepicker._get(inst,"dateFormat"),(inst.input?inst.input.val():null),$.datepicker._getFormatConfig(inst));if(date){$.datepicker._setDateFromField(inst);$.datepicker._updateAlternate(inst);$.datepicker._updateDatepicker(inst);}}
catch(err){}}
return true;},_showDatepicker:function(input){input=input.target||input;if(input.nodeName.toLowerCase()!=="input"){input=$("input",input.parentNode)[0];}
if($.datepicker._isDisabledDatepicker(input)||$.datepicker._lastInput===input){return;}
var inst,beforeShow,beforeShowSettings,isFixed,offset,showAnim,duration;inst=$.datepicker._getInst(input);if($.datepicker._curInst&&$.datepicker._curInst!==inst){$.datepicker._curInst.dpDiv.stop(true,true);if(inst&&$.datepicker._datepickerShowing){$.datepicker._hideDatepicker($.datepicker._curInst.input[0]);}}
beforeShow=$.datepicker._get(inst,"beforeShow");beforeShowSettings=beforeShow?beforeShow.apply(input,[input,inst]):{};if(beforeShowSettings===false){return;}
extendRemove(inst.settings,beforeShowSettings);inst.lastVal=null;$.datepicker._lastInput=input;$.datepicker._setDateFromField(inst);if($.datepicker._inDialog){input.value="";}
if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(input);$.datepicker._pos[1]+=input.offsetHeight;}
isFixed=false;$(input).parents().each(function(){isFixed|=$(this).css("position")==="fixed";return!isFixed;});offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;inst.dpDiv.empty();inst.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});$.datepicker._updateDatepicker(inst);offset=$.datepicker._checkOffset(inst,offset,isFixed);inst.dpDiv.css({position:($.datepicker._inDialog&&$.blockUI?"static":(isFixed?"fixed":"absolute")),display:"none",left:offset.left+"px",top:offset.top+"px"});if(!inst.inline){showAnim=$.datepicker._get(inst,"showAnim");duration=$.datepicker._get(inst,"duration");inst.dpDiv.zIndex($(input).zIndex()+1);$.datepicker._datepickerShowing=true;if($.effects&&$.effects.effect[showAnim]){inst.dpDiv.show(showAnim,$.datepicker._get(inst,"showOptions"),duration);}else{inst.dpDiv[showAnim||"show"](showAnim?duration:null);}
if($.datepicker._shouldFocusInput(inst)){inst.input.focus();}
$.datepicker._curInst=inst;}},_updateDatepicker:function(inst){this.maxRows=4;instActive=inst;inst.dpDiv.empty().append(this._generateHTML(inst));this._attachHandlers(inst);inst.dpDiv.find("."+this._dayOverClass+" a").mouseover();var origyearshtml,numMonths=this._getNumberOfMonths(inst),cols=numMonths[1],width=17;inst.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");if(cols>1){inst.dpDiv.addClass("ui-datepicker-multi-"+cols).css("width",(width*cols)+"em");}
inst.dpDiv[(numMonths[0]!==1||numMonths[1]!==1?"add":"remove")+"Class"]("ui-datepicker-multi");inst.dpDiv[(this._get(inst,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");if(inst===$.datepicker._curInst&&$.datepicker._datepickerShowing&&$.datepicker._shouldFocusInput(inst)){inst.input.focus();}
if(inst.yearshtml){origyearshtml=inst.yearshtml;setTimeout(function(){if(origyearshtml===inst.yearshtml&&inst.yearshtml){inst.dpDiv.find("select.ui-datepicker-year:first").replaceWith(inst.yearshtml);}
origyearshtml=inst.yearshtml=null;},0);}},_shouldFocusInput:function(inst){return inst.input&&inst.input.is(":visible")&&!inst.input.is(":disabled")&&!inst.input.is(":focus");},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth(),dpHeight=inst.dpDiv.outerHeight(),inputWidth=inst.input?inst.input.outerWidth():0,inputHeight=inst.input?inst.input.outerHeight():0,viewWidth=document.documentElement.clientWidth+(isFixed?0:$(document).scrollLeft()),viewHeight=document.documentElement.clientHeight+(isFixed?0:$(document).scrollTop());offset.left-=(this._get(inst,"isRTL")?(dpWidth-inputWidth):0);offset.left-=(isFixed&&offset.left===inst.input.offset().left)?$(document).scrollLeft():0;offset.top-=(isFixed&&offset.top===(inst.input.offset().top+inputHeight))?$(document).scrollTop():0;offset.left-=Math.min(offset.left,(offset.left+dpWidth>viewWidth&&viewWidth>dpWidth)?Math.abs(offset.left+dpWidth-viewWidth):0);offset.top-=Math.min(offset.top,(offset.top+dpHeight>viewHeight&&viewHeight>dpHeight)?Math.abs(dpHeight+inputHeight):0);return offset;},_findPos:function(obj){var position,inst=this._getInst(obj),isRTL=this._get(inst,"isRTL");while(obj&&(obj.type==="hidden"||obj.nodeType!==1||$.expr.filters.hidden(obj))){obj=obj[isRTL?"previousSibling":"nextSibling"];}
position=$(obj).offset();return[position.left,position.top];},_hideDatepicker:function(input){var showAnim,duration,postProcess,onClose,inst=this._curInst;if(!inst||(input&&inst!==$.data(input,PROP_NAME))){return;}
if(this._datepickerShowing){showAnim=this._get(inst,"showAnim");duration=this._get(inst,"duration");postProcess=function(){$.datepicker._tidyDialog(inst);};if($.effects&&($.effects.effect[showAnim]||$.effects[showAnim])){inst.dpDiv.hide(showAnim,$.datepicker._get(inst,"showOptions"),duration,postProcess);}else{inst.dpDiv[(showAnim==="slideDown"?"slideUp":(showAnim==="fadeIn"?"fadeOut":"hide"))]((showAnim?duration:null),postProcess);}
if(!showAnim){postProcess();}
this._datepickerShowing=false;onClose=this._get(inst,"onClose");if(onClose){onClose.apply((inst.input?inst.input[0]:null),[(inst.input?inst.input.val():""),inst]);}
this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",left:"0",top:"-100px"});if($.blockUI){$.unblockUI();$("body").append(this.dpDiv);}}
this._inDialog=false;}},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar");},_checkExternalClick:function(event){if(!$.datepicker._curInst){return;}
var $target=$(event.target),inst=$.datepicker._getInst($target[0]);if((($target[0].id!==$.datepicker._mainDivId&&$target.parents("#"+$.datepicker._mainDivId).length===0&&!$target.hasClass($.datepicker.markerClassName)&&!$target.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&!($.datepicker._inDialog&&$.blockUI)))||($target.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!==inst)){$.datepicker._hideDatepicker();}},_adjustDate:function(id,offset,period){var target=$(id),inst=this._getInst(target[0]);if(this._isDisabledDatepicker(target[0])){return;}
this._adjustInstDate(inst,offset+
(period==="M"?this._get(inst,"showCurrentAtPos"):0),period);this._updateDatepicker(inst);},_gotoToday:function(id){var date,target=$(id),inst=this._getInst(target[0]);if(this._get(inst,"gotoCurrent")&&inst.currentDay){inst.selectedDay=inst.currentDay;inst.drawMonth=inst.selectedMonth=inst.currentMonth;inst.drawYear=inst.selectedYear=inst.currentYear;}else{date=new Date();inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();}
this._notifyChange(inst);this._adjustDate(target);},_selectMonthYear:function(id,select,period){var target=$(id),inst=this._getInst(target[0]);inst["selected"+(period==="M"?"Month":"Year")]=inst["draw"+(period==="M"?"Month":"Year")]=parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target);},_selectDay:function(id,month,year,td){var inst,target=$(id);if($(td).hasClass(this._unselectableClass)||this._isDisabledDatepicker(target[0])){return;}
inst=this._getInst(target[0]);inst.selectedDay=inst.currentDay=$("a",td).html();inst.selectedMonth=inst.currentMonth=month;inst.selectedYear=inst.currentYear=year;this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear));},_clearDate:function(id){var target=$(id);this._selectDate(target,"");},_selectDate:function(id,dateStr){var onSelect,target=$(id),inst=this._getInst(target[0]);dateStr=(dateStr!=null?dateStr:this._formatDate(inst));if(inst.input){inst.input.val(dateStr);}
this._updateAlternate(inst);onSelect=this._get(inst,"onSelect");if(onSelect){onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);}else if(inst.input){inst.input.trigger("change");}
if(inst.inline){this._updateDatepicker(inst);}else{this._hideDatepicker();this._lastInput=inst.input[0];if(typeof(inst.input[0])!=="object"){inst.input.focus();}
this._lastInput=null;}},_updateAlternate:function(inst){var altFormat,date,dateStr,altField=this._get(inst,"altField");if(altField){altFormat=this._get(inst,"altFormat")||this._get(inst,"dateFormat");date=this._getDate(inst);dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst));$(altField).each(function(){$(this).val(dateStr);});}},noWeekends:function(date){var day=date.getDay();return[(day>0&&day<6),""];},iso8601Week:function(date){var time,checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1;},parseDate:function(format,value,settings){if(format==null||value==null){throw"Invalid arguments";}
value=(typeof value==="object"?value.toString():value+"");if(value===""){return null;}
var iFormat,dim,extra,iValue=0,shortYearCutoffTemp=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff,shortYearCutoff=(typeof shortYearCutoffTemp!=="string"?shortYearCutoffTemp:new Date().getFullYear()%100+parseInt(shortYearCutoffTemp,10)),dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort,dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames,monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort,monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames,year=-1,month=-1,day=-1,doy=-1,literal=false,date,lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)===match);if(matches){iFormat++;}
return matches;},getNumber=function(match){var isDoubled=lookAhead(match),size=(match==="@"?14:(match==="!"?20:(match==="y"&&isDoubled?4:(match==="o"?3:2)))),digits=new RegExp("^\\d{1,"+size+"}"),num=value.substring(iValue).match(digits);if(!num){throw"Missing number at position "+iValue;}
iValue+=num[0].length;return parseInt(num[0],10);},getName=function(match,shortNames,longNames){var index=-1,names=$.map(lookAhead(match)?longNames:shortNames,function(v,k){return[[k,v]];}).sort(function(a,b){return-(a[1].length-b[1].length);});$.each(names,function(i,pair){var name=pair[1];if(value.substr(iValue,name.length).toLowerCase()===name.toLowerCase()){index=pair[0];iValue+=name.length;return false;}});if(index!==-1){return index+1;}else{throw"Unknown name at position "+iValue;}},checkLiteral=function(){if(value.charAt(iValue)!==format.charAt(iFormat)){throw"Unexpected literal at position "+iValue;}
iValue++;};for(iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)==="'"&&!lookAhead("'")){literal=false;}else{checkLiteral();}}else{switch(format.charAt(iFormat)){case"d":day=getNumber("d");break;case"D":getName("D",dayNamesShort,dayNames);break;case"o":doy=getNumber("o");break;case"m":month=getNumber("m");break;case"M":month=getName("M",monthNamesShort,monthNames);break;case"y":year=getNumber("y");break;case"@":date=new Date(getNumber("@"));year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"!":date=new Date((getNumber("!")-this._ticksTo1970)/10000);year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"'":if(lookAhead("'")){checkLiteral();}else{literal=true;}
break;default:checkLiteral();}}}
if(iValue<value.length){extra=value.substr(iValue);if(!/^\s+/.test(extra)){throw"Extra/unparsed characters found in date: "+extra;}}
if(year===-1){year=new Date().getFullYear();}else if(year<100){year+=new Date().getFullYear()-new Date().getFullYear()%100+
(year<=shortYearCutoff?0:-100);}
if(doy>-1){month=1;day=doy;do{dim=this._getDaysInMonth(year,month-1);if(day<=dim){break;}
month++;day-=dim;}while(true);}
date=this._daylightSavingAdjust(new Date(year,month-1,day));if(date.getFullYear()!==year||date.getMonth()+1!==month||date.getDate()!==day){throw"Invalid date";}
return date;},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(((1970-1)*365+Math.floor(1970/4)-Math.floor(1970/100)+
Math.floor(1970/400))*24*60*60*10000000),formatDate:function(format,date,settings){if(!date){return"";}
var iFormat,dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort,dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames,monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort,monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames,lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)===match);if(matches){iFormat++;}
return matches;},formatNumber=function(match,value,len){var num=""+value;if(lookAhead(match)){while(num.length<len){num="0"+num;}}
return num;},formatName=function(match,value,shortNames,longNames){return(lookAhead(match)?longNames[value]:shortNames[value]);},output="",literal=false;if(date){for(iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)==="'"&&!lookAhead("'")){literal=false;}else{output+=format.charAt(iFormat);}}else{switch(format.charAt(iFormat)){case"d":output+=formatNumber("d",date.getDate(),2);break;case"D":output+=formatName("D",date.getDay(),dayNamesShort,dayNames);break;case"o":output+=formatNumber("o",Math.round((new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime()-new Date(date.getFullYear(),0,0).getTime())/86400000),3);break;case"m":output+=formatNumber("m",date.getMonth()+1,2);break;case"M":output+=formatName("M",date.getMonth(),monthNamesShort,monthNames);break;case"y":output+=(lookAhead("y")?date.getFullYear():(date.getYear()%100<10?"0":"")+date.getYear()%100);break;case"@":output+=date.getTime();break;case"!":output+=date.getTime()*10000+this._ticksTo1970;break;case"'":if(lookAhead("'")){output+="'";}else{literal=true;}
break;default:output+=format.charAt(iFormat);}}}}
return output;},_possibleChars:function(format){var iFormat,chars="",literal=false,lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)===match);if(matches){iFormat++;}
return matches;};for(iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)==="'"&&!lookAhead("'")){literal=false;}else{chars+=format.charAt(iFormat);}}else{switch(format.charAt(iFormat)){case"d":case"m":case"y":case"@":chars+="0123456789";break;case"D":case"M":return null;case"'":if(lookAhead("'")){chars+="'";}else{literal=true;}
break;default:chars+=format.charAt(iFormat);}}}
return chars;},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name];},_setDateFromField:function(inst,noDefault){if(inst.input.val()===inst.lastVal){return;}
var dateFormat=this._get(inst,"dateFormat"),dates=inst.lastVal=inst.input?inst.input.val():null,defaultDate=this._getDefaultDate(inst),date=defaultDate,settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate;}catch(event){dates=(noDefault?"":dates);}
inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();inst.currentDay=(dates?date.getDate():0);inst.currentMonth=(dates?date.getMonth():0);inst.currentYear=(dates?date.getFullYear():0);this._adjustInstDate(inst);},_getDefaultDate:function(inst){return this._restrictMinMax(inst,this._determineDate(inst,this._get(inst,"defaultDate"),new Date()));},_determineDate:function(inst,date,defaultDate){var offsetNumeric=function(offset){var date=new Date();date.setDate(date.getDate()+offset);return date;},offsetString=function(offset){try{return $.datepicker.parseDate($.datepicker._get(inst,"dateFormat"),offset,$.datepicker._getFormatConfig(inst));}
catch(e){}
var date=(offset.toLowerCase().match(/^c/)?$.datepicker._getDate(inst):null)||new Date(),year=date.getFullYear(),month=date.getMonth(),day=date.getDate(),pattern=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,matches=pattern.exec(offset);while(matches){switch(matches[2]||"d"){case"d":case"D":day+=parseInt(matches[1],10);break;case"w":case"W":day+=parseInt(matches[1],10)*7;break;case"m":case"M":month+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;case"y":case"Y":year+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;}
matches=pattern.exec(offset);}
return new Date(year,month,day);},newDate=(date==null||date===""?defaultDate:(typeof date==="string"?offsetString(date):(typeof date==="number"?(isNaN(date)?defaultDate:offsetNumeric(date)):new Date(date.getTime()))));newDate=(newDate&&newDate.toString()==="Invalid Date"?defaultDate:newDate);if(newDate){newDate.setHours(0);newDate.setMinutes(0);newDate.setSeconds(0);newDate.setMilliseconds(0);}
return this._daylightSavingAdjust(newDate);},_daylightSavingAdjust:function(date){if(!date){return null;}
date.setHours(date.getHours()>12?date.getHours()+2:0);return date;},_setDate:function(inst,date,noChange){var clear=!date,origMonth=inst.selectedMonth,origYear=inst.selectedYear,newDate=this._restrictMinMax(inst,this._determineDate(inst,date,new Date()));inst.selectedDay=inst.currentDay=newDate.getDate();inst.drawMonth=inst.selectedMonth=inst.currentMonth=newDate.getMonth();inst.drawYear=inst.selectedYear=inst.currentYear=newDate.getFullYear();if((origMonth!==inst.selectedMonth||origYear!==inst.selectedYear)&&!noChange){this._notifyChange(inst);}
this._adjustInstDate(inst);if(inst.input){inst.input.val(clear?"":this._formatDate(inst));}},_getDate:function(inst){var startDate=(!inst.currentYear||(inst.input&&inst.input.val()==="")?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return startDate;},_attachHandlers:function(inst){var stepMonths=this._get(inst,"stepMonths"),id="#"+inst.id.replace(/\\\\/g,"\\");inst.dpDiv.find("[data-handler]").map(function(){var handler={prev:function(){$.datepicker._adjustDate(id,-stepMonths,"M");},next:function(){$.datepicker._adjustDate(id,+stepMonths,"M");},hide:function(){$.datepicker._hideDatepicker();},today:function(){$.datepicker._gotoToday(id);},selectDay:function(){$.datepicker._selectDay(id,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this);return false;},selectMonth:function(){$.datepicker._selectMonthYear(id,this,"M");return false;},selectYear:function(){$.datepicker._selectMonthYear(id,this,"Y");return false;}};$(this).bind(this.getAttribute("data-event"),handler[this.getAttribute("data-handler")]);});},_generateHTML:function(inst){var maxDraw,prevText,prev,nextText,next,currentText,gotoDate,controls,buttonPanel,firstDay,showWeek,dayNames,dayNamesMin,monthNames,monthNamesShort,beforeShowDay,showOtherMonths,selectOtherMonths,defaultDate,html,dow,row,group,col,selectedDate,cornerClass,calender,thead,day,daysInMonth,leadDays,curRows,numRows,printDate,dRow,tbody,daySettings,otherMonth,unselectable,tempDate=new Date(),today=this._daylightSavingAdjust(new Date(tempDate.getFullYear(),tempDate.getMonth(),tempDate.getDate())),isRTL=this._get(inst,"isRTL"),showButtonPanel=this._get(inst,"showButtonPanel"),hideIfNoPrevNext=this._get(inst,"hideIfNoPrevNext"),navigationAsDateFormat=this._get(inst,"navigationAsDateFormat"),numMonths=this._getNumberOfMonths(inst),showCurrentAtPos=this._get(inst,"showCurrentAtPos"),stepMonths=this._get(inst,"stepMonths"),isMultiMonth=(numMonths[0]!==1||numMonths[1]!==1),currentDate=this._daylightSavingAdjust((!inst.currentDay?new Date(9999,9,9):new Date(inst.currentYear,inst.currentMonth,inst.currentDay))),minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),drawMonth=inst.drawMonth-showCurrentAtPos,drawYear=inst.drawYear;if(drawMonth<0){drawMonth+=12;drawYear--;}
if(maxDate){maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-(numMonths[0]*numMonths[1])+1,maxDate.getDate()));maxDraw=(minDate&&maxDraw<minDate?minDate:maxDraw);while(this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw){drawMonth--;if(drawMonth<0){drawMonth=11;drawYear--;}}}
inst.drawMonth=drawMonth;inst.drawYear=drawYear;prevText=this._get(inst,"prevText");prevText=(!navigationAsDateFormat?prevText:this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst)));prev=(this._canAdjustMonth(inst,-1,drawYear,drawMonth)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click'"+" title='"+prevText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"e":"w")+"'>"+prevText+"</span></a>":(hideIfNoPrevNext?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+prevText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"e":"w")+"'>"+prevText+"</span></a>"));nextText=this._get(inst,"nextText");nextText=(!navigationAsDateFormat?nextText:this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst)));next=(this._canAdjustMonth(inst,+1,drawYear,drawMonth)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click'"+" title='"+nextText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"w":"e")+"'>"+nextText+"</span></a>":(hideIfNoPrevNext?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+nextText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"w":"e")+"'>"+nextText+"</span></a>"));currentText=this._get(inst,"currentText");gotoDate=(this._get(inst,"gotoCurrent")&&inst.currentDay?currentDate:today);currentText=(!navigationAsDateFormat?currentText:this.formatDate(currentText,gotoDate,this._getFormatConfig(inst)));controls=(!inst.inline?"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+
this._get(inst,"closeText")+"</button>":"");buttonPanel=(showButtonPanel)?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(isRTL?controls:"")+
(this._isInRange(inst,gotoDate)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'"+">"+currentText+"</button>":"")+(isRTL?"":controls)+"</div>":"";firstDay=parseInt(this._get(inst,"firstDay"),10);firstDay=(isNaN(firstDay)?0:firstDay);showWeek=this._get(inst,"showWeek");dayNames=this._get(inst,"dayNames");dayNamesMin=this._get(inst,"dayNamesMin");monthNames=this._get(inst,"monthNames");monthNamesShort=this._get(inst,"monthNamesShort");beforeShowDay=this._get(inst,"beforeShowDay");showOtherMonths=this._get(inst,"showOtherMonths");selectOtherMonths=this._get(inst,"selectOtherMonths");defaultDate=this._getDefaultDate(inst);html="";dow;for(row=0;row<numMonths[0];row++){group="";this.maxRows=4;for(col=0;col<numMonths[1];col++){selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay));cornerClass=" ui-corner-all";calender="";if(isMultiMonth){calender+="<div class='ui-datepicker-group";if(numMonths[1]>1){switch(col){case 0:calender+=" ui-datepicker-group-first";cornerClass=" ui-corner-"+(isRTL?"right":"left");break;case numMonths[1]-1:calender+=" ui-datepicker-group-last";cornerClass=" ui-corner-"+(isRTL?"left":"right");break;default:calender+=" ui-datepicker-group-middle";cornerClass="";break;}}
calender+="'>";}
calender+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+cornerClass+"'>"+
(/all|left/.test(cornerClass)&&row===0?(isRTL?next:prev):"")+
(/all|right/.test(cornerClass)&&row===0?(isRTL?prev:next):"")+
this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,row>0||col>0,monthNames,monthNamesShort)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>";thead=(showWeek?"<th class='ui-datepicker-week-col'>"+this._get(inst,"weekHeader")+"</th>":"");for(dow=0;dow<7;dow++){day=(dow+firstDay)%7;thead+="<th"+((dow+firstDay+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+dayNames[day]+"'>"+dayNamesMin[day]+"</span></th>";}
calender+=thead+"</tr></thead><tbody>";daysInMonth=this._getDaysInMonth(drawYear,drawMonth);if(drawYear===inst.selectedYear&&drawMonth===inst.selectedMonth){inst.selectedDay=Math.min(inst.selectedDay,daysInMonth);}
leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7;curRows=Math.ceil((leadDays+daysInMonth)/7);numRows=(isMultiMonth?this.maxRows>curRows?this.maxRows:curRows:curRows);this.maxRows=numRows;printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays));for(dRow=0;dRow<numRows;dRow++){calender+="<tr>";tbody=(!showWeek?"":"<td class='ui-datepicker-week-col'>"+
this._get(inst,"calculateWeek")(printDate)+"</td>");for(dow=0;dow<7;dow++){daySettings=(beforeShowDay?beforeShowDay.apply((inst.input?inst.input[0]:null),[printDate]):[true,""]);otherMonth=(printDate.getMonth()!==drawMonth);unselectable=(otherMonth&&!selectOtherMonths)||!daySettings[0]||(minDate&&printDate<minDate)||(maxDate&&printDate>maxDate);tbody+="<td class='"+
((dow+firstDay+6)%7>=5?" ui-datepicker-week-end":"")+
(otherMonth?" ui-datepicker-other-month":"")+
((printDate.getTime()===selectedDate.getTime()&&drawMonth===inst.selectedMonth&&inst._keyEvent)||(defaultDate.getTime()===printDate.getTime()&&defaultDate.getTime()===selectedDate.getTime())?" "+this._dayOverClass:"")+
(unselectable?" "+this._unselectableClass+" ui-state-disabled":"")+
(otherMonth&&!showOtherMonths?"":" "+daySettings[1]+
(printDate.getTime()===currentDate.getTime()?" "+this._currentClass:"")+
(printDate.getTime()===today.getTime()?" ui-datepicker-today":""))+"'"+
((!otherMonth||showOtherMonths)&&daySettings[2]?" title='"+daySettings[2].replace(/'/g,"&#39;")+"'":"")+
(unselectable?"":" data-handler='selectDay' data-event='click' data-month='"+printDate.getMonth()+"' data-year='"+printDate.getFullYear()+"'")+">"+
(otherMonth&&!showOtherMonths?"&#xa0;":(unselectable?"<span class='ui-state-default'>"+printDate.getDate()+"</span>":"<a class='ui-state-default"+
(printDate.getTime()===today.getTime()?" ui-state-highlight":"")+
(printDate.getTime()===currentDate.getTime()?" ui-state-active":"")+
(otherMonth?" ui-priority-secondary":"")+"' href='#'>"+printDate.getDate()+"</a>"))+"</td>";printDate.setDate(printDate.getDate()+1);printDate=this._daylightSavingAdjust(printDate);}
calender+=tbody+"</tr>";}
drawMonth++;if(drawMonth>11){drawMonth=0;drawYear++;}
calender+="</tbody></table>"+(isMultiMonth?"</div>"+
((numMonths[0]>0&&col===numMonths[1]-1)?"<div class='ui-datepicker-row-break'></div>":""):"");group+=calender;}
html+=group;}
html+=buttonPanel;inst._keyEvent=false;return html;},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,secondary,monthNames,monthNamesShort){var inMinYear,inMaxYear,month,years,thisYear,determineYear,year,endYear,changeMonth=this._get(inst,"changeMonth"),changeYear=this._get(inst,"changeYear"),showMonthAfterYear=this._get(inst,"showMonthAfterYear"),html="<div class='ui-datepicker-title'>",monthHtml="";if(secondary||!changeMonth){monthHtml+="<span class='ui-datepicker-month'>"+monthNames[drawMonth]+"</span>";}else{inMinYear=(minDate&&minDate.getFullYear()===drawYear);inMaxYear=(maxDate&&maxDate.getFullYear()===drawYear);monthHtml+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>";for(month=0;month<12;month++){if((!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||month<=maxDate.getMonth())){monthHtml+="<option value='"+month+"'"+
(month===drawMonth?" selected='selected'":"")+">"+monthNamesShort[month]+"</option>";}}
monthHtml+="</select>";}
if(!showMonthAfterYear){html+=monthHtml+(secondary||!(changeMonth&&changeYear)?"&#xa0;":"");}
if(!inst.yearshtml){inst.yearshtml="";if(secondary||!changeYear){html+="<span class='ui-datepicker-year'>"+drawYear+"</span>";}else{years=this._get(inst,"yearRange").split(":");thisYear=new Date().getFullYear();determineYear=function(value){var year=(value.match(/c[+\-].*/)?drawYear+parseInt(value.substring(1),10):(value.match(/[+\-].*/)?thisYear+parseInt(value,10):parseInt(value,10)));return(isNaN(year)?thisYear:year);};year=determineYear(years[0]);endYear=Math.max(year,determineYear(years[1]||""));year=(minDate?Math.max(year,minDate.getFullYear()):year);endYear=(maxDate?Math.min(endYear,maxDate.getFullYear()):endYear);inst.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";for(;year<=endYear;year++){inst.yearshtml+="<option value='"+year+"'"+
(year===drawYear?" selected='selected'":"")+">"+year+"</option>";}
inst.yearshtml+="</select>";html+=inst.yearshtml;inst.yearshtml=null;}}
html+=this._get(inst,"yearSuffix");if(showMonthAfterYear){html+=(secondary||!(changeMonth&&changeYear)?"&#xa0;":"")+monthHtml;}
html+="</div>";return html;},_adjustInstDate:function(inst,offset,period){var year=inst.drawYear+(period==="Y"?offset:0),month=inst.drawMonth+(period==="M"?offset:0),day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+(period==="D"?offset:0),date=this._restrictMinMax(inst,this._daylightSavingAdjust(new Date(year,month,day)));inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();if(period==="M"||period==="Y"){this._notifyChange(inst);}},_restrictMinMax:function(inst,date){var minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),newDate=(minDate&&date<minDate?minDate:date);return(maxDate&&newDate>maxDate?maxDate:newDate);},_notifyChange:function(inst){var onChange=this._get(inst,"onChangeMonthYear");if(onChange){onChange.apply((inst.input?inst.input[0]:null),[inst.selectedYear,inst.selectedMonth+1,inst]);}},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,"numberOfMonths");return(numMonths==null?[1,1]:(typeof numMonths==="number"?[1,numMonths]:numMonths));},_getMinMaxDate:function(inst,minMax){return this._determineDate(inst,this._get(inst,minMax+"Date"),null);},_getDaysInMonth:function(year,month){return 32-this._daylightSavingAdjust(new Date(year,month,32)).getDate();},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay();},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst),date=this._daylightSavingAdjust(new Date(curYear,curMonth+(offset<0?offset:numMonths[0]*numMonths[1]),1));if(offset<0){date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth()));}
return this._isInRange(inst,date);},_isInRange:function(inst,date){var yearSplit,currentYear,minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),minYear=null,maxYear=null,years=this._get(inst,"yearRange");if(years){yearSplit=years.split(":");currentYear=new Date().getFullYear();minYear=parseInt(yearSplit[0],10);maxYear=parseInt(yearSplit[1],10);if(yearSplit[0].match(/[+\-].*/)){minYear+=currentYear;}
if(yearSplit[1].match(/[+\-].*/)){maxYear+=currentYear;}}
return((!minDate||date.getTime()>=minDate.getTime())&&(!maxDate||date.getTime()<=maxDate.getTime())&&(!minYear||date.getFullYear()>=minYear)&&(!maxYear||date.getFullYear()<=maxYear));},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,"shortYearCutoff");shortYearCutoff=(typeof shortYearCutoff!=="string"?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));return{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,"dayNamesShort"),dayNames:this._get(inst,"dayNames"),monthNamesShort:this._get(inst,"monthNamesShort"),monthNames:this._get(inst,"monthNames")};},_formatDate:function(inst,day,month,year){if(!day){inst.currentDay=inst.selectedDay;inst.currentMonth=inst.selectedMonth;inst.currentYear=inst.selectedYear;}
var date=(day?(typeof day==="object"?day:this._daylightSavingAdjust(new Date(year,month,day))):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return this.formatDate(this._get(inst,"dateFormat"),date,this._getFormatConfig(inst));}});function bindHover(dpDiv){var selector="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return dpDiv.delegate(selector,"mouseout",function(){$(this).removeClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!==-1){$(this).removeClass("ui-datepicker-prev-hover");}
if(this.className.indexOf("ui-datepicker-next")!==-1){$(this).removeClass("ui-datepicker-next-hover");}}).delegate(selector,"mouseover",function(){if(!$.datepicker._isDisabledDatepicker(instActive.inline?dpDiv.parent()[0]:instActive.input[0])){$(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");$(this).addClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!==-1){$(this).addClass("ui-datepicker-prev-hover");}
if(this.className.indexOf("ui-datepicker-next")!==-1){$(this).addClass("ui-datepicker-next-hover");}}});}
function extendRemove(target,props){$.extend(target,props);for(var name in props){if(props[name]==null){target[name]=props[name];}}
return target;}
$.fn.datepicker=function(options){if(!this.length){return this;}
if(!$.datepicker.initialized){$(document).mousedown($.datepicker._checkExternalClick);$.datepicker.initialized=true;}
if($("#"+$.datepicker._mainDivId).length===0){$("body").append($.datepicker.dpDiv);}
var otherArgs=Array.prototype.slice.call(arguments,1);if(typeof options==="string"&&(options==="isDisabled"||options==="getDate"||options==="widget")){return $.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs));}
if(options==="option"&&arguments.length===2&&typeof arguments[1]==="string"){return $.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs));}
return this.each(function(){typeof options==="string"?$.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this].concat(otherArgs)):$.datepicker._attachDatepicker(this,options);});};$.datepicker=new Datepicker();$.datepicker.initialized=false;$.datepicker.uuid=new Date().getTime();$.datepicker.version="1.10.4";})(jQuery);(function($){var US_ENGLISH_BCP47_TAG='en-US';function getBcp47Tag(){var bcp47Tag='';var htmlElList=document.getElementsByTagName('html'),htmlEl=(htmlElList.length>0)?htmlElList[0]:null;if(htmlEl){bcp47Tag=htmlEl.getAttribute('lang');}
if(!bcp47Tag){bcp47Tag=US_ENGLISH_BCP47_TAG;if(typeof(Tombstone)!='undefined'){Tombstone.marker('./js/plugins/jquery/jquery.ui.datepicker.box.js:22','2014-10-13','Language should always be defined as html tag attribute. Please let the Moji team know: moji@box.com.');}}
return bcp47Tag;}
$.DATEPICKER_DEFAULTS={showOn:'click',showMonthYearHeader:false,showOtherMonths:true,showControls:false,prevText:$t('Previous month','datepicker_prev_month'),nextText:$t('Next month','datepicker_next_month'),changeFirstDay:false,hideIfNoPrevNext:true};if(getBcp47Tag()===US_ENGLISH_BCP47_TAG){$.DATEPICKER_DEFAULTS.dateFormat='m/d/y';}}(jQuery));(function($){var
defaults={className:'autosizejs',id:'autosizejs',append:'\n',callback:false,resizeDelay:10,placeholder:true},copy='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; padding: 0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>',typographyStyles=['fontFamily','fontSize','fontWeight','fontStyle','letterSpacing','textTransform','wordSpacing','textIndent','whiteSpace'],mirrored,mirror=$(copy).data('autosize',true)[0];mirror.style.lineHeight='99px';if($(mirror).css('lineHeight')==='99px'){typographyStyles.push('lineHeight');}
mirror.style.lineHeight='';$.fn.autosize=function(options){if(!this.length){return this;}
options=$.extend({},defaults,options||{});if(mirror.parentNode!==document.body){$(document.body).append(mirror);}
return this.each(function(){var
ta=this,$ta=$(ta),maxHeight,minHeight,boxOffset=0,callback=$.isFunction(options.callback),originalStyles={height:ta.style.height,overflow:ta.style.overflow,overflowY:ta.style.overflowY,wordWrap:ta.style.wordWrap,resize:ta.style.resize},timeout,width=$ta.width(),taResize=$ta.css('resize');if($ta.data('autosize')){return;}
$ta.data('autosize',true);if($ta.css('box-sizing')==='border-box'||$ta.css('-moz-box-sizing')==='border-box'||$ta.css('-webkit-box-sizing')==='border-box'){boxOffset=$ta.outerHeight()-$ta.height();}
minHeight=Math.max(parseInt($ta.css('minHeight'),10)-boxOffset||0,$ta.height());$ta.css({overflow:'hidden',overflowY:'hidden',wordWrap:'break-word'});if(taResize==='vertical'){$ta.css('resize','none');}else if(taResize==='both'){$ta.css('resize','horizontal');}
function setWidth(){var width;var style=window.getComputedStyle?window.getComputedStyle(ta,null):false;if(style){width=ta.getBoundingClientRect().width;if(width===0||typeof width!=='number'){width=parseInt(style.width,10);}
$.each(['paddingLeft','paddingRight','borderLeftWidth','borderRightWidth'],function(i,val){width-=parseInt(style[val],10);});}else{width=$ta.width();}
mirror.style.width=Math.max(width,0)+'px';}
function initMirror(){var styles={};mirrored=ta;mirror.className=options.className;mirror.id=options.id;maxHeight=parseInt($ta.css('maxHeight'),10);$.each(typographyStyles,function(i,val){styles[val]=$ta.css(val);});$(mirror).css(styles).attr('wrap',$ta.attr('wrap'));setWidth();if(window.chrome){var width=ta.style.width;ta.style.width='0px';var ignore=ta.offsetWidth;ta.style.width=width;}}
function adjust(){var height,original;if(mirrored!==ta){initMirror();}else{setWidth();}
if(!ta.value&&options.placeholder){mirror.value=($ta.attr("placeholder")||'');}else{mirror.value=ta.value;}
mirror.value+=options.append||'';mirror.style.overflowY=ta.style.overflowY;original=parseInt(ta.style.height,10);mirror.scrollTop=0;mirror.scrollTop=9e4;height=mirror.scrollTop;if(maxHeight&&height>maxHeight){ta.style.overflowY='scroll';height=maxHeight;}else{ta.style.overflowY='hidden';if(height<minHeight){height=minHeight;}}
height+=boxOffset;if(original!==height){ta.style.height=height+'px';mirror.className=mirror.className;if(callback){options.callback.call(ta,ta);}
$ta.trigger('autosize.resized');}}
function resize(){clearTimeout(timeout);timeout=setTimeout(function(){var newWidth=$ta.width();if(newWidth!==width){width=newWidth;adjust();}},parseInt(options.resizeDelay,10));}
if('onpropertychange'in ta){if('oninput'in ta){$ta.on('input.autosize keyup.autosize',adjust);}else{$ta.on('propertychange.autosize',function(){if(event.propertyName==='value'){adjust();}});}}else{$ta.on('input.autosize',adjust);}
if(options.resizeDelay!==false){$(window).on('resize.autosize',resize);}
$ta.on('autosize.resize',adjust);$ta.on('autosize.resizeIncludeStyle',function(){mirrored=null;adjust();});$ta.on('autosize.destroy',function(){mirrored=null;clearTimeout(timeout);$(window).off('resize',resize);$ta.off('autosize').off('.autosize').css(originalStyles).removeData('autosize');});adjust();});};}(jQuery||$));(function($,undefined){$.ui=$.ui||{};var cachedScrollbarWidth,max=Math.max,abs=Math.abs,round=Math.round,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)];}
function parseCss(element,property){return parseInt($.css(element,property),10)||0;}
function getDimensions(elem){var raw=elem[0];if(raw.nodeType===9){return{width:elem.width(),height:elem.height(),offset:{top:0,left:0}};}
if($.isWindow(raw)){return{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}};}
if(raw.preventDefault){return{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}};}
return{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()};}
$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined){return cachedScrollbarWidth;}
var w1,w2,div=$("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth;}
div.remove();return(cachedScrollbarWidth=w1-w2);},getScrollInfo:function(within){var overflowX=within.isWindow||within.isDocument?"":within.element.css("overflow-x"),overflowY=within.isWindow||within.isDocument?"":within.element.css("overflow-y"),hasOverflowX=overflowX==="scroll"||(overflowX==="auto"&&within.width<within.element[0].scrollWidth),hasOverflowY=overflowY==="scroll"||(overflowY==="auto"&&within.height<within.element[0].scrollHeight);return{width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0};},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]),isDocument=!!withinElement[0]&&withinElement[0].nodeType===9;return{element:withinElement,isWindow:isWindow,isDocument:isDocument,offset:withinElement.offset()||{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:isWindow?withinElement.width():withinElement.outerWidth(),height:isWindow?withinElement.height():withinElement.outerHeight()};}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments);}
options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={};dimensions=getDimensions(target);if(target[0].preventDefault){options.at="left top";}
targetWidth=dimensions.width;targetHeight=dimensions.height;targetOffset=dimensions.offset;basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"];}
pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]];});if(collision.length===1){collision[1]=collision[0];}
if(options.at[0]==="right"){basePosition.left+=targetWidth;}else if(options.at[0]==="center"){basePosition.left+=targetWidth/2;}
if(options.at[1]==="bottom"){basePosition.top+=targetHeight;}else if(options.at[1]==="center"){basePosition.top+=targetHeight/2;}
atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==="right"){position.left-=elemWidth;}else if(options.my[0]==="center"){position.left-=elemWidth/2;}
if(options.my[1]==="bottom"){position.top-=elemHeight;}else if(options.my[1]==="center"){position.top-=elemHeight/2;}
position.left+=myOffset[0];position.top+=myOffset[1];if(!$.support.offsetFractions){position.left=round(position.left);position.top=round(position.top);}
collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem});}});if(options.using){using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":left>0?"right":"center",vertical:bottom<0?"top":top>0?"bottom":"middle"};if(targetWidth<elemWidth&&abs(left+right)<targetWidth){feedback.horizontal="center";}
if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight){feedback.vertical="middle";}
if(max(abs(left),abs(right))>max(abs(top),abs(bottom))){feedback.important="horizontal";}else{feedback.important="vertical";}
options.using.call(this,props,feedback);};}
elem.offset($.extend(position,{using:using}));});};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset;position.left+=overLeft-newOverRight;}else if(overRight>0&&overLeft<=0){position.left=withinOffset;}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth;}else{position.left=withinOffset;}}}else if(overLeft>0){position.left+=overLeft;}else if(overRight>0){position.left-=overRight;}else{position.left=max(position.left-collisionPosLeft,position.left);}},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset;position.top+=overTop-newOverBottom;}else if(overBottom>0&&overTop<=0){position.top=withinOffset;}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight;}else{position.top=withinOffset;}}}else if(overTop>0){position.top+=overTop;}else if(overBottom>0){position.top-=overBottom;}else{position.top=max(position.top-collisionPosTop,position.top);}}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:data.at[0]==="right"?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft)){position.left+=myOffset+atOffset+offset;}}
else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight){position.left+=myOffset+atOffset+offset;}}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top=data.my[1]==="top",myOffset=top?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:data.at[1]==="bottom"?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset;if((position.top+myOffset+atOffset+offset)>overTop&&(newOverBottom<0||newOverBottom<abs(overTop))){position.top+=myOffset+atOffset+offset;}}
else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-offsetTop;if((position.top+myOffset+atOffset+offset)>overBottom&&(newOverTop>0||abs(newOverTop)<overBottom)){position.top+=myOffset+atOffset+offset;}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments);},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments);}}};(function(){var testElement,testElementParent,testElementStyle,offsetLeft,i,body=document.getElementsByTagName("body")[0],div=document.createElement("div");testElement=document.createElement(body?"div":"body");testElementStyle={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(body){$.extend(testElementStyle,{position:"absolute",left:"-1000px",top:"-1000px"});}
for(i in testElementStyle){testElement.style[i]=testElementStyle[i];}
testElement.appendChild(div);testElementParent=body||document.documentElement;testElementParent.insertBefore(testElement,testElementParent.firstChild);div.style.cssText="position: absolute; left: 10.7432222px;";offsetLeft=$(div).offset().left;$.support.offsetFractions=offsetLeft>10&&offsetLeft<11;testElement.innerHTML="";testElementParent.removeChild(testElement);})();}(jQuery));!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Promise=e()}}(function(){var define,module,exports;return(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof _dereq_=="function"&&_dereq_;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof _dereq_=="function"&&_dereq_;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){var SomePromiseArray=Promise._SomePromiseArray;function any(promises){var ret=new SomePromiseArray(promises);var promise=ret.promise();ret.setHowMany(1);ret.setUnwrap();ret.init();return promise;}
Promise.any=function(promises){return any(promises);};Promise.prototype.any=function(){return any(this);};};},{}],2:[function(_dereq_,module,exports){"use strict";var firstLineError;try{throw new Error();}catch(e){firstLineError=e;}
var schedule=_dereq_("./schedule.js");var Queue=_dereq_("./queue.js");var util=_dereq_("./util.js");function Async(){this._isTickUsed=false;this._lateQueue=new Queue(16);this._normalQueue=new Queue(16);this._trampolineEnabled=true;var self=this;this.drainQueues=function(){self._drainQueues();};this._schedule=schedule.isStatic?schedule(this.drainQueues):schedule;}
Async.prototype.disableTrampolineIfNecessary=function(){if(util.hasDevTools){this._trampolineEnabled=false;}};Async.prototype.enableTrampoline=function(){if(!this._trampolineEnabled){this._trampolineEnabled=true;this._schedule=function(fn){setTimeout(fn,0);};}};Async.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0;};Async.prototype.throwLater=function(fn,arg){if(arguments.length===1){arg=fn;fn=function(){throw arg;};}
if(typeof setTimeout!=="undefined"){setTimeout(function(){fn(arg);},0);}else try{this._schedule(function(){fn(arg);});}catch(e){throw new Error("No async scheduler available\u000a\u000a    See http://goo.gl/m3OTXk\u000a");}};function AsyncInvokeLater(fn,receiver,arg){this._lateQueue.push(fn,receiver,arg);this._queueTick();}
function AsyncInvoke(fn,receiver,arg){this._normalQueue.push(fn,receiver,arg);this._queueTick();}
function AsyncSettlePromises(promise){this._normalQueue._pushOne(promise);this._queueTick();}
if(!util.hasDevTools){Async.prototype.invokeLater=AsyncInvokeLater;Async.prototype.invoke=AsyncInvoke;Async.prototype.settlePromises=AsyncSettlePromises;}else{if(schedule.isStatic){schedule=function(fn){setTimeout(fn,0);};}
Async.prototype.invokeLater=function(fn,receiver,arg){if(this._trampolineEnabled){AsyncInvokeLater.call(this,fn,receiver,arg);}else{this._schedule(function(){setTimeout(function(){fn.call(receiver,arg);},100);});}};Async.prototype.invoke=function(fn,receiver,arg){if(this._trampolineEnabled){AsyncInvoke.call(this,fn,receiver,arg);}else{this._schedule(function(){fn.call(receiver,arg);});}};Async.prototype.settlePromises=function(promise){if(this._trampolineEnabled){AsyncSettlePromises.call(this,promise);}else{this._schedule(function(){promise._settlePromises();});}};}
Async.prototype.invokeFirst=function(fn,receiver,arg){this._normalQueue.unshift(fn,receiver,arg);this._queueTick();};Async.prototype._drainQueue=function(queue){while(queue.length()>0){var fn=queue.shift();if(typeof fn!=="function"){fn._settlePromises();continue;}
var receiver=queue.shift();var arg=queue.shift();fn.call(receiver,arg);}};Async.prototype._drainQueues=function(){this._drainQueue(this._normalQueue);this._reset();this._drainQueue(this._lateQueue);};Async.prototype._queueTick=function(){if(!this._isTickUsed){this._isTickUsed=true;this._schedule(this.drainQueues);}};Async.prototype._reset=function(){this._isTickUsed=false;};module.exports=new Async();module.exports.firstLineError=firstLineError;},{"./queue.js":20,"./schedule.js":21,"./util.js":26}],3:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise){var rejectThis=function(_,e){this._reject(e);};var targetRejected=function(e,context){context.promiseRejectionQueued=true;context.bindingPromise._then(rejectThis,rejectThis,null,this,e);};var bindingResolved=function(thisArg,context){if(this._isPending()){this._resolveCallback(context.target);}};var bindingRejected=function(e,context){if(!context.promiseRejectionQueued)this._reject(e);};Promise.prototype.bind=function(thisArg){var maybePromise=tryConvertToPromise(thisArg);var ret=new Promise(INTERNAL);ret._propagateFrom(this,1);var target=this._target();ret._setBoundTo(maybePromise);if(maybePromise instanceof Promise){var context={promiseRejectionQueued:false,promise:ret,target:target,bindingPromise:maybePromise};target._then(INTERNAL,targetRejected,ret._progress,ret,context);maybePromise._then(bindingResolved,bindingRejected,ret._progress,ret,context);}else{ret._resolveCallback(target);}
return ret;};Promise.prototype._setBoundTo=function(obj){if(obj!==undefined){this._bitField=this._bitField|131072;this._boundTo=obj;}else{this._bitField=this._bitField&(~131072);}};Promise.prototype._isBound=function(){return(this._bitField&131072)===131072;};Promise.bind=function(thisArg,value){var maybePromise=tryConvertToPromise(thisArg);var ret=new Promise(INTERNAL);ret._setBoundTo(maybePromise);if(maybePromise instanceof Promise){maybePromise._then(function(){ret._resolveCallback(value);},ret._reject,ret._progress,ret,null);}else{ret._resolveCallback(value);}
return ret;};};},{}],4:[function(_dereq_,module,exports){"use strict";var old;if(typeof Promise!=="undefined")old=Promise;function noConflict(){try{if(Promise===bluebird)Promise=old;}
catch(e){}
return bluebird;}
var bluebird=_dereq_("./promise.js")();bluebird.noConflict=noConflict;module.exports=bluebird;},{"./promise.js":17}],5:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){var errors=_dereq_("./errors.js");var async=_dereq_("./async.js");var CancellationError=errors.CancellationError;Promise.prototype._cancel=function(reason){if(!this.isCancellable())return this;var parent;var promiseToReject=this;while((parent=promiseToReject._cancellationParent)!==undefined&&parent.isCancellable()){promiseToReject=parent;}
this._unsetCancellable();promiseToReject._target()._rejectCallback(reason,false,true);};Promise.prototype.cancel=function(reason){if(!this.isCancellable())return this;if(reason===undefined)reason=new CancellationError();async.invokeLater(this._cancel,this,reason);return this;};Promise.prototype.cancellable=function(){if(this._cancellable())return this;async.enableTrampoline();this._setCancellable();this._cancellationParent=undefined;return this;};Promise.prototype.uncancellable=function(){var ret=this.then();ret._unsetCancellable();return ret;};Promise.prototype.fork=function(didFulfill,didReject,didProgress){var ret=this._then(didFulfill,didReject,didProgress,undefined,undefined);ret._setCancellable();ret._cancellationParent=undefined;return ret;};};},{"./async.js":2,"./errors.js":11}],6:[function(_dereq_,module,exports){"use strict";module.exports=function(){var async=_dereq_("./async.js");var util=_dereq_("./util.js");var bluebirdFramePattern=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo|instrumented)/;var stackFramePattern=null;var formatStack=null;var indentStackFrames=false;var warn;function CapturedTrace(parent){this._parent=parent;var length=this._length=1+(parent===undefined?0:parent._length);captureStackTrace(this,CapturedTrace);if(length>32)this.uncycle();}
util.inherits(CapturedTrace,Error);CapturedTrace.prototype.uncycle=function(){var length=this._length;if(length<2)return;var nodes=[];var stackToIndex={};for(var i=0,node=this;node!==undefined;++i){nodes.push(node);node=node._parent;}
length=this._length=i;for(var i=length-1;i>=0;--i){var stack=nodes[i].stack;if(stackToIndex[stack]===undefined){stackToIndex[stack]=i;}}
for(var i=0;i<length;++i){var currentStack=nodes[i].stack;var index=stackToIndex[currentStack];if(index!==undefined&&index!==i){if(index>0){nodes[index-1]._parent=undefined;nodes[index-1]._length=1;}
nodes[i]._parent=undefined;nodes[i]._length=1;var cycleEdgeNode=i>0?nodes[i-1]:this;if(index<length-1){cycleEdgeNode._parent=nodes[index+1];cycleEdgeNode._parent.uncycle();cycleEdgeNode._length=cycleEdgeNode._parent._length+1;}else{cycleEdgeNode._parent=undefined;cycleEdgeNode._length=1;}
var currentChildLength=cycleEdgeNode._length+1;for(var j=i-2;j>=0;--j){nodes[j]._length=currentChildLength;currentChildLength++;}
return;}}};CapturedTrace.prototype.parent=function(){return this._parent;};CapturedTrace.prototype.hasParent=function(){return this._parent!==undefined;};CapturedTrace.prototype.attachExtraTrace=function(error){if(error.__stackCleaned__)return;this.uncycle();var parsed=CapturedTrace.parseStackAndMessage(error);var message=parsed.message;var stacks=[parsed.stack];var trace=this;while(trace!==undefined){stacks.push(cleanStack(trace.stack.split("\n")));trace=trace._parent;}
removeCommonRoots(stacks);removeDuplicateOrEmptyJumps(stacks);util.notEnumerableProp(error,"stack",reconstructStack(message,stacks));util.notEnumerableProp(error,"__stackCleaned__",true);};function reconstructStack(message,stacks){for(var i=0;i<stacks.length-1;++i){stacks[i].push("From previous event:");stacks[i]=stacks[i].join("\n");}
if(i<stacks.length){stacks[i]=stacks[i].join("\n");}
return message+"\n"+stacks.join("\n");}
function removeDuplicateOrEmptyJumps(stacks){for(var i=0;i<stacks.length;++i){if(stacks[i].length===0||((i+1<stacks.length)&&stacks[i][0]===stacks[i+1][0])){stacks.splice(i,1);i--;}}}
function removeCommonRoots(stacks){var current=stacks[0];for(var i=1;i<stacks.length;++i){var prev=stacks[i];var currentLastIndex=current.length-1;var currentLastLine=current[currentLastIndex];var commonRootMeetPoint=-1;for(var j=prev.length-1;j>=0;--j){if(prev[j]===currentLastLine){commonRootMeetPoint=j;break;}}
for(var j=commonRootMeetPoint;j>=0;--j){var line=prev[j];if(current[currentLastIndex]===line){current.pop();currentLastIndex--;}else{break;}}
current=prev;}}
function cleanStack(stack){var ret=[];for(var i=0;i<stack.length;++i){var line=stack[i];var isTraceLine=stackFramePattern.test(line)||"    (No stack trace)"===line;var isInternalFrame=isTraceLine&&shouldIgnore(line);if(isTraceLine&&!isInternalFrame){if(indentStackFrames&&line.charAt(0)!==" "){line="    "+line;}
ret.push(line);}}
return ret;}
function stackFramesAsArray(error){var stack=error.stack.replace(/\s+$/g,"").split("\n");for(var i=0;i<stack.length;++i){var line=stack[i];if("    (No stack trace)"===line||stackFramePattern.test(line)){break;}}
if(i>0){stack=stack.slice(i);}
return stack;}
CapturedTrace.parseStackAndMessage=function(error){var stack=error.stack;var message=error.toString();stack=typeof stack==="string"&&stack.length>0?stackFramesAsArray(error):["    (No stack trace)"];return{message:message,stack:cleanStack(stack)};};CapturedTrace.formatAndLogError=function(error,title){if(typeof console!=="undefined"){var message;if(typeof error==="object"||typeof error==="function"){var stack=error.stack;message=title+formatStack(stack,error);}else{message=title+String(error);}
if(typeof warn==="function"){warn(message);}else if(typeof console.log==="function"||typeof console.log==="object"){console.log(message);}}};CapturedTrace.unhandledRejection=function(reason){CapturedTrace.formatAndLogError(reason,"^--- With additional stack trace: ");};CapturedTrace.isSupported=function(){return typeof captureStackTrace==="function";};CapturedTrace.fireRejectionEvent=function(name,localHandler,reason,promise){var localEventFired=false;try{if(typeof localHandler==="function"){localEventFired=true;if(name==="rejectionHandled"){localHandler(promise);}else{localHandler(reason,promise);}}}catch(e){async.throwLater(e);}
var globalEventFired=false;try{globalEventFired=fireGlobalEvent(name,reason,promise);}catch(e){globalEventFired=true;async.throwLater(e);}
var domEventFired=false;if(fireDomEvent){try{domEventFired=fireDomEvent(name.toLowerCase(),{reason:reason,promise:promise});}catch(e){domEventFired=true;async.throwLater(e);}}
if(!globalEventFired&&!localEventFired&&!domEventFired&&name==="unhandledRejection"){CapturedTrace.formatAndLogError(reason,"Unhandled rejection ");}};function formatNonError(obj){var str;if(typeof obj==="function"){str="[function "+
(obj.name||"anonymous")+"]";}else{str=obj.toString();var ruselessToString=/\[object [a-zA-Z0-9$_]+\]/;if(ruselessToString.test(str)){try{var newStr=JSON.stringify(obj);str=newStr;}
catch(e){}}
if(str.length===0){str="(empty array)";}}
return("(<"+snip(str)+">, no stack trace)");}
function snip(str){var maxChars=41;if(str.length<maxChars){return str;}
return str.substr(0,maxChars-3)+"...";}
var shouldIgnore=function(){return false;};var parseLineInfoRegex=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function parseLineInfo(line){var matches=line.match(parseLineInfoRegex);if(matches){return{fileName:matches[1],line:parseInt(matches[2],10)};}}
CapturedTrace.setBounds=function(firstLineError,lastLineError){if(!CapturedTrace.isSupported())return;var firstStackLines=firstLineError.stack.split("\n");var lastStackLines=lastLineError.stack.split("\n");var firstIndex=-1;var lastIndex=-1;var firstFileName;var lastFileName;for(var i=0;i<firstStackLines.length;++i){var result=parseLineInfo(firstStackLines[i]);if(result){firstFileName=result.fileName;firstIndex=result.line;break;}}
for(var i=0;i<lastStackLines.length;++i){var result=parseLineInfo(lastStackLines[i]);if(result){lastFileName=result.fileName;lastIndex=result.line;break;}}
if(firstIndex<0||lastIndex<0||!firstFileName||!lastFileName||firstFileName!==lastFileName||firstIndex>=lastIndex){return;}
shouldIgnore=function(line){if(bluebirdFramePattern.test(line))return true;var info=parseLineInfo(line);if(info){if(info.fileName===firstFileName&&(firstIndex<=info.line&&info.line<=lastIndex)){return true;}}
return false;};};var captureStackTrace=(function stackDetection(){var v8stackFramePattern=/^\s*at\s*/;var v8stackFormatter=function(stack,error){if(typeof stack==="string")return stack;if(error.name!==undefined&&error.message!==undefined){return error.toString();}
return formatNonError(error);};if(typeof Error.stackTraceLimit==="number"&&typeof Error.captureStackTrace==="function"){Error.stackTraceLimit=Error.stackTraceLimit+6;stackFramePattern=v8stackFramePattern;formatStack=v8stackFormatter;var captureStackTrace=Error.captureStackTrace;shouldIgnore=function(line){return bluebirdFramePattern.test(line);};return function(receiver,ignoreUntil){Error.stackTraceLimit=Error.stackTraceLimit+6;captureStackTrace(receiver,ignoreUntil);Error.stackTraceLimit=Error.stackTraceLimit-6;};}
var err=new Error();if(typeof err.stack==="string"&&err.stack.split("\n")[0].indexOf("stackDetection@")>=0){stackFramePattern=/@/;formatStack=v8stackFormatter;indentStackFrames=true;return function captureStackTrace(o){o.stack=new Error().stack;};}
var hasStackAfterThrow;try{throw new Error();}
catch(e){hasStackAfterThrow=("stack"in e);}
if(!("stack"in err)&&hasStackAfterThrow&&typeof Error.stackTraceLimit==="number"){stackFramePattern=v8stackFramePattern;formatStack=v8stackFormatter;return function captureStackTrace(o){Error.stackTraceLimit=Error.stackTraceLimit+6;try{throw new Error();}
catch(e){o.stack=e.stack;}
Error.stackTraceLimit=Error.stackTraceLimit-6;};}
formatStack=function(stack,error){if(typeof stack==="string")return stack;if((typeof error==="object"||typeof error==="function")&&error.name!==undefined&&error.message!==undefined){return error.toString();}
return formatNonError(error);};return null;})([]);var fireDomEvent;var fireGlobalEvent=(function(){if(util.isNode){return function(name,reason,promise){if(name==="rejectionHandled"){return process.emit(name,promise);}else{return process.emit(name,reason,promise);}};}else{var customEventWorks=false;var anyEventWorks=true;try{var ev=new self.CustomEvent("test");customEventWorks=ev instanceof CustomEvent;}catch(e){}
if(!customEventWorks){try{var event=document.createEvent("CustomEvent");event.initCustomEvent("testingtheevent",false,true,{});self.dispatchEvent(event);}catch(e){anyEventWorks=false;}}
if(anyEventWorks){fireDomEvent=function(type,detail){var event;if(customEventWorks){event=new self.CustomEvent(type,{detail:detail,bubbles:false,cancelable:true});}else if(self.dispatchEvent){event=document.createEvent("CustomEvent");event.initCustomEvent(type,false,true,detail);}
return event?!self.dispatchEvent(event):false;};}
var toWindowMethodNameMap={};toWindowMethodNameMap["unhandledRejection"]=("on"+"unhandledRejection").toLowerCase();toWindowMethodNameMap["rejectionHandled"]=("on"+"rejectionHandled").toLowerCase();return function(name,reason,promise){var methodName=toWindowMethodNameMap[name];var method=self[methodName];if(!method)return false;if(name==="rejectionHandled"){method.call(self,promise);}else{method.call(self,reason,promise);}
return true;};}})();if(typeof console!=="undefined"&&typeof console.warn!=="undefined"){warn=function(message){console.warn(message);};if(util.isNode&&process.stderr.isTTY){warn=function(message){process.stderr.write("\u001b[31m"+message+"\u001b[39m\n");};}else if(!util.isNode&&typeof(new Error().stack)==="string"){warn=function(message){console.warn("%c"+message,"color: red");};}}
return CapturedTrace;};},{"./async.js":2,"./util.js":26}],7:[function(_dereq_,module,exports){"use strict";module.exports=function(NEXT_FILTER){var util=_dereq_("./util.js");var errors=_dereq_("./errors.js");var tryCatch=util.tryCatch;var errorObj=util.errorObj;var keys=_dereq_("./es5.js").keys;var TypeError=errors.TypeError;function CatchFilter(instances,callback,promise){this._instances=instances;this._callback=callback;this._promise=promise;}
function safePredicate(predicate,e){var safeObject={};var retfilter=tryCatch(predicate).call(safeObject,e);if(retfilter===errorObj)return retfilter;var safeKeys=keys(safeObject);if(safeKeys.length){errorObj.e=new TypeError("Catch filter must inherit from Error or be a simple predicate function\u000a\u000a    See http://goo.gl/o84o68\u000a");return errorObj;}
return retfilter;}
CatchFilter.prototype.doFilter=function(e){var cb=this._callback;var promise=this._promise;var boundTo=promise._boundValue();for(var i=0,len=this._instances.length;i<len;++i){var item=this._instances[i];var itemIsErrorType=item===Error||(item!=null&&item.prototype instanceof Error);if(itemIsErrorType&&e instanceof item){var ret=tryCatch(cb).call(boundTo,e);if(ret===errorObj){NEXT_FILTER.e=ret.e;return NEXT_FILTER;}
return ret;}else if(typeof item==="function"&&!itemIsErrorType){var shouldHandle=safePredicate(item,e);if(shouldHandle===errorObj){e=errorObj.e;break;}else if(shouldHandle){var ret=tryCatch(cb).call(boundTo,e);if(ret===errorObj){NEXT_FILTER.e=ret.e;return NEXT_FILTER;}
return ret;}}}
NEXT_FILTER.e=e;return NEXT_FILTER;};return CatchFilter;};},{"./errors.js":11,"./es5.js":12,"./util.js":26}],8:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,CapturedTrace,isDebugging){var contextStack=[];function Context(){this._trace=new CapturedTrace(peekContext());}
Context.prototype._pushContext=function(){if(!isDebugging())return;if(this._trace!==undefined){contextStack.push(this._trace);}};Context.prototype._popContext=function(){if(!isDebugging())return;if(this._trace!==undefined){contextStack.pop();}};function createContext(){if(isDebugging())return new Context();}
function peekContext(){var lastIndex=contextStack.length-1;if(lastIndex>=0){return contextStack[lastIndex];}
return undefined;}
Promise.prototype._peekContext=peekContext;Promise.prototype._pushContext=Context.prototype._pushContext;Promise.prototype._popContext=Context.prototype._popContext;return createContext;};},{}],9:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,CapturedTrace){var getDomain=Promise._getDomain;var async=_dereq_("./async.js");var Warning=_dereq_("./errors.js").Warning;var util=_dereq_("./util.js");var canAttachTrace=util.canAttachTrace;var unhandledRejectionHandled;var possiblyUnhandledRejection;var debugging=false||(util.isNode&&(!!process.env["BLUEBIRD_DEBUG"]||process.env["NODE_ENV"]==="development"));if(debugging){async.disableTrampolineIfNecessary();}
Promise.prototype._ignoreRejections=function(){this._unsetRejectionIsUnhandled();this._bitField=this._bitField|16777216;};Promise.prototype._ensurePossibleRejectionHandled=function(){if((this._bitField&16777216)!==0)return;this._setRejectionIsUnhandled();async.invokeLater(this._notifyUnhandledRejection,this,undefined);};Promise.prototype._notifyUnhandledRejectionIsHandled=function(){CapturedTrace.fireRejectionEvent("rejectionHandled",unhandledRejectionHandled,undefined,this);};Promise.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var reason=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified();CapturedTrace.fireRejectionEvent("unhandledRejection",possiblyUnhandledRejection,reason,this);}};Promise.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=this._bitField|524288;};Promise.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&(~524288);};Promise.prototype._isUnhandledRejectionNotified=function(){return(this._bitField&524288)>0;};Promise.prototype._setRejectionIsUnhandled=function(){this._bitField=this._bitField|2097152;};Promise.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&(~2097152);if(this._isUnhandledRejectionNotified()){this._unsetUnhandledRejectionIsNotified();this._notifyUnhandledRejectionIsHandled();}};Promise.prototype._isRejectionUnhandled=function(){return(this._bitField&2097152)>0;};Promise.prototype._setCarriedStackTrace=function(capturedTrace){this._bitField=this._bitField|1048576;this._fulfillmentHandler0=capturedTrace;};Promise.prototype._isCarryingStackTrace=function(){return(this._bitField&1048576)>0;};Promise.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:undefined;};Promise.prototype._captureStackTrace=function(){if(debugging){this._trace=new CapturedTrace(this._peekContext());}
return this;};Promise.prototype._attachExtraTrace=function(error,ignoreSelf){if(debugging&&canAttachTrace(error)){var trace=this._trace;if(trace!==undefined){if(ignoreSelf)trace=trace._parent;}
if(trace!==undefined){trace.attachExtraTrace(error);}else if(!error.__stackCleaned__){var parsed=CapturedTrace.parseStackAndMessage(error);util.notEnumerableProp(error,"stack",parsed.message+"\n"+parsed.stack.join("\n"));util.notEnumerableProp(error,"__stackCleaned__",true);}}};Promise.prototype._warn=function(message){var warning=new Warning(message);var ctx=this._peekContext();if(ctx){ctx.attachExtraTrace(warning);}else{var parsed=CapturedTrace.parseStackAndMessage(warning);warning.stack=parsed.message+"\n"+parsed.stack.join("\n");}
CapturedTrace.formatAndLogError(warning,"");};Promise.onPossiblyUnhandledRejection=function(fn){var domain=getDomain();possiblyUnhandledRejection=typeof fn==="function"?(domain===null?fn:domain.bind(fn)):undefined;};Promise.onUnhandledRejectionHandled=function(fn){var domain=getDomain();unhandledRejectionHandled=typeof fn==="function"?(domain===null?fn:domain.bind(fn)):undefined;};Promise.longStackTraces=function(){if(async.haveItemsQueued()&&debugging===false){throw new Error("cannot enable long stack traces after promises have been created\u000a\u000a    See http://goo.gl/DT1qyG\u000a");}
debugging=CapturedTrace.isSupported();if(debugging){async.disableTrampolineIfNecessary();}};Promise.hasLongStackTraces=function(){return debugging&&CapturedTrace.isSupported();};if(!CapturedTrace.isSupported()){Promise.longStackTraces=function(){};debugging=false;}
return function(){return debugging;};};},{"./async.js":2,"./errors.js":11,"./util.js":26}],10:[function(_dereq_,module,exports){"use strict";var util=_dereq_("./util.js");var isPrimitive=util.isPrimitive;module.exports=function(Promise){var returner=function(){return this;};var thrower=function(){throw this;};var returnUndefined=function(){};var throwUndefined=function(){throw undefined;};var wrapper=function(value,action){if(action===1){return function(){throw value;};}else if(action===2){return function(){return value;};}};Promise.prototype["return"]=Promise.prototype.thenReturn=function(value){if(value===undefined)return this.then(returnUndefined);if(isPrimitive(value)){return this._then(wrapper(value,2),undefined,undefined,undefined,undefined);}
return this._then(returner,undefined,undefined,value,undefined);};Promise.prototype["throw"]=Promise.prototype.thenThrow=function(reason){if(reason===undefined)return this.then(throwUndefined);if(isPrimitive(reason)){return this._then(wrapper(reason,1),undefined,undefined,undefined,undefined);}
return this._then(thrower,undefined,undefined,reason,undefined);};};},{"./util.js":26}],11:[function(_dereq_,module,exports){"use strict";var es5=_dereq_("./es5.js");var Objectfreeze=es5.freeze;var util=_dereq_("./util.js");var inherits=util.inherits;var notEnumerableProp=util.notEnumerableProp;function subError(nameProperty,defaultMessage){function SubError(message){if(!(this instanceof SubError))return new SubError(message);notEnumerableProp(this,"message",typeof message==="string"?message:defaultMessage);notEnumerableProp(this,"name",nameProperty);if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor);}else{Error.call(this);}}
inherits(SubError,Error);return SubError;}
var _TypeError,_RangeError;var Warning=subError("Warning","warning");var CancellationError=subError("CancellationError","cancellation error");var TimeoutError=subError("TimeoutError","timeout error");var AggregateError=subError("AggregateError","aggregate error");try{_TypeError=TypeError;_RangeError=RangeError;}catch(e){_TypeError=subError("TypeError","type error");_RangeError=subError("RangeError","range error");}
var methods=("join pop push shift unshift slice filter forEach some "+"every map indexOf lastIndexOf reduce reduceRight sort reverse").split(" ");for(var i=0;i<methods.length;++i){if(typeof Array.prototype[methods[i]]==="function"){AggregateError.prototype[methods[i]]=Array.prototype[methods[i]];}}
es5.defineProperty(AggregateError.prototype,"length",{value:0,configurable:false,writable:true,enumerable:true});AggregateError.prototype["isOperational"]=true;var level=0;AggregateError.prototype.toString=function(){var indent=Array(level*4+1).join(" ");var ret="\n"+indent+"AggregateError of:"+"\n";level++;indent=Array(level*4+1).join(" ");for(var i=0;i<this.length;++i){var str=this[i]===this?"[Circular AggregateError]":this[i]+"";var lines=str.split("\n");for(var j=0;j<lines.length;++j){lines[j]=indent+lines[j];}
str=lines.join("\n");ret+=str+"\n";}
level--;return ret;};function OperationalError(message){if(!(this instanceof OperationalError))
return new OperationalError(message);notEnumerableProp(this,"name","OperationalError");notEnumerableProp(this,"message",message);this.cause=message;this["isOperational"]=true;if(message instanceof Error){notEnumerableProp(this,"message",message.message);notEnumerableProp(this,"stack",message.stack);}else if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor);}}
inherits(OperationalError,Error);var errorTypes=Error["__BluebirdErrorTypes__"];if(!errorTypes){errorTypes=Objectfreeze({CancellationError:CancellationError,TimeoutError:TimeoutError,OperationalError:OperationalError,RejectionError:OperationalError,AggregateError:AggregateError});notEnumerableProp(Error,"__BluebirdErrorTypes__",errorTypes);}
module.exports={Error:Error,TypeError:_TypeError,RangeError:_RangeError,CancellationError:errorTypes.CancellationError,OperationalError:errorTypes.OperationalError,TimeoutError:errorTypes.TimeoutError,AggregateError:errorTypes.AggregateError,Warning:Warning};},{"./es5.js":12,"./util.js":26}],12:[function(_dereq_,module,exports){var isES5=(function(){"use strict";return this===undefined;})();if(isES5){module.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:isES5,propertyIsWritable:function(obj,prop){var descriptor=Object.getOwnPropertyDescriptor(obj,prop);return!!(!descriptor||descriptor.writable||descriptor.set);}};}else{var has={}.hasOwnProperty;var str={}.toString;var proto={}.constructor.prototype;var ObjectKeys=function(o){var ret=[];for(var key in o){if(has.call(o,key)){ret.push(key);}}
return ret;};var ObjectGetDescriptor=function(o,key){return{value:o[key]};};var ObjectDefineProperty=function(o,key,desc){o[key]=desc.value;return o;};var ObjectFreeze=function(obj){return obj;};var ObjectGetPrototypeOf=function(obj){try{return Object(obj).constructor.prototype;}
catch(e){return proto;}};var ArrayIsArray=function(obj){try{return str.call(obj)==="[object Array]";}
catch(e){return false;}};module.exports={isArray:ArrayIsArray,keys:ObjectKeys,names:ObjectKeys,defineProperty:ObjectDefineProperty,getDescriptor:ObjectGetDescriptor,freeze:ObjectFreeze,getPrototypeOf:ObjectGetPrototypeOf,isES5:isES5,propertyIsWritable:function(){return true;}};}},{}],13:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,NEXT_FILTER,tryConvertToPromise){var util=_dereq_("./util.js");var isPrimitive=util.isPrimitive;var thrower=util.thrower;function returnThis(){return this;}
function throwThis(){throw this;}
function return$(r){return function(){return r;};}
function throw$(r){return function(){throw r;};}
function promisedFinally(ret,reasonOrValue,isFulfilled){var then;if(isPrimitive(reasonOrValue)){then=isFulfilled?return$(reasonOrValue):throw$(reasonOrValue);}else{then=isFulfilled?returnThis:throwThis;}
return ret._then(then,thrower,undefined,reasonOrValue,undefined);}
function finallyHandler(reasonOrValue){var promise=this.promise;var handler=this.handler;var ret=promise._isBound()?handler.call(promise._boundValue()):handler();if(ret!==undefined){var maybePromise=tryConvertToPromise(ret,promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();return promisedFinally(maybePromise,reasonOrValue,promise.isFulfilled());}}
if(promise.isRejected()){NEXT_FILTER.e=reasonOrValue;return NEXT_FILTER;}else{return reasonOrValue;}}
function tapHandler(value){var promise=this.promise;var handler=this.handler;var ret=promise._isBound()?handler.call(promise._boundValue(),value):handler(value);if(ret!==undefined){var maybePromise=tryConvertToPromise(ret,promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();return promisedFinally(maybePromise,value,true);}}
return value;}
Promise.prototype._passThroughHandler=function(handler,isFinally){if(typeof handler!=="function")return this.then();var promiseAndHandler={promise:this,handler:handler};return this._then(isFinally?finallyHandler:tapHandler,isFinally?finallyHandler:undefined,undefined,promiseAndHandler,undefined);};Promise.prototype.lastly=Promise.prototype["finally"]=function(handler){return this._passThroughHandler(handler,true);};Promise.prototype.tap=function(handler){return this._passThroughHandler(handler,false);};};},{"./util.js":26}],14:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,INTERNAL){var util=_dereq_("./util.js");var canEvaluate=util.canEvaluate;var tryCatch=util.tryCatch;var errorObj=util.errorObj;var reject;if(!true){if(canEvaluate){var thenCallback=function(i){return new Function("value","holder","                             \n\
   'use strict';                                                    \n\
   holder.pIndex = value;                                           \n\
   holder.checkFulfillment(this);                                   \n\
   ".replace(/Index/g,i));};var caller=function(count){var values=[];for(var i=1;i<=count;++i)values.push("holder.p"+i);return new Function("holder","                                      \n\
   'use strict';                                                    \n\
   var callback = holder.fn;                                        \n\
   return callback(values);                                         \n\
   ".replace(/values/g,values.join(", ")));};var thenCallbacks=[];var callers=[undefined];for(var i=1;i<=5;++i){thenCallbacks.push(thenCallback(i));callers.push(caller(i));}
var Holder=function(total,fn){this.p1=this.p2=this.p3=this.p4=this.p5=null;this.fn=fn;this.total=total;this.now=0;};Holder.prototype.callers=callers;Holder.prototype.checkFulfillment=function(promise){var now=this.now;now++;var total=this.total;if(now>=total){var handler=this.callers[total];promise._pushContext();var ret=tryCatch(handler)(this);promise._popContext();if(ret===errorObj){promise._rejectCallback(ret.e,false,true);}else{promise._resolveCallback(ret);}}else{this.now=now;}};var reject=function(reason){this._reject(reason);};}}
Promise.join=function(){var last=arguments.length-1;var fn;if(last>0&&typeof arguments[last]==="function"){fn=arguments[last];if(!true){if(last<6&&canEvaluate){var ret=new Promise(INTERNAL);ret._captureStackTrace();var holder=new Holder(last,fn);var callbacks=thenCallbacks;for(var i=0;i<last;++i){var maybePromise=tryConvertToPromise(arguments[i],ret);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();if(maybePromise._isPending()){maybePromise._then(callbacks[i],reject,undefined,ret,holder);}else if(maybePromise._isFulfilled()){callbacks[i].call(ret,maybePromise._value(),holder);}else{ret._reject(maybePromise._reason());}}else{callbacks[i].call(ret,maybePromise,holder);}}
return ret;}}}
var $_len=arguments.length;var args=new Array($_len);for(var $_i=0;$_i<$_len;++$_i){args[$_i]=arguments[$_i];}
if(fn)args.pop();var ret=new PromiseArray(args).promise();return fn!==undefined?ret.spread(fn):ret;};};},{"./util.js":26}],15:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){var util=_dereq_("./util.js");var tryCatch=util.tryCatch;Promise.method=function(fn){if(typeof fn!=="function"){throw new Promise.TypeError("fn must be a function\u000a\u000a    See http://goo.gl/916lJJ\u000a");}
return function(){var ret=new Promise(INTERNAL);ret._captureStackTrace();ret._pushContext();var value=tryCatch(fn).apply(this,arguments);ret._popContext();ret._resolveFromSyncValue(value);return ret;};};Promise.attempt=Promise["try"]=function(fn,args,ctx){if(typeof fn!=="function"){return apiRejection("fn must be a function\u000a\u000a    See http://goo.gl/916lJJ\u000a");}
var ret=new Promise(INTERNAL);ret._captureStackTrace();ret._pushContext();var value=util.isArray(args)?tryCatch(fn).apply(ctx,args):tryCatch(fn).call(ctx,args);ret._popContext();ret._resolveFromSyncValue(value);return ret;};Promise.prototype._resolveFromSyncValue=function(value){if(value===util.errorObj){this._rejectCallback(value.e,false,true);}else{this._resolveCallback(value,true);}};};},{"./util.js":26}],16:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray){var util=_dereq_("./util.js");var async=_dereq_("./async.js");var tryCatch=util.tryCatch;var errorObj=util.errorObj;Promise.prototype.progressed=function(handler){return this._then(undefined,undefined,handler,undefined,undefined);};Promise.prototype._progress=function(progressValue){if(this._isFollowingOrFulfilledOrRejected())return;this._target()._progressUnchecked(progressValue);};Promise.prototype._progressHandlerAt=function(index){return index===0?this._progressHandler0:this[(index<<2)+index-5+2];};Promise.prototype._doProgressWith=function(progression){var progressValue=progression.value;var handler=progression.handler;var promise=progression.promise;var receiver=progression.receiver;var ret=tryCatch(handler).call(receiver,progressValue);if(ret===errorObj){if(ret.e!=null&&ret.e.name!=="StopProgressPropagation"){var trace=util.canAttachTrace(ret.e)?ret.e:new Error(util.toString(ret.e));promise._attachExtraTrace(trace);promise._progress(ret.e);}}else if(ret instanceof Promise){ret._then(promise._progress,null,null,promise,undefined);}else{promise._progress(ret);}};Promise.prototype._progressUnchecked=function(progressValue){var len=this._length();var progress=this._progress;for(var i=0;i<len;i++){var handler=this._progressHandlerAt(i);var promise=this._promiseAt(i);if(!(promise instanceof Promise)){var receiver=this._receiverAt(i);if(typeof handler==="function"){handler.call(receiver,progressValue,promise);}else if(receiver instanceof PromiseArray&&!receiver._isResolved()){receiver._promiseProgressed(progressValue,promise);}
continue;}
if(typeof handler==="function"){async.invoke(this._doProgressWith,this,{handler:handler,promise:promise,receiver:this._receiverAt(i),value:progressValue});}else{async.invoke(progress,promise,progressValue);}}};};},{"./async.js":2,"./util.js":26}],17:[function(_dereq_,module,exports){"use strict";module.exports=function(){var makeSelfResolutionError=function(){return new TypeError("circular promise resolution chain\u000a\u000a    See http://goo.gl/LhFpo0\u000a");};var reflect=function(){return new Promise.PromiseInspection(this._target());};var apiRejection=function(msg){return Promise.reject(new TypeError(msg));};var util=_dereq_("./util.js");var getDomain;if(util.isNode){getDomain=function(){var ret=process.domain;if(ret===undefined)ret=null;return ret;};}else{getDomain=function(){return null;};}
util.notEnumerableProp(Promise,"_getDomain",getDomain);var async=_dereq_("./async.js");var errors=_dereq_("./errors.js");var TypeError=Promise.TypeError=errors.TypeError;Promise.RangeError=errors.RangeError;Promise.CancellationError=errors.CancellationError;Promise.TimeoutError=errors.TimeoutError;Promise.OperationalError=errors.OperationalError;Promise.RejectionError=errors.OperationalError;Promise.AggregateError=errors.AggregateError;var INTERNAL=function(){};var APPLY={};var NEXT_FILTER={e:null};var tryConvertToPromise=_dereq_("./thenables.js")(Promise,INTERNAL);var PromiseArray=_dereq_("./promise_array.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection);var CapturedTrace=_dereq_("./captured_trace.js")();var isDebugging=_dereq_("./debuggability.js")(Promise,CapturedTrace);var createContext=_dereq_("./context.js")(Promise,CapturedTrace,isDebugging);var CatchFilter=_dereq_("./catch_filter.js")(NEXT_FILTER);var PromiseResolver=_dereq_("./promise_resolver.js");var nodebackForPromise=PromiseResolver._nodebackForPromise;var errorObj=util.errorObj;var tryCatch=util.tryCatch;function Promise(resolver){if(typeof resolver!=="function"){throw new TypeError("the promise constructor requires a resolver function\u000a\u000a    See http://goo.gl/EC22Yn\u000a");}
if(this.constructor!==Promise){throw new TypeError("the promise constructor cannot be invoked directly\u000a\u000a    See http://goo.gl/KsIlge\u000a");}
this._bitField=0;this._fulfillmentHandler0=undefined;this._rejectionHandler0=undefined;this._progressHandler0=undefined;this._promise0=undefined;this._receiver0=undefined;this._settledValue=undefined;if(resolver!==INTERNAL)this._resolveFromResolver(resolver);}
Promise.prototype.toString=function(){return"[object Promise]";};Promise.prototype.caught=Promise.prototype["catch"]=function(fn){var len=arguments.length;if(len>1){var catchInstances=new Array(len-1),j=0,i;for(i=0;i<len-1;++i){var item=arguments[i];if(typeof item==="function"){catchInstances[j++]=item;}else{return Promise.reject(new TypeError("Catch filter must inherit from Error or be a simple predicate function\u000a\u000a    See http://goo.gl/o84o68\u000a"));}}
catchInstances.length=j;fn=arguments[i];var catchFilter=new CatchFilter(catchInstances,fn,this);return this._then(undefined,catchFilter.doFilter,undefined,catchFilter,undefined);}
return this._then(undefined,fn,undefined,undefined,undefined);};Promise.prototype.reflect=function(){return this._then(reflect,reflect,undefined,this,undefined);};Promise.prototype.then=function(didFulfill,didReject,didProgress){if(isDebugging()&&arguments.length>0&&typeof didFulfill!=="function"&&typeof didReject!=="function"){var msg=".then() only accepts functions but was passed: "+
util.classString(didFulfill);if(arguments.length>1){msg+=", "+util.classString(didReject);}
this._warn(msg);}
return this._then(didFulfill,didReject,didProgress,undefined,undefined);};Promise.prototype.done=function(didFulfill,didReject,didProgress){var promise=this._then(didFulfill,didReject,didProgress,undefined,undefined);promise._setIsFinal();};Promise.prototype.spread=function(didFulfill,didReject){return this.all()._then(didFulfill,didReject,undefined,APPLY,undefined);};Promise.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable();};Promise.prototype.toJSON=function(){var ret={isFulfilled:false,isRejected:false,fulfillmentValue:undefined,rejectionReason:undefined};if(this.isFulfilled()){ret.fulfillmentValue=this.value();ret.isFulfilled=true;}else if(this.isRejected()){ret.rejectionReason=this.reason();ret.isRejected=true;}
return ret;};Promise.prototype.all=function(){return new PromiseArray(this).promise();};Promise.prototype.error=function(fn){return this.caught(util.originatesFromRejection,fn);};Promise.is=function(val){return val instanceof Promise;};Promise.fromNode=function(fn){var ret=new Promise(INTERNAL);var result=tryCatch(fn)(nodebackForPromise(ret));if(result===errorObj){ret._rejectCallback(result.e,true,true);}
return ret;};Promise.all=function(promises){return new PromiseArray(promises).promise();};Promise.defer=Promise.pending=function(){var promise=new Promise(INTERNAL);return new PromiseResolver(promise);};Promise.cast=function(obj){var ret=tryConvertToPromise(obj);if(!(ret instanceof Promise)){var val=ret;ret=new Promise(INTERNAL);ret._fulfillUnchecked(val);}
return ret;};Promise.resolve=Promise.fulfilled=Promise.cast;Promise.reject=Promise.rejected=function(reason){var ret=new Promise(INTERNAL);ret._captureStackTrace();ret._rejectCallback(reason,true);return ret;};Promise.setScheduler=function(fn){if(typeof fn!=="function")throw new TypeError("fn must be a function\u000a\u000a    See http://goo.gl/916lJJ\u000a");var prev=async._schedule;async._schedule=fn;return prev;};Promise.prototype._then=function(didFulfill,didReject,didProgress,receiver,internalData){var haveInternalData=internalData!==undefined;var ret=haveInternalData?internalData:new Promise(INTERNAL);if(!haveInternalData){ret._propagateFrom(this,4|1);ret._captureStackTrace();}
var target=this._target();if(target!==this){if(receiver===undefined)receiver=this._boundTo;if(!haveInternalData)ret._setIsMigrated();}
var callbackIndex=target._addCallbacks(didFulfill,didReject,didProgress,ret,receiver,getDomain());if(target._isResolved()&&!target._isSettlePromisesQueued()){async.invoke(target._settlePromiseAtPostResolution,target,callbackIndex);}
return ret;};Promise.prototype._settlePromiseAtPostResolution=function(index){if(this._isRejectionUnhandled())this._unsetRejectionIsUnhandled();this._settlePromiseAt(index);};Promise.prototype._length=function(){return this._bitField&131071;};Promise.prototype._isFollowingOrFulfilledOrRejected=function(){return(this._bitField&939524096)>0;};Promise.prototype._isFollowing=function(){return(this._bitField&536870912)===536870912;};Promise.prototype._setLength=function(len){this._bitField=(this._bitField&-131072)|(len&131071);};Promise.prototype._setFulfilled=function(){this._bitField=this._bitField|268435456;};Promise.prototype._setRejected=function(){this._bitField=this._bitField|134217728;};Promise.prototype._setFollowing=function(){this._bitField=this._bitField|536870912;};Promise.prototype._setIsFinal=function(){this._bitField=this._bitField|33554432;};Promise.prototype._isFinal=function(){return(this._bitField&33554432)>0;};Promise.prototype._cancellable=function(){return(this._bitField&67108864)>0;};Promise.prototype._setCancellable=function(){this._bitField=this._bitField|67108864;};Promise.prototype._unsetCancellable=function(){this._bitField=this._bitField&(~67108864);};Promise.prototype._setIsMigrated=function(){this._bitField=this._bitField|4194304;};Promise.prototype._unsetIsMigrated=function(){this._bitField=this._bitField&(~4194304);};Promise.prototype._isMigrated=function(){return(this._bitField&4194304)>0;};Promise.prototype._receiverAt=function(index){var ret=index===0?this._receiver0:this[index*5-5+4];if(ret===undefined&&this._isBound()){return this._boundValue();}
return ret;};Promise.prototype._promiseAt=function(index){return index===0?this._promise0:this[index*5-5+3];};Promise.prototype._fulfillmentHandlerAt=function(index){return index===0?this._fulfillmentHandler0:this[index*5-5+0];};Promise.prototype._rejectionHandlerAt=function(index){return index===0?this._rejectionHandler0:this[index*5-5+1];};Promise.prototype._boundValue=function(){var ret=this._boundTo;if(ret!==undefined){if(ret instanceof Promise){if(ret.isFulfilled()){return ret.value();}else{return undefined;}}}
return ret;};Promise.prototype._migrateCallbacks=function(follower,index){var fulfill=follower._fulfillmentHandlerAt(index);var reject=follower._rejectionHandlerAt(index);var progress=follower._progressHandlerAt(index);var promise=follower._promiseAt(index);var receiver=follower._receiverAt(index);if(promise instanceof Promise)promise._setIsMigrated();this._addCallbacks(fulfill,reject,progress,promise,receiver,null);};Promise.prototype._addCallbacks=function(fulfill,reject,progress,promise,receiver,domain){var index=this._length();if(index>=131071-5){index=0;this._setLength(0);}
if(index===0){this._promise0=promise;if(receiver!==undefined)this._receiver0=receiver;if(typeof fulfill==="function"&&!this._isCarryingStackTrace()){this._fulfillmentHandler0=domain===null?fulfill:domain.bind(fulfill);}
if(typeof reject==="function"){this._rejectionHandler0=domain===null?reject:domain.bind(reject);}
if(typeof progress==="function"){this._progressHandler0=domain===null?progress:domain.bind(progress);}}else{var base=index*5-5;this[base+3]=promise;this[base+4]=receiver;if(typeof fulfill==="function"){this[base+0]=domain===null?fulfill:domain.bind(fulfill);}
if(typeof reject==="function"){this[base+1]=domain===null?reject:domain.bind(reject);}
if(typeof progress==="function"){this[base+2]=domain===null?progress:domain.bind(progress);}}
this._setLength(index+1);return index;};Promise.prototype._setProxyHandlers=function(receiver,promiseSlotValue){var index=this._length();if(index>=131071-5){index=0;this._setLength(0);}
if(index===0){this._promise0=promiseSlotValue;this._receiver0=receiver;}else{var base=index*5-5;this[base+3]=promiseSlotValue;this[base+4]=receiver;}
this._setLength(index+1);};Promise.prototype._proxyPromiseArray=function(promiseArray,index){this._setProxyHandlers(promiseArray,index);};Promise.prototype._resolveCallback=function(value,shouldBind){if(this._isFollowingOrFulfilledOrRejected())return;if(value===this)
return this._rejectCallback(makeSelfResolutionError(),false,true);var maybePromise=tryConvertToPromise(value,this);if(!(maybePromise instanceof Promise))return this._fulfill(value);var propagationFlags=1|(shouldBind?4:0);this._propagateFrom(maybePromise,propagationFlags);var promise=maybePromise._target();if(promise._isPending()){var len=this._length();for(var i=0;i<len;++i){promise._migrateCallbacks(this,i);}
this._setFollowing();this._setLength(0);this._setFollowee(promise);}else if(promise._isFulfilled()){this._fulfillUnchecked(promise._value());}else{this._rejectUnchecked(promise._reason(),promise._getCarriedStackTrace());}};Promise.prototype._rejectCallback=function(reason,synchronous,shouldNotMarkOriginatingFromRejection){if(!shouldNotMarkOriginatingFromRejection){util.markAsOriginatingFromRejection(reason);}
var trace=util.ensureErrorObject(reason);var hasStack=trace===reason;this._attachExtraTrace(trace,synchronous?hasStack:false);this._reject(reason,hasStack?undefined:trace);};Promise.prototype._resolveFromResolver=function(resolver){var promise=this;this._captureStackTrace();this._pushContext();var synchronous=true;var r=tryCatch(resolver)(function(value){if(promise===null)return;promise._resolveCallback(value);promise=null;},function(reason){if(promise===null)return;promise._rejectCallback(reason,synchronous);promise=null;});synchronous=false;this._popContext();if(r!==undefined&&r===errorObj&&promise!==null){promise._rejectCallback(r.e,true,true);promise=null;}};Promise.prototype._settlePromiseFromHandler=function(handler,receiver,value,promise){if(promise._isRejected())return;promise._pushContext();var x;if(receiver===APPLY&&!this._isRejected()){x=tryCatch(handler).apply(this._boundValue(),value);}else{x=tryCatch(handler).call(receiver,value);}
promise._popContext();if(x===errorObj||x===promise||x===NEXT_FILTER){var err=x===promise?makeSelfResolutionError():x.e;promise._rejectCallback(err,false,true);}else{promise._resolveCallback(x);}};Promise.prototype._target=function(){var ret=this;while(ret._isFollowing())ret=ret._followee();return ret;};Promise.prototype._followee=function(){return this._rejectionHandler0;};Promise.prototype._setFollowee=function(promise){this._rejectionHandler0=promise;};Promise.prototype._cleanValues=function(){if(this._cancellable()){this._cancellationParent=undefined;}};Promise.prototype._propagateFrom=function(parent,flags){if((flags&1)>0&&parent._cancellable()){this._setCancellable();this._cancellationParent=parent;}
if((flags&4)>0&&parent._isBound()){this._setBoundTo(parent._boundTo);}};Promise.prototype._fulfill=function(value){if(this._isFollowingOrFulfilledOrRejected())return;this._fulfillUnchecked(value);};Promise.prototype._reject=function(reason,carriedStackTrace){if(this._isFollowingOrFulfilledOrRejected())return;this._rejectUnchecked(reason,carriedStackTrace);};Promise.prototype._settlePromiseAt=function(index){var promise=this._promiseAt(index);var isPromise=promise instanceof Promise;if(isPromise&&promise._isMigrated()){promise._unsetIsMigrated();return async.invoke(this._settlePromiseAt,this,index);}
var handler=this._isFulfilled()?this._fulfillmentHandlerAt(index):this._rejectionHandlerAt(index);var carriedStackTrace=this._isCarryingStackTrace()?this._getCarriedStackTrace():undefined;var value=this._settledValue;var receiver=this._receiverAt(index);this._clearCallbackDataAtIndex(index);if(typeof handler==="function"){if(!isPromise){handler.call(receiver,value,promise);}else{this._settlePromiseFromHandler(handler,receiver,value,promise);}}else if(receiver instanceof PromiseArray){if(!receiver._isResolved()){if(this._isFulfilled()){receiver._promiseFulfilled(value,promise);}
else{receiver._promiseRejected(value,promise);}}}else if(isPromise){if(this._isFulfilled()){promise._fulfill(value);}else{promise._reject(value,carriedStackTrace);}}
if(index>=4&&(index&31)===4)
async.invokeLater(this._setLength,this,0);};Promise.prototype._clearCallbackDataAtIndex=function(index){if(index===0){if(!this._isCarryingStackTrace()){this._fulfillmentHandler0=undefined;}
this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=undefined;}else{var base=index*5-5;this[base+3]=this[base+4]=this[base+0]=this[base+1]=this[base+2]=undefined;}};Promise.prototype._isSettlePromisesQueued=function(){return(this._bitField&-1073741824)===-1073741824;};Promise.prototype._setSettlePromisesQueued=function(){this._bitField=this._bitField|-1073741824;};Promise.prototype._unsetSettlePromisesQueued=function(){this._bitField=this._bitField&(~-1073741824);};Promise.prototype._queueSettlePromises=function(){async.settlePromises(this);this._setSettlePromisesQueued();};Promise.prototype._fulfillUnchecked=function(value){if(value===this){var err=makeSelfResolutionError();this._attachExtraTrace(err);return this._rejectUnchecked(err,undefined);}
this._setFulfilled();this._settledValue=value;this._cleanValues();if(this._length()>0){this._queueSettlePromises();}};Promise.prototype._rejectUncheckedCheckError=function(reason){var trace=util.ensureErrorObject(reason);this._rejectUnchecked(reason,trace===reason?undefined:trace);};Promise.prototype._rejectUnchecked=function(reason,trace){if(reason===this){var err=makeSelfResolutionError();this._attachExtraTrace(err);return this._rejectUnchecked(err);}
this._setRejected();this._settledValue=reason;this._cleanValues();if(this._isFinal()){async.throwLater(function(e){if("stack"in e){async.invokeFirst(CapturedTrace.unhandledRejection,undefined,e);}
throw e;},trace===undefined?reason:trace);return;}
if(trace!==undefined&&trace!==reason){this._setCarriedStackTrace(trace);}
if(this._length()>0){this._queueSettlePromises();}else{this._ensurePossibleRejectionHandled();}};Promise.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();var len=this._length();for(var i=0;i<len;i++){this._settlePromiseAt(i);}};util.notEnumerableProp(Promise,"_makeSelfResolutionError",makeSelfResolutionError);_dereq_("./progress.js")(Promise,PromiseArray);_dereq_("./method.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection);_dereq_("./bind.js")(Promise,INTERNAL,tryConvertToPromise);_dereq_("./finally.js")(Promise,NEXT_FILTER,tryConvertToPromise);_dereq_("./direct_resolve.js")(Promise);_dereq_("./synchronous_inspection.js")(Promise);_dereq_("./join.js")(Promise,PromiseArray,tryConvertToPromise,INTERNAL);Promise.Promise=Promise;_dereq_('./cancel.js')(Promise);_dereq_('./settle.js')(Promise,PromiseArray);_dereq_('./some.js')(Promise,PromiseArray,apiRejection);_dereq_('./any.js')(Promise);util.toFastProperties(Promise);util.toFastProperties(Promise.prototype);function fillTypes(value){var p=new Promise(INTERNAL);p._fulfillmentHandler0=value;p._rejectionHandler0=value;p._progressHandler0=value;p._promise0=value;p._receiver0=value;p._settledValue=value;}
fillTypes({a:1});fillTypes({b:2});fillTypes({c:3});fillTypes(1);fillTypes(function(){});fillTypes(undefined);fillTypes(false);fillTypes(new Promise(INTERNAL));CapturedTrace.setBounds(async.firstLineError,util.lastLineError);return Promise;};},{"./any.js":1,"./async.js":2,"./bind.js":3,"./cancel.js":5,"./captured_trace.js":6,"./catch_filter.js":7,"./context.js":8,"./debuggability.js":9,"./direct_resolve.js":10,"./errors.js":11,"./finally.js":13,"./join.js":14,"./method.js":15,"./progress.js":16,"./promise_array.js":18,"./promise_resolver.js":19,"./settle.js":22,"./some.js":23,"./synchronous_inspection.js":24,"./thenables.js":25,"./util.js":26}],18:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){var util=_dereq_("./util.js");var isArray=util.isArray;function toResolutionValue(val){switch(val){case-2:return[];case-3:return{};}}
function PromiseArray(values){var promise=this._promise=new Promise(INTERNAL);var parent;if(values instanceof Promise){parent=values;promise._propagateFrom(parent,1|4);}
this._values=values;this._length=0;this._totalResolved=0;this._init(undefined,-2);}
PromiseArray.prototype.length=function(){return this._length;};PromiseArray.prototype.promise=function(){return this._promise;};PromiseArray.prototype._init=function init(_,resolveValueIfEmpty){var values=tryConvertToPromise(this._values,this._promise);if(values instanceof Promise){values=values._target();this._values=values;if(values._isFulfilled()){values=values._value();if(!isArray(values)){var err=new Promise.TypeError("expecting an array, a promise or a thenable\u000a\u000a    See http://goo.gl/s8MMhc\u000a");this.__hardReject__(err);return;}}else if(values._isPending()){values._then(init,this._reject,undefined,this,resolveValueIfEmpty);return;}else{this._reject(values._reason());return;}}else if(!isArray(values)){this._promise._reject(apiRejection("expecting an array, a promise or a thenable\u000a\u000a    See http://goo.gl/s8MMhc\u000a")._reason());return;}
if(values.length===0){if(resolveValueIfEmpty===-5){this._resolveEmptyArray();}
else{this._resolve(toResolutionValue(resolveValueIfEmpty));}
return;}
var len=this.getActualLength(values.length);this._length=len;this._values=this.shouldCopyValues()?new Array(len):this._values;var promise=this._promise;for(var i=0;i<len;++i){var isResolved=this._isResolved();var maybePromise=tryConvertToPromise(values[i],promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();if(isResolved){maybePromise._ignoreRejections();}else if(maybePromise._isPending()){maybePromise._proxyPromiseArray(this,i);}else if(maybePromise._isFulfilled()){this._promiseFulfilled(maybePromise._value(),i);}else{this._promiseRejected(maybePromise._reason(),i);}}else if(!isResolved){this._promiseFulfilled(maybePromise,i);}}};PromiseArray.prototype._isResolved=function(){return this._values===null;};PromiseArray.prototype._resolve=function(value){this._values=null;this._promise._fulfill(value);};PromiseArray.prototype.__hardReject__=PromiseArray.prototype._reject=function(reason){this._values=null;this._promise._rejectCallback(reason,false,true);};PromiseArray.prototype._promiseProgressed=function(progressValue,index){this._promise._progress({index:index,value:progressValue});};PromiseArray.prototype._promiseFulfilled=function(value,index){this._values[index]=value;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){this._resolve(this._values);}};PromiseArray.prototype._promiseRejected=function(reason,index){this._totalResolved++;this._reject(reason);};PromiseArray.prototype.shouldCopyValues=function(){return true;};PromiseArray.prototype.getActualLength=function(len){return len;};return PromiseArray;};},{"./util.js":26}],19:[function(_dereq_,module,exports){"use strict";var util=_dereq_("./util.js");var maybeWrapAsError=util.maybeWrapAsError;var errors=_dereq_("./errors.js");var TimeoutError=errors.TimeoutError;var OperationalError=errors.OperationalError;var haveGetters=util.haveGetters;var es5=_dereq_("./es5.js");function isUntypedError(obj){return obj instanceof Error&&es5.getPrototypeOf(obj)===Error.prototype;}
var rErrorKey=/^(?:name|message|stack|cause)$/;function wrapAsOperationalError(obj){var ret;if(isUntypedError(obj)){ret=new OperationalError(obj);ret.name=obj.name;ret.message=obj.message;ret.stack=obj.stack;var keys=es5.keys(obj);for(var i=0;i<keys.length;++i){var key=keys[i];if(!rErrorKey.test(key)){ret[key]=obj[key];}}
return ret;}
util.markAsOriginatingFromRejection(obj);return obj;}
function nodebackForPromise(promise){return function(err,value){if(promise===null)return;if(err){var wrapped=wrapAsOperationalError(maybeWrapAsError(err));promise._attachExtraTrace(wrapped);promise._reject(wrapped);}else if(arguments.length>2){var $_len=arguments.length;var args=new Array($_len-1);for(var $_i=1;$_i<$_len;++$_i){args[$_i-1]=arguments[$_i];}
promise._fulfill(args);}else{promise._fulfill(value);}
promise=null;};}
var PromiseResolver;if(!haveGetters){PromiseResolver=function(promise){this.promise=promise;this.asCallback=nodebackForPromise(promise);this.callback=this.asCallback;};}
else{PromiseResolver=function(promise){this.promise=promise;};}
if(haveGetters){var prop={get:function(){return nodebackForPromise(this.promise);}};es5.defineProperty(PromiseResolver.prototype,"asCallback",prop);es5.defineProperty(PromiseResolver.prototype,"callback",prop);}
PromiseResolver._nodebackForPromise=nodebackForPromise;PromiseResolver.prototype.toString=function(){return"[object PromiseResolver]";};PromiseResolver.prototype.resolve=PromiseResolver.prototype.fulfill=function(value){if(!(this instanceof PromiseResolver)){throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\u000a\u000a    See http://goo.gl/sdkXL9\u000a");}
this.promise._resolveCallback(value);};PromiseResolver.prototype.reject=function(reason){if(!(this instanceof PromiseResolver)){throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\u000a\u000a    See http://goo.gl/sdkXL9\u000a");}
this.promise._rejectCallback(reason);};PromiseResolver.prototype.progress=function(value){if(!(this instanceof PromiseResolver)){throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\u000a\u000a    See http://goo.gl/sdkXL9\u000a");}
this.promise._progress(value);};PromiseResolver.prototype.cancel=function(err){this.promise.cancel(err);};PromiseResolver.prototype.timeout=function(){this.reject(new TimeoutError("timeout"));};PromiseResolver.prototype.isResolved=function(){return this.promise.isResolved();};PromiseResolver.prototype.toJSON=function(){return this.promise.toJSON();};module.exports=PromiseResolver;},{"./errors.js":11,"./es5.js":12,"./util.js":26}],20:[function(_dereq_,module,exports){"use strict";function arrayMove(src,srcIndex,dst,dstIndex,len){for(var j=0;j<len;++j){dst[j+dstIndex]=src[j+srcIndex];src[j+srcIndex]=void 0;}}
function Queue(capacity){this._capacity=capacity;this._length=0;this._front=0;}
Queue.prototype._willBeOverCapacity=function(size){return this._capacity<size;};Queue.prototype._pushOne=function(arg){var length=this.length();this._checkCapacity(length+1);var i=(this._front+length)&(this._capacity-1);this[i]=arg;this._length=length+1;};Queue.prototype._unshiftOne=function(value){var capacity=this._capacity;this._checkCapacity(this.length()+1);var front=this._front;var i=((((front-1)&(capacity-1))^capacity)-capacity);this[i]=value;this._front=i;this._length=this.length()+1;};Queue.prototype.unshift=function(fn,receiver,arg){this._unshiftOne(arg);this._unshiftOne(receiver);this._unshiftOne(fn);};Queue.prototype.push=function(fn,receiver,arg){var length=this.length()+3;if(this._willBeOverCapacity(length)){this._pushOne(fn);this._pushOne(receiver);this._pushOne(arg);return;}
var j=this._front+length-3;this._checkCapacity(length);var wrapMask=this._capacity-1;this[(j+0)&wrapMask]=fn;this[(j+1)&wrapMask]=receiver;this[(j+2)&wrapMask]=arg;this._length=length;};Queue.prototype.shift=function(){var front=this._front,ret=this[front];this[front]=undefined;this._front=(front+1)&(this._capacity-1);this._length--;return ret;};Queue.prototype.length=function(){return this._length;};Queue.prototype._checkCapacity=function(size){if(this._capacity<size){this._resizeTo(this._capacity<<1);}};Queue.prototype._resizeTo=function(capacity){var oldCapacity=this._capacity;this._capacity=capacity;var front=this._front;var length=this._length;var moveItemsCount=(front+length)&(oldCapacity-1);arrayMove(this,0,this,oldCapacity,moveItemsCount);};module.exports=Queue;},{}],21:[function(_dereq_,module,exports){"use strict";var schedule;var util=_dereq_("./util");var noAsyncScheduler=function(){throw new Error("No async scheduler available\u000a\u000a    See http://goo.gl/m3OTXk\u000a");};if(util.isNode&&typeof MutationObserver==="undefined"){var GlobalSetImmediate=global.setImmediate;var ProcessNextTick=process.nextTick;schedule=util.isRecentNode?function(fn){GlobalSetImmediate.call(global,fn);}:function(fn){ProcessNextTick.call(process,fn);};}else if((typeof MutationObserver!=="undefined")&&!(typeof window!=="undefined"&&window.navigator&&window.navigator.standalone)){schedule=function(fn){var div=document.createElement("div");var observer=new MutationObserver(fn);observer.observe(div,{attributes:true});return function(){div.classList.toggle("foo");};};schedule.isStatic=true;}else if(typeof setImmediate!=="undefined"){schedule=function(fn){setImmediate(fn);};}else if(typeof setTimeout!=="undefined"){schedule=function(fn){setTimeout(fn,0);};}else{schedule=noAsyncScheduler;}
module.exports=schedule;},{"./util":26}],22:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray){var PromiseInspection=Promise.PromiseInspection;var util=_dereq_("./util.js");function SettledPromiseArray(values){this.constructor$(values);}
util.inherits(SettledPromiseArray,PromiseArray);SettledPromiseArray.prototype._promiseResolved=function(index,inspection){this._values[index]=inspection;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){this._resolve(this._values);}};SettledPromiseArray.prototype._promiseFulfilled=function(value,index){var ret=new PromiseInspection();ret._bitField=268435456;ret._settledValue=value;this._promiseResolved(index,ret);};SettledPromiseArray.prototype._promiseRejected=function(reason,index){var ret=new PromiseInspection();ret._bitField=134217728;ret._settledValue=reason;this._promiseResolved(index,ret);};Promise.settle=function(promises){return new SettledPromiseArray(promises).promise();};Promise.prototype.settle=function(){return new SettledPromiseArray(this).promise();};};},{"./util.js":26}],23:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection){var util=_dereq_("./util.js");var RangeError=_dereq_("./errors.js").RangeError;var AggregateError=_dereq_("./errors.js").AggregateError;var isArray=util.isArray;function SomePromiseArray(values){this.constructor$(values);this._howMany=0;this._unwrap=false;this._initialized=false;}
util.inherits(SomePromiseArray,PromiseArray);SomePromiseArray.prototype._init=function(){if(!this._initialized){return;}
if(this._howMany===0){this._resolve([]);return;}
this._init$(undefined,-5);var isArrayResolved=isArray(this._values);if(!this._isResolved()&&isArrayResolved&&this._howMany>this._canPossiblyFulfill()){this._reject(this._getRangeError(this.length()));}};SomePromiseArray.prototype.init=function(){this._initialized=true;this._init();};SomePromiseArray.prototype.setUnwrap=function(){this._unwrap=true;};SomePromiseArray.prototype.howMany=function(){return this._howMany;};SomePromiseArray.prototype.setHowMany=function(count){this._howMany=count;};SomePromiseArray.prototype._promiseFulfilled=function(value){this._addFulfilled(value);if(this._fulfilled()===this.howMany()){this._values.length=this.howMany();if(this.howMany()===1&&this._unwrap){this._resolve(this._values[0]);}else{this._resolve(this._values);}}};SomePromiseArray.prototype._promiseRejected=function(reason){this._addRejected(reason);if(this.howMany()>this._canPossiblyFulfill()){var e=new AggregateError();for(var i=this.length();i<this._values.length;++i){e.push(this._values[i]);}
this._reject(e);}};SomePromiseArray.prototype._fulfilled=function(){return this._totalResolved;};SomePromiseArray.prototype._rejected=function(){return this._values.length-this.length();};SomePromiseArray.prototype._addRejected=function(reason){this._values.push(reason);};SomePromiseArray.prototype._addFulfilled=function(value){this._values[this._totalResolved++]=value;};SomePromiseArray.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected();};SomePromiseArray.prototype._getRangeError=function(count){var message="Input array must contain at least "+
this._howMany+" items but contains only "+count+" items";return new RangeError(message);};SomePromiseArray.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0));};function some(promises,howMany){if((howMany|0)!==howMany||howMany<0){return apiRejection("expecting a positive integer\u000a\u000a    See http://goo.gl/1wAmHx\u000a");}
var ret=new SomePromiseArray(promises);var promise=ret.promise();ret.setHowMany(howMany);ret.init();return promise;}
Promise.some=function(promises,howMany){return some(promises,howMany);};Promise.prototype.some=function(howMany){return some(this,howMany);};Promise._SomePromiseArray=SomePromiseArray;};},{"./errors.js":11,"./util.js":26}],24:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function PromiseInspection(promise){if(promise!==undefined){promise=promise._target();this._bitField=promise._bitField;this._settledValue=promise._settledValue;}
else{this._bitField=0;this._settledValue=undefined;}}
PromiseInspection.prototype.value=function(){if(!this.isFulfilled()){throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\u000a\u000a    See http://goo.gl/hc1DLj\u000a");}
return this._settledValue;};PromiseInspection.prototype.error=PromiseInspection.prototype.reason=function(){if(!this.isRejected()){throw new TypeError("cannot get rejection reason of a non-rejected promise\u000a\u000a    See http://goo.gl/hPuiwB\u000a");}
return this._settledValue;};PromiseInspection.prototype.isFulfilled=Promise.prototype._isFulfilled=function(){return(this._bitField&268435456)>0;};PromiseInspection.prototype.isRejected=Promise.prototype._isRejected=function(){return(this._bitField&134217728)>0;};PromiseInspection.prototype.isPending=Promise.prototype._isPending=function(){return(this._bitField&402653184)===0;};PromiseInspection.prototype.isResolved=Promise.prototype._isResolved=function(){return(this._bitField&402653184)>0;};Promise.prototype.isPending=function(){return this._target()._isPending();};Promise.prototype.isRejected=function(){return this._target()._isRejected();};Promise.prototype.isFulfilled=function(){return this._target()._isFulfilled();};Promise.prototype.isResolved=function(){return this._target()._isResolved();};Promise.prototype._value=function(){return this._settledValue;};Promise.prototype._reason=function(){this._unsetRejectionIsUnhandled();return this._settledValue;};Promise.prototype.value=function(){var target=this._target();if(!target.isFulfilled()){throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\u000a\u000a    See http://goo.gl/hc1DLj\u000a");}
return target._settledValue;};Promise.prototype.reason=function(){var target=this._target();if(!target.isRejected()){throw new TypeError("cannot get rejection reason of a non-rejected promise\u000a\u000a    See http://goo.gl/hPuiwB\u000a");}
target._unsetRejectionIsUnhandled();return target._settledValue;};Promise.PromiseInspection=PromiseInspection;};},{}],25:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var util=_dereq_("./util.js");var errorObj=util.errorObj;var isObject=util.isObject;function tryConvertToPromise(obj,context){if(isObject(obj)){if(obj instanceof Promise){return obj;}
else if(isAnyBluebirdPromise(obj)){var ret=new Promise(INTERNAL);obj._then(ret._fulfillUnchecked,ret._rejectUncheckedCheckError,ret._progressUnchecked,ret,null);return ret;}
var then=util.tryCatch(getThen)(obj);if(then===errorObj){if(context)context._pushContext();var ret=Promise.reject(then.e);if(context)context._popContext();return ret;}else if(typeof then==="function"){return doThenable(obj,then,context);}}
return obj;}
function getThen(obj){return obj.then;}
var hasProp={}.hasOwnProperty;function isAnyBluebirdPromise(obj){return hasProp.call(obj,"_promise0");}
function doThenable(x,then,context){var promise=new Promise(INTERNAL);var ret=promise;if(context)context._pushContext();promise._captureStackTrace();if(context)context._popContext();var synchronous=true;var result=util.tryCatch(then).call(x,resolveFromThenable,rejectFromThenable,progressFromThenable);synchronous=false;if(promise&&result===errorObj){promise._rejectCallback(result.e,true,true);promise=null;}
function resolveFromThenable(value){if(!promise)return;promise._resolveCallback(value);promise=null;}
function rejectFromThenable(reason){if(!promise)return;promise._rejectCallback(reason,synchronous,true);promise=null;}
function progressFromThenable(value){if(!promise)return;if(typeof promise._progress==="function"){promise._progress(value);}}
return ret;}
return tryConvertToPromise;};},{"./util.js":26}],26:[function(_dereq_,module,exports){"use strict";var es5=_dereq_("./es5.js");var canEvaluate=typeof navigator=="undefined";var haveGetters=(function(){try{var o={};es5.defineProperty(o,"f",{get:function(){return 3;}});return o.f===3;}
catch(e){return false;}})();var errorObj={e:{}};var tryCatchTarget;function tryCatcher(){try{var target=tryCatchTarget;tryCatchTarget=null;return target.apply(this,arguments);}catch(e){errorObj.e=e;return errorObj;}}
function tryCatch(fn){tryCatchTarget=fn;return tryCatcher;}
var inherits=function(Child,Parent){var hasProp={}.hasOwnProperty;function T(){this.constructor=Child;this.constructor$=Parent;for(var propertyName in Parent.prototype){if(hasProp.call(Parent.prototype,propertyName)&&propertyName.charAt(propertyName.length-1)!=="$"){this[propertyName+"$"]=Parent.prototype[propertyName];}}}
T.prototype=Parent.prototype;Child.prototype=new T();return Child.prototype;};function isPrimitive(val){return val==null||val===true||val===false||typeof val==="string"||typeof val==="number";}
function isObject(value){return!isPrimitive(value);}
function maybeWrapAsError(maybeError){if(!isPrimitive(maybeError))return maybeError;return new Error(safeToString(maybeError));}
function withAppended(target,appendee){var len=target.length;var ret=new Array(len+1);var i;for(i=0;i<len;++i){ret[i]=target[i];}
ret[i]=appendee;return ret;}
function getDataPropertyOrDefault(obj,key,defaultValue){if(es5.isES5){var desc=Object.getOwnPropertyDescriptor(obj,key);if(desc!=null){return desc.get==null&&desc.set==null?desc.value:defaultValue;}}else{return{}.hasOwnProperty.call(obj,key)?obj[key]:undefined;}}
function notEnumerableProp(obj,name,value){if(isPrimitive(obj))return obj;var descriptor={value:value,configurable:true,enumerable:false,writable:true};es5.defineProperty(obj,name,descriptor);return obj;}
function thrower(r){throw r;}
var inheritedDataKeys=(function(){var excludedPrototypes=[Array.prototype,Object.prototype,Function.prototype];var isExcludedProto=function(val){for(var i=0;i<excludedPrototypes.length;++i){if(excludedPrototypes[i]===val){return true;}}
return false;};if(es5.isES5){var getKeys=Object.getOwnPropertyNames;return function(obj){var ret=[];var visitedKeys=Object.create(null);while(obj!=null&&!isExcludedProto(obj)){var keys;try{keys=getKeys(obj);}catch(e){return ret;}
for(var i=0;i<keys.length;++i){var key=keys[i];if(visitedKeys[key])continue;visitedKeys[key]=true;var desc=Object.getOwnPropertyDescriptor(obj,key);if(desc!=null&&desc.get==null&&desc.set==null){ret.push(key);}}
obj=es5.getPrototypeOf(obj);}
return ret;};}else{var hasProp={}.hasOwnProperty;return function(obj){if(isExcludedProto(obj))return[];var ret=[];enumeration:for(var key in obj){if(hasProp.call(obj,key)){ret.push(key);}else{for(var i=0;i<excludedPrototypes.length;++i){if(hasProp.call(excludedPrototypes[i],key)){continue enumeration;}}
ret.push(key);}}
return ret;};}})();var thisAssignmentPattern=/this\s*\.\s*\S+\s*=/;function isClass(fn){try{if(typeof fn==="function"){var keys=es5.names(fn.prototype);var hasMethods=es5.isES5&&keys.length>1;var hasMethodsOtherThanConstructor=keys.length>0&&!(keys.length===1&&keys[0]==="constructor");var hasThisAssignmentAndStaticMethods=thisAssignmentPattern.test(fn+"")&&es5.names(fn).length>0;if(hasMethods||hasMethodsOtherThanConstructor||hasThisAssignmentAndStaticMethods){return true;}}
return false;}catch(e){return false;}}
function toFastProperties(obj){function f(){}
f.prototype=obj;var l=8;while(l--)new f();return obj;eval(obj);}
var rident=/^[a-z$_][a-z$_0-9]*$/i;function isIdentifier(str){return rident.test(str);}
function filledRange(count,prefix,suffix){var ret=new Array(count);for(var i=0;i<count;++i){ret[i]=prefix+i+suffix;}
return ret;}
function safeToString(obj){try{return obj+"";}catch(e){return"[no string representation]";}}
function markAsOriginatingFromRejection(e){try{notEnumerableProp(e,"isOperational",true);}
catch(ignore){}}
function originatesFromRejection(e){if(e==null)return false;return((e instanceof Error["__BluebirdErrorTypes__"].OperationalError)||e["isOperational"]===true);}
function canAttachTrace(obj){return obj instanceof Error&&es5.propertyIsWritable(obj,"stack");}
var ensureErrorObject=(function(){if(!("stack"in new Error())){return function(value){if(canAttachTrace(value))return value;try{throw new Error(safeToString(value));}
catch(err){return err;}};}else{return function(value){if(canAttachTrace(value))return value;return new Error(safeToString(value));};}})();function classString(obj){return{}.toString.call(obj);}
function copyDescriptors(from,to,filter){var keys=es5.names(from);for(var i=0;i<keys.length;++i){var key=keys[i];if(filter(key)){try{es5.defineProperty(to,key,es5.getDescriptor(from,key));}catch(ignore){}}}}
var ret={isClass:isClass,isIdentifier:isIdentifier,inheritedDataKeys:inheritedDataKeys,getDataPropertyOrDefault:getDataPropertyOrDefault,thrower:thrower,isArray:es5.isArray,haveGetters:haveGetters,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,canEvaluate:canEvaluate,errorObj:errorObj,tryCatch:tryCatch,inherits:inherits,withAppended:withAppended,maybeWrapAsError:maybeWrapAsError,toFastProperties:toFastProperties,filledRange:filledRange,toString:safeToString,canAttachTrace:canAttachTrace,ensureErrorObject:ensureErrorObject,originatesFromRejection:originatesFromRejection,markAsOriginatingFromRejection:markAsOriginatingFromRejection,classString:classString,copyDescriptors:copyDescriptors,hasDevTools:typeof chrome!=="undefined"&&chrome&&typeof chrome.loadTimes==="function",isNode:typeof process!=="undefined"&&classString(process).toLowerCase()==="[object process]"};ret.isRecentNode=ret.isNode&&(function(){var version=process.versions.node.split(".").map(Number);return(version[0]===0&&version[1]>10)||(version[0]>0);})();if(ret.isNode)ret.toFastProperties(process);try{throw new Error();}catch(e){ret.lastLineError=e;}
module.exports=ret;},{"./es5.js":12}]},{},[4])(4)});;if(typeof window!=='undefined'&&window!==null){window.P=window.Promise;}else if(typeof self!=='undefined'&&self!==null){self.P=self.Promise;}
(function($){'use strict';function throwEqualError(F,a,b){if((F[a]||F[b])&&(F[a]===F[b])){throw new Error("(Link) '"+a+"' can't match '"+b+"'.'");}}
function isInstance(a){return a instanceof $||($['zepto']&&$['zepto']['isZ'](a));}
var
Formatting=['decimals','mark','thousand','prefix','postfix','encoder','decoder','negative','negativeBefore','to','from'],FormatDefaults=[2,'.','','','',function(a){return a;},function(a){return a;},'-','',function(a){return a;},function(a){return a;}];function Format(options){if(options===undefined){options={};}
if(typeof options!=='object'){throw new Error("(Format) 'format' option must be an object.");}
var settings={};$(Formatting).each(function(i,val){if(options[val]===undefined){settings[val]=FormatDefaults[i];}else if((typeof options[val])===(typeof FormatDefaults[i])){if(val==='decimals'){if(options[val]<0||options[val]>7){throw new Error("(Format) 'format.decimals' option must be between 0 and 7.");}}
settings[val]=options[val];}else{throw new Error("(Format) 'format."+val+"' must be a "+typeof FormatDefaults[i]+".");}});throwEqualError(settings,'mark','thousand');throwEqualError(settings,'prefix','negative');throwEqualError(settings,'prefix','negativeBefore');this.settings=settings;}
Format.prototype.v=function(a){return this.settings[a];};Format.prototype.to=function(number){function reverse(a){return a.split('').reverse().join('');}
number=this.v('encoder')(number);var decimals=this.v('decimals'),negative='',preNegative='',base='',mark='';if(parseFloat(number.toFixed(decimals))===0){number='0';}
if(number<0){negative=this.v('negative');preNegative=this.v('negativeBefore');}
number=Math.abs(number).toFixed(decimals).toString();number=number.split('.');if(this.v('thousand')){base=reverse(number[0]).match(/.{1,3}/g);base=reverse(base.join(reverse(this.v('thousand'))));}else{base=number[0];}
if(this.v('mark')&&number.length>1){mark=this.v('mark')+number[1];}
return this.v('to')(preNegative+
this.v('prefix')+
negative+
base+
mark+
this.v('postfix'));};Format.prototype.from=function(input){function esc(s){return s.replace(/[\-\/\\\^$*+?.()|\[\]{}]/g,'\\$&');}
var isNeg;if(input===null||input===undefined){return false;}
input=this.v('from')(input);input=input.toString();isNeg=input.replace(new RegExp('^'+esc(this.v('negativeBefore'))),'');if(input!==isNeg){input=isNeg;isNeg='-';}else{isNeg='';}
input=input.replace(new RegExp('^'+esc(this.v('prefix'))),'');if(this.v('negative')){isNeg='';input=input.replace(new RegExp('^'+esc(this.v('negative'))),'-');}
input=input.replace(new RegExp(esc(this.v('postfix'))+'$'),'').replace(new RegExp(esc(this.v('thousand')),'g'),'').replace(this.v('mark'),'.');input=this.v('decoder')(parseFloat(isNeg+input));if(isNaN(input)){return false;}
return input;};function Link(entry,update){if(typeof entry!=="object"){$.error("(Link) Initialize with an object.");}
return new Link.prototype.init(entry['target']||function(){},entry['method'],entry['format']||{},update);}
Link.prototype.setTooltip=function(target,method){this.method=method||'html';this.el=$(target.replace('-tooltip-','')||'<div/>')[0];};Link.prototype.setHidden=function(target){this.method='val';this.el=document.createElement('input');this.el.name=target;this.el.type='hidden';};Link.prototype.setField=function(target){function at(a,b,c){return[c?a:b,c?b:a];}
var that=this;this.method='val';this.target=target.on('change',function(e){that.obj.val(at(null,$(e.target).val(),that.N),{'link':that,'set':true});});};Link.prototype.init=function(target,method,format,update){this.formatting=format;this.update=!update;if(typeof target==='string'&&target.indexOf('-tooltip-')===0){this.setTooltip(target,method);return;}
if(typeof target==='string'&&target.indexOf('-')!==0){this.setHidden(target);return;}
if(typeof target==='function'){this.target=false;this.method=target;return;}
if(isInstance(target)){if(!method){if(target.is('input, select, textarea')){this.setField(target);return;}
method='html';}
if(typeof method==='function'||(typeof method==='string'&&target[method])){this.method=method;this.target=target;return;}}
throw new RangeError("(Link) Invalid Link.");};Link.prototype.write=function(value,handle,slider,update){if(this.update&&update===false){return;}
this.actual=value;value=this.format(value);this.saved=value;if(typeof this.method==='function'){this.method.call(this.target[0]||slider[0],value,handle,slider);}else{this.target[this.method](value,handle,slider);}};Link.prototype.setFormatting=function(options){this.formatting=new Format($.extend({},options,this.formatting instanceof Format?this.formatting.settings:this.formatting));};Link.prototype.setObject=function(obj){this.obj=obj;};Link.prototype.setIndex=function(index){this.N=index;};Link.prototype.format=function(a){return this.formatting.to(a);};Link.prototype.getValue=function(a){return this.formatting.from(a);};Link.prototype.init.prototype=Link.prototype;$.Link=Link;}(window['jQuery']||window['Zepto']));(function($){'use strict';var
doc=$(document),$val=$.fn.val,namespace='.nui',actions=window.navigator['pointerEnabled']?{start:'pointerdown',move:'pointermove',end:'pointerup'}:window.navigator['msPointerEnabled']?{start:'MSPointerDown',move:'MSPointerMove',end:'MSPointerUp'}:{start:'mousedown touchstart',move:'mousemove touchmove',end:'mouseup touchend'},Classes=['noUi-target','noUi-base','noUi-origin','noUi-handle','noUi-horizontal','noUi-vertical','noUi-background','noUi-connect','noUi-ltr','noUi-rtl','noUi-dragable','','noUi-state-drag','','noUi-state-tap','noUi-active','noUi-extended','noUi-stacking'];function limit(a){return Math.max(Math.min(a,100),0);}
function closest(value,to){return Math.round(value/to)*to;}
function subRangeRatio(pa,pb){return(100/(pb-pa));}
function isNumeric(a){return typeof a==='number'&&!isNaN(a)&&isFinite(a);}
function asArray(a){return $.isArray(a)?a:[a];}
function addClassFor(element,className,duration){element.addClass(className);setTimeout(function(){element.removeClass(className);},duration);}
function fromPercentage(range,value){return(value*100)/(range[1]-range[0]);}
function toPercentage(range,value){return fromPercentage(range,range[0]<0?value+Math.abs(range[0]):value-range[0]);}
function isPercentage(range,value){return((value*(range[1]-range[0]))/100)+range[0];}
function toStepping(options,value){if(value>=options.xVal.slice(-1)[0]){return 100;}
var j=1,va,vb,pa,pb;while(value>=options.xVal[j]){j++;}
va=options.xVal[j-1];vb=options.xVal[j];pa=options.xPct[j-1];pb=options.xPct[j];return pa+(toPercentage([va,vb],value)/subRangeRatio(pa,pb));}
function fromStepping(options,value){if(value>=100){return options.xVal.slice(-1)[0];}
var j=1,va,vb,pa,pb;while(value>=options.xPct[j]){j++;}
va=options.xVal[j-1];vb=options.xVal[j];pa=options.xPct[j-1];pb=options.xPct[j];return isPercentage([va,vb],(value-pa)*subRangeRatio(pa,pb));}
function getStep(options,value){var j=1,a,b;while((options.dir?(100-value):value)>=options.xPct[j]){j++;}
if(options.snap){a=options.xPct[j-1];b=options.xPct[j];if((value-a)>((b-a)/2)){return b;}
return a;}
if(!options.xSteps[j-1]){return value;}
return options.xPct[j-1]+closest(value-options.xPct[j-1],options.xSteps[j-1]);}
function fixEvent(e){e.preventDefault();var touch=e.type.indexOf('touch')===0,mouse=e.type.indexOf('mouse')===0,pointer=e.type.indexOf('pointer')===0,x,y,event=e;if(e.type.indexOf('MSPointer')===0){pointer=true;}
if(e.originalEvent){e=e.originalEvent;}
if(touch){x=e.changedTouches[0].pageX;y=e.changedTouches[0].pageY;}
if(mouse||pointer){if(!pointer&&window.pageXOffset===undefined){window.pageXOffset=document.documentElement.scrollLeft;window.pageYOffset=document.documentElement.scrollTop;}
x=e.clientX+window.pageXOffset;y=e.clientY+window.pageYOffset;}
event.points=[x,y];event.cursor=mouse;return event;}
function testStep(parsed,entry){if(!isNumeric(entry)){throw new Error("noUiSlider: 'step' is not numeric.");}
parsed.xSteps[0]=entry;}
function testRange(parsed,entry){if(typeof entry!=='object'||$.isArray(entry)){throw new Error("noUiSlider: 'range' is not an object.");}
if(entry['min']===undefined||entry['max']===undefined){throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");}
$.each(entry,function(index,value){var percentage;if(typeof value==="number"){value=[value];}
if(!$.isArray(value)){throw new Error("noUiSlider: 'range' contains invalid value.");}
if(index==='min'){percentage=0;}else if(index==='max'){percentage=100;}else{percentage=parseFloat(index);}
if(!isNumeric(percentage)||!isNumeric(value[0])){throw new Error("noUiSlider: 'range' value isn't numeric.");}
parsed.xPct.push(percentage);parsed.xVal.push(value[0]);if(!percentage){if(!isNaN(value[1])){parsed.xSteps[0]=value[1];}}else{parsed.xSteps.push(isNaN(value[1])?false:value[1]);}});$.each(parsed.xSteps,function(i,n){if(!n){return true;}
parsed.xSteps[i]=fromPercentage([parsed.xVal[i],parsed.xVal[i+1]],n)/subRangeRatio(parsed.xPct[i],parsed.xPct[i+1]);});}
function testStart(parsed,entry){if(typeof entry==="number"){entry=[entry];}
if(!$.isArray(entry)||!entry.length||entry.length>2){throw new Error("noUiSlider: 'start' option is incorrect.");}
parsed.handles=entry.length;parsed.start=entry;}
function testSnap(parsed,entry){parsed.snap=entry;if(typeof entry!=='boolean'){throw new Error("noUiSlider: 'snap' option must be a boolean.");}}
function testConnect(parsed,entry){if(entry==='lower'&&parsed.handles===1){parsed.connect=1;}else if(entry==='upper'&&parsed.handles===1){parsed.connect=2;}else if(entry===true&&parsed.handles===2){parsed.connect=3;}else if(entry===false){parsed.connect=0;}else{throw new Error("noUiSlider: 'connect' option doesn't match handle count.");}}
function testOrientation(parsed,entry){switch(entry){case'horizontal':parsed.ort=0;break;case'vertical':parsed.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.");}}
function testMargin(parsed,entry){if(parsed.xPct.length>2){throw new Error("noUiSlider: 'margin' option is only supported on linear sliders.");}
parsed.margin=fromPercentage(parsed.xVal,entry);if(!isNumeric(entry)){throw new Error("noUiSlider: 'margin' option must be numeric.");}}
function testDirection(parsed,entry){switch(entry){case'ltr':parsed.dir=0;break;case'rtl':parsed.dir=1;parsed.connect=[0,2,1,3][parsed.connect];break;default:throw new Error("noUiSlider: 'direction' option was not recognized.");}}
function testBehaviour(parsed,entry){if(typeof entry!=='string'){throw new Error("noUiSlider: 'behaviour' must be a string containing options.");}
var tap=entry.indexOf('tap')>=0,extend=entry.indexOf('extend')>=0,drag=entry.indexOf('drag')>=0,fixed=entry.indexOf('fixed')>=0,snap=entry.indexOf('snap')>=0;parsed.events={tap:tap||snap,extend:extend,drag:drag,fixed:fixed,snap:snap};}
function testSerialization(parsed,entry,sliders){parsed.ser=[entry['lower'],entry['upper']];parsed.formatting=entry['format'];$.each(parsed.ser,function(index,linkInstances){if(!$.isArray(linkInstances)){throw new Error("noUiSlider: 'serialization."+(!index?'lower':'upper')+"' must be an array.");}
$.each(linkInstances,function(){if(!(this instanceof $.Link)){throw new Error("noUiSlider: 'serialization."+(!index?'lower':'upper')+"' can only contain Link instances.");}
this.setIndex(index);this.setObject(sliders);this.setFormatting(entry['format']);});});if(parsed.dir&&parsed.handles>1){parsed.ser.reverse();}}
function test(options,sliders){var parsed={xPct:[],xVal:[],xSteps:[false],margin:0},tests;tests={'step':{r:false,t:testStep},'start':{r:true,t:testStart},'connect':{r:true,t:testConnect},'direction':{r:true,t:testDirection},'range':{r:true,t:testRange},'snap':{r:false,t:testSnap},'orientation':{r:false,t:testOrientation},'margin':{r:false,t:testMargin},'behaviour':{r:true,t:testBehaviour},'serialization':{r:true,t:testSerialization}};options=$.extend({'connect':false,'direction':'ltr','behaviour':'tap','orientation':'horizontal'},options);options['serialization']=$.extend({'lower':[],'upper':[],'format':{}},options['serialization']);$.each(tests,function(name,test){if(options[name]===undefined){if(test.r){throw new Error("noUiSlider: '"+name+"' is required.");}
return true;}
test.t(parsed,options[name],sliders);});parsed.style=parsed.ort?'top':'left';return parsed;}
function addHandle(options,index){var handle=$('<div><div/></div>').addClass(Classes[2]),additions=['-lower','-upper'];if(options.dir){additions.reverse();}
handle.children().addClass(Classes[3]+" "+Classes[3]+additions[index]);return handle;}
function addElement(handle,link){if(link.el){link=new $.Link({'target':$(link.el).clone().appendTo(handle),'method':link.method,'format':link.formatting},true);}
return link;}
function addElements(elements,handle,formatting){var index,list=[],standard=new $.Link({},true);standard.setFormatting(formatting);list.push(standard);for(index=0;index<elements.length;index++){list.push(addElement(handle,elements[index]));}
return list;}
function addLinks(options,handles){var index,links=[];for(index=0;index<options.handles;index++){links[index]=addElements(options.ser[index],handles[index].children(),options.formatting);}
return links;}
function addConnection(connect,target,handles){switch(connect){case 1:target.addClass(Classes[7]);handles[0].addClass(Classes[6]);break;case 3:handles[1].addClass(Classes[6]);case 2:handles[0].addClass(Classes[7]);case 0:target.addClass(Classes[6]);break;}}
function addHandles(options,base){var index,handles=[];for(index=0;index<options.handles;index++){handles.push(addHandle(options,index).appendTo(base));}
return handles;}
function addSlider(options,target){target.addClass([Classes[0],Classes[8+options.dir],Classes[4+options.ort]].join(' '));return $('<div/>').appendTo(target).addClass(Classes[1]);}
function closure(target,options,originalOptions){var $Target=$(target),$Locations=[-1,-1],$Base,$Serialization,$Handles;function baseSize(){return $Base[['width','height'][options.ort]]();}
function fireEvents(events){var index,values=[$Target.val()];for(index=0;index<events.length;index++){$Target.trigger(events[index],values);}}
function setHandle(handle,to,delimit){var n=handle[0]!==$Handles[0][0]?1:0,lower=$Locations[0]+options.margin,upper=$Locations[1]-options.margin;if(delimit&&$Handles.length>1){to=n?Math.max(to,lower):Math.min(to,upper);}
if(to<100){to=getStep(options,to);}
to=limit(parseFloat(to.toFixed(7)));if(to===$Locations[n]){if($Handles.length===1){return false;}
return(to===lower||to===upper)?0:false;}
handle.css(options.style,to+'%');if(handle.is(':first-child')){handle.toggleClass(Classes[17],to>50);}
$Locations[n]=to;if(options.dir){to=100-to;}
$($Serialization[n]).each(function(){this.write(fromStepping(options,to),handle.children(),$Target);});return true;}
function getPositions(a,b,delimit){var c=a+b[0],d=a+b[1];if(delimit){if(c<0){d+=Math.abs(c);}
if(d>100){c-=(d-100);}
return[limit(c),limit(d)];}
return[c,d];}
function jump(handle,to,instant){if(!instant){addClassFor($Target,Classes[14],300);}
setHandle(handle,to,false);fireEvents(['slide','set','change']);}
function attach(events,element,callback,data){events=events.replace(/\s/g,namespace+' ')+namespace;return element.on(events,function(e){var disabled=$Target.attr('disabled');disabled=!(disabled===undefined||disabled===null);if($Target.hasClass(Classes[14])||disabled){return false;}
e=fixEvent(e);e.calcPoint=e.points[options.ort];callback(e,data);});}
function move(event,data){var handles=data.handles||$Handles,positions,state=false,proposal=((event.calcPoint-data.start)*100)/baseSize(),h=handles[0][0]!==$Handles[0][0]?1:0;positions=getPositions(proposal,data.positions,handles.length>1);state=setHandle(handles[0],positions[h],handles.length===1);if(handles.length>1){state=setHandle(handles[1],positions[h?0:1],false)||state;}
if(state){fireEvents(['slide']);}}
function end(event){$('.'+Classes[15]).removeClass(Classes[15]);if(event.cursor){$('body').css('cursor','').off(namespace);}
doc.off(namespace);$Target.removeClass(Classes[12]);fireEvents(['set','change']);}
function start(event,data){if(data.handles.length===1){data.handles[0].children().addClass(Classes[15]);}
event.stopPropagation();attach(actions.move,doc,move,{start:event.calcPoint,handles:data.handles,positions:[$Locations[0],$Locations[$Handles.length-1]]});attach(actions.end,doc,end,null);if(event.cursor){$('body').css('cursor',$(event.target).css('cursor'));if($Handles.length>1){$Target.addClass(Classes[12]);}
$('body').on('selectstart'+namespace,false);}}
function tap(event){var location=event.calcPoint,total=0,to;event.stopPropagation();$.each($Handles,function(){total+=this.offset()[options.style];});total=(location<total/2||$Handles.length===1)?0:1;location-=$Base.offset()[options.style];to=(location*100)/baseSize();jump($Handles[total],to,options.events.snap);if(options.events.snap){start(event,{handles:[$Handles[total]]});}}
function edge(event){var i=event.calcPoint<$Base.offset()[options.style],to=i?0:100;i=i?0:$Handles.length-1;jump($Handles[i],to,false);}
function events(behaviour){var i,drag;if(!behaviour.fixed){for(i=0;i<$Handles.length;i++){attach(actions.start,$Handles[i].children(),start,{handles:[$Handles[i]]});}}
if(behaviour.tap){attach(actions.start,$Base,tap,{handles:$Handles});}
if(behaviour.extend){$Target.addClass(Classes[16]);if(behaviour.tap){attach(actions.start,$Target,edge,{handles:$Handles});}}
if(behaviour.drag){drag=$Base.find('.'+Classes[7]).addClass(Classes[10]);if(behaviour.fixed){drag=drag.add($Base.children().not(drag).children());}
attach(actions.start,drag,start,{handles:$Handles});}}
if($Target.hasClass(Classes[0])){throw new Error('Slider was already initialized.');}
$Base=addSlider(options,$Target);$Handles=addHandles(options,$Base);$Serialization=addLinks(options,$Handles);addConnection(options.connect,$Target,$Handles);events(options.events);target.vSet=function(){var args=Array.prototype.slice.call(arguments,0),callback,link,update,animate,i,count,actual,to,values=asArray(args[0]);if(typeof args[1]==='object'){callback=args[1]['set'];link=args[1]['link'];update=args[1]['update'];animate=args[1]['animate'];}else if(args[1]===true){callback=true;}
if(options.dir&&options.handles>1){values.reverse();}
if(animate){addClassFor($Target,Classes[14],300);}
count=$Handles.length>1?3:1;if(values.length===1){count=1;}
for(i=0;i<count;i++){to=link||$Serialization[i%2][0];to=to.getValue(values[i%2]);if(to===false){continue;}
to=toStepping(options,to);if(options.dir){to=100-to;}
if(setHandle($Handles[i%2],to,true)===true){continue;}
$($Serialization[i%2]).each(function(index){if(!index){actual=this.actual;return true;}
this.write(actual,$Handles[i%2].children(),$Target,update);});}
if(callback===true){fireEvents(['set']);}
return this;};target.vGet=function(){var i,retour=[];for(i=0;i<options.handles;i++){retour[i]=$Serialization[i][0].saved;}
if(retour.length===1){return retour[0];}
if(options.dir){return retour.reverse();}
return retour;};target.destroy=function(){$.each($Serialization,function(){$.each(this,function(){if(this.target){this.target.off(namespace);}});});$(this).off(namespace).removeClass(Classes.join(' ')).empty();return originalOptions;};$Target.val(options.start);}
function initialize(originalOptions){if(!this.length){throw new Error("noUiSlider: Can't initialize slider on empty selection.");}
var options=test(originalOptions,this);return this.each(function(){closure(this,options,originalOptions);});}
function rebuild(options){return this.each(function(){var values=$(this).val(),originalOptions=this.destroy(),newOptions=$.extend({},originalOptions,options);$(this).noUiSlider(newOptions);if(originalOptions.start===newOptions.start){$(this).val(values);}});}
function value(){return this[0][!arguments.length?'vGet':'vSet'].apply(this[0],arguments);}
$.fn.val=function(){function valMethod(a){return a.hasClass(Classes[0])?value:$val;}
var args=arguments,first=$(this[0]);if(!arguments.length){return valMethod(first).call(first);}
return this.each(function(){valMethod($(this)).apply($(this),args);});};$.noUiSlider={'Link':$.Link};$.fn.noUiSlider=function(options,re){return(re?rebuild:initialize).call(this,options);};}(window['jQuery']||window['Zepto']));(function(jQuery){jQuery.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":"\"",",":"<",".":">","/":"?","\\":"|"},textAcceptingInputTypes:["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color","tel"],textInputTypes:/textarea|input|select/i,options:{filterInputAcceptingElements:true,filterTextInputs:true,filterContentEditable:true}};function keyHandler(handleObj){if(typeof handleObj.data==="string"){handleObj.data={keys:handleObj.data};}
if(!handleObj.data||!handleObj.data.keys||typeof handleObj.data.keys!=="string"){return;}
var origHandler=handleObj.handler,keys=handleObj.data.keys.toLowerCase().split(" ");handleObj.handler=function(event){if(this!==event.target&&(jQuery.hotkeys.options.filterInputAcceptingElements&&jQuery.hotkeys.textInputTypes.test(event.target.nodeName)||(jQuery.hotkeys.options.filterContentEditable&&jQuery(event.target).attr('contenteditable'))||(jQuery.hotkeys.options.filterTextInputs&&jQuery.inArray(event.target.type,jQuery.hotkeys.textAcceptingInputTypes)>-1))){return;}
var special=event.type!=="keypress"&&jQuery.hotkeys.specialKeys[event.which],character=String.fromCharCode(event.which).toLowerCase(),modif="",possible={};jQuery.each(["alt","ctrl","shift"],function(index,specialKey){if(event[specialKey+'Key']&&special!==specialKey){modif+=specialKey+'+';}});if(event.metaKey&&!event.ctrlKey&&special!=="meta"){modif+="meta+";}
if(event.metaKey&&special!=="meta"&&modif.indexOf("alt+ctrl+shift+")>-1){modif=modif.replace("alt+ctrl+shift+","hyper+");}
if(special){possible[modif+special]=true;}
else{possible[modif+character]=true;possible[modif+jQuery.hotkeys.shiftNums[character]]=true;if(modif==="shift+"){possible[jQuery.hotkeys.shiftNums[character]]=true;}}
for(var i=0,l=keys.length;i<l;i++){if(possible[keys[i]]){return origHandler.apply(this,arguments);}}};}
jQuery.each(["keydown","keyup","keypress"],function(){jQuery.event.special[this]={add:keyHandler};});})(jQuery||this.jQuery||window.jQuery);window.Resin=window.Resin||{};Resin=(function(){'use strict';var TARGET_BOUNDARY_ELEMENTS=['A','BUTTON','OPTION','INPUT','SELECT','TEXTAREA'],ACTION_WHITE_LIST='keypress|click|change|drop|programmatic|doubleclick|rightclick|hover',MAX_TARGET_BOUNDARY_DISTANCE=3,ENTER_KEY=13,SPACE_KEY=32,ALPHANUM_REGEX=/^[a-zA-Z0-9|]+$/i,RESIN_ACTION_ATTRIBUTES=['data-resin-target','data-resin-component','data-resin-page','data-resin-application','data-resin-client'],DEFAULT_EVENTS={click:'click',keypress:'keypress',change:'change'};var active=false,previousAction,previousWaypoint,startTime,sessionId,handler,subscribedEvents={};function fire(type,data){handler.call(this,{type:type,data:data});}
function extend(obj1,obj2){for(var i in obj2){if(obj2.hasOwnProperty(i)&&!obj1[i]){obj1[i]=obj2[i];}}
return obj1;}
function generateId(){var time=Date.now();return'xxxxxxxxxxxxxxxxxxxxxx'.replace(/x/g,function(){var rand=Math.floor((time+Math.random()*16)%16);return rand.toString(16);});}
function getActionTargetElement(element){var selectorDistance=0,i,targetBoundaryArrLen=TARGET_BOUNDARY_ELEMENTS.length;while(element&&!element.disabled){if(MAX_TARGET_BOUNDARY_DISTANCE<selectorDistance){break;}
for(i=0;i<targetBoundaryArrLen;i++){if(element.nodeName===TARGET_BOUNDARY_ELEMENTS[i]){return element;}}
element=element.parentElement;selectorDistance++;}
return null;}
function createActionLog(actionAttributes,isWaypoint){var elapsedTime=Date.now()-startTime;var previousLog=isWaypoint?previousWaypoint:previousAction;return extend(actionAttributes,{path:window.location.pathname,session:sessionId,id:generateId(),isWaypoint:isWaypoint,elapsedTime:elapsedTime,prevId:previousLog?previousLog.id:null,prevAction:previousLog?previousLog.action:null,prevTarget:previousLog?previousLog.target:null,prevComponent:previousLog?previousLog.component:null,prevFeature:previousLog?previousLog.feature:null});}
function isDuplicateAction(action){return previousAction&&action.component===previousAction.component&&action.target===previousAction.target&&action.elapsedTime<500;}
function isValidAction(actionType,event){var targetEl=event.target;if(actionType==='keypress'&&(event.which===ENTER_KEY||event.which===SPACE_KEY)){if(targetEl.nodeName==='TEXTAREA'){return false;}else if(event.which===SPACE_KEY&&targetEl.nodeName==='INPUT'){return false;}
return true;}else if(actionType==='change'&&targetEl.options&&typeof targetEl.selectedIndex!=='undefined'){return true;}else if(actionType==='change'&&typeof targetEl.checked==='boolean'){return true;}else if(actionType!=='change'&&actionType!=='keypress'){return true;}
return false;}
function getCleanAttributeKey(attributeName){return attributeName.split('-').slice(2).join('-').replace(/-([a-z0-9])/g,function(match){return match[1].toUpperCase();});}
function isResinAttribute(attribute){return attribute.name.indexOf('data-resin-')===0;}
function sortAttributesBySpecificity(attributes){attributes.sort(function sortBySpecificity(attribute1,attribute2){var attribute1Index=RESIN_ACTION_ATTRIBUTES.indexOf(attribute1.name);var attribute2Index=RESIN_ACTION_ATTRIBUTES.indexOf(attribute2.name);return attribute1Index-attribute2Index;});return attributes;}
function getResinAttributesSortedBySpecificity(element){var attributes=element.attributes,attributesCount=attributes.length,resinAttributes=[];for(var i=0;i<attributesCount;i++){var attribute=attributes[i];if(isResinAttribute(attribute)){resinAttributes.push(attribute);}}
return sortAttributesBySpecificity(resinAttributes);}
function getActionAttributes(actionTargetEl){var currentEl=actionTargetEl,attributes,actionAttributes={target:null,feature:null,component:null,page:null,application:null,client:null,isWaypoint:false,data:{}},foundAttributeIndex=-1;while(currentEl&&actionAttributes.client===null){attributes=getResinAttributesSortedBySpecificity(currentEl);for(var i=0;i<attributes.length;i++){var attribute=attributes[i];var attributeKey=getCleanAttributeKey(attribute.name);var indexInAttributeArray=RESIN_ACTION_ATTRIBUTES.indexOf(attribute.name);if(indexInAttributeArray-1===foundAttributeIndex){foundAttributeIndex++;actionAttributes[attributeKey]=attribute.value;}else if(indexInAttributeArray>=0){}else if(attribute.name==='data-resin-waypoint'){actionAttributes.isWaypoint=attribute.value==='true';}else if(attribute.name==='data-resin-feature'){actionAttributes.feature=attribute.value;}else if(!actionAttributes.data[attributeKey]){actionAttributes.data[attributeKey]=attribute.value;}}
currentEl=currentEl.parentElement;}
return actionAttributes;}
function isValidActionAttributes(actionAttributes){if(!actionAttributes.target){return false;}else if(actionAttributes.feature&&!actionAttributes.feature.match(ALPHANUM_REGEX)){console.warn('Resin: Feature must be an alphanum');return false;}else if(!actionAttributes.component){console.warn('Resin: Component not found');return false;}else if(!actionAttributes.component.match(ALPHANUM_REGEX)){console.warn('Resin: Component must be an alphanum');return false;}else if(!actionAttributes.page){console.warn('Resin: Page not found');return false;}else if(!actionAttributes.page.match(ALPHANUM_REGEX)){console.warn('Resin: Page must be an alphanum');return false;}else if(!actionAttributes.application){console.warn('Resin: Application not found');return false;}else if(!actionAttributes.application.match(ALPHANUM_REGEX)){console.warn('Resin: Application must be an alphanum');return false;}else if(!actionAttributes.client){console.warn('Resin: Client not found');return false;}else if(!actionAttributes.client.match(ALPHANUM_REGEX)){console.warn('Resin: Client must be an alphanum');return false;}
return true;}
function onActionHandler(actionType){return function(event){var targetEl=event.target,actionTargetEl,action,actionAttributes,isWaypoint,waypoint,waypointAttributes;if(!isValidAction(actionType,event)){return;}
if(actionType==='change'&&targetEl.options){actionTargetEl=targetEl.options[targetEl.selectedIndex];}else{actionTargetEl=getActionTargetElement(targetEl);}
if(actionTargetEl){actionAttributes=getActionAttributes(actionTargetEl);if(!actionAttributes||!isValidActionAttributes(actionAttributes)){return;}
actionAttributes.action=actionType;isWaypoint=actionAttributes.isWaypoint;waypointAttributes=extend({},actionAttributes);actionAttributes.isWaypoint=false;action=createActionLog(actionAttributes,false);if(isDuplicateAction(action)||action.elapsedTime<200){return;}
if(isWaypoint){waypoint=createActionLog(waypointAttributes,true);previousWaypoint=waypoint;fire('useraction',waypoint);}
fire('useraction',action);previousAction=action;startTime=Date.now();}};}
function canUseSessionStorage(){try{sessionStorage.setItem('testKey','testValue');sessionStorage.removeItem('testKey');return true;}catch(e){return false;}}
function initSesssion(){if(!canUseSessionStorage()){return;}
var lastActionTime=sessionStorage.getItem('resin-last-action-time');sessionId=sessionStorage.getItem('resin-session-id');if(!sessionId||!lastActionTime||Date.now()-lastActionTime>1800000){sessionId=generateId();sessionStorage.setItem('resin-session-id',sessionId);sessionStorage.setItem('resin-last-action-time',startTime);}}
function subscribeToEvents(events){var _handler;for(var property in events){if(events.hasOwnProperty(property)){_handler=onActionHandler(property);document.addEventListener(events[property],_handler);subscribedEvents[property]=_handler;}}}
function unsubscribeFromEvents(){for(var eventType in subscribedEvents){if(subscribedEvents.hasOwnProperty(eventType)){document.removeEventListener(eventType,subscribedEvents[eventType]);}}}
return{start:function(cb,params){var events=params&&params.events?extend(params.events,DEFAULT_EVENTS):DEFAULT_EVENTS;if(!active){startTime=Date.now();initSesssion();subscribeToEvents(events);handler=cb;active=true;}else{throw new Error('Resin is already started');}},stop:function(){previousAction=null;startTime=null;sessionId=null;handler=null;active=false;unsubscribeFromEvents();},recordAction:function(actionAttributes){var isWhiteListedAction=ACTION_WHITE_LIST.indexOf(actionAttributes.action)!==-1,actionLog;if(active&&isWhiteListedAction){actionLog=createActionLog(actionAttributes);fire('useraction',actionLog);previousAction=actionLog;startTime=Date.now();}else{console.warn('Action '+actionAttributes.action+' is not whitelisted');}},getActionAttributes:getActionAttributes};}());(function(window,undefined){"use strict";var
History=window.History=window.History||{},jQuery=window.jQuery;if(typeof History.Adapter!=='undefined'){throw new Error('History.js Adapter has already been loaded...');}
History.Adapter={bind:function(el,event,callback){jQuery(el).bind(event,callback);},trigger:function(el,event,extra){jQuery(el).trigger(event,extra);},extractEventData:function(key,event,extra){var result=(event&&event.originalEvent&&event.originalEvent[key])||(extra&&extra[key])||undefined;return result;},onDomLoad:function(callback){jQuery(callback);}};if(typeof History.init!=='undefined'){History.init();}})(window);(function(window,undefined){"use strict";var
console=window.console||undefined,document=window.document,navigator=window.navigator,sessionStorage=window.sessionStorage||false,setTimeout=window.setTimeout,clearTimeout=window.clearTimeout,setInterval=window.setInterval,clearInterval=window.clearInterval,JSON=window.JSON,alert=window.alert,History=window.History=window.History||{},history=window.history;JSON.stringify=JSON.stringify||JSON.encode;JSON.parse=JSON.parse||JSON.decode;if(typeof History.init!=='undefined'){throw new Error('History.js Core has already been loaded...');}
History.init=function(){if(typeof History.Adapter==='undefined'){return false;}
if(typeof History.initCore!=='undefined'){History.initCore();}
if(typeof History.initHtml4!=='undefined'){History.initHtml4();}
return true;};History.initCore=function(){if(typeof History.initCore.initialized!=='undefined'){return false;}
else{History.initCore.initialized=true;}
History.options=History.options||{};History.options.hashChangeInterval=History.options.hashChangeInterval||100;History.options.safariPollInterval=History.options.safariPollInterval||500;History.options.doubleCheckInterval=History.options.doubleCheckInterval||500;History.options.storeInterval=History.options.storeInterval||1000;History.options.busyDelay=History.options.busyDelay||250;History.options.debug=History.options.debug||false;History.options.initialTitle=History.options.initialTitle||document.title;History.intervalList=[];History.clearAllIntervals=function(){var i,il=History.intervalList;if(typeof il!=="undefined"&&il!==null){for(i=0;i<il.length;i++){clearInterval(il[i]);}
History.intervalList=null;}};History.debug=function(){if((History.options.debug||false)){History.log.apply(History,arguments);}};History.log=function(){var
consoleExists=!(typeof console==='undefined'||typeof console.log==='undefined'||typeof console.log.apply==='undefined'),textarea=document.getElementById('logger'),message,i,n,args,arg;if(consoleExists){args=Array.prototype.slice.call(arguments);message=args.shift();if(typeof console.debug!=='undefined'){console.debug.apply(console,[message,args]);}
else{console.log.apply(console,[message,args]);}}
else{message=("\n"+arguments[0]+"\n");}
for(i=1,n=arguments.length;i<n;++i){arg=arguments[i];if(typeof arg==='object'&&typeof JSON!=='undefined'){try{arg=JSON.stringify(arg);}
catch(Exception){}}
message+="\n"+arg+"\n";}
if(textarea){textarea.value+=message+"\n-----\n";textarea.scrollTop=textarea.scrollHeight-textarea.clientHeight;}
else if(!consoleExists){alert(message);}
return true;};History.getInternetExplorerMajorVersion=function(){var result=History.getInternetExplorerMajorVersion.cached=(typeof History.getInternetExplorerMajorVersion.cached!=='undefined')?History.getInternetExplorerMajorVersion.cached:(function(){var v=3,div=document.createElement('div'),all=div.getElementsByTagName('i');while((div.innerHTML='<!--[if gt IE '+(++v)+']><i></i><![endif]-->')&&all[0]){}
return(v>4)?v:false;})();return result;};History.isInternetExplorer=function(){var result=History.isInternetExplorer.cached=(typeof History.isInternetExplorer.cached!=='undefined')?History.isInternetExplorer.cached:Boolean(History.getInternetExplorerMajorVersion());return result;};History.emulated={pushState:!Boolean(window.history&&window.history.pushState&&window.history.replaceState&&!((/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i).test(navigator.userAgent)||(/AppleWebKit\/5([0-2]|3[0-2])/i).test(navigator.userAgent))),hashChange:Boolean(!(('onhashchange'in window)||('onhashchange'in document))||(History.isInternetExplorer()&&History.getInternetExplorerMajorVersion()<8))};History.enabled=!History.emulated.pushState;History.bugs={setHash:Boolean(!History.emulated.pushState&&navigator.vendor==='Apple Computer, Inc.'&&/AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),safariPoll:Boolean(!History.emulated.pushState&&navigator.vendor==='Apple Computer, Inc.'&&/AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),ieDoubleCheck:Boolean(History.isInternetExplorer()&&History.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(History.isInternetExplorer()&&History.getInternetExplorerMajorVersion()<7)};History.isEmptyObject=function(obj){for(var name in obj){return false;}
return true;};History.cloneObject=function(obj){var hash,newObj;if(obj){hash=JSON.stringify(obj);newObj=JSON.parse(hash);}
else{newObj={};}
return newObj;};History.getRootUrl=function(){var rootUrl=document.location.protocol+'//'+(document.location.hostname||document.location.host);if(document.location.port||false){rootUrl+=':'+document.location.port;}
rootUrl+='/';return rootUrl;};History.getBaseHref=function(){var
baseElements=document.getElementsByTagName('base'),baseElement=null,baseHref='';if(baseElements.length===1){baseElement=baseElements[0];baseHref=baseElement.href.replace(/[^\/]+$/,'');}
baseHref=baseHref.replace(/\/+$/,'');if(baseHref)baseHref+='/';return baseHref;};History.getBaseUrl=function(){var baseUrl=History.getBaseHref()||History.getBasePageUrl()||History.getRootUrl();return baseUrl;};History.getPageUrl=function(){var
State=History.getState(false,false),stateUrl=(State||{}).url||document.location.href,pageUrl;pageUrl=stateUrl.replace(/\/+$/,'').replace(/[^\/]+$/,function(part,index,string){return(/\./).test(part)?part:part+'/';});return pageUrl;};History.getBasePageUrl=function(){var basePageUrl=document.location.href.replace(/[#\?].*/,'').replace(/[^\/]+$/,function(part,index,string){return(/[^\/]$/).test(part)?'':part;}).replace(/\/+$/,'')+'/';return basePageUrl;};History.getFullUrl=function(url,allowBaseHref){var fullUrl=url,firstChar=url.substring(0,1);allowBaseHref=(typeof allowBaseHref==='undefined')?true:allowBaseHref;if(/[a-z]+\:\/\//.test(url)){}
else if(firstChar==='/'){fullUrl=History.getRootUrl()+url.replace(/^\/+/,'');}
else if(firstChar==='#'){fullUrl=History.getPageUrl().replace(/#.*/,'')+url;}
else if(firstChar==='?'){fullUrl=History.getPageUrl().replace(/[\?#].*/,'')+url;}
else{if(allowBaseHref){fullUrl=History.getBaseUrl()+url.replace(/^(\.\/)+/,'');}else{fullUrl=History.getBasePageUrl()+url.replace(/^(\.\/)+/,'');}}
return fullUrl.replace(/\#$/,'');};History.getShortUrl=function(url){var shortUrl=url,baseUrl=History.getBaseUrl(),rootUrl=History.getRootUrl();if(History.emulated.pushState){}
shortUrl=shortUrl.replace(rootUrl,'/');if(History.isTraditionalAnchor(shortUrl)){shortUrl='./'+shortUrl;}
shortUrl=shortUrl.replace(/^(\.\/)+/g,'./').replace(/\#$/,'');return shortUrl;};History.store={};History.idToState=History.idToState||{};History.stateToId=History.stateToId||{};History.urlToId=History.urlToId||{};History.storedStates=History.storedStates||[];History.savedStates=History.savedStates||[];History.normalizeStore=function(){History.store.idToState=History.store.idToState||{};History.store.urlToId=History.store.urlToId||{};History.store.stateToId=History.store.stateToId||{};};History.getState=function(friendly,create){if(typeof friendly==='undefined'){friendly=true;}
if(typeof create==='undefined'){create=true;}
var State=History.getLastSavedState();if(!State&&create){State=History.createStateObject();}
if(friendly){State=History.cloneObject(State);State.url=State.cleanUrl||State.url;}
return State;};History.getIdByState=function(newState){var id=History.extractId(newState.url),str;if(!id){str=History.getStateString(newState);if(typeof History.stateToId[str]!=='undefined'){id=History.stateToId[str];}
else if(typeof History.store.stateToId[str]!=='undefined'){id=History.store.stateToId[str];}
else{while(true){id=(new Date()).getTime()+String(Math.random()).replace(/\D/g,'');if(typeof History.idToState[id]==='undefined'&&typeof History.store.idToState[id]==='undefined'){break;}}
History.stateToId[str]=id;History.idToState[id]=newState;}}
return id;};History.normalizeState=function(oldState){var newState,dataNotEmpty;if(!oldState||(typeof oldState!=='object')){oldState={};}
if(typeof oldState.normalized!=='undefined'){return oldState;}
if(!oldState.data||(typeof oldState.data!=='object')){oldState.data={};}
newState={};newState.normalized=true;newState.title=oldState.title||'';newState.url=History.getFullUrl(History.unescapeString(oldState.url||document.location.href));newState.hash=History.getShortUrl(newState.url);newState.data=History.cloneObject(oldState.data);newState.id=History.getIdByState(newState);newState.cleanUrl=newState.url.replace(/\??\&_suid.*/,'');newState.url=newState.cleanUrl;dataNotEmpty=!History.isEmptyObject(newState.data);if(newState.title||dataNotEmpty){newState.hash=History.getShortUrl(newState.url).replace(/\??\&_suid.*/,'');if(!/\?/.test(newState.hash)){newState.hash+='?';}
newState.hash+='&_suid='+newState.id;}
newState.hashedUrl=History.getFullUrl(newState.hash);if((History.emulated.pushState||History.bugs.safariPoll)&&History.hasUrlDuplicate(newState)){newState.url=newState.hashedUrl;}
return newState;};History.createStateObject=function(data,title,url){var State={'data':data,'title':title,'url':url};State=History.normalizeState(State);return State;};History.getStateById=function(id){id=String(id);var State=History.idToState[id]||History.store.idToState[id]||undefined;return State;};History.getStateString=function(passedState){var State,cleanedState,str;State=History.normalizeState(passedState);cleanedState={data:State.data,title:passedState.title,url:passedState.url};str=JSON.stringify(cleanedState);return str;};History.getStateId=function(passedState){var State,id;State=History.normalizeState(passedState);id=State.id;return id;};History.getHashByState=function(passedState){var State,hash;State=History.normalizeState(passedState);hash=State.hash;return hash;};History.extractId=function(url_or_hash){var id,parts,url;parts=/(.*)\&_suid=([0-9]+)$/.exec(url_or_hash);url=parts?(parts[1]||url_or_hash):url_or_hash;id=parts?String(parts[2]||''):'';return id||false;};History.isTraditionalAnchor=function(url_or_hash){var isTraditional=!(/[\/\?\.]/.test(url_or_hash));return isTraditional;};History.extractState=function(url_or_hash,create){var State=null,id,url;create=create||false;id=History.extractId(url_or_hash);if(id){State=History.getStateById(id);}
if(!State){url=History.getFullUrl(url_or_hash);id=History.getIdByUrl(url)||false;if(id){State=History.getStateById(id);}
if(!State&&create&&!History.isTraditionalAnchor(url_or_hash)){State=History.createStateObject(null,null,url);}}
return State;};History.getIdByUrl=function(url){var id=History.urlToId[url]||History.store.urlToId[url]||undefined;return id;};History.getLastSavedState=function(){return History.savedStates[History.savedStates.length-1]||undefined;};History.getLastStoredState=function(){return History.storedStates[History.storedStates.length-1]||undefined;};History.hasUrlDuplicate=function(newState){var hasDuplicate=false,oldState;oldState=History.extractState(newState.url);hasDuplicate=oldState&&oldState.id!==newState.id;return hasDuplicate;};History.storeState=function(newState){History.urlToId[newState.url]=newState.id;History.storedStates.push(History.cloneObject(newState));return newState;};History.isLastSavedState=function(newState){var isLast=false,newId,oldState,oldId;if(History.savedStates.length){newId=newState.id;oldState=History.getLastSavedState();oldId=oldState.id;isLast=(newId===oldId);}
return isLast;};History.saveState=function(newState){if(History.isLastSavedState(newState)){return false;}
History.savedStates.push(History.cloneObject(newState));return true;};History.getStateByIndex=function(index){var State=null;if(typeof index==='undefined'){State=History.savedStates[History.savedStates.length-1];}
else if(index<0){State=History.savedStates[History.savedStates.length+index];}
else{State=History.savedStates[index];}
return State;};History.getHash=function(){var hash=History.unescapeHash(document.location.hash);return hash;};History.unescapeString=function(str){return str;};History.unescapeHash=function(hash){var result=History.normalizeHash(hash);result=History.unescapeString(result);return result;};History.normalizeHash=function(hash){var result=hash.replace(/[^#]*#/,'').replace(/#.*/,'');return result;};History.setHash=function(hash,queue){var adjustedHash,State,pageUrl;if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.setHash,args:arguments,queue:queue});return false;}
adjustedHash=hash;History.busy(true);State=History.extractState(hash,true);if(State&&!History.emulated.pushState){History.pushState(State.data,State.title,State.url,false);}
else if(document.location.hash!==adjustedHash){if(History.bugs.setHash){pageUrl=History.getPageUrl();History.pushState(null,null,pageUrl+'#'+adjustedHash,false);}
else{document.location.hash=adjustedHash;}}
return History;};History.escapeHash=function(hash){var result=History.normalizeHash(hash);result=window.escape(result);if(!History.bugs.hashEscape){result=result.replace(/\%21/g,'!').replace(/\%26/g,'&').replace(/\%3D/g,'=').replace(/\%3F/g,'?');}
return result;};History.getHashByUrl=function(url){var hash=String(url).replace(/([^#]*)#?([^#]*)#?(.*)/,'$2');hash=History.unescapeHash(hash);return hash;};History.setTitle=function(newState){var title=newState.title,firstState;if(!title){firstState=History.getStateByIndex(0);if(firstState&&firstState.url===newState.url){title=firstState.title||History.options.initialTitle;}}
try{document.getElementsByTagName('title')[0].innerHTML=title.replace('<','&lt;').replace('>','&gt;').replace(' & ',' &amp; ');}
catch(Exception){}
document.title=title;return History;};History.queues=[];History.busy=function(value){if(typeof value!=='undefined'){History.busy.flag=value;}
else if(typeof History.busy.flag==='undefined'){History.busy.flag=false;}
if(!History.busy.flag){clearTimeout(History.busy.timeout);var fireNext=function(){var i,queue,item;if(History.busy.flag)return;for(i=History.queues.length-1;i>=0;--i){queue=History.queues[i];if(queue.length===0)continue;item=queue.shift();History.fireQueueItem(item);History.busy.timeout=setTimeout(fireNext,History.options.busyDelay);}};History.busy.timeout=setTimeout(fireNext,History.options.busyDelay);}
return History.busy.flag;};History.busy.flag=false;History.fireQueueItem=function(item){return item.callback.apply(item.scope||History,item.args||[]);};History.pushQueue=function(item){History.queues[item.queue||0]=History.queues[item.queue||0]||[];History.queues[item.queue||0].push(item);return History;};History.queue=function(item,queue){if(typeof item==='function'){item={callback:item};}
if(typeof queue!=='undefined'){item.queue=queue;}
if(History.busy()){History.pushQueue(item);}else{History.fireQueueItem(item);}
return History;};History.clearQueue=function(){History.busy.flag=false;History.queues=[];return History;};History.stateChanged=false;History.doubleChecker=false;History.doubleCheckComplete=function(){History.stateChanged=true;History.doubleCheckClear();return History;};History.doubleCheckClear=function(){if(History.doubleChecker){clearTimeout(History.doubleChecker);History.doubleChecker=false;}
return History;};History.doubleCheck=function(tryAgain){History.stateChanged=false;History.doubleCheckClear();if(History.bugs.ieDoubleCheck){History.doubleChecker=setTimeout(function(){History.doubleCheckClear();if(!History.stateChanged){tryAgain();}
return true;},History.options.doubleCheckInterval);}
return History;};History.safariStatePoll=function(){var
urlState=History.extractState(document.location.href),newState;if(!History.isLastSavedState(urlState)){newState=urlState;}
else{return;}
if(!newState){newState=History.createStateObject();}
History.Adapter.trigger(window,'popstate');return History;};History.back=function(queue){if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.back,args:arguments,queue:queue});return false;}
History.busy(true);History.doubleCheck(function(){History.back(false);});history.go(-1);return true;};History.forward=function(queue){if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.forward,args:arguments,queue:queue});return false;}
History.busy(true);History.doubleCheck(function(){History.forward(false);});history.go(1);return true;};History.go=function(index,queue){var i;if(index>0){for(i=1;i<=index;++i){History.forward(queue);}}
else if(index<0){for(i=-1;i>=index;--i){History.back(queue);}}
else{throw new Error('History.go: History.go requires a positive or negative integer passed.');}
return History;};if(History.emulated.pushState){var emptyFunction=function(){};History.pushState=History.pushState||emptyFunction;History.replaceState=History.replaceState||emptyFunction;}
else{History.onPopState=function(event,extra){var stateId=false,newState=false,currentHash,currentState;History.doubleCheckComplete();currentHash=History.getHash();if(currentHash){currentState=History.extractState(currentHash||document.location.href,true);if(currentState){History.replaceState(currentState.data,currentState.title,currentState.url,false);}
else{History.Adapter.trigger(window,'anchorchange');History.busy(false);}
History.expectedStateId=false;return false;}
stateId=History.Adapter.extractEventData('state',event,extra)||false;if(stateId){newState=History.getStateById(stateId);}
else if(History.expectedStateId){newState=History.getStateById(History.expectedStateId);}
else{newState=History.extractState(document.location.href);}
if(!newState){newState=History.createStateObject(null,null,document.location.href);}
History.expectedStateId=false;if(History.isLastSavedState(newState)){History.busy(false);return false;}
History.storeState(newState);History.saveState(newState);History.setTitle(newState);History.Adapter.trigger(window,'statechange');History.busy(false);return true;};History.Adapter.bind(window,'popstate',History.onPopState);History.pushState=function(data,title,url,queue){if(History.getHashByUrl(url)&&History.emulated.pushState){throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');}
if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.pushState,args:arguments,queue:queue});return false;}
History.busy(true);var newState=History.createStateObject(data,title,url);if(History.isLastSavedState(newState)){History.busy(false);}
else{History.storeState(newState);History.expectedStateId=newState.id;history.pushState(newState.id,newState.title,newState.url);History.Adapter.trigger(window,'popstate');}
return true;};History.replaceState=function(data,title,url,queue){if(History.getHashByUrl(url)&&History.emulated.pushState){throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');}
if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.replaceState,args:arguments,queue:queue});return false;}
History.busy(true);var newState=History.createStateObject(data,title,url);if(History.isLastSavedState(newState)){History.busy(false);}
else{History.storeState(newState);History.expectedStateId=newState.id;history.replaceState(newState.id,newState.title,newState.url);History.Adapter.trigger(window,'popstate');}
return true;};}
if(sessionStorage){try{History.store=JSON.parse(sessionStorage.getItem('History.store'))||{};}
catch(err){History.store={};}
History.normalizeStore();}
else{History.store={};History.normalizeStore();}
History.Adapter.bind(window,"beforeunload",History.clearAllIntervals);History.Adapter.bind(window,"unload",History.clearAllIntervals);History.saveState(History.storeState(History.extractState(document.location.href,true)));if(sessionStorage){History.onUnload=function(){var currentStore,item;try{currentStore=JSON.parse(sessionStorage.getItem('History.store'))||{};}
catch(err){currentStore={};}
currentStore.idToState=currentStore.idToState||{};currentStore.urlToId=currentStore.urlToId||{};currentStore.stateToId=currentStore.stateToId||{};for(item in History.idToState){if(!History.idToState.hasOwnProperty(item)){continue;}
currentStore.idToState[item]=History.idToState[item];}
for(item in History.urlToId){if(!History.urlToId.hasOwnProperty(item)){continue;}
currentStore.urlToId[item]=History.urlToId[item];}
for(item in History.stateToId){if(!History.stateToId.hasOwnProperty(item)){continue;}
currentStore.stateToId[item]=History.stateToId[item];}
History.store=currentStore;History.normalizeStore();sessionStorage.setItem('History.store',JSON.stringify(currentStore));};History.intervalList.push(setInterval(History.onUnload,History.options.storeInterval));History.Adapter.bind(window,'beforeunload',History.onUnload);History.Adapter.bind(window,'unload',History.onUnload);}
if(!History.emulated.pushState){if(History.bugs.safariPoll){History.intervalList.push(setInterval(History.safariStatePoll,History.options.safariPollInterval));}
if(navigator.vendor==='Apple Computer, Inc.'||(navigator.appCodeName||'')==='Mozilla'){History.Adapter.bind(window,'hashchange',function(){History.Adapter.trigger(window,'popstate');});if(History.getHash()){History.Adapter.onDomLoad(function(){History.Adapter.trigger(window,'hashchange');});}}}};History.init();})(window);(function(window,undefined){"use strict";var
document=window.document,setTimeout=window.setTimeout||setTimeout,clearTimeout=window.clearTimeout||clearTimeout,setInterval=window.setInterval||setInterval,History=window.History=window.History||{};if(typeof History.initHtml4!=='undefined'){throw new Error('History.js HTML4 Support has already been loaded...');}
History.initHtml4=function(){if(typeof History.initHtml4.initialized!=='undefined'){return false;}
else{History.initHtml4.initialized=true;}
History.enabled=true;History.savedHashes=[];History.isLastHash=function(newHash){var oldHash=History.getHashByIndex(),isLast;isLast=newHash===oldHash;return isLast;};History.saveHash=function(newHash){if(History.isLastHash(newHash)){return false;}
History.savedHashes.push(newHash);return true;};History.getHashByIndex=function(index){var hash=null;if(typeof index==='undefined'){hash=History.savedHashes[History.savedHashes.length-1];}
else if(index<0){hash=History.savedHashes[History.savedHashes.length+index];}
else{hash=History.savedHashes[index];}
return hash;};History.discardedHashes={};History.discardedStates={};History.discardState=function(discardedState,forwardState,backState){var discardedStateHash=History.getHashByState(discardedState),discardObject;discardObject={'discardedState':discardedState,'backState':backState,'forwardState':forwardState};History.discardedStates[discardedStateHash]=discardObject;return true;};History.discardHash=function(discardedHash,forwardState,backState){var discardObject={'discardedHash':discardedHash,'backState':backState,'forwardState':forwardState};History.discardedHashes[discardedHash]=discardObject;return true;};History.discardedState=function(State){var StateHash=History.getHashByState(State),discarded;discarded=History.discardedStates[StateHash]||false;return discarded;};History.discardedHash=function(hash){var discarded=History.discardedHashes[hash]||false;return discarded;};History.recycleState=function(State){var StateHash=History.getHashByState(State);if(History.discardedState(State)){delete History.discardedStates[StateHash];}
return true;};if(History.emulated.hashChange){History.hashChangeInit=function(){History.checkerFunction=null;var lastDocumentHash='',iframeId,iframe,lastIframeHash,checkerRunning;if(History.isInternetExplorer()){iframeId='historyjs-iframe';iframe=document.createElement('iframe');iframe.setAttribute('id',iframeId);iframe.style.display='none';document.body.appendChild(iframe);iframe.contentWindow.document.open();iframe.contentWindow.document.close();lastIframeHash='';checkerRunning=false;History.checkerFunction=function(){if(checkerRunning){return false;}
checkerRunning=true;var documentHash=History.getHash()||'',iframeHash=History.unescapeHash(iframe.contentWindow.document.location.hash)||'';if(documentHash!==lastDocumentHash){lastDocumentHash=documentHash;if(iframeHash!==documentHash){lastIframeHash=iframeHash=documentHash;iframe.contentWindow.document.open();iframe.contentWindow.document.close();iframe.contentWindow.document.location.hash=documentHash;}
History.Adapter.trigger(window,'hashchange');}
else if(iframeHash!==lastIframeHash){lastIframeHash=iframeHash;History.setHash(iframeHash,false);}
checkerRunning=false;return true;};}
else{History.checkerFunction=function(){var documentHash=History.getHash();if(documentHash!==lastDocumentHash){lastDocumentHash=documentHash;History.Adapter.trigger(window,'hashchange');}
return true;};}
History.intervalList.push(setInterval(History.checkerFunction,History.options.hashChangeInterval));return true;};History.Adapter.onDomLoad(History.hashChangeInit);}
if(History.emulated.pushState){History.onHashChange=function(event){var currentUrl=((event&&event.newURL)||document.location.href),currentHash=History.getHashByUrl(currentUrl),currentState=null,currentStateHash=null,currentStateHashExits=null,discardObject;if(History.isLastHash(currentHash)){History.busy(false);return false;}
History.doubleCheckComplete();History.saveHash(currentHash);if(currentHash&&History.isTraditionalAnchor(currentHash)){History.Adapter.trigger(window,'anchorchange');History.busy(false);return false;}
currentState=History.extractState(History.getFullUrl(currentHash||document.location.href,false),true);if(History.isLastSavedState(currentState)){History.busy(false);return false;}
currentStateHash=History.getHashByState(currentState);discardObject=History.discardedState(currentState);if(discardObject){if(History.getHashByIndex(-2)===History.getHashByState(discardObject.forwardState)){History.back(false);}else{History.forward(false);}
return false;}
History.pushState(currentState.data,currentState.title,currentState.url,false,true);return true;};History.Adapter.bind(window,'hashchange',History.onHashChange);History.pushState=function(data,title,url,queue,calledByHashChange){if(History.getHashByUrl(url)){throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');}
if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.pushState,args:arguments,queue:queue});return false;}
History.busy(true);var newState=History.createStateObject(data,title,url),newStateHash=History.getHashByState(newState),oldState=History.getState(false),oldStateHash=History.getHashByState(oldState),html4Hash=History.getHash();History.storeState(newState);History.expectedStateId=newState.id;History.recycleState(newState);History.setTitle(newState);if(newStateHash===oldStateHash){History.busy(false);return false;}
if(newStateHash!==html4Hash&&newStateHash!==History.getShortUrl(document.location.href)){History.setHash(newStateHash,false);return false;}
History.saveState(newState);if(calledByHashChange){History.triggeredBy}
History.Adapter.trigger(window,'statechange');History.busy(false);return true;};History.replaceState=function(data,title,url,queue){if(History.getHashByUrl(url)){throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');}
if(queue!==false&&History.busy()){History.pushQueue({scope:History,callback:History.replaceState,args:arguments,queue:queue});return false;}
History.busy(true);var newState=History.createStateObject(data,title,url),oldState=History.getState(false),previousState=History.getStateByIndex(-2);History.discardState(oldState,newState,previousState);History.pushState(newState.data,newState.title,newState.url,false);return true;};}
if(History.emulated.pushState){if(History.getHash()&&!History.emulated.hashChange){History.Adapter.onDomLoad(function(){History.Adapter.trigger(window,'hashchange');});}}};if(typeof History.init!=='undefined'){History.init();}})(window);(function(window){var Box={};Box.EventTarget=(function(){'use strict';function EventTarget(){this._handlers={};}
EventTarget.prototype={constructor:EventTarget,on:function(type,handler){var handlers=this._handlers[type],i,len;if(typeof handlers==='undefined'){handlers=this._handlers[type]=[];}
for(i=0,len=handlers.length;i<len;i++){if(handlers[i]===handler){return;}}
handlers.push(handler);},fire:function(type,data){var handlers,i,len,event={type:type,data:data};handlers=this._handlers[event.type];if(handlers instanceof Array){handlers=handlers.concat();for(i=0,len=handlers.length;i<len;i++){handlers[i].call(this,event);}}},off:function(type,handler){var handlers=this._handlers[type],i,len;if(handlers instanceof Array){for(i=0,len=handlers.length;i<len;i++){if(handlers[i]===handler){handlers.splice(i,1);break;}}}}};return EventTarget;}());Box.JQueryDOM=(function(){'use strict';return{type:'jquery',query:function(root,selector){return jQuery(root).find(selector)[0]||null;},queryAll:function(root,selector){return jQuery.makeArray(jQuery(root).find(selector));},on:function(element,type,listener){jQuery(element).on(type,listener);},off:function(element,type,listener){jQuery(element).off(type,listener);}};}());Box.DOM=Box.JQueryDOM;Box.DOMEventDelegate=(function(){'use strict';var DEFAULT_EVENT_TYPES=['click','mouseover','mouseout','mousedown','mouseup','mouseenter','mouseleave','mousemove','keydown','keyup','submit','change','contextmenu','dblclick','input','focusin','focusout'];function isModuleElement(element){return element&&element.hasAttribute('data-module');}
function isTypeElement(element){return element&&element.hasAttribute('data-type');}
function getNearestTypeElement(element){var found=false;var moduleBoundaryReached=false;while(!found&&element&&element.parentNode&&!moduleBoundaryReached){found=isTypeElement(element);moduleBoundaryReached=isModuleElement(element);if(!found){element=element.parentNode;}}
return found?element:null;}
function forEachEventType(eventTypes,handler,callback,thisValue){var i,type;for(i=0;i<eventTypes.length;i++){type=eventTypes[i];if(handler['on'+type]){callback.call(thisValue,type);}}}
function DOMEventDelegate(element,handler,eventTypes){this.element=element;this._handler=handler;this._eventTypes=eventTypes||DEFAULT_EVENT_TYPES;this._boundHandler={};this._attached=false;}
DOMEventDelegate.prototype={constructor:DOMEventDelegate,_handleEvent:function(event){var targetElement=getNearestTypeElement(event.target),elementType=targetElement?targetElement.getAttribute('data-type'):'';this._handler['on'+event.type](event,targetElement,elementType);},attachEvents:function(){if(!this._attached){forEachEventType(this._eventTypes,this._handler,function(eventType){var that=this;function handleEvent(){that._handleEvent.apply(that,arguments);}
Box.DOM.on(this.element,eventType,handleEvent);this._boundHandler[eventType]=handleEvent;},this);this._attached=true;}},detachEvents:function(){forEachEventType(this._eventTypes,this._handler,function(eventType){Box.DOM.off(this.element,eventType,this._boundHandler[eventType]);},this);}};return DOMEventDelegate;}());Box.Context=(function(){'use strict';function Context(application,element){this.application=application;this.element=element;}
Context.prototype={broadcast:function(name,data){this.application.broadcast(name,data);},getService:function(serviceName){return this.application.getService(serviceName);},hasService:function(serviceName){return this.application.hasService(serviceName);},getConfig:function(name){return this.application.getModuleConfig(this.element,name);},getGlobal:function(name){return this.application.getGlobal(name);},getGlobalConfig:function(name){return this.application.getGlobalConfig(name);},reportError:function(exception){this.application.reportError(exception);},getElement:function(){return this.element;}};return Context;}());Box.Application=(function(){'use strict';var MODULE_SELECTOR='[data-module]';var globalConfig={},modules={},serviceStack=[],services={},behaviors={},instances={},initialized=false,application=new Box.EventTarget();function assign(receiver,supplier){for(var prop in supplier){if(supplier.hasOwnProperty(prop)){receiver[prop]=supplier[prop];}}
return receiver;}
function indexOf(items,item){for(var i=0,len=items.length;i<len;i++){if(items[i]===item){return i;}}
return-1;}
function reset(){globalConfig={};modules={};services={};serviceStack=[];behaviors={};instances={};initialized=false;}
function isServiceBeingInstantiated(serviceName){for(var i=0,len=serviceStack.length;i<len;i++){if(serviceStack[i]===serviceName){return true;}}
return false;}
function error(exception){if(globalConfig.debug){throw exception;}else{application.fire('error',{exception:exception});}}
function captureObjectErrors(object,objectName){var propertyName,propertyValue;for(propertyName in object){propertyValue=object[propertyName];if(typeof propertyValue==='function'){object[propertyName]=(function(methodName,method){return function(){var errorPrefix=objectName+'.'+methodName+'() - ';try{return method.apply(this,arguments);}catch(ex){ex.methodName=methodName;ex.objectName=objectName;ex.name=errorPrefix+ex.name;ex.message=errorPrefix+ex.message;error(ex);}};}(propertyName,propertyValue));}}}
function getModuleName(element){var moduleAttribute=element.getAttribute('data-module');if(moduleAttribute){return moduleAttribute.split(' ')[0];}
return'';}
function callModuleMethod(instance,method){if(typeof instance[method]==='function'){instance[method].apply(instance,Array.prototype.slice.call(arguments,2));}}
function getService(serviceName){var serviceData=services[serviceName];if(serviceData){if(!serviceData.instance){if(isServiceBeingInstantiated(serviceName)){error(new ReferenceError('Circular service dependency: '+serviceStack.join(' -> ')+' -> '+serviceName));return null;}
serviceStack.push(serviceName);serviceData.instance=serviceData.creator(application);serviceStack.pop();}
return serviceData.instance;}else{error(new Error('Service "'+serviceName+'" not found'));}
return null;}
function getBehaviors(instanceData){var i,behaviorNames,behaviorData,behaviorInstances=[],includedBehaviors={},moduleBehaviorInstances,behaviorName;behaviorNames=instanceData.instance.behaviors||[];for(i=0;i<behaviorNames.length;i++){behaviorName=behaviorNames[i];if(!('behaviorInstances'in instanceData)){instanceData.behaviorInstances={};}
moduleBehaviorInstances=instanceData.behaviorInstances;behaviorData=behaviors[behaviorName];if(behaviorName in includedBehaviors){error(new Error('Behavior "'+behaviorName+'" cannot be specified twice in a module.'));}else if(behaviorData){if(!moduleBehaviorInstances[behaviorName]){moduleBehaviorInstances[behaviorName]=behaviorData.creator(instanceData.context);}
behaviorInstances.push(moduleBehaviorInstances[behaviorName]);}else{error(new Error('Behavior "'+behaviorName+'" not found'));}
includedBehaviors[behaviorName]=true;}
return behaviorInstances;}
function createAndBindEventDelegate(eventDelegates,element,handler){var delegate=new Box.DOMEventDelegate(element,handler,globalConfig.eventTypes);eventDelegates.push(delegate);delegate.attachEvents();}
function bindEventListeners(instanceData){var eventDelegates=instanceData.eventDelegates,moduleBehaviors=getBehaviors(instanceData);createAndBindEventDelegate(eventDelegates,instanceData.element,instanceData.instance);for(var i=0;i<moduleBehaviors.length;i++){createAndBindEventDelegate(eventDelegates,instanceData.element,moduleBehaviors[i]);}}
function unbindEventListeners(instanceData){var eventDelegates=instanceData.eventDelegates;for(var i=0;i<eventDelegates.length;i++){eventDelegates[i].detachEvents();}
instanceData.eventDelegates=[];}
function getInstanceDataByElement(element){return instances[element.id];}
function callMessageHandler(instance,name,data){if(instance.onmessage!==null&&typeof instance.onmessage==='object'&&instance.onmessage.hasOwnProperty(name)){instance.onmessage[name].call(instance,data);}else if(indexOf(instance.messages||[],name)!==-1){instance.onmessage.call(instance,name,data);}}
return assign(application,{init:function(params){assign(globalConfig,params||{});this.startAll(document.documentElement);this.fire('init');initialized=true;return this;},destroy:function(){this.stopAll(document.documentElement);reset();return this;},isStarted:function(element){var instanceData=getInstanceDataByElement(element);return typeof instanceData==='object';},start:function(element){var moduleName=getModuleName(element),moduleData=modules[moduleName],instanceData,context,module;if(!moduleData){error(new Error('Module type "'+moduleName+'" is not defined.'));return this;}
if(!this.isStarted(element)){if(!element.id){element.id='mod-'+moduleName+'-'+moduleData.counter;}
moduleData.counter++;context=new Box.Context(this,element);module=moduleData.creator(context);if(!globalConfig.debug){captureObjectErrors(module,moduleName);}
instanceData={moduleName:moduleName,instance:module,context:context,element:element,eventDelegates:[]};instances[element.id]=instanceData;var moduleBehaviors=getBehaviors(instanceData),behaviorInstance;for(var i=0,len=moduleBehaviors.length;i<len;i++){behaviorInstance=moduleBehaviors[i];callModuleMethod(behaviorInstance,'init');}
callModuleMethod(instanceData.instance,'init');bindEventListeners(instanceData);}
return this;},stop:function(element){var instanceData=getInstanceDataByElement(element);if(!instanceData){if(globalConfig.debug){error(new Error('Unable to stop module associated with element: '+element.id));return this;}}else{unbindEventListeners(instanceData);var moduleBehaviors=getBehaviors(instanceData);var behaviorInstance;for(var i=moduleBehaviors.length-1;i>=0;i--){behaviorInstance=moduleBehaviors[i];callModuleMethod(behaviorInstance,'destroy');}
callModuleMethod(instanceData.instance,'destroy');delete instances[element.id];}
return this;},startAll:function(root){var moduleElements=Box.DOM.queryAll(root,MODULE_SELECTOR);for(var i=0,len=moduleElements.length;i<len;i++){this.start(moduleElements[i]);}
return this;},stopAll:function(root){var moduleElements=Box.DOM.queryAll(root,MODULE_SELECTOR);for(var i=0,len=moduleElements.length;i<len;i++){this.stop(moduleElements[i]);}
return this;},addModule:function(moduleName,creator){if(typeof modules[moduleName]!=='undefined'){error(new Error('Module '+moduleName+' has already been added.'));return this;}
modules[moduleName]={creator:creator,counter:1};return this;},getModuleConfig:function(element,name){var instanceData=getInstanceDataByElement(element);var moduleConfig=null;if(instanceData&&instanceData.config){moduleConfig=instanceData.config;}else{var configElement=Box.DOM.query(element,'script[type="text/x-config"]');if(configElement){try{moduleConfig=JSON.parse(configElement.text);}catch(exception){error(new Error('Module with id '+element.id+' has a malformed config.'));}}
if(instanceData){instanceData.config=moduleConfig;}}
if(!moduleConfig){return null;}else if(typeof name==='undefined'){return moduleConfig;}else if(name in moduleConfig){return moduleConfig[name];}else{return null;}},addService:function(serviceName,creator){if(typeof services[serviceName]!=='undefined'){error(new Error('Service '+serviceName+' has already been added.'));return this;}
services[serviceName]={creator:creator,instance:null};return this;},getService:getService,hasService:function(serviceName){return services.hasOwnProperty(serviceName);},addBehavior:function(behaviorName,creator){if(typeof behaviors[behaviorName]!=='undefined'){error(new Error('Behavior '+behaviorName+' has already been added.'));return this;}
behaviors[behaviorName]={creator:creator,instance:null};return this;},broadcast:function(name,data){var i,id,instanceData,behaviorInstance,moduleBehaviors;for(id in instances){if(instances.hasOwnProperty(id)){instanceData=instances[id];callMessageHandler(instanceData.instance,name,data);moduleBehaviors=getBehaviors(instanceData);for(i=0;i<moduleBehaviors.length;i++){behaviorInstance=moduleBehaviors[i];callMessageHandler(behaviorInstance,name,data);}}}
this.fire('message',{message:name,messageData:data});return this;},getGlobal:function(name){if(name in window){return window[name];}else{return null;}},getGlobalConfig:function(name){if(typeof name==='undefined'){return globalConfig;}else if(name in globalConfig){return globalConfig[name];}else{return null;}},setGlobalConfig:function(config){if(initialized){error(new Error('Cannot set global configuration after application initialization'));return this;}
assign(globalConfig,config);return this;},reportError:error,reportWarning:function(data){if(globalConfig.debug){var globalConsole=this.getGlobal('console');if(globalConsole&&globalConsole.warn){globalConsole.warn(data);}}else{application.fire('warning',data);}}});}());if(typeof define==='function'&&define.amd){define('t3',[],function(){return Box;});}else if(typeof module==='object'&&typeof module.exports==='object'){module.exports=Box;}else{window.Box=window.Box||{};for(var key in Box){if(Box.hasOwnProperty(key)){window.Box[key]=Box[key];}}}}(typeof window!=='undefined'?window:this));(function(window){'use strict';window.Crocodoc=(function(fn){if(typeof exports==='object'){module.exports=fn;}else{return fn(jQuery);}}(function($){var CSS_CLASS_PREFIX='crocodoc-',ATTR_SVG_VERSION='data-svg-version',CSS_CLASS_VIEWER=CSS_CLASS_PREFIX+'viewer',CSS_CLASS_DOC=CSS_CLASS_PREFIX+'doc',CSS_CLASS_VIEWPORT=CSS_CLASS_PREFIX+'viewport',CSS_CLASS_LOGO=CSS_CLASS_PREFIX+'viewer-logo',CSS_CLASS_DRAGGABLE=CSS_CLASS_PREFIX+'draggable',CSS_CLASS_DRAGGING=CSS_CLASS_PREFIX+'dragging',CSS_CLASS_TEXT_SELECTED=CSS_CLASS_PREFIX+'text-selected',CSS_CLASS_TEXT_DISABLED=CSS_CLASS_PREFIX+'text-disabled',CSS_CLASS_LINKS_DISABLED=CSS_CLASS_PREFIX+'links-disabled',CSS_CLASS_MOBILE=CSS_CLASS_PREFIX+'mobile',CSS_CLASS_IELT9=CSS_CLASS_PREFIX+'ielt9',CSS_CLASS_SUPPORTS_SVG=CSS_CLASS_PREFIX+'supports-svg',CSS_CLASS_WINDOW_AS_VIEWPORT=CSS_CLASS_PREFIX+'window-as-viewport',CSS_CLASS_LAYOUT_PREFIX=CSS_CLASS_PREFIX+'layout-',CSS_CLASS_CURRENT_PAGE=CSS_CLASS_PREFIX+'current-page',CSS_CLASS_PRECEDING_PAGE=CSS_CLASS_PREFIX+'preceding-page',CSS_CLASS_PAGE=CSS_CLASS_PREFIX+'page',CSS_CLASS_PAGE_INNER=CSS_CLASS_PAGE+'-inner',CSS_CLASS_PAGE_CONTENT=CSS_CLASS_PAGE+'-content',CSS_CLASS_PAGE_SVG=CSS_CLASS_PAGE+'-svg',CSS_CLASS_PAGE_TEXT=CSS_CLASS_PAGE+'-text',CSS_CLASS_PAGE_LINK=CSS_CLASS_PAGE+'-link',CSS_CLASS_PAGE_LINKS=CSS_CLASS_PAGE+'-links',CSS_CLASS_PAGE_AUTOSCALE=CSS_CLASS_PAGE+'-autoscale',CSS_CLASS_PAGE_LOADING=CSS_CLASS_PAGE+'-loading',CSS_CLASS_PAGE_ERROR=CSS_CLASS_PAGE+'-error',CSS_CLASS_PAGE_VISIBLE=CSS_CLASS_PAGE+'-visible',CSS_CLASS_PAGE_AUTOSCALE=CSS_CLASS_PAGE+'-autoscale',CSS_CLASS_PAGE_PREV=CSS_CLASS_PAGE+'-prev',CSS_CLASS_PAGE_NEXT=CSS_CLASS_PAGE+'-next',CSS_CLASS_PAGE_BEFORE=CSS_CLASS_PAGE+'-before',CSS_CLASS_PAGE_AFTER=CSS_CLASS_PAGE+'-after',CSS_CLASS_PAGE_BEFORE_BUFFER=CSS_CLASS_PAGE+'-before-buffer',CSS_CLASS_PAGE_AFTER_BUFFER=CSS_CLASS_PAGE+'-after-buffer',PRESENTATION_CSS_CLASSES=[CSS_CLASS_PAGE_NEXT,CSS_CLASS_PAGE_AFTER,CSS_CLASS_PAGE_PREV,CSS_CLASS_PAGE_BEFORE,CSS_CLASS_PAGE_BEFORE_BUFFER,CSS_CLASS_PAGE_AFTER_BUFFER].join(' ');var VIEWER_HTML_TEMPLATE='<div tabindex="-1" class="'+CSS_CLASS_VIEWPORT+'">'+'<div class="'+CSS_CLASS_DOC+'"></div>'+'</div>'+'<div class="'+CSS_CLASS_LOGO+'"></div>';var PAGE_HTML_TEMPLATE='<div class="'+CSS_CLASS_PAGE+' '+CSS_CLASS_PAGE_LOADING+'" '+'style="width:{{w}}px; height:{{h}}px;" data-width="{{w}}" data-height="{{h}}">'+'<div class="'+CSS_CLASS_PAGE_INNER+'">'+'<div class="'+CSS_CLASS_PAGE_CONTENT+'">'+'<div class="'+CSS_CLASS_PAGE_SVG+'"></div>'+'<div class="'+CSS_CLASS_PAGE_AUTOSCALE+'">'+'<div class="'+CSS_CLASS_PAGE_TEXT+'"></div>'+'<div class="'+CSS_CLASS_PAGE_LINKS+'"></div>'+'</div>'+'</div>'+'</div>'+'</div>';var DOCUMENT_100_PERCENT_WIDTH=1024;var ZOOM_FIT_WIDTH='fitwidth',ZOOM_FIT_HEIGHT='fitheight',ZOOM_AUTO='auto',ZOOM_IN='in',ZOOM_OUT='out',SCROLL_PREVIOUS='previous',SCROLL_NEXT='next',LAYOUT_VERTICAL='vertical',LAYOUT_VERTICAL_SINGLE_COLUMN='vertical-single-column',LAYOUT_HORIZONTAL='horizontal',LAYOUT_PRESENTATION='presentation',LAYOUT_PRESENTATION_TWO_PAGE='presentation-two-page',LAYOUT_TEXT='text',PAGE_STATUS_CONVERTING='converting',PAGE_STATUS_NOT_LOADED='not loaded',PAGE_STATUS_LOADING='loading',PAGE_STATUS_LOADED='loaded',PAGE_STATUS_ERROR='error';var STYLE_PADDING_PREFIX='padding-',STYLE_PADDING_TOP=STYLE_PADDING_PREFIX+'top',STYLE_PADDING_RIGHT=STYLE_PADDING_PREFIX+'right',STYLE_PADDING_LEFT=STYLE_PADDING_PREFIX+'left',STYLE_PADDING_BOTTOM=STYLE_PADDING_PREFIX+'bottom',ZOOM_LEVEL_SIMILARITY_THRESHOLD=0.95,ZOOM_LEVEL_PRESETS_SIMILARITY_THRESHOLD=0.99;var PAGE_LOAD_INTERVAL=100,MAX_PAGE_LOAD_RANGE=32,MAX_PAGE_LOAD_RANGE_MOBILE=8,READY_TRIGGER_PRELOADING_DELAY=1000;function PROXY_SVG(){'use strict';window.loadSVG=function(svgText){var domParser=new window.DOMParser(),svgDoc=domParser.parseFromString(svgText,'image/svg+xml'),svgEl=document.importNode(svgDoc.documentElement,true);svgEl.setAttribute('width','100%');svgEl.setAttribute('height','100%');if(document.body){document.body.appendChild(svgEl);}else{document.documentElement.appendChild(svgEl);}};}
var SVG_MIME_TYPE='image/svg+xml',HTML_TEMPLATE='<style>html,body{width:100%;height:100%;margin:0;overflow:hidden;}</style>',SVG_CONTAINER_TEMPLATE='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"><script><![CDATA[('+PROXY_SVG+')()]]></script></svg>',EMBED_STRATEGY_IFRAME_INNERHTML=1,EMBED_STRATEGY_DATA_URL=2,EMBED_STRATEGY_INLINE_SVG=3,EMBED_STRATEGY_BASIC_OBJECT=4,EMBED_STRATEGY_BASIC_IMG=5,EMBED_STRATEGY_DATA_URL_PROXY=6,EMBED_STRATEGY_IFRAME_PROXY=7,EMBED_STRATEGY_DATA_URL_IMG=8;if(typeof $==='undefined'){throw new Error('jQuery is required');}
var Crocodoc=(function(){'use strict';var components={},utilities={};function findCircularDependencies(componentName,dependencies,path){var i;path=path||componentName;for(i=0;i<dependencies.length;++i){if(componentName===dependencies[i]){throw new Error('Circular dependency detected: '+path+'->'+dependencies[i]);}else if(components[dependencies[i]]){findCircularDependencies(componentName,components[dependencies[i]].mixins,path+'->'+dependencies[i]);}}}
return{ZOOM_FIT_WIDTH:ZOOM_FIT_WIDTH,ZOOM_FIT_HEIGHT:ZOOM_FIT_HEIGHT,ZOOM_AUTO:ZOOM_AUTO,ZOOM_IN:ZOOM_IN,ZOOM_OUT:ZOOM_OUT,SCROLL_PREVIOUS:SCROLL_PREVIOUS,SCROLL_NEXT:SCROLL_NEXT,LAYOUT_VERTICAL:LAYOUT_VERTICAL,LAYOUT_VERTICAL_SINGLE_COLUMN:LAYOUT_VERTICAL_SINGLE_COLUMN,LAYOUT_HORIZONTAL:LAYOUT_HORIZONTAL,LAYOUT_PRESENTATION:LAYOUT_PRESENTATION,LAYOUT_PRESENTATION_TWO_PAGE:LAYOUT_PRESENTATION_TWO_PAGE,LAYOUT_TEXT:LAYOUT_TEXT,ASSET_REQUEST_RETRIES:1,viewerTemplate:VIEWER_HTML_TEMPLATE,pageTemplate:PAGE_HTML_TEMPLATE,components:components,utilities:utilities,createViewer:function(el,config){return new Crocodoc.Viewer(el,config);},getViewer:function(id){return Crocodoc.Viewer.get(id);},addComponent:function(name,mixins,creator){if(mixins instanceof Function){creator=mixins;mixins=[];}
findCircularDependencies(name,mixins);components[name]={mixins:mixins,creator:creator};},createComponent:function(name,scope){var component=components[name];if(component){var args=[];for(var i=0;i<component.mixins.length;++i){args.push(this.createComponent(component.mixins[i],scope));}
args.unshift(scope);return component.creator.apply(component.creator,args);}
return null;},addPlugin:function(name,creator){this.addComponent('plugin-'+name,creator);},addDataProvider:function(modelName,creator){this.addComponent('data-provider-'+modelName,creator);},addUtility:function(name,creator){utilities[name]={creator:creator,instance:null};},getUtility:function(name){var utility=utilities[name];if(utility){if(!utility.instance){utility.instance=utility.creator(this);}
return utility.instance;}
return null;}};})();(function(){'use strict';Crocodoc.Scope=function Scope(config){var util=Crocodoc.getUtility('common');var instances=[],messageQueue=[],dataProviders={},ready=false;function broadcast(messageName,data){var i,len,instance,messages;for(i=0,len=instances.length;i<len;++i){instance=instances[i];if(!instance){continue;}
messages=instance.messages||[];if(util.inArray(messageName,messages)!==-1){if(util.isFn(instance.onmessage)){instance.onmessage.call(instance,messageName,data);}}}}
function broadcastQueuedMessages(){var message;while(messageQueue.length){message=messageQueue.shift();broadcast(message.name,message.data);}
messageQueue=null;}
function destroyComponent(instance){if(util.isFn(instance.destroy)&&!instance._destroyed){instance.destroy();instance._destroyed=true;}}
config.dataProviders=config.dataProviders||{};this.createComponent=function(componentName){var instance=Crocodoc.createComponent(componentName,this);if(instance){instance.componentName=componentName;instances.push(instance);}
return instance;};this.destroyComponent=function(instance){var i,len;for(i=0,len=instances.length;i<len;++i){if(instance===instances[i]){destroyComponent(instance);instances.splice(i,1);break;}}};this.destroy=function(){var i,len,instance,components=instances.slice();for(i=0,len=components.length;i<len;++i){instance=components[i];destroyComponent(instance);}
instances=[];dataProviders={};};this.broadcast=function(messageName,data){if(ready){broadcast(messageName,data);}else{messageQueue.push({name:messageName,data:data});}};this.getUtility=function(name){return Crocodoc.getUtility(name);};this.getConfig=function(){return config;};this.ready=function(){if(!ready){ready=true;broadcastQueuedMessages();}};this.get=function(objectType,objectKey){var newObjectType=config.dataProviders[objectType]||objectType;var provider=this.getDataProvider(newObjectType);if(provider){return provider.get(objectType,objectKey);}
return $.Deferred().reject('data-provider not found').promise();};this.getDataProvider=function(objectType){var provider;if(dataProviders[objectType]){provider=dataProviders[objectType];}else{provider=this.createComponent('data-provider-'+objectType);dataProviders[objectType]=provider;}
return provider;};};})();(function(){'use strict';function buildEventObject(type,data){var isDefaultPrevented=false;return{type:type,data:data,preventDefault:function(){isDefaultPrevented=true;},isDefaultPrevented:function(){return isDefaultPrevented;}};}
Crocodoc.EventTarget=function(){this._handlers={};};Crocodoc.EventTarget.prototype={constructor:Crocodoc.EventTarget,on:function(type,handler){if(typeof this._handlers[type]==='undefined'){this._handlers[type]=[];}
this._handlers[type].push(handler);},fire:function(type,data){var handlers,i,len,event=buildEventObject(type,data);handlers=this._handlers[event.type];if(handlers instanceof Array){handlers=handlers.concat();for(i=0,len=handlers.length;i<len;i++){if(handlers[i]){handlers[i].call(this,event);}}}
handlers=this._handlers.all;if(handlers instanceof Array){handlers=handlers.concat();for(i=0,len=handlers.length;i<len;i++){if(handlers[i]){handlers[i].call(this,event);}}}
return event;},off:function(type,handler){var handlers=this._handlers[type],i,len;if(handlers instanceof Array){if(!handler){handlers.length=0;return;}
for(i=0,len=handlers.length;i<len;i++){if(handlers[i]===handler||handlers[i].handler===handler){handlers.splice(i,1);break;}}}},one:function(type,handler){var self=this,proxy=function(event){self.off(type,proxy);handler.call(self,event);};proxy.handler=handler;this.on(type,proxy);}};})();(function(){'use strict';var viewerInstanceCount=0,instances={};Crocodoc.Viewer=function(el,options){Crocodoc.EventTarget.call(this);var util=Crocodoc.getUtility('common');var layout,$el=$(el),config=util.extend(true,{},Crocodoc.Viewer.defaults,options),scope=new Crocodoc.Scope(config),viewerBase=scope.createComponent('viewer-base');if($el.length===0){throw new Error('Invalid container element');}
this.id=config.id=++viewerInstanceCount;config.api=this;config.$el=$el;instances[this.id]=this;function init(){viewerBase.init();}
this.destroy=function(){delete instances[config.id];scope.broadcast('destroy');scope.destroy();};this.load=function(){viewerBase.loadAssets();};this.setLayout=function(mode){layout=null;layout=viewerBase.setLayout(mode);};this.zoom=function(val){var valFloat=parseFloat(val);if(layout){if(valFloat){val=valFloat/(config.pageScale||1);}
layout.setZoom(val);}};this.scrollTo=function(page){if(layout&&util.isFn(layout.scrollTo)){layout.scrollTo(page);}};this.scrollBy=function(left,top){if(layout){layout.scrollBy(left,top);}};this.focus=function(){if(layout){layout.focus();}};this.enableTextSelection=function(){$el.toggleClass(CSS_CLASS_TEXT_DISABLED,false);if(!config.enableTextSelection){config.enableTextSelection=true;scope.broadcast('textenabledchange',{enabled:true});}};this.disableTextSelection=function(){$el.toggleClass(CSS_CLASS_TEXT_DISABLED,true);if(config.enableTextSelection){config.enableTextSelection=false;scope.broadcast('textenabledchange',{enabled:false});}};this.enableLinks=function(){if(!config.enableLinks){$el.removeClass(CSS_CLASS_LINKS_DISABLED);config.enableLinks=true;}};this.disableLinks=function(){if(config.enableLinks){$el.addClass(CSS_CLASS_LINKS_DISABLED);config.enableLinks=false;}};this.updateLayout=function(){if(layout){layout.update();}};init();};Crocodoc.Viewer.prototype=new Crocodoc.EventTarget();Crocodoc.Viewer.prototype.constructor=Crocodoc.Viewer;Crocodoc.Viewer.get=function(id){return instances[id];};Crocodoc.Viewer.defaults={url:null,layout:LAYOUT_VERTICAL,zoom:ZOOM_AUTO,page:1,enableTextSelection:true,enableLinks:true,enableDragging:false,queryParams:null,plugins:{},useWindowAsViewport:false,conversionIsComplete:true,template:{svg:'page-{{page}}.svg',img:'page-{{page}}.png',html:'text-{{page}}.html',css:'stylesheet.css',json:'info.json'},dataProviders:{metadata:'metadata',stylesheet:'stylesheet','page-svg':'page-svg','page-text':'page-text','page-img':'page-img'},pageStart:null,pageEnd:null,autoloadFirstPage:true,zoomLevels:[0.25,0.5,0.75,1.0,1.25,1.5,2.0,3.0]};})();Crocodoc.addDataProvider('metadata',function(scope){'use strict';var ajax=scope.getUtility('ajax'),util=scope.getUtility('common'),config=scope.getConfig();function processJSONContent(json){return util.parseJSON(json);}
return{get:function(){var url=this.getURL(),$promise=ajax.fetch(url,Crocodoc.ASSET_REQUEST_RETRIES);return $promise.then(processJSONContent).promise({abort:$promise.abort});},getURL:function(){var jsonPath=config.template.json;return config.url+jsonPath+config.queryString;}};});Crocodoc.addDataProvider('page-img',function(scope){'use strict';var util=scope.getUtility('common'),config=scope.getConfig();return{get:function(objectType,pageNum){var img=this.getImage(),retries=Crocodoc.ASSET_REQUEST_RETRIES,loaded=false,url=this.getURL(pageNum),$deferred=$.Deferred();function loadImage(){img.setAttribute('src',url);}
function abortImage(){if(img){img.removeAttribute('src');}}
img.onload=function(){loaded=true;$deferred.resolve(img);};img.onerror=function(){if(retries>0){retries--;abortImage();loadImage();}else{img=null;loaded=false;$deferred.reject({error:'image failed to load',resource:url});}};loadImage();return $deferred.promise({abort:function(){if(!loaded){abortImage();$deferred.reject();}}});},getURL:function(pageNum){var imgPath=util.template(config.template.img,{page:pageNum});return config.url+imgPath+config.queryString;},getImage:function(){return new Image();}};});Crocodoc.addDataProvider('page-svg',function(scope){'use strict';var MAX_DATA_URLS=1000;var util=scope.getUtility('common'),ajax=scope.getUtility('ajax'),browser=scope.getUtility('browser'),subpx=scope.getUtility('subpx'),config=scope.getConfig(),destroyed=false,cache={},inlineCSSRegExp=/<xhtml:link[^>]*>(\s*<\/xhtml:link>)?/i;function interpolateCSSText(text,cssText){var stylesheetHTML='<style>'+cssText+'</style>';if(browser.firefox&&!subpx.isSubpxSupported()){stylesheetHTML+='<style>text { text-rendering: geometricPrecision; }</style>';}
text=text.replace(inlineCSSRegExp,stylesheetHTML);return text;}
function processSVGContent(text){if(destroyed){return;}
var query=config.queryString.replace('&','&#38;'),dataUrlCount;dataUrlCount=util.countInStr(text,'xlink:href="data:image');if(dataUrlCount>MAX_DATA_URLS){text=text.replace(/<image[\s\w-_="]*xlink:href="data:image\/[^"]{0,5120}"[^>]*>/ig,'');}
text=text.replace(/href="([^"#:]*)"/g,function(match,group){return'href="'+config.url+group+query+'"';});return scope.get('stylesheet').then(function(cssText){return interpolateCSSText(text,cssText);});}
return{get:function(objectType,pageNum){var url=this.getURL(pageNum),$promise;if(cache[pageNum]){return cache[pageNum];}
$promise=ajax.fetch(url,Crocodoc.ASSET_REQUEST_RETRIES);cache[pageNum]=$promise.then(processSVGContent).promise({abort:function(){$promise.abort();if(cache){delete cache[pageNum];}}});return cache[pageNum];},getURL:function(pageNum){var svgPath=util.template(config.template.svg,{page:pageNum});return config.url+svgPath+config.queryString;},destroy:function(){destroyed=true;util=ajax=subpx=browser=config=cache=null;}};});Crocodoc.addDataProvider('page-text',function(scope){'use strict';var MAX_TEXT_BOXES=256;var util=scope.getUtility('common'),ajax=scope.getUtility('ajax'),config=scope.getConfig(),destroyed=false,cache={};function processTextContent(text){if(destroyed){return;}
var numTextBoxes=util.countInStr(text,'<div');if(numTextBoxes>MAX_TEXT_BOXES){return'';}
text=text.replace(/<link rel="stylesheet".*/,'');return text;}
return{get:function(objectType,pageNum){var url=this.getURL(pageNum),$promise;if(cache[pageNum]){return cache[pageNum];}
$promise=ajax.fetch(url,Crocodoc.ASSET_REQUEST_RETRIES);cache[pageNum]=$promise.then(processTextContent).promise({abort:function(){$promise.abort();if(cache){delete cache[pageNum];}}});return cache[pageNum];},getURL:function(pageNum){var textPath=util.template(config.template.html,{page:pageNum});return config.url+textPath+config.queryString;},destroy:function(){destroyed=true;util=ajax=config=cache=null;}};});Crocodoc.addDataProvider('stylesheet',function(scope){'use strict';var ajax=scope.getUtility('ajax'),browser=scope.getUtility('browser'),config=scope.getConfig(),$cachedPromise;function processStylesheetContent(text){if(browser.ie){text=text.replace(/font-family:[\s\"\']*([\w-]+)\b/g,'$0-'+config.id);}
return text;}
return{get:function(){if($cachedPromise){return $cachedPromise;}
var $promise=ajax.fetch(this.getURL(),Crocodoc.ASSET_REQUEST_RETRIES);$cachedPromise=$promise.then(processStylesheetContent).promise({abort:function(){$promise.abort();$cachedPromise=null;}});return $cachedPromise;},getURL:function(){var cssPath=config.template.css;return config.url+cssPath+config.queryString;},destroy:function(){ajax=browser=config=null;$cachedPromise=null;}};});Crocodoc.addUtility('ajax',function(framework){'use strict';var util=framework.getUtility('common'),support=framework.getUtility('support'),urlUtil=framework.getUtility('url');function createRequestWrapper(req){var status,statusText,responseText;try{status=req.status;statusText=req.statusText;responseText=req.responseText;}catch(e){status=0;statusText='';responseText=null;}
return{status:status,statusText:statusText,responseText:responseText,rawRequest:req};}
function isRequestToLocalFile(url){return urlUtil.parse(url).protocol==='file:';}
function isSuccessfulStatusCode(status){return status>=200&&status<300||status===304;}
function parseOptions(options){options=util.extend(true,{},options||{});options.method=options.method||'GET';options.headers=options.headers||[];options.data=options.data||'';options.withCredentials=!!options.withCredentials;if(typeof options.data!=='string'){options.data=$.param(options.data);if(options.method!=='GET'){options.data=options.data;options.headers.push(['Content-Type','application/x-www-form-urlencoded']);}}
return options;}
function setHeaders(req,headers){var i;for(i=0;i<headers.length;++i){req.setRequestHeader(headers[i][0],headers[i][1]);}}
function doXHR(url,method,data,headers,withCredentials,success,fail){var req=support.getXHR();req.open(method,url,true);req.onreadystatechange=function(){var status;if(req.readyState===4){req.onreadystatechange=function(){};try{status=req.status;}catch(e){fail(req);return;}
if(status===0&&isRequestToLocalFile(url)){status=200;}
if(isSuccessfulStatusCode(status)){success(req);}else{fail(req);}}};setHeaders(req,headers);req.withCredentials=withCredentials;req.send(data);return req;}
function doXDR(url,method,data,success,fail){var req=support.getXDR();try{req.open(method,url);req.onload=function(){success(req);};req.onerror=function(){fail(req);};req.ontimeout=function(){fail(req);};req.onprogress=function(){};req.send(data);}catch(e){return fail({status:0,statusText:e.message});}
return req;}
return{request:function(url,options){var opt=parseOptions(options),method=opt.method,data=opt.data,headers=opt.headers,withCredentials=opt.withCredentials;if(method==='GET'&&data){url=urlUtil.appendQueryParams(url,data);data='';}
function ajaxSuccess(req){if(util.isFn(opt.success)){opt.success.call(createRequestWrapper(req));}
return req;}
function ajaxFail(req){if(util.isFn(opt.fail)){opt.fail.call(createRequestWrapper(req));}
return req;}
if(!support.isXHRSupported()){return opt.fail({status:0,statusText:'AJAX not supported'});}
if(urlUtil.isCrossDomain(url)&&!support.isCORSSupported()){return doXDR(url,method,data,ajaxSuccess,ajaxFail);}else{return doXHR(url,method,data,headers,withCredentials,ajaxSuccess,ajaxFail);}},fetch:function(url,retries){var req,aborted=false,ajax=this,$deferred=$.Deferred();function retryOrFail(error){if(retries>0){retries--;req=request();}else{$deferred.reject(error);}}
function request(){return ajax.request(url,{success:function(){var retryAfter,req;if(!aborted){req=this.rawRequest;if(this.status===202&&util.isFn(req.getResponseHeader)){retryAfter=parseInt(req.getResponseHeader('retry-after'));if(retryAfter>0){setTimeout(request,retryAfter*1000);return;}}
if(this.responseText){$deferred.resolve(this.responseText);}else{retryOrFail({error:'empty response',status:this.status,resource:url});}}},fail:function(){if(!aborted){retryOrFail({error:this.statusText,status:this.status,resource:url});}}});}
req=request();return $deferred.promise({abort:function(){aborted=true;req.abort();}});}};});Crocodoc.addUtility('browser',function(){'use strict';var ua=navigator.userAgent,version,browser={},ios=/ip(hone|od|ad)/i.test(ua),android=/android/i.test(ua),blackberry=/blackberry/i.test(ua),webos=/webos/i.test(ua),kindle=/silk|kindle/i.test(ua),ie=/MSIE|Trident/i.test(ua);if(ie){browser.ie=true;if(/MSIE/i.test(ua)){version=/MSIE\s+(\d+\.\d+)/i.exec(ua);}else{version=/Trident.*rv[ :](\d+\.\d+)/.exec(ua);}
browser.version=version&&parseFloat(version[1]);browser.ielt9=browser.version<9;browser.ielt10=browser.version<10;browser.ielt11=browser.version<11;}
if(ios){browser.ios=true;version=(navigator.appVersion).match(/OS (\d+)_(\d+)_?(\d+)?/);browser.version=version&&parseFloat(version[1]+'.'+version[2]);}
browser.mobile=/mobile/i.test(ua)||ios||android||blackberry||webos||kindle;browser.firefox=/firefox/i.test(ua);if(/safari/i.test(ua)){browser.chrome=/chrome/i.test(ua);browser.safari=!browser.chrome;}
if(browser.safari){version=(navigator.appVersion).match(/Version\/(\d+(\.\d+)?)/);browser.version=version&&parseFloat(version[1]);}
return browser;});Crocodoc.addUtility('common',function(){'use strict';var DEFAULT_PT2PX_RATIO=1.33333;var util={};util.extend=$.extend;util.each=$.each;util.map=$.map;util.param=$.param;util.parseJSON=$.parseJSON;util.stringifyJSON=typeof window.JSON!=='undefined'?window.JSON.stringify:function(){throw new Error('JSON.stringify not supported');};return $.extend(util,{bisectLeft:function(list,x,prop){var val,mid,low=0,high=list.length;while(low<high){mid=Math.floor((low+high)/2);val=prop?list[mid][prop]:list[mid];if(val<x){low=mid+1;}else{high=mid;}}
return low;},bisectRight:function(list,x,prop){var val,mid,low=0,high=list.length;while(low<high){mid=Math.floor((low+high)/2);val=prop?list[mid][prop]:list[mid];if(x<val){high=mid;}else{low=mid+1;}}
return low;},clamp:function(x,a,b){if(x<a){return a;}else if(x>b){return b;}
return x;},sign:function(value){var number=parseInt(value,10);if(!number){return number;}
return number<0?-1:1;},isFn:function(val){return typeof val==='function';},inArray:function(value,array){if(util.isFn(array.indexOf)){return array.indexOf(value);}else{return $.inArray(value,array);}},constrainRange:function(low,high,max){var length=high-low;if(length<0){return{min:-1,max:-1};}
low=util.clamp(low,0,max);high=util.clamp(low+length,0,max);if(high-low<length){low=util.clamp(high-length,0,max);}
return{min:low,max:high};},now:function(){return(new Date()).getTime();},throttle:function(wait,fn){var context,args,timeout,result,previous=0;function later(){previous=util.now();timeout=null;result=fn.apply(context,args);}
return function throttled(){var now=util.now(),remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=fn.apply(context,args);}else if(!timeout){timeout=setTimeout(later,remaining);}
return result;};},debounce:function(wait,fn){var context,args,timeout,timestamp,result;function later(){var last=util.now()-timestamp;if(last<wait){timeout=setTimeout(later,wait-last);}else{timeout=null;result=fn.apply(context,args);context=args=null;}}
return function debounced(){context=this;args=arguments;timestamp=util.now();if(!timeout){timeout=setTimeout(later,wait);}
return result;};},insertCSS:function(css){var styleEl=document.createElement('style'),cssTextNode=document.createTextNode(css);try{styleEl.setAttribute('type','text/css');styleEl.appendChild(cssTextNode);}catch(err){}
document.getElementsByTagName('head')[0].appendChild(styleEl);return styleEl;},appendCSSRule:function(sheet,selector,rule){var index;if(sheet.insertRule){return sheet.insertRule(selector+'{'+rule+'}',sheet.cssRules.length);}else{index=sheet.addRule(selector,rule,sheet.rules.length);if(index<0){index=sheet.rules.length-1;}
return index;}},deleteCSSRule:function(sheet,index){if(sheet.deleteRule){sheet.deleteRule(index);}else{sheet.removeRule(index);}},getSelectedNode:function(){var node,sel,range;if(window.getSelection){sel=window.getSelection();if(sel.rangeCount){range=sel.getRangeAt(0);if(!range.collapsed){node=sel.anchorNode.parentNode;}}}else if(document.selection){node=document.selection.createRange().parentElement();}
return node;},getComputedStyle:function(el){if('getComputedStyle'in window){return window.getComputedStyle(el);}
return el.currentStyle;},calculatePtSize:function(){var style,px,testSize=10000,div=document.createElement('div');div.style.display='block';div.style.position='absolute';div.style.width=testSize+'pt';document.body.appendChild(div);style=util.getComputedStyle(div);if(style&&style.width){px=parseFloat(style.width)/testSize;}else{px=DEFAULT_PT2PX_RATIO;}
document.body.removeChild(div);return px;},countInStr:function(str,token){var total=0,i;while((i=str.indexOf(token,i)+1)){total++;}
return total;},template:function(template,data){var p;for(p in data){if(data.hasOwnProperty(p)){template=template.replace(new RegExp('\\{\\{'+p+'\\}\\}','g'),data[p]);}}
return template;}});});Crocodoc.addUtility('subpx',function(framework){'use strict';var CSS_CLASS_SUBPX_FIX='crocodoc-subpx-fix',TEST_SPAN_TEMPLATE='<span style="font:{{size}}px serif; color:transparent; white-space:nowrap;">'+
(new Array(100)).join('A')+'</span>';var util=framework.getUtility('common');function isSubpixelRenderingSupported(){if(!$.support.leadingWhitespace){return false;}else{var span=$(util.template(TEST_SPAN_TEMPLATE,{size:12.5})).appendTo(document.documentElement).get(0);var fontsize1=$(span).css('font-size');var width1=$(span).width();$(span).remove();span=$(util.template(TEST_SPAN_TEMPLATE,{size:12.6})).appendTo(document.documentElement).get(0);var fontsize2=$(span).css('font-size');var width2=$(span).width();$(span).remove();if(!('ontouchstart'in window)){if(fontsize1===fontsize2){return false;}
if(width1===width2){return false;}}}
return true;}
var subpixelRenderingIsSupported=isSubpixelRenderingSupported();return{fix:function(el){if(!subpixelRenderingIsSupported){if(document.body.style.zoom!==undefined){var $wrap=$('<div>').addClass(CSS_CLASS_SUBPX_FIX);$(el).wrap($wrap);}}
return el;},isSubpxSupported:function(){return subpixelRenderingIsSupported;}};});Crocodoc.addUtility('support',function(){'use strict';var prefixes=['Moz','Webkit','O','ms'],xhrSupported=null,xhrCORSSupported=null;function getVendorCSSPropertyName(prop){var testDiv=document.createElement('div'),prop_,i,vendorProp;if(prop in testDiv.style){return prop;}
prop_=prop.charAt(0).toUpperCase()+prop.substr(1);if(prop in testDiv.style){return prop;}
for(i=0;i<prefixes.length;++i){vendorProp=prefixes[i]+prop_;if(vendorProp in testDiv.style){if(vendorProp.indexOf('ms')===0){vendorProp='-'+vendorProp;}
return uncamel(vendorProp);}}
return false;}
function uncamel(str){return str.replace(/([A-Z])/g,function(letter){return'-'+letter.toLowerCase();});}
return{svg:document.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure','1.1'),csstransform:getVendorCSSPropertyName('transform'),csstransition:getVendorCSSPropertyName('transition'),csszoom:getVendorCSSPropertyName('zoom'),isXHRSupported:function(){if(xhrSupported===null){xhrSupported=!!this.getXHR();}
return xhrSupported;},isCORSSupported:function(){if(xhrCORSSupported===null){xhrCORSSupported=this.isXHRSupported()&&('withCredentials'in this.getXHR());}
return xhrCORSSupported;},isXDRSupported:function(){return typeof window.XDomainRequest!=='undefined';},getXHR:function(){if(window.XMLHttpRequest){return new window.XMLHttpRequest();}else{try{return new ActiveXObject('MSXML2.XMLHTTP.3.0');}
catch(ex){return null;}}},getXDR:function(){if(this.isXDRSupported()){return new window.XDomainRequest();}
return null;}};});Crocodoc.addUtility('url',function(framework){'use strict';var browser=framework.getUtility('browser'),parsedLocation;return{getCurrentURL:function(){return window.location.href;},makeAbsolute:function(path){return this.parse(path).href;},isCrossDomain:function(url){var parsedURL=this.parse(url);if(!parsedLocation){parsedLocation=this.parse(this.getCurrentURL());}
if(!parsedURL.hostname){return false;}
return parsedURL.protocol!==parsedLocation.protocol||parsedURL.hostname!==parsedLocation.hostname||parsedURL.port!==parsedLocation.port;},appendQueryParams:function(url,str){if(url.indexOf('?')>-1){return url+'&'+str;}else{return url+'?'+str;}},parse:function(url){var parsed=document.createElement('a'),pathname;parsed.href=url;if(browser.ie&&url!==parsed.href){url=parsed.href;parsed.href=url;}
pathname=parsed.pathname;if(!/^\//.test(pathname)){pathname='/'+pathname;}
return{href:parsed.href,protocol:parsed.protocol,host:parsed.host,hostname:parsed.hostname,port:parsed.port,pathname:pathname,hash:parsed.hash,search:parsed.search};}};});Crocodoc.addComponent('controller-paged',function(scope){'use strict';var util=scope.getUtility('common');var config,$el,lazyLoader;function validateConfig(){var metadata=config.metadata;config.numPages=metadata.numpages;if(!config.pageStart){config.pageStart=1;}else if(config.pageStart<0){config.pageStart=metadata.numpages+config.pageStart;}
config.pageStart=util.clamp(config.pageStart,1,metadata.numpages);if(!config.pageEnd){config.pageEnd=metadata.numpages;}else if(config.pageEnd<0){config.pageEnd=metadata.numpages+config.pageEnd;}
config.pageEnd=util.clamp(config.pageEnd,config.pageStart,metadata.numpages);config.numPages=config.pageEnd-config.pageStart+1;}
function prepareDOM(){var i,pageNum,zoomLevel,maxZoom,ptWidth,ptHeight,pxWidth,pxHeight,pt2px=util.calculatePtSize(),dimensions=config.metadata.dimensions,skeleton='';config.pageScale=DOCUMENT_100_PERCENT_WIDTH/(dimensions.width*pt2px);zoomLevel=config.zoomLevels[config.zoomLevels.length-1];maxZoom=3/config.pageScale;while(zoomLevel<maxZoom){zoomLevel+=zoomLevel/2;config.zoomLevels.push(zoomLevel);}
dimensions.exceptions=dimensions.exceptions||{};for(i=config.pageStart-1;i<config.pageEnd;i++){pageNum=i+1;if(pageNum in dimensions.exceptions){ptWidth=dimensions.exceptions[pageNum].width;ptHeight=dimensions.exceptions[pageNum].height;}else{ptWidth=dimensions.width;ptHeight=dimensions.height;}
pxWidth=ptWidth*pt2px;pxHeight=ptHeight*pt2px;pxWidth*=config.pageScale;pxHeight*=config.pageScale;skeleton+=util.template(Crocodoc.pageTemplate,{w:pxWidth,h:pxHeight});}
config.$pages=$(skeleton).appendTo(config.$doc);}
function getInitialPageStatus(pageIndex){if(config.conversionIsComplete||(pageIndex===0&&config.autoloadFirstPage)){return PAGE_STATUS_NOT_LOADED;}
return PAGE_STATUS_CONVERTING;}
function createPages(){var i,pages=[],page,start=config.pageStart-1,end=config.pageEnd,links=sortPageLinks();for(i=start;i<end;i++){page=scope.createComponent('page');page.init(config.$pages.eq(i-start),{index:i,status:getInitialPageStatus(i),enableLinks:config.enableLinks,links:links[i],pageScale:config.pageScale,useSVG:config.useSVG});pages.push(page);}
config.pages=pages;}
function sortPageLinks(){var i,len,link,destination,start=config.pageStart,end=config.pageEnd,links=config.metadata.links||[],sorted=[];for(i=0,len=config.metadata.numpages;i<len;++i){sorted[i]=[];}
for(i=0,len=links.length;i<len;++i){link=links[i];if(link.pagenum<start||link.pagenum>end){continue;}
if(link.destination){destination=link.destination.pagenum;if(destination<start||destination>end){continue;}else{link.destination.pagenum=destination-(start-1);}}
sorted[link.pagenum-1].push(link);}
return sorted;}
function handleMouseUp(){updateSelectedPages();}
function updateSelectedPages(){var node=util.getSelectedNode();var $page=$(node).closest('.'+CSS_CLASS_PAGE);$el.find('.'+CSS_CLASS_TEXT_SELECTED).removeClass(CSS_CLASS_TEXT_SELECTED);if(node&&$el.has(node)){$page.addClass(CSS_CLASS_TEXT_SELECTED);}}
return{init:function(){config=scope.getConfig();$el=config.$el;$(document).on('mouseup',handleMouseUp);validateConfig();prepareDOM();createPages();lazyLoader=scope.createComponent('lazy-loader');lazyLoader.init(config.pages);},destroy:function(){$(document).off('mouseup',handleMouseUp);}};});Crocodoc.addComponent('controller-text',function(scope){'use strict';var $promise;return{init:function(){var config=scope.getConfig();config.$textContainer=$();$promise=scope.get('page-text',1).then(function(html){var $viewport=config.$doc.parent();config.$doc=$(html);$viewport.html(config.$doc);});},destroy:function(){$promise.abort();}};});Crocodoc.addComponent('dragger',function(scope){'use strict';var $el,$window=$(window),downScrollPosition,downMousePosition;function handleMousemove(event){$el.scrollTop(downScrollPosition.top-(event.clientY-downMousePosition.y));$el.scrollLeft(downScrollPosition.left-(event.clientX-downMousePosition.x));event.preventDefault();}
function handleMouseup(event){scope.broadcast('dragend');$window.off('mousemove',handleMousemove);$window.off('mouseup',handleMouseup);event.preventDefault();}
function handleMousedown(event){scope.broadcast('dragstart');downScrollPosition={top:$el.scrollTop(),left:$el.scrollLeft()};downMousePosition={x:event.clientX,y:event.clientY};$window.on('mousemove',handleMousemove);$window.on('mouseup',handleMouseup);event.preventDefault();}
return{init:function(el){$el=$(el);$el.on('mousedown',handleMousedown);},destroy:function(){$el.off('mousedown',handleMousedown);$el.off('mousemove',handleMousemove);$window.off('mouseup',handleMouseup);}};});Crocodoc.addComponent('layout-base',function(scope){'use strict';var util=scope.getUtility('common');return{messages:['resize','scroll','scrollend'],onmessage:function(name,data){switch(name){case'resize':this.handleResize(data);break;case'scroll':this.handleScroll(data);break;case'scrollend':this.handleScrollEnd(data);break;}},init:function(){var config=scope.getConfig();this.config=config;this.$el=config.$el;this.$doc=config.$doc;this.$viewport=config.$viewport;this.$pages=config.$pages;this.numPages=config.numPages;this.layoutClass=CSS_CLASS_LAYOUT_PREFIX+config.layout;this.$el.addClass(this.layoutClass);this.initState();},initState:function(){var viewportEl=this.$viewport[0],dimensionsEl=viewportEl;if(viewportEl===window){dimensionsEl=document.documentElement;}
this.state={scrollTop:viewportEl.scrollTop,scrollLeft:viewportEl.scrollLeft,viewportDimensions:{clientWidth:dimensionsEl.clientWidth,clientHeight:dimensionsEl.clientHeight,offsetWidth:dimensionsEl.offsetWidth,offsetHeight:dimensionsEl.offsetHeight},zoomState:{zoom:1,prevZoom:0,zoomMode:null},initialWidth:0,initialHeight:0,totalWidth:0,totalHeight:0};this.zoomLevels=[];},destroy:function(){this.$doc.removeAttr('style');this.$el.removeClass(this.layoutClass);},setZoom:function(){},calculateNextZoomLevel:function(direction){var i,zoom=false,currentZoom=this.state.zoomState.zoom,zoomLevels=this.zoomLevels;if(direction===Crocodoc.ZOOM_IN){for(i=0;i<zoomLevels.length;++i){if(zoomLevels[i]>currentZoom){zoom=zoomLevels[i];break;}}}else if(direction===Crocodoc.ZOOM_OUT){for(i=zoomLevels.length-1;i>=0;--i){if(zoomLevels[i]<currentZoom){zoom=zoomLevels[i];break;}}}
return zoom;},isDraggable:function(){var state=this.state;return(state.viewportDimensions.clientHeight<state.totalHeight)||(state.viewportDimensions.clientWidth<state.totalWidth);},scrollBy:function(left,top){left=parseInt(left,10)||0;top=parseInt(top,10)||0;this.scrollToOffset(left+this.state.scrollLeft,top+this.state.scrollTop);},scrollToOffset:function(left,top){this.$viewport.scrollLeft(left);this.$viewport.scrollTop(top);},handleScroll:function(data){this.state.scrollTop=data.scrollTop;this.state.scrollLeft=data.scrollLeft;},handleResize:function(){},handleScrollEnd:function(){},update:function(){},focus:function(){this.$viewport.focus();},extend:function(layout){return util.extend({},this,layout);}};});Crocodoc.addComponent('layout-'+LAYOUT_HORIZONTAL,['layout-paged'],function(scope,paged){'use strict';var util=scope.getUtility('common'),browser=scope.getUtility('browser');return paged.extend({calculateZoomAutoValue:function(){var state=this.state,fitWidth=this.calculateZoomValue(ZOOM_FIT_WIDTH),fitHeight=this.calculateZoomValue(ZOOM_FIT_HEIGHT);if(state.widestPage.actualWidth>state.tallestPage.actualHeight){return Math.min(fitWidth,fitHeight);}
else{if(browser.mobile){return fitHeight;}
return Math.min(1,fitHeight);}},calculateCurrentPage:function(){var prev,page,state=this.state,pages=state.pages;prev=util.bisectRight(pages,state.scrollLeft,'x0')-1;page=util.bisectRight(pages,state.scrollLeft+pages[prev].width/2,'x0')-1;return 1+page;},calculateNextPage:function(){return this.state.currentPage+1;},calculatePreviousPage:function(){return this.state.currentPage-1;},handleResize:function(data){paged.handleResize.call(this,data);this.updateCurrentPage();},handleScroll:function(data){paged.handleScroll.call(this,data);this.updateCurrentPage();},updateLayout:function(){var state=this.state,zoomState=state.zoomState,zoom=zoomState.zoom,zoomedWidth=state.sumWidths,zoomedHeight=Math.floor(state.tallestPage.totalActualHeight*zoom),docWidth=Math.max(zoomedWidth,state.viewportDimensions.clientWidth),docHeight=Math.max(zoomedHeight,state.viewportDimensions.clientHeight);this.$doc.css({height:docHeight,lineHeight:docHeight+'px',width:docWidth});}});});Crocodoc.addComponent('layout-paged',['layout-base'],function(scope,base){'use strict';var util=scope.getUtility('common'),support=scope.getUtility('support');function applyZoomResize(layout,zoom){var i,len,pageState,cssRule,state=layout.state,selector='.'+layout.config.namespace+' .'+CSS_CLASS_PAGE_AUTOSCALE,stylesheet=layout.config.stylesheet,pages=state.pages,scale=zoom*layout.config.pageScale,percent=100/scale;if(support.csstransform){cssRule=support.csstransform+':scale('+scale+');'+'width:'+percent+'%;'+'height:'+percent+'%;';}else if(support.csszoom){cssRule='zoom:'+scale;}else{cssRule='';}
if(state.previousStyleIndex){util.deleteCSSRule(stylesheet,state.previousStyleIndex);}
state.previousStyleIndex=util.appendCSSRule(stylesheet,selector,cssRule);for(i=0,len=pages.length;i<len;++i){pageState=pages[i];layout.$pages.eq(i).css({width:pageState.actualWidth*zoom,height:pageState.actualHeight*zoom,paddingTop:pageState.paddingTop*zoom,paddingRight:pageState.paddingRight*zoom,paddingBottom:pageState.paddingBottom*zoom,paddingLeft:pageState.paddingLeft*zoom});}}
function getMaxY1InRow(pages,row){if(!row||row.length===0){return Infinity;}
var y1s=util.map(row,function(pageIndex){return pages[pageIndex].y1;});return Math.max.apply(Math,y1s);}
return base.extend({init:function(){base.init.call(this);this.updatePageStates();this.updateZoomLevels();},initState:function(){base.initState.call(this);util.extend(this.state,{pages:[],widestPage:{index:0,actualWidth:0},tallestPage:{index:0,actualHeight:0},sumWidths:0,sumHeights:0,rows:[],currentPage:null,visiblePages:[],fullyVisiblePages:[]});},destroy:function(){base.destroy.call(this);this.$pages.css('padding','');},update:function(){this.updatePageStates(true);this.setZoom();},setZoom:function(val){var state=this.state,zoom=this.parseZoomValue(val),zoomState=state.zoomState,currentZoom=zoomState.zoom,zoomMode,shouldNotCenter;zoomMode=this.calculateZoomMode(val,zoom);zoom=util.clamp(zoom,state.minZoom,state.maxZoom);scope.broadcast('beforezoom',util.extend({page:state.currentPage,visiblePages:util.extend([],state.visiblePages),fullyVisiblePages:util.extend([],state.fullyVisiblePages)},zoomState));zoomState.prevZoom=currentZoom;zoomState.zoom=zoom;zoomState.zoomMode=zoomMode;this.applyZoom(zoom);zoomState.canZoomIn=this.calculateNextZoomLevel(Crocodoc.ZOOM_IN)!==false;zoomState.canZoomOut=this.calculateNextZoomLevel(Crocodoc.ZOOM_OUT)!==false;this.updatePageStates();this.updateLayout();shouldNotCenter=val===Crocodoc.ZOOM_AUTO||val===Crocodoc.ZOOM_FIT_WIDTH||val===Crocodoc.ZOOM_FIT_HEIGHT;this.updateScrollPosition(shouldNotCenter);this.updatePageStates();this.updateVisiblePages(true);scope.broadcast('zoom',util.extend({page:state.currentPage,visiblePages:util.extend([],state.visiblePages),fullyVisiblePages:util.extend([],state.fullyVisiblePages),isDraggable:this.isDraggable()},zoomState));},parseZoomValue:function(val){var zoomVal=parseFloat(val),state=this.state,zoomState=state.zoomState,currentZoom=zoomState.zoom,nextZoom=currentZoom;if(zoomVal){nextZoom=zoomVal;}else{switch(val){case Crocodoc.ZOOM_FIT_WIDTH:case Crocodoc.ZOOM_FIT_HEIGHT:case Crocodoc.ZOOM_AUTO:nextZoom=this.calculateZoomValue(val);break;case Crocodoc.ZOOM_IN:case Crocodoc.ZOOM_OUT:nextZoom=this.calculateNextZoomLevel(val)||currentZoom;break;default:if(!currentZoom){nextZoom=this.calculateZoomValue(this.config.zoom||Crocodoc.ZOOM_AUTO);}
else if(zoomState.zoomMode){nextZoom=this.calculateZoomValue(zoomState.zoomMode);}else{nextZoom=currentZoom;}
break;}}
return nextZoom;},calculateZoomMode:function(val,parsedZoom){switch(parsedZoom){case this.calculateZoomValue(Crocodoc.ZOOM_AUTO):if(typeof val==='string'&&(val===Crocodoc.ZOOM_FIT_WIDTH||val===Crocodoc.ZOOM_FIT_HEIGHT))
{return val;}
return Crocodoc.ZOOM_AUTO;case this.calculateZoomValue(Crocodoc.ZOOM_FIT_WIDTH):return Crocodoc.ZOOM_FIT_WIDTH;case this.calculateZoomValue(Crocodoc.ZOOM_FIT_HEIGHT):return Crocodoc.ZOOM_FIT_HEIGHT;default:return null;}},updateZoomLevels:function(){var i,lastZoomLevel,zoomLevels=this.config.zoomLevels.slice()||[1],auto=this.calculateZoomValue(Crocodoc.ZOOM_AUTO),fitWidth=this.calculateZoomValue(Crocodoc.ZOOM_FIT_WIDTH),fitHeight=this.calculateZoomValue(Crocodoc.ZOOM_FIT_HEIGHT),presets=[fitWidth,fitHeight];this.state.minZoom=this.config.minZoom||zoomLevels[0];this.state.maxZoom=this.config.maxZoom||zoomLevels[zoomLevels.length-1];if(auto!==fitWidth&&auto!==fitHeight){presets.push(auto);}
zoomLevels=zoomLevels.concat(presets);zoomLevels.sort(function sortZoomLevels(a,b){return a-b;});this.zoomLevels=[];function shouldUseZoomLevel(zoomLevel){var similarity=lastZoomLevel/zoomLevel;if(zoomLevel===lastZoomLevel){return false;}
if(similarity<ZOOM_LEVEL_SIMILARITY_THRESHOLD){return true;}
if(util.inArray(zoomLevel,presets)>-1){if(similarity<ZOOM_LEVEL_PRESETS_SIMILARITY_THRESHOLD){return true;}}
return false;}
lastZoomLevel=0;for(i=0;i<zoomLevels.length;++i){if(shouldUseZoomLevel(zoomLevels[i])){lastZoomLevel=zoomLevels[i];this.zoomLevels.push(lastZoomLevel);}}},calculateZoomValue:function(mode){var state=this.state,val=parseFloat(mode);if(val){return val;}
if(mode===Crocodoc.ZOOM_FIT_WIDTH){return state.viewportDimensions.clientWidth/state.widestPage.totalActualWidth;}
else if(mode===Crocodoc.ZOOM_FIT_HEIGHT){return state.viewportDimensions.clientHeight/state.tallestPage.totalActualHeight;}
else if(mode===Crocodoc.ZOOM_AUTO){return this.calculateZoomAutoValue();}else{return state.zoomState.zoom;}},applyZoom:function(zoom){applyZoomResize(this,zoom);},scrollTo:function(val){var state=this.state,pageNum=parseInt(val,10);if(typeof val==='string'){if(val===Crocodoc.SCROLL_PREVIOUS&&state.currentPage>1){pageNum=this.calculatePreviousPage();}
else if(val===Crocodoc.SCROLL_NEXT&&state.currentPage<this.numPages){pageNum=this.calculateNextPage();}
else if(!pageNum){return;}}
else if(!pageNum&&pageNum!==0){return;}
pageNum=util.clamp(pageNum,1,this.numPages);this.scrollToPage(pageNum);},scrollToPage:function(page){var offset=this.calculateScrollPositionForPage(page);this.scrollToOffset(offset.left,offset.top);},calculateCurrentPage:function(){return this.state.currentPage;},calculateScrollPositionForPage:function(pageNum){var index=util.clamp(pageNum-1,0,this.numPages-1),page=this.state.pages[index];return{top:page.y0,left:page.x0};},calculateVisibleRange:function(){var state=this.state,pages=state.pages,viewportHeight=state.viewportDimensions.clientHeight,viewportWidth=state.viewportDimensions.clientWidth;if(viewportWidth===0||viewportHeight===0){return{min:-1,max:-1};}
var viewportY0=state.scrollTop,viewportY1=viewportY0+viewportHeight,viewportX0=state.scrollLeft,viewportX1=viewportX0+viewportWidth,lowY=util.bisectLeft(pages,viewportY0,'y1'),highY=util.bisectRight(pages,viewportY1,'y0')-1,lowX=util.bisectLeft(pages,viewportX0,'x1'),highX=util.bisectRight(pages,viewportX1,'x0')-1,low=Math.max(lowX,lowY),high=Math.min(highX,highY);return util.constrainRange(low,high,this.numPages-1);},calculateFullyVisibleRange:function(){var state=this.state,pages=state.pages,viewportHeight=state.viewportDimensions.clientHeight,viewportWidth=state.viewportDimensions.clientWidth;if(viewportWidth===0||viewportHeight===0){return{min:-1,max:-1};}
var viewportY0=state.scrollTop,viewportY1=viewportY0+viewportHeight,viewportX0=state.scrollLeft,viewportX1=viewportX0+viewportWidth,lowY=util.bisectLeft(pages,viewportY0,'y0'),highY=util.bisectRight(pages,viewportY1,'y1')-1,lowX=util.bisectLeft(pages,viewportX0,'x0'),highX=util.bisectRight(pages,viewportX1,'x1')-1,low=Math.max(lowX,lowY),high=Math.min(highX,highY);return util.constrainRange(low,high,this.numPages-1);},setCurrentPage:function(page){var state=this.state;if(state.currentPage!==page){state.currentPage=page;this.updateVisiblePages();scope.broadcast('pagefocus',{page:state.currentPage,numPages:this.numPages,visiblePages:util.extend([],state.visiblePages),fullyVisiblePages:util.extend([],state.fullyVisiblePages)});}else{this.updateVisiblePages();}},updateVisiblePages:function(updateClasses){var i,len,$page,state=this.state,visibleRange=this.calculateVisibleRange(),fullyVisibleRange=this.calculateFullyVisibleRange();state.visiblePages.length=0;state.fullyVisiblePages.length=0;for(i=0,len=this.$pages.length;i<len;++i){$page=this.$pages.eq(i);if(i<visibleRange.min||i>visibleRange.max){if(updateClasses&&$page.hasClass(CSS_CLASS_PAGE_VISIBLE)){$page.removeClass(CSS_CLASS_PAGE_VISIBLE);}}else{if(updateClasses&&!$page.hasClass(CSS_CLASS_PAGE_VISIBLE)){$page.addClass(CSS_CLASS_PAGE_VISIBLE);}
state.visiblePages.push(i+1);}
if(i>=fullyVisibleRange.min&&i<=fullyVisibleRange.max){state.fullyVisiblePages.push(i+1);}}},updatePageStates:function(forceUpdatePaddings){var state=this.state,pages=state.pages,rows=state.rows,scrollTop=this.$viewport.scrollTop(),scrollLeft=this.$viewport.scrollLeft(),rowIndex=0,lastY1=0,rightmostPageIndex=0,bottommostPageIndex=0,i,len,page,pageEl,$pageEl;rows.length=state.sumWidths=state.sumHeights=state.totalWidth=state.totalHeight=0;state.widestPage.totalActualWidth=state.tallestPage.totalActualHeight=0;for(i=0,len=this.$pages.length;i<len;++i){$pageEl=this.$pages.eq(i);pageEl=$pageEl[0];page=pages[i];if(!page||forceUpdatePaddings){$pageEl.css('padding','');page={index:i,paddingLeft:parseFloat($pageEl.css(STYLE_PADDING_LEFT)),paddingRight:parseFloat($pageEl.css(STYLE_PADDING_RIGHT)),paddingTop:parseFloat($pageEl.css(STYLE_PADDING_TOP)),paddingBottom:parseFloat($pageEl.css(STYLE_PADDING_BOTTOM))};}
if(!page.actualWidth){page.actualWidth=parseFloat(pageEl.getAttribute('data-width'));}
if(!page.actualHeight){page.actualHeight=parseFloat(pageEl.getAttribute('data-height'));}
page.totalActualWidth=page.actualWidth+page.paddingLeft+page.paddingRight;page.totalActualHeight=page.actualHeight+page.paddingTop+page.paddingBottom;page.width=pageEl.offsetWidth;page.height=pageEl.offsetHeight;page.x0=pageEl.offsetLeft;page.y0=pageEl.offsetTop;page.x1=page.width+page.x0;page.y1=page.height+page.y0;if(lastY1&&getMaxY1InRow(pages,rows[rowIndex])<=page.y0+2){rowIndex++;}
lastY1=page.y1;if(!rows[rowIndex]){rows[rowIndex]=[];}
if(page.totalActualWidth>state.widestPage.totalActualWidth){state.widestPage=page;}
if(page.totalActualHeight>state.tallestPage.totalActualHeight){state.tallestPage=page;}
state.sumWidths+=page.width;state.sumHeights+=page.height;page.rowIndex=rowIndex;pages[i]=page;rows[rowIndex].push(i);if(pages[rightmostPageIndex].x0+pages[rightmostPageIndex].width<page.x0+page.width){rightmostPageIndex=i;}
if(pages[bottommostPageIndex].y0+pages[bottommostPageIndex].height<page.y0+page.height){bottommostPageIndex=i;}}
state.totalWidth=pages[rightmostPageIndex].x0+pages[rightmostPageIndex].width;state.totalHeight=pages[bottommostPageIndex].y0+pages[bottommostPageIndex].height;state.scrollTop=scrollTop;state.scrollLeft=scrollLeft;this.setCurrentPage(this.calculateCurrentPage());},updateCurrentPage:function(){var currentPage=this.calculateCurrentPage();this.setCurrentPage(currentPage);},handleResize:function(data){var zoomMode=this.state.zoomState.zoomMode;this.state.viewportDimensions=data;this.updateZoomLevels();this.setZoom(zoomMode);},handleScrollEnd:function(data){this.$doc.find('.'+CSS_CLASS_CURRENT_PAGE).removeClass(CSS_CLASS_CURRENT_PAGE);this.$pages.eq(this.state.currentPage-1).addClass(CSS_CLASS_CURRENT_PAGE);this.updateVisiblePages(true);this.handleScroll(data);},updateScrollPosition:function(shouldNotCenter){var state=this.state,zoomState=state.zoomState,ratio=zoomState.zoom/zoomState.prevZoom,newScrollLeft,newScrollTop;newScrollLeft=state.scrollLeft*ratio;newScrollTop=state.scrollTop*ratio;if(shouldNotCenter!==true){newScrollTop+=state.viewportDimensions.offsetHeight*(ratio-1)/2;newScrollLeft+=state.viewportDimensions.offsetWidth*(ratio-1)/2;}
this.scrollToOffset(newScrollLeft,newScrollTop);},updateLayout:function(){},calculateZoomAutoValue:function(){return 1;},calculateNextPage:function(){return 1;},calculatePreviousPage:function(){return 1;}});});Crocodoc.addComponent('layout-'+LAYOUT_PRESENTATION_TWO_PAGE,['layout-'+LAYOUT_PRESENTATION],function(scope,presentation){'use strict';var util=scope.getUtility('common');return presentation.extend({init:function(){this.twoPageMode=true;presentation.init.call(this);},calculateNextPage:function(){return this.state.currentPage+2;},calculatePreviousPage:function(){return this.state.currentPage-2;},calculateZoomValue:function(mode){var baseVal=presentation.calculateZoomValue.call(this,mode);if(mode===ZOOM_FIT_WIDTH){baseVal/=2;}
return baseVal;},scrollToPage:function(page){presentation.scrollToPage.call(this,page-(page+1)%2);},calculateVisibleRange:function(){var min=this.state.currentPage-1,max=min+1;return util.constrainRange(min,max,this.numPages);},calculateFullyVisibleRange:function(){return this.calculateVisibleRange();}});});Crocodoc.addComponent('layout-'+LAYOUT_PRESENTATION,['layout-paged'],function(scope,paged){'use strict';var util=scope.getUtility('common');return paged.extend({init:function(){paged.init.call(this);this.updatePageMargins();this.updatePageClasses();},destroy:function(){paged.destroy.call(this);this.$pages.css({margin:'',left:''}).removeClass(PRESENTATION_CSS_CLASSES);},calculateZoomAutoValue:function(){var fitWidth=this.calculateZoomValue(ZOOM_FIT_WIDTH),fitHeight=this.calculateZoomValue(ZOOM_FIT_HEIGHT);return Math.min(fitWidth,fitHeight);},calculateCurrentPage:function(){return this.state.currentPage;},calculateNextPage:function(){return this.state.currentPage+1;},calculatePreviousPage:function(){return this.state.currentPage-1;},calculateVisibleRange:function(){var index=this.state.currentPage-1;return util.constrainRange(index,index,this.numPages);},calculateFullyVisibleRange:function(){return this.calculateVisibleRange();},setCurrentPage:function(page){var index=util.clamp(page-1,0,this.numPages),$precedingPage,$currentPage;paged.setCurrentPage.call(this,page);this.$doc.find('.'+CSS_CLASS_PRECEDING_PAGE).removeClass(CSS_CLASS_PRECEDING_PAGE);$precedingPage=this.$doc.find('.'+CSS_CLASS_CURRENT_PAGE);$currentPage=this.$pages.eq(index);if($precedingPage[0]!==$currentPage[0]){$precedingPage.addClass(CSS_CLASS_PRECEDING_PAGE).removeClass(CSS_CLASS_CURRENT_PAGE);$currentPage.addClass(CSS_CLASS_CURRENT_PAGE);}
this.updateVisiblePages(true);this.updatePageClasses(index);},scrollToPage:function(page){this.setCurrentPage(page);},updateLayout:function(){var state=this.state,zoomState=state.zoomState,zoom=zoomState.zoom,page=this.currentPage||1,currentPage=state.pages[page-1],secondPage=this.twoPageMode?state.pages[page]:currentPage,viewportWidth=state.viewportDimensions.clientWidth,viewportHeight=state.viewportDimensions.clientHeight,secondPageWidth,currentPageWidth,currentPageHeight,zoomedWidth,zoomedHeight,docWidth,docHeight;secondPageWidth=secondPage.actualWidth;currentPageWidth=currentPage.actualWidth+(this.twoPageMode?secondPageWidth:0);currentPageHeight=currentPage.actualHeight;zoomedWidth=Math.floor((currentPageWidth+currentPage.paddingLeft+secondPage.paddingRight)*zoom);zoomedHeight=Math.floor((currentPage.totalActualHeight)*zoom);docWidth=Math.max(zoomedWidth,viewportWidth);docHeight=Math.max(zoomedHeight,viewportHeight);this.$doc.css({width:docWidth,height:docHeight});this.updatePageMargins();if(docWidth>viewportWidth||docHeight>viewportHeight){this.$el.addClass('crocodoc-scrollable');}else{this.$el.removeClass('crocodoc-scrollable');}},updatePageMargins:function(){var i,len,page,$page,width,height,left,top,paddingH,state=this.state,viewportWidth=state.viewportDimensions.clientWidth,viewportHeight=state.viewportDimensions.clientHeight;for(i=0,len=this.$pages.length;i<len;++i){$page=this.$pages.eq(i);page=state.pages[i];if(this.twoPageMode){paddingH=(i%2===1)?page.paddingRight:page.paddingLeft;}else{paddingH=page.paddingRight+page.paddingLeft;}
width=(page.actualWidth+paddingH)*state.zoomState.zoom;height=(page.actualHeight+page.paddingTop+page.paddingBottom)*state.zoomState.zoom;if(this.twoPageMode){left=Math.max(0,(viewportWidth-width*2)/2);if(i%2===1){left+=width;}}else{left=(viewportWidth-width)/2;}
top=(viewportHeight-height)/2;left=Math.max(left,0);top=Math.max(top,0);$page.css({marginLeft:left,marginTop:top});}},updatePageClasses:function(){var $pages=this.$pages,index=this.state.currentPage-1,next=index+1,prev=index-1,buffer=20;$pages.removeClass(PRESENTATION_CSS_CLASSES);if(this.twoPageMode){next=index+2;prev=index-2;$pages.slice(Math.max(prev,0),index).addClass(CSS_CLASS_PAGE_PREV);$pages.slice(next,next+2).addClass(CSS_CLASS_PAGE_NEXT);}else{if(prev>=0){$pages.eq(prev).addClass(CSS_CLASS_PAGE_PREV);}
if(next<this.numPages){$pages.eq(next).addClass(CSS_CLASS_PAGE_NEXT);}}
$pages.slice(0,index).addClass(CSS_CLASS_PAGE_BEFORE);$pages.slice(Math.max(0,index-buffer),index).addClass(CSS_CLASS_PAGE_BEFORE_BUFFER);$pages.slice(next).addClass(CSS_CLASS_PAGE_AFTER);$pages.slice(next,Math.min(this.numPages,next+buffer)).addClass(CSS_CLASS_PAGE_AFTER_BUFFER);}});});Crocodoc.addComponent('layout-'+LAYOUT_TEXT,['layout-base'],function(scope,base){'use strict';var util=scope.getUtility('common');return base.extend({init:function(){base.init.call(this);this.zoomLevels=this.config.zoomLevels.slice();this.minZoom=this.zoomLevels[0];this.maxZoom=this.zoomLevels[this.zoomLevels.length-1];},setZoom:function(val){var z,zoomState=this.state.zoomState,currentZoom=zoomState.zoom;if(typeof val==='string'){z=this.calculateNextZoomLevel(val);if(!z){if(val==='auto'||val==='fitwidth'||val==='fitheight'){z=1;}else{z=currentZoom;}}}else{z=parseFloat(val)||currentZoom;}
z=util.clamp(z,this.minZoom,this.maxZoom);this.config.$doc.css('font-size',(z*10)+'pt');zoomState.prevZoom=currentZoom;zoomState.zoom=z;zoomState.canZoomIn=this.calculateNextZoomLevel(Crocodoc.ZOOM_IN)!==false;zoomState.canZoomOut=this.calculateNextZoomLevel(Crocodoc.ZOOM_OUT)!==false;scope.broadcast('zoom',util.extend({isDraggable:this.isDraggable()},zoomState));}});});Crocodoc.addComponent('layout-'+LAYOUT_VERTICAL_SINGLE_COLUMN,['layout-'+LAYOUT_VERTICAL],function(scope,vertical){'use strict';return vertical;});Crocodoc.addComponent('layout-'+LAYOUT_VERTICAL,['layout-paged'],function(scope,paged){'use strict';var util=scope.getUtility('common'),browser=scope.getUtility('browser');return paged.extend({calculateZoomAutoValue:function(){var state=this.state,fitWidth=this.calculateZoomValue(ZOOM_FIT_WIDTH),fitHeight=this.calculateZoomValue(ZOOM_FIT_HEIGHT);if(state.widestPage.actualWidth>state.tallestPage.actualHeight){return Math.min(1,fitWidth,fitHeight);}else{if(browser.mobile){return fitWidth;}
return Math.min(1,fitWidth);}},calculateCurrentPage:function(){var prevPageIndex,currentPageIndex,rowIndex,row,offset,state=this.state,pages=state.pages;prevPageIndex=util.bisectRight(pages,state.scrollTop,'y0')-1;if(prevPageIndex<0){return 1;}
offset=state.scrollTop+pages[prevPageIndex].height/2;currentPageIndex=util.bisectRight(pages,offset,'y0')-1;rowIndex=pages[currentPageIndex].rowIndex;row=state.rows[rowIndex];return 1+row[0];},calculateNextPage:function(){var state=this.state,currentPage=state.pages[state.currentPage-1],rowIndex=currentPage.rowIndex,nextRow=state.rows[rowIndex+1];return nextRow&&nextRow[0]+1||state.currentPage;},calculatePreviousPage:function(){var state=this.state,currentPage=state.pages[state.currentPage-1],rowIndex=currentPage.rowIndex,prevRow=state.rows[rowIndex-1];return prevRow&&prevRow[0]+1||state.currentPage;},handleResize:function(data){paged.handleResize.call(this,data);this.updateCurrentPage();},handleScroll:function(data){paged.handleScroll.call(this,data);this.updateCurrentPage();},updateLayout:function(){var state=this.state,zoom=state.zoomState.zoom,zoomedWidth,docWidth;zoomedWidth=Math.floor(state.widestPage.totalActualWidth*zoom);if(zoomedWidth<=state.viewportDimensions.clientWidth){docWidth='auto';}else{docWidth=zoomedWidth;}
this.$doc.css({width:docWidth});}});});Crocodoc.addComponent('lazy-loader',function(scope){'use strict';var util=scope.getUtility('common'),browser=scope.getUtility('browser'),api={},pages,numPages,pagefocusTriggerLoadingTID,readyTriggerLoadingTID,pageLoadTID,pageLoadQueue=[],pageLoadRange=1,pageLoadingStopped=true,scrollDirection=1,ready=false,layoutState={page:1,visiblePages:[1]};function calculateRange(range){range=range||pageLoadRange;var currentIndex=layoutState.page-1,low=currentIndex-range,high=currentIndex+range;return util.constrainRange(low,high,numPages-1);}
function pageLoadLoop(){var index;clearTimeout(pageLoadTID);if(pageLoadQueue.length>0){index=pageLoadQueue.shift();if(pages[index]){api.loadPage(index,function loadPageCallback(pageIsLoading){if(pageIsLoading===false){pageLoadLoop();}else{pageLoadTID=setTimeout(pageLoadLoop,PAGE_LOAD_INTERVAL);}});}else{pageLoadLoop();}}else{stopPageLoadLoop();}}
function startPageLoadLoop(){clearTimeout(pageLoadTID);pageLoadingStopped=false;pageLoadTID=setTimeout(pageLoadLoop,PAGE_LOAD_INTERVAL);}
function stopPageLoadLoop(){clearTimeout(pageLoadTID);pageLoadingStopped=true;}
function pushPageLoadQueue(index){pageLoadQueue.push(index);if(pageLoadingStopped){startPageLoadLoop();}}
function clearPageLoadQueue(){pageLoadQueue.length=0;stopPageLoadLoop();}
function indexInRange(index,rangeLength){var range=calculateRange(rangeLength);if(index>=range.min&&index<=range.max){return true;}
return false;}
function shouldLoadPage(index){var page=pages[index];if(page){if(indexInRange(index)){return true;}
if(pageIsVisible(index)){return true;}}
return false;}
function shouldUnloadPage(index,rangeLength){if(indexInRange(index,rangeLength)){return false;}
if(pageIsVisible(index)){return false;}
return true;}
function pageIsVisible(index){return util.inArray(index+1,layoutState.visiblePages)>-1;}
function queuePagesToLoadInOrder(start,end){var increment=util.sign(end-start);while(start!==end){api.queuePageToLoad(start);start+=increment;}
api.queuePageToLoad(start);}
return util.extend(api,{messages:['beforezoom','pageavailable','pagefocus','ready','scroll','scrollend','zoom'],onmessage:function(name,data){switch(name){case'beforezoom':this.handleBeforeZoom(data);break;case'pageavailable':this.handlePageAvailable(data);break;case'pagefocus':this.handlePageFocus(data);break;case'ready':this.handleReady();break;case'scroll':this.handleScroll();break;case'scrollend':this.handleScrollEnd();break;case'zoom':this.handleZoom(data);break;}},init:function(pageComponents){pages=pageComponents;numPages=pages.length;pageLoadRange=(browser.mobile||browser.ielt10)?MAX_PAGE_LOAD_RANGE_MOBILE:MAX_PAGE_LOAD_RANGE;pageLoadRange=Math.min(pageLoadRange,numPages);},destroy:function(){this.cancelAllLoading();},updateLayoutState:function(state){scrollDirection=util.sign(state.page-layoutState.page);layoutState=state;},loadNecessaryPages:util.debounce(100,function(){this.cancelAllLoading();this.queuePageToLoad(layoutState.page-1);this.loadVisiblePages();this.loadPagesInRange(pageLoadRange);}),loadPagesInRange:function(range){var currentIndex=layoutState.page-1;if(range>0){range=calculateRange(range);if(scrollDirection>=0){queuePagesToLoadInOrder(currentIndex+1,range.max);queuePagesToLoadInOrder(currentIndex-1,range.min);}else{queuePagesToLoadInOrder(currentIndex-1,range.min);queuePagesToLoadInOrder(currentIndex+1,range.max);}}},loadVisiblePages:function(){var i,len;for(i=0,len=layoutState.visiblePages.length;i<len;++i){this.queuePageToLoad(layoutState.visiblePages[i]-1);}},queuePageToLoad:function(index){if(shouldLoadPage(index)){pages[index].preload();pushPageLoadQueue(index);}},cancelAllLoading:function(){clearTimeout(readyTriggerLoadingTID);clearTimeout(pagefocusTriggerLoadingTID);clearPageLoadQueue();},loadPage:function(index,callback){$.when(pages[index]&&pages[index].load()).always(callback);},unloadPage:function(index){var page=pages[index];if(page){page.unload();}},unloadUnnecessaryPages:function(rangeLength){var i,l;for(i=0,l=pages.length;i<l;++i){if(shouldUnloadPage(i,rangeLength)){this.unloadPage(i);}}},handleReady:function(){ready=true;this.loadVisiblePages();readyTriggerLoadingTID=setTimeout(function(){api.loadNecessaryPages();},READY_TRIGGER_PRELOADING_DELAY);},handlePageAvailable:function(data){if(!ready){return;}
var i;if(data.all===true){data.upto=numPages;}
if(data.page){this.queuePageToLoad(data.page-1);}else if(data.upto){for(i=0;i<data.upto;++i){this.queuePageToLoad(i);}}},handlePageFocus:function(data){this.updateLayoutState(data);if(!ready){return;}
this.cancelAllLoading();pagefocusTriggerLoadingTID=setTimeout(function(){api.loadNecessaryPages();},200);},handleBeforeZoom:function(data){if(!ready){return;}
this.cancelAllLoading();this.unloadUnnecessaryPages(data.visiblePages.length*2);},handleZoom:function(data){this.updateLayoutState(data);if(!ready){return;}
this.loadNecessaryPages();},handleScroll:function(){this.cancelAllLoading();},handleScrollEnd:function(){if(!ready){return;}
this.loadNecessaryPages();this.unloadUnnecessaryPages(pageLoadRange);}});});Crocodoc.addComponent('page-img',function(scope){'use strict';var browser=scope.getUtility('browser');var $img,$el,$loadImgPromise,page,imageLoaded=false,removeOnUnload=browser.mobile;return{init:function(el,pageNum){$el=$(el);page=pageNum;},destroy:function(){removeOnUnload=true;this.unload();$el.empty();},prepare:function(){},preload:function(){if(!$loadImgPromise){$loadImgPromise=scope.get('page-img',page);}},load:function(){this.preload();$loadImgPromise.done(function loadImgSuccess(img){if(!imageLoaded){imageLoaded=true;$img=$(img).appendTo($el);}});$loadImgPromise.fail(function loadImgFail(error){imageLoaded=false;if(error){scope.broadcast('asseterror',error);}});return $loadImgPromise;},unload:function(){if($loadImgPromise){$loadImgPromise.abort();$loadImgPromise=null;}
if(removeOnUnload){if($img){$img.remove();$img=null;}
imageLoaded=false;}}};});Crocodoc.addComponent('page-links',function(scope){'use strict';var $el,browser=scope.getUtility('browser');function createLink(link){var $link=$('<a>').addClass(CSS_CLASS_PAGE_LINK),left=link.bbox[0],top=link.bbox[1],attr={};if(browser.ie){$('<span>').appendTo($link).on('click',handleClick);}
$link.css({left:left+'pt',top:top+'pt',width:link.bbox[2]-left+'pt',height:link.bbox[3]-top+'pt'});if(link.uri){if(/^http|^mailto/.test(link.uri)){attr.href=encodeURI(link.uri);attr.target='_blank';attr.rel='noreferrer';}else{return;}}else if(link.destination){attr.href='#page-'+link.destination.pagenum;}
$link.attr(attr);$link.data('link',link);$link.appendTo($el);}
function handleClick(event){var targetEl=browser.ie?event.target.parentNode:event.target,$link=$(targetEl),data=$link.data('link');if(data){scope.broadcast('linkclick',data);}
event.preventDefault();}
return{init:function(el,links){$el=$(el);this.createLinks(links);if(!browser.ie){$el.on('click','.'+CSS_CLASS_PAGE_LINK,handleClick);}},destroy:function(){$el.empty().off('click');$el=browser=null;},createLinks:function(links){var i,len;for(i=0,len=links.length;i<len;++i){createLink(links[i]);}}};});Crocodoc.addComponent('page-svg',function(scope){'use strict';var browser=scope.getUtility('browser'),DOMParser=window.DOMParser;var $svg,$svgLayer,$loadSVGPromise,page,destroyed=false,unloaded=false,svgLoaded=false,viewerConfig=scope.getConfig(),removeOnUnload=browser.mobile||browser.ielt10,embedStrategy=browser.ielt11||browser.firefox?EMBED_STRATEGY_DATA_URL_IMG:EMBED_STRATEGY_IFRAME_INNERHTML;function createSVGEl(){switch(embedStrategy){case EMBED_STRATEGY_IFRAME_INNERHTML:case EMBED_STRATEGY_IFRAME_PROXY:return $('<iframe>');case EMBED_STRATEGY_DATA_URL_PROXY:case EMBED_STRATEGY_DATA_URL:return $('<object>').attr({type:SVG_MIME_TYPE,data:'data:'+SVG_MIME_TYPE+';base64,'+window.btoa(SVG_CONTAINER_TEMPLATE)});case EMBED_STRATEGY_INLINE_SVG:return $('<div>');case EMBED_STRATEGY_BASIC_OBJECT:return $('<object>');case EMBED_STRATEGY_BASIC_IMG:case EMBED_STRATEGY_DATA_URL_IMG:return $('<img>');}}
function prepareSVGContainer(){if(!$svg||$svg.length===0){svgLoaded=false;$svg=createSVGEl();}
if($svg.parent().length===0){$svg.appendTo($svgLayer);}}
function loadSVGText(){if(svgLoaded||embedStrategy===EMBED_STRATEGY_BASIC_OBJECT||embedStrategy===EMBED_STRATEGY_BASIC_IMG)
{return $.Deferred().resolve().promise({abort:function(){}});}else{return scope.get('page-svg',page);}}
function fixUseElements(contentDocument){var useEls=contentDocument.querySelectorAll('use');[].forEach.call(useEls,function(use){var id=use.getAttribute('xlink:href'),image=contentDocument.querySelector(id).cloneNode(),parent=use.parentNode;image.removeAttribute('id');image.setAttribute('transform',use.getAttribute('transform'));parent.replaceChild(image,use);});}
function embedSVG(svgText){var domParser,svgDoc,svgEl,html,dataURLPrefix,contentDocument=$svg[0].contentDocument,contentWindow=$svg[0].contentWindow||contentDocument&&contentDocument.defaultView;switch(embedStrategy){case EMBED_STRATEGY_IFRAME_INNERHTML:if(browser.ielt10){svgText=svgText.replace(/<xhtml:link.*/,'');}
html=HTML_TEMPLATE+svgText;if(browser.ielt10){contentDocument.body.innerHTML=html;}else{contentDocument.documentElement.innerHTML=html;if((browser.ios||browser.safari)&&browser.version<7){fixUseElements(contentDocument);}}
svgEl=contentDocument.getElementsByTagName('svg')[0];break;case EMBED_STRATEGY_IFRAME_PROXY:contentDocument.documentElement.innerHTML=HTML_TEMPLATE;var head=contentDocument.getElementsByTagName('head')[0]||contentDocument.documentElement,script=contentDocument.createElement('script'),data='('+proxySVG+')()';script.type='text/javascript';try{script.appendChild(document.createTextNode(data));}catch(e){script.text=data;}
head.insertBefore(script,head.firstChild);if(contentDocument.readyState==='complete'){contentWindow.loadSVG(svgText);}else{contentWindow.onload=function(){this.loadSVG(svgText);};}
return;case EMBED_STRATEGY_DATA_URL:domParser=new DOMParser();svgDoc=domParser.parseFromString(svgText,SVG_MIME_TYPE);svgEl=contentDocument.importNode(svgDoc.documentElement,true);contentDocument.documentElement.appendChild(svgEl);break;case EMBED_STRATEGY_DATA_URL_PROXY:contentWindow.loadSVG(svgText);svgEl=contentDocument.querySelector('svg');break;case EMBED_STRATEGY_INLINE_SVG:domParser=new DOMParser();svgDoc=domParser.parseFromString(svgText,SVG_MIME_TYPE);svgEl=document.importNode(svgDoc.documentElement,true);$svg.append(svgEl);break;case EMBED_STRATEGY_BASIC_OBJECT:$svg.attr({type:SVG_MIME_TYPE,data:scope.getDataProvider('page-svg').getURL(page)});svgEl=$svg[0];break;case EMBED_STRATEGY_BASIC_IMG:svgEl=$svg[0];svgEl.src=scope.getDataProvider('page-svg').getURL(page);break;case EMBED_STRATEGY_DATA_URL_IMG:svgEl=$svg[0];dataURLPrefix='data:'+SVG_MIME_TYPE;if(!browser.ie&&window.btoa){svgEl.src=dataURLPrefix+';base64,'+window.btoa(svgText);}else{svgEl.src=dataURLPrefix+','+encodeURIComponent(svgText);}
break;}
svgEl.setAttribute('width','100%');svgEl.setAttribute('height','100%');}
function loadSVGSuccess(text){if(!destroyed&&!unloaded){if(!svgLoaded&&text){embedSVG(text);svgLoaded=true;if(!removeOnUnload){$loadSVGPromise.abort();$loadSVGPromise=null;}}
if($svg.parent().length===0){$svg.appendTo($svgLayer);}}}
function loadSVGFail(error){scope.broadcast('asseterror',error);svgLoaded=false;if($loadSVGPromise){$loadSVGPromise.abort();}}
return{init:function($el,pageNum){$svgLayer=$el;page=pageNum;embedStrategy=viewerConfig.embedStrategy||embedStrategy;},destroy:function(){destroyed=true;removeOnUnload=true;this.unload();$svgLayer.empty();},prepare:function(){prepareSVGContainer();},preload:function(){this.prepare();if(!$loadSVGPromise){$loadSVGPromise=loadSVGText();}},load:function(){unloaded=false;this.preload();$loadSVGPromise.done(loadSVGSuccess).fail(loadSVGFail);return $loadSVGPromise;},unload:function(){unloaded=true;if($loadSVGPromise&&$loadSVGPromise.state()!=='resolved'){$loadSVGPromise.abort();$loadSVGPromise=null;}
if(removeOnUnload){if($svg){$svg.remove();$svg=null;}
svgLoaded=false;}}};});Crocodoc.addComponent('page-text',function(scope){'use strict';var browser=scope.getUtility('browser'),subpx=scope.getUtility('subpx');var destroyed=false,loaded=false,$textLayer,$loadTextPromise,page,viewerConfig=scope.getConfig();function shouldUseTextLayer(){return viewerConfig.enableTextSelection&&!browser.ielt9;}
function loadTextLayerHTMLSuccess(text){var doc,textEl;if(!text||loaded||destroyed){return;}
loaded=true;doc=document.implementation.createHTMLDocument('');doc.getElementsByTagName('body')[0].innerHTML=text;text=null;textEl=document.importNode(doc.querySelector('.'+CSS_CLASS_PAGE_TEXT),true);$textLayer.attr('class',textEl.getAttribute('class'));$textLayer.html(textEl.innerHTML);subpx.fix($textLayer);}
function loadTextLayerHTMLFail(error){if(error){scope.broadcast('asseterror',error);}}
function loadTextLayerHTML(){if(!$loadTextPromise){if(shouldUseTextLayer()){$loadTextPromise=scope.get('page-text',page);}else{$loadTextPromise=$.Deferred().resolve().promise({abort:function(){}});}}
return $loadTextPromise;}
return{init:function($el,pageNum){$textLayer=$el;page=pageNum;},destroy:function(){destroyed=true;this.unload();$textLayer.empty();},preload:function(){loadTextLayerHTML();},load:function(){return loadTextLayerHTML().done(loadTextLayerHTMLSuccess).fail(loadTextLayerHTMLFail);},unload:function(){if($loadTextPromise&&$loadTextPromise.state()!=='resolved'){$loadTextPromise.abort();$loadTextPromise=null;}},enable:function(){$textLayer.css('display','');if($loadTextPromise&&!loaded){$loadTextPromise=null;}},disable:function(){$textLayer.css('display','none');}};});Crocodoc.addComponent('page',function(scope){'use strict';var support=scope.getUtility('support'),util=scope.getUtility('common');var $el,pageText,pageContent,pageLinks,pageNum,index,isVisible,status,loadRequested=false;return{messages:['pageavailable','pagefocus','textenabledchange','zoom'],onmessage:function(name,data){switch(name){case'pageavailable':if(data.page===index+1||data.upto>index||data.all===true){if(status===PAGE_STATUS_CONVERTING){status=PAGE_STATUS_NOT_LOADED;}}
break;case'textenabledchange':if(data.enabled===true){this.enableTextSelection();}else{this.disableTextSelection();}
break;case'pagefocus':case'zoom':isVisible=pageNum===data.page||(util.inArray(pageNum,data.visiblePages)>-1);break;}},init:function($pageEl,config){var $text,$svg,$links;$el=$pageEl;$svg=$pageEl.find('.'+CSS_CLASS_PAGE_SVG);$text=$pageEl.find('.'+CSS_CLASS_PAGE_TEXT);$links=$pageEl.find('.'+CSS_CLASS_PAGE_LINKS);status=config.status||PAGE_STATUS_NOT_LOADED;index=config.index;pageNum=index+1;this.config=config;config.url=config.url||'';pageText=scope.createComponent('page-text');if(config.useSVG===undefined){config.useSVG=true;}
pageContent=support.svg&&config.useSVG?scope.createComponent('page-svg'):scope.createComponent('page-img');pageText.init($text,pageNum);pageContent.init($svg,pageNum);if(config.enableLinks&&config.links.length){pageLinks=scope.createComponent('page-links');pageLinks.init($links,config.links);}},destroy:function(){this.unload();},preload:function(){pageContent.prepare();if(status===PAGE_STATUS_NOT_LOADED){pageContent.preload();pageText.preload();}},load:function(){var pageComponent=this;loadRequested=true;if(status===PAGE_STATUS_ERROR){return false;}
if(status===PAGE_STATUS_CONVERTING){return false;}
if(status!==PAGE_STATUS_LOADED){status=PAGE_STATUS_LOADING;}
return $.when(pageContent.load(),pageText.load()).done(function handleLoadDone(){if(loadRequested){if(status!==PAGE_STATUS_LOADED){$el.removeClass(CSS_CLASS_PAGE_LOADING);status=PAGE_STATUS_LOADED;scope.broadcast('pageload',{page:pageNum});}}else{pageComponent.unload();}}).fail(function handleLoadFail(error){status=PAGE_STATUS_ERROR;$el.addClass(CSS_CLASS_PAGE_ERROR);scope.broadcast('pagefail',{page:index+1,error:error});});},unload:function(){loadRequested=false;pageContent.unload();pageText.unload();if(status===PAGE_STATUS_LOADED){status=PAGE_STATUS_NOT_LOADED;$el.addClass(CSS_CLASS_PAGE_LOADING);$el.removeClass(CSS_CLASS_PAGE_ERROR);scope.broadcast('pageunload',{page:pageNum});}},enableTextSelection:function(){pageText.enable();if(isVisible){pageText.load();}},disableTextSelection:function(){pageText.disable();}};});Crocodoc.addComponent('resizer',function(scope){'use strict';var util=scope.getUtility('common');var FULLSCREENCHANGE_EVENT=['',' webkit',' moz',' '].join('fullscreenchange')+'MSFullscreenChange';var $window=$(window),$document=$(document),element,frameWidth=0,currentClientWidth,currentClientHeight,currentOffsetWidth,currentOffsetHeight,inIframe=(function(){try{return window.self!==window.top;}catch(e){return true;}})();function broadcast(){scope.broadcast('resize',{width:currentOffsetWidth,height:currentOffsetHeight,clientWidth:currentClientWidth,clientHeight:currentClientHeight,offsetWidth:currentOffsetWidth,offsetHeight:currentOffsetHeight});}
function fixElementPosition(){var style=util.getComputedStyle(element);if(style&&style.position==='static'){$(element).css({position:'relative'});}}
function initResizer(){var $iframe=$('<iframe frameborder="0">'),$div=$('<div>');$iframe.add($div).css({opacity:0,visiblility:'hidden',position:'absolute',width:'100%',height:'100%',top:0,left:0,border:0});$iframe.prependTo($div.prependTo(element));fixElementPosition();$window=$($iframe[0].contentWindow);$window.on('resize',checkResize);}
function checkResize(){var newOffsetHeight=element.offsetHeight,newOffsetWidth=element.offsetWidth;if(inIframe){if(frameWidth===0&&window.innerWidth!==0){frameWidth=window.innerWidth;fixElementPosition();scope.broadcast('layoutchange');return;}}
if(newOffsetHeight){if(newOffsetHeight!==currentOffsetHeight||newOffsetWidth!==currentOffsetWidth){currentOffsetHeight=newOffsetHeight;currentOffsetWidth=newOffsetWidth;currentClientHeight=element.clientHeight;currentClientWidth=element.clientWidth;broadcast();}}}
return{messages:['layoutchange'],onmessage:function(){currentOffsetHeight=null;checkResize();},init:function(el){element=$(el).get(0);if(element===window){element=document.documentElement;$window.on('resize',checkResize);}else{initResizer();}
$document.on(FULLSCREENCHANGE_EVENT,checkResize);checkResize();},destroy:function(){$document.off(FULLSCREENCHANGE_EVENT,checkResize);$window.off('resize',checkResize);}};});Crocodoc.addComponent('scroller',function(scope){'use strict';var util=scope.getUtility('common'),browser=scope.getUtility('browser');var GHOST_SCROLL_TIMEOUT=3000,GHOST_SCROLL_INTERVAL=30,SCROLL_EVENT_THROTTLE_INTERVAL=200,SCROLL_END_TIMEOUT=browser.mobile?500:250;var $el,scrollendTID,scrollingStarted=false,touchStarted=false,touchEnded=false,touchMoved=false,touchEndTime=0,ghostScrollStart=null;function buildEventData(){return{scrollTop:$el.scrollTop(),scrollLeft:$el.scrollLeft()};}
var fireScroll=util.throttle(SCROLL_EVENT_THROTTLE_INTERVAL,function(){scope.broadcast('scroll',buildEventData());});function handleScrollEnd(){scrollingStarted=false;ghostScrollStart=null;clearTimeout(scrollendTID);scope.broadcast('scrollend',buildEventData());}
function handleScroll(){if(!scrollingStarted){scrollingStarted=true;scope.broadcast('scrollstart',buildEventData());}
clearTimeout(scrollendTID);scrollendTID=setTimeout(handleScrollEnd,SCROLL_END_TIMEOUT);fireScroll();}
function handleTouchstart(){touchStarted=true;touchEnded=false;touchMoved=false;handleScroll();}
function handleTouchmove(){touchMoved=true;handleScroll();}
function handleTouchend(){touchStarted=false;touchEnded=true;touchEndTime=new Date().getTime();if(touchMoved){ghostScroll();}}
function ghostScroll(){clearTimeout(scrollendTID);if(ghostScrollStart===null){ghostScrollStart=new Date().getTime();}
if(new Date().getTime()-ghostScrollStart>GHOST_SCROLL_TIMEOUT){handleScrollEnd();return;}
fireScroll();scrollendTID=setTimeout(ghostScroll,GHOST_SCROLL_INTERVAL);}
return{init:function(el){$el=$(el);$el.on('scroll',handleScroll);$el.on('touchstart',handleTouchstart);$el.on('touchmove',handleTouchmove);$el.on('touchend',handleTouchend);},destroy:function(){clearTimeout(scrollendTID);$el.off('scroll',handleScroll);$el.off('touchstart',handleTouchstart);$el.off('touchmove',handleTouchmove);$el.off('touchend',handleTouchend);}};});Crocodoc.addComponent('viewer-base',function(scope){'use strict';var util=scope.getUtility('common'),browser=scope.getUtility('browser'),support=scope.getUtility('support');var api,config,$el,stylesheetEl,layout,scroller,resizer,dragger,$assetsPromise;function setCSSFlags(){$el.attr(ATTR_SVG_VERSION,config.metadata.version||'0.0.0');if(browser.mobile){$el.addClass(CSS_CLASS_MOBILE);}
if(browser.ielt9){$el.addClass(CSS_CLASS_IELT9);}
if(support.svg&&config.useSVG){$el.addClass(CSS_CLASS_SUPPORTS_SVG);}}
function initViewerHTML(){$el.html(Crocodoc.viewerTemplate);if(config.useWindowAsViewport){config.$viewport=$(window);$el.addClass(CSS_CLASS_WINDOW_AS_VIEWPORT);}else{config.$viewport=$el.find('.'+CSS_CLASS_VIEWPORT);}
config.$doc=$el.find('.'+CSS_CLASS_DOC);}
function initPlugins(){var name,plugin,plugins=config.plugins||{};for(name in plugins){plugin=scope.createComponent('plugin-'+name);if(plugin&&util.isFn(plugin.init)){plugin.init(config.plugins[name]);}}}
function completeInit(){setCSSFlags();scroller=scope.createComponent('scroller');scroller.init(config.$viewport);resizer=scope.createComponent('resizer');resizer.init(config.$viewport);var controller;switch(config.metadata.type){case'text':controller=scope.createComponent('controller-text');config.layout=LAYOUT_TEXT;break;case'paged':default:controller=scope.createComponent('controller-paged');break;}
controller.init();if(config.metadata.type==='text'){if(!config.enableTextSelection){api.disableTextSelection();}}else if(browser.ielt9){api.disableTextSelection();}
if(!config.enableLinks||browser.ielt9){api.disableLinks();}
api.setLayout(config.layout);scope.broadcast('ready',{page:config.page||1,numPages:config.numPages});scope.ready();}
function handleLinkClick(data){var event=api.fire('linkclick',data);if(!event.isDefaultPrevented()){if(data.uri){window.open(data.uri);}else if(data.destination){api.scrollTo(data.destination.pagenum);}}}
function updateDragger(isDraggable){if(isDraggable){if(!dragger){$el.addClass(CSS_CLASS_DRAGGABLE);dragger=scope.createComponent('dragger');dragger.init(config.$viewport);}}else{if(dragger){$el.removeClass(CSS_CLASS_DRAGGABLE);scope.destroyComponent(dragger);dragger=null;}}}
function validateQueryParams(){var queryString;if(config.queryParams){if(typeof config.queryParams==='string'){queryString=config.queryParams.replace(/^\?/,'');}else{queryString=util.param(config.queryParams);}}
config.queryString=queryString?'?'+queryString:'';}
return{messages:['asseterror','destroy','dragend','dragstart','fail','layoutchange','linkclick','pagefail','pagefocus','pageload','pageunload','ready','resize','scrollstart','scrollend','zoom'],onmessage:function(name,data){switch(name){case'layoutchange':api.updateLayout();break;case'linkclick':handleLinkClick(data);break;case'zoom':data.zoom*=config.pageScale;data.prevZoom*=config.pageScale;if(config.enableDragging){updateDragger(data.isDraggable);}
api.fire(name,data);break;case'dragstart':if(!$el.hasClass(CSS_CLASS_DRAGGING)){$el.addClass(CSS_CLASS_DRAGGING);}
api.fire(name,data);break;case'dragend':if($el.hasClass(CSS_CLASS_DRAGGING)){$el.removeClass(CSS_CLASS_DRAGGING);}
api.fire(name,data);break;default:api.fire(name,data);break;}},init:function(){config=scope.getConfig();api=config.api;config.namespace=CSS_CLASS_VIEWER+'-'+config.id;$el=config.$el;$el.addClass(CSS_CLASS_VIEWER);$el.addClass(config.namespace);if(config.url){if(!/\/$/.test(config.url)){config.url+='/';}}else{throw new Error('no URL given for viewer assets');}
config.url=scope.getUtility('url').makeAbsolute(config.url);if(config.useSVG===undefined){config.useSVG=true;}
validateQueryParams();initViewerHTML();initPlugins();},destroy:function(){$el.empty().removeClass(function(i,cls){var match=cls.match(new RegExp('crocodoc\\S+','g'));return match&&match.join(' ');});$(stylesheetEl).remove();if($assetsPromise){$assetsPromise.abort();}},setLayout:function(layoutMode){var lastPage=config.page,lastZoom=config.zoom||1,previousLayoutMode=config.layout,newLayout;if(layout){if(layoutMode===previousLayoutMode){return layout;}
lastPage=layout.state.currentPage;lastZoom=layout.state.zoomState;}
newLayout=scope.createComponent('layout-'+layoutMode);if(!newLayout){throw new Error('Invalid layout '+layoutMode);}
if(layout){scope.destroyComponent(layout);}
config.layout=layoutMode;layout=newLayout;layout.init();layout.setZoom(lastZoom.zoomMode||lastZoom.zoom||lastZoom);if(util.isFn(layout.scrollTo)){layout.scrollTo(lastPage);}
config.currentLayout=layout;scope.broadcast('layoutchange',{previousLayout:previousLayoutMode,layout:layoutMode});return layout;},loadAssets:function(){var $loadStylesheetPromise,$loadMetadataPromise,$pageOneContentPromise,$pageOneTextPromise;if($assetsPromise){return;}
$loadMetadataPromise=scope.get('metadata');$loadMetadataPromise.then(function handleMetadataResponse(metadata){config.metadata=metadata;});if(browser.ielt9){stylesheetEl=util.insertCSS('');config.stylesheet=stylesheetEl.styleSheet;$loadStylesheetPromise=$.when('').promise({abort:function(){}});}else{$loadStylesheetPromise=scope.get('stylesheet');$loadStylesheetPromise.then(function handleStylesheetResponse(cssText){stylesheetEl=util.insertCSS(cssText);config.stylesheet=stylesheetEl.sheet;});}
if(config.autoloadFirstPage&&(!config.pageStart||config.pageStart===1)){if(support.svg&&config.useSVG){$pageOneContentPromise=scope.get('page-svg',1);}else if(config.conversionIsComplete){$pageOneContentPromise=scope.get('page-img',1);}
if(config.enableTextSelection){$pageOneTextPromise=scope.get('page-text',1);}}
$assetsPromise=$.when($loadMetadataPromise,$loadStylesheetPromise).fail(function(error){if($assetsPromise){$assetsPromise.abort();}
scope.ready();scope.broadcast('asseterror',error);scope.broadcast('fail',error);}).then(completeInit).promise({abort:function(){$assetsPromise=null;$loadMetadataPromise.abort();$loadStylesheetPromise.abort();if($pageOneContentPromise){$pageOneContentPromise.abort();}
if($pageOneTextPromise){$pageOneTextPromise.abort();}}});}};});return Crocodoc;}));})(typeof window!=='undefined'?window:this);var swfobject=function(){var UNDEF="undefined",OBJECT="object",SHOCKWAVE_FLASH="Shockwave Flash",SHOCKWAVE_FLASH_AX="ShockwaveFlash.ShockwaveFlash",FLASH_MIME_TYPE="application/x-shockwave-flash",EXPRESS_INSTALL_ID="SWFObjectExprInst",ON_READY_STATE_CHANGE="onreadystatechange",win=window,doc=document,nav=navigator,plugin=false,domLoadFnArr=[main],regObjArr=[],objIdArr=[],listenersArr=[],storedAltContent,storedAltContentId,storedCallbackFn,storedCallbackObj,isDomLoaded=false,isExpressInstallActive=false,dynamicStylesheet,dynamicStylesheetMedia,autoHideShow=true,ua=function(){var w3cdom=typeof doc.getElementById!=UNDEF&&typeof doc.getElementsByTagName!=UNDEF&&typeof doc.createElement!=UNDEF,u=nav.userAgent.toLowerCase(),p=nav.platform.toLowerCase(),windows=p?/win/.test(p):/win/.test(u),mac=p?/mac/.test(p):/mac/.test(u),webkit=/webkit/.test(u)?parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,ie=nav.appName==='Microsoft Internet Explorer',playerVersion=[0,0,0],d=null;if(typeof nav.plugins!=UNDEF&&typeof nav.plugins[SHOCKWAVE_FLASH]==OBJECT){d=nav.plugins[SHOCKWAVE_FLASH].description;if(d&&!(typeof nav.mimeTypes!=UNDEF&&nav.mimeTypes[FLASH_MIME_TYPE]&&!nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)){plugin=true;ie=false;d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1");playerVersion[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10);playerVersion[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10);playerVersion[2]=/[a-zA-Z]/.test(d)?parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;}}
else if(typeof win.ActiveXObject!=UNDEF){try{var a=new ActiveXObject(SHOCKWAVE_FLASH_AX);if(a){d=a.GetVariable("$version");if(d){ie=true;d=d.split(" ")[1].split(",");playerVersion=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)];}}}
catch(e){}}
return{w3:w3cdom,pv:playerVersion,wk:webkit,ie:ie,win:windows,mac:mac};}(),onDomLoad=function(){if(!ua.w3){return;}
if((typeof doc.readyState!=UNDEF&&doc.readyState=="complete")||(typeof doc.readyState==UNDEF&&(doc.getElementsByTagName("body")[0]||doc.body))){callDomLoadFunctions();}
if(!isDomLoaded){if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("DOMContentLoaded",callDomLoadFunctions,false);}
if(ua.ie&&ua.win){doc.attachEvent(ON_READY_STATE_CHANGE,function(){if(doc.readyState=="complete"){doc.detachEvent(ON_READY_STATE_CHANGE,arguments.callee);callDomLoadFunctions();}});if(win==top){(function(){if(isDomLoaded){return;}
try{doc.documentElement.doScroll("left");}
catch(e){setTimeout(arguments.callee,0);return;}
callDomLoadFunctions();})();}}
if(ua.wk){(function(){if(isDomLoaded){return;}
if(!/loaded|complete/.test(doc.readyState)){setTimeout(arguments.callee,1000);return;}
callDomLoadFunctions();})();}
addLoadEvent(callDomLoadFunctions);}}();function callDomLoadFunctions(){if(isDomLoaded){return;}
try{var t=doc.getElementsByTagName("body")[0].appendChild(createElement("span"));t.parentNode.removeChild(t);}
catch(e){return;}
isDomLoaded=true;var dl=domLoadFnArr.length;for(var i=0;i<dl;i++){domLoadFnArr[i]();}}
function addDomLoadEvent(fn){if(isDomLoaded){fn();}
else{domLoadFnArr[domLoadFnArr.length]=fn;}}
function addLoadEvent(fn){if(typeof win.addEventListener!=UNDEF){win.addEventListener("load",fn,false);}
else if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("load",fn,false);}
else if(typeof win.attachEvent!=UNDEF){addListener(win,"onload",fn);}
else if(typeof win.onload=="function"){var fnOld=win.onload;win.onload=function(){fnOld();fn();};}
else{win.onload=fn;}}
function main(){setTimeout(function(){if(plugin){testPlayerVersion();}
else{matchVersions();}},0);}
function testPlayerVersion(){var b=doc.getElementsByTagName("body")[0];var o=createElement(OBJECT);o.style.display="none";o.setAttribute("type",FLASH_MIME_TYPE);var t=b.appendChild(o);if(t){var counter=0;(function(){if(typeof t.GetVariable!=UNDEF){var d=t.GetVariable("$version");if(d){d=d.split(" ")[1].split(",");ua.pv=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)];}}
else if(counter<10){counter++;setTimeout(arguments.callee,10);return;}
b.removeChild(o);t=null;matchVersions();})();}
else{matchVersions();}}
function matchVersions(){var rl=regObjArr.length;if(rl>0){for(var i=0;i<rl;i++){var id=regObjArr[i].id;var cb=regObjArr[i].callbackFn;var cbObj={success:false,id:id};if(ua.pv[0]>0){var obj=getElementById(id);if(obj){if(hasPlayerVersion(regObjArr[i].swfVersion)&&!(ua.wk&&ua.wk<312)){setVisibility(id,true);if(cb){cbObj.success=true;cbObj.ref=getObjectById(id);cb(cbObj);}}
else if(regObjArr[i].expressInstall&&canExpressInstall()){var att={};att.data=regObjArr[i].expressInstall;att.width=obj.getAttribute("width")||"0";att.height=obj.getAttribute("height")||"0";if(obj.getAttribute("class")){att.styleclass=obj.getAttribute("class");}
if(obj.getAttribute("align")){att.align=obj.getAttribute("align");}
var par={};var p=obj.getElementsByTagName("param");var pl=p.length;for(var j=0;j<pl;j++){if(p[j].getAttribute("name").toLowerCase()!="movie"){par[p[j].getAttribute("name")]=p[j].getAttribute("value");}}
showExpressInstall(att,par,id,cb);}
else{displayAltContent(obj);if(cb){cb(cbObj);}}}}
else{setVisibility(id,true);if(cb){var o=getObjectById(id);if(o&&typeof o.SetVariable!=UNDEF){cbObj.success=true;cbObj.ref=o;}
cb(cbObj);}}}}}
function getObjectById(objectIdStr){var r=null;var o=getElementById(objectIdStr);if(o&&o.nodeName=="OBJECT"){if(typeof o.SetVariable!=UNDEF){r=o;}
else{var n=o.getElementsByTagName(OBJECT)[0];if(n){r=n;}}}
return r;}
function canExpressInstall(){return!isExpressInstallActive&&hasPlayerVersion("6.0.65")&&(ua.win||ua.mac)&&!(ua.wk&&ua.wk<312);}
function showExpressInstall(att,par,replaceElemIdStr,callbackFn){isExpressInstallActive=true;storedCallbackFn=callbackFn||null;storedCallbackObj={success:false,id:replaceElemIdStr};var obj=getElementById(replaceElemIdStr);if(obj){if(obj.nodeName=="OBJECT"){storedAltContent=abstractAltContent(obj);storedAltContentId=null;}
else{storedAltContent=obj;storedAltContentId=replaceElemIdStr;}
att.id=EXPRESS_INSTALL_ID;if(typeof att.width==UNDEF||(!/%$/.test(att.width)&&parseInt(att.width,10)<310)){att.width="310";}
if(typeof att.height==UNDEF||(!/%$/.test(att.height)&&parseInt(att.height,10)<137)){att.height="137";}
doc.title=doc.title.slice(0,47)+" - Flash Player Installation";var pt=ua.ie&&ua.win?"ActiveX":"PlugIn",fv="MMredirectURL="+win.location.toString().replace(/&/g,"%26")+"&MMplayerType="+pt+"&MMdoctitle="+doc.title;if(typeof par.flashvars!=UNDEF){par.flashvars+="&"+fv;}
else{par.flashvars=fv;}
if(ua.ie&&ua.win&&obj.readyState!=4){var newObj=createElement("div");replaceElemIdStr+="SWFObjectNew";newObj.setAttribute("id",replaceElemIdStr);obj.parentNode.insertBefore(newObj,obj);obj.style.display="none";(function(){if(obj.readyState==4){obj.parentNode.removeChild(obj);}
else{setTimeout(arguments.callee,10);}})();}
createSWF(att,par,replaceElemIdStr);}}
function displayAltContent(obj){if(ua.ie&&ua.win&&obj.readyState!=4){var el=createElement("div");obj.parentNode.insertBefore(el,obj);el.parentNode.replaceChild(abstractAltContent(obj),el);obj.style.display="none";(function(){if(obj.readyState==4){obj.parentNode.removeChild(obj);}
else{setTimeout(arguments.callee,10);}})();}
else{obj.parentNode.replaceChild(abstractAltContent(obj),obj);}}
function abstractAltContent(obj){var ac=createElement("div");if(ua.win&&ua.ie){ac.innerHTML=obj.innerHTML;}
else{var nestedObj=obj.getElementsByTagName(OBJECT)[0];if(nestedObj){var c=nestedObj.childNodes;if(c){var cl=c.length;for(var i=0;i<cl;i++){if(!(c[i].nodeType==1&&c[i].nodeName=="PARAM")&&!(c[i].nodeType==8)){ac.appendChild(c[i].cloneNode(true));}}}}}
return ac;}
function createSWF(attObj,parObj,id){var r,el=getElementById(id);if(ua.wk&&ua.wk<312){return r;}
if(el){if(typeof attObj.id==UNDEF){attObj.id=id;}
if(ua.ie&&ua.win){var att="";for(var i in attObj){if(attObj[i]!=Object.prototype[i]){if(i.toLowerCase()=="data"){parObj.movie=attObj[i];}
else if(i.toLowerCase()=="styleclass"){att+=' class="'+attObj[i]+'"';}
else if(i.toLowerCase()!="classid"){att+=' '+i+'="'+attObj[i]+'"';}}}
var par="";for(var j in parObj){if(parObj[j]!=Object.prototype[j]){par+='<param name="'+j+'" value="'+parObj[j]+'" />';}}
el.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+att+'>'+par+'</object>';objIdArr[objIdArr.length]=attObj.id;r=getElementById(attObj.id);}
else{var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);for(var m in attObj){if(attObj[m]!=Object.prototype[m]){if(m.toLowerCase()=="styleclass"){o.setAttribute("class",attObj[m]);}
else if(m.toLowerCase()!="classid"){o.setAttribute(m,attObj[m]);}}}
for(var n in parObj){if(parObj[n]!=Object.prototype[n]&&n.toLowerCase()!="movie"){createObjParam(o,n,parObj[n]);}}
el.parentNode.replaceChild(o,el);r=o;}}
return r;}
function createObjParam(el,pName,pValue){var p=createElement("param");p.setAttribute("name",pName);p.setAttribute("value",pValue);el.appendChild(p);}
function removeSWF(id){var obj=getElementById(id);if(obj&&obj.nodeName=="OBJECT"){if(ua.ie&&ua.win){obj.style.display="none";(function(){if(obj.readyState==4){removeObjectInIE(id);}
else{setTimeout(arguments.callee,10);}})();}
else{obj.parentNode.removeChild(obj);}}}
function removeObjectInIE(id){var obj=getElementById(id);if(obj){for(var i in obj){if(typeof obj[i]=="function"){obj[i]=null;}}
obj.parentNode.removeChild(obj);}}
function getElementById(id){var el=null;try{el=doc.getElementById(id);}
catch(e){}
return el;}
function createElement(el){return doc.createElement(el);}
function addListener(target,eventType,fn){target.attachEvent(eventType,fn);listenersArr[listenersArr.length]=[target,eventType,fn];}
function hasPlayerVersion(rv){var pv=ua.pv,v=rv.split(".");v[0]=parseInt(v[0],10);v[1]=parseInt(v[1],10)||0;v[2]=parseInt(v[2],10)||0;return(pv[0]>v[0]||(pv[0]==v[0]&&pv[1]>v[1])||(pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]))?true:false;}
function createCSS(sel,decl,media,newStyle){if(ua.ie&&ua.mac){return;}
var h=doc.getElementsByTagName("head")[0];if(!h){return;}
var m=(media&&typeof media=="string")?media:"screen";if(newStyle){dynamicStylesheet=null;dynamicStylesheetMedia=null;}
if(!dynamicStylesheet||dynamicStylesheetMedia!=m){var s=createElement("style");s.setAttribute("type","text/css");s.setAttribute("media",m);dynamicStylesheet=h.appendChild(s);if(ua.ie&&ua.win&&typeof doc.styleSheets!=UNDEF&&doc.styleSheets.length>0){dynamicStylesheet=doc.styleSheets[doc.styleSheets.length-1];}
dynamicStylesheetMedia=m;}
if(ua.ie&&ua.win){if(dynamicStylesheet&&typeof dynamicStylesheet.addRule==OBJECT){dynamicStylesheet.addRule(sel,decl);}}
else{if(dynamicStylesheet&&typeof doc.createTextNode!=UNDEF){dynamicStylesheet.appendChild(doc.createTextNode(sel+" {"+decl+"}"));}}}
function setVisibility(id,isVisible){if(!autoHideShow){return;}
var v=isVisible?"visible":"hidden";if(isDomLoaded&&getElementById(id)){getElementById(id).style.visibility=v;}
else{createCSS("#"+id,"visibility:"+v);}}
function urlEncodeIfNecessary(s){var regex=/[\\\"<>\.;]/;var hasBadChars=regex.exec(s)!=null;return hasBadChars&&typeof encodeURIComponent!=UNDEF?encodeURIComponent(s):s;}
var cleanup=function(){if(ua.ie&&ua.win){window.attachEvent("onunload",function(){var ll=listenersArr.length;for(var i=0;i<ll;i++){listenersArr[i][0].detachEvent(listenersArr[i][1],listenersArr[i][2]);}
var il=objIdArr.length;for(var j=0;j<il;j++){removeSWF(objIdArr[j]);}
for(var k in ua){ua[k]=null;}
ua=null;for(var l in swfobject){swfobject[l]=null;}
swfobject=null;});}}();return{registerObject:function(objectIdStr,swfVersionStr,xiSwfUrlStr,callbackFn){if(ua.w3&&objectIdStr&&swfVersionStr){var regObj={};regObj.id=objectIdStr;regObj.swfVersion=swfVersionStr;regObj.expressInstall=xiSwfUrlStr;regObj.callbackFn=callbackFn;regObjArr[regObjArr.length]=regObj;setVisibility(objectIdStr,false);}
else if(callbackFn){callbackFn({success:false,id:objectIdStr});}},getObjectById:function(objectIdStr){if(ua.w3){return getObjectById(objectIdStr);}},embedSWF:function(swfUrlStr,replaceElemIdStr,widthStr,heightStr,swfVersionStr,xiSwfUrlStr,flashvarsObj,parObj,attObj,callbackFn){var callbackObj={success:false,id:replaceElemIdStr};if(ua.w3&&!(ua.wk&&ua.wk<312)&&swfUrlStr&&replaceElemIdStr&&widthStr&&heightStr&&swfVersionStr){setVisibility(replaceElemIdStr,false);addDomLoadEvent(function(){widthStr+="";heightStr+="";var att={};if(attObj&&typeof attObj===OBJECT){for(var i in attObj){att[i]=attObj[i];}}
att.data=swfUrlStr;att.width=widthStr;att.height=heightStr;var par={};if(parObj&&typeof parObj===OBJECT){for(var j in parObj){par[j]=parObj[j];}}
if(flashvarsObj&&typeof flashvarsObj===OBJECT){for(var k in flashvarsObj){if(typeof par.flashvars!=UNDEF){par.flashvars+="&"+k+"="+flashvarsObj[k];}
else{par.flashvars=k+"="+flashvarsObj[k];}}}
if(hasPlayerVersion(swfVersionStr)){var obj=createSWF(att,par,replaceElemIdStr);if(att.id==replaceElemIdStr){setVisibility(replaceElemIdStr,true);}
callbackObj.success=true;callbackObj.ref=obj;}
else if(xiSwfUrlStr&&canExpressInstall()){att.data=xiSwfUrlStr;showExpressInstall(att,par,replaceElemIdStr,callbackFn);return;}
else{setVisibility(replaceElemIdStr,true);}
if(callbackFn){callbackFn(callbackObj);}});}
else if(callbackFn){callbackFn(callbackObj);}},switchOffAutoHideShow:function(){autoHideShow=false;},ua:ua,getFlashPlayerVersion:function(){return{major:ua.pv[0],minor:ua.pv[1],release:ua.pv[2]};},hasFlashPlayerVersion:hasPlayerVersion,createSWF:function(attObj,parObj,replaceElemIdStr){if(ua.w3){return createSWF(attObj,parObj,replaceElemIdStr);}
else{return undefined;}},showExpressInstall:function(att,par,replaceElemIdStr,callbackFn){if(ua.w3&&canExpressInstall()){showExpressInstall(att,par,replaceElemIdStr,callbackFn);}},removeSWF:function(objElemIdStr){if(ua.w3){removeSWF(objElemIdStr);}},createCSS:function(selStr,declStr,mediaStr,newStyleBoolean){if(ua.w3){createCSS(selStr,declStr,mediaStr,newStyleBoolean);}},addDomLoadEvent:addDomLoadEvent,addLoadEvent:addLoadEvent,getQueryParamValue:function(param){var q=doc.location.search||doc.location.hash;if(q){if(/\?/.test(q)){q=q.split("?")[1];}
if(param==null){return urlEncodeIfNecessary(q);}
var pairs=q.split("&");for(var i=0;i<pairs.length;i++){if(pairs[i].substring(0,pairs[i].indexOf("="))==param){return urlEncodeIfNecessary(pairs[i].substring((pairs[i].indexOf("=")+1)));}}}
return"";},expressInstallCallback:function(){if(isExpressInstallActive){var obj=getElementById(EXPRESS_INSTALL_ID);if(obj&&storedAltContent){obj.parentNode.replaceChild(storedAltContent,obj);if(storedAltContentId){setVisibility(storedAltContentId,true);if(ua.ie&&ua.win){storedAltContent.style.display="block";}}
if(storedCallbackFn){storedCallbackFn(storedCallbackObj);}}
isExpressInstallActive=false;}}};}();(function(){function Promise(){var passCallbacks=[];var failCallbacks=[];var STATE_UNRESOLVED=0;var STATE_RESOLVED=1;var STATE_REJECTED=2;var state=STATE_UNRESOLVED;var done=this.done=function(callback){if(!callback){return;}
if(state===STATE_RESOLVED){callback();}else if(passCallbacks){passCallbacks.push(callback);}};var fail=this.fail=function(callback){if(!callback){return;}
if(state===STATE_REJECTED){callback();}else if(failCallbacks){failCallbacks.push(callback);}};var then=this.then=function(passCallback,failCallback){var newPromise=new Promise();newPromise.done(passCallback);newPromise.fail(failCallback);done(newPromise.resolve);fail(newPromise.reject);return newPromise.promise();};var _complete=function(callbacks,finalState){if(state!==STATE_UNRESOLVED){return;}
state=finalState;for(var i=0;i<callbacks.length;i++){callbacks[i]();}
passCallbacks=null;failCallbacks=null;};this.resolve=function(){_complete(passCallbacks,STATE_RESOLVED);};this.reject=function(){_complete(failCallbacks,STATE_REJECTED);};this.promise=function(obj){obj=obj||{};obj.done=done;obj.fail=fail;obj.then=then;return obj;};}
function createLoader(exports,mockWindow,mockDocument){mockWindow=mockWindow||window;mockDocument=mockDocument||document;exports=exports||{};var t3Loaded=new Promise();exports.t3Loaded=t3Loaded.promise();var pageReady=new Promise();exports.pageReady=pageReady.promise();var pageLoad=new Promise();exports.pageLoad=pageLoad.promise();var hasT3Initialized=false;function initializeT3(){if(hasT3Initialized){return;}
hasT3Initialized=true;if(mockWindow.Box&&mockWindow.Box.Application&&mockWindow.initialConfig){mockWindow.Box.Application.init(mockWindow.initialConfig);}
t3Loaded.resolve();}
pageReady.done(initializeT3);if(mockDocument.addEventListener){mockWindow.addEventListener('load',function(){pageReady.resolve();pageLoad.resolve();},false);}else{mockWindow.attachEvent('onload',function(){pageReady.resolve();pageLoad.resolve();});}
exports.allScriptsLoaded=function(){pageReady.resolve();};var i;if(mockWindow.onreadyList){for(i=0;i<mockWindow.onreadyList.length;i++){pageReady.done(mockWindow.onreadyList[i]);}
mockWindow.onreadyList={push:pageReady.done};}
if(mockWindow.onloadList){for(i=0;i<mockWindow.onloadList.length;i++){pageLoad.done(mockWindow.onloadList[i]);}
mockWindow.onloadList={push:pageLoad.done};}
return exports;}
window.Loader=createLoader();window.Loader._createLoader=createLoader;window.Loader._createPromise=function(){return new Promise();};})();var Box_Base=Base.extend({constructor:function(params)
{this.set_params(params);},set_params:function(params)
{params=params||{};for(var param_name in params)
{this[param_name]=params[param_name];}
return this;}},{});Box.Application.addService('focus',function(application){'use strict';var FOCUS_AFTER='after';var FOCUS_BEFORE='before';var FOCUS_FOCUSABLE_TYPES='a[href], button:not(.popup-x-btn), input, select, textarea';var dom=application.getService('dom');function getVisibleElements(domNode){var elements=dom.queryAll(FOCUS_FOCUSABLE_TYPES,domNode);var visibleElements=[];for(var i=0;i<elements.length;i++){if(dom.isVisible(elements[i])){visibleElements.push(elements[i]);}}
return visibleElements;}
function generateOnFocus(domNode){return function(event){var elements=getVisibleElements(domNode);if(elements.length>0&&event&&event.data&&event.data.field){if(event.data.field===FOCUS_AFTER){elements[0].focus();}else{elements[elements.length-1].focus();}}};}
return{wrap:function(domNode,firstFocus){if(domNode.isFocusWrapped){return;}
domNode.isFocusWrapped=true;var before=document.createElement('i');before.setAttribute('tabindex','0');var after=document.createElement('i');after.setAttribute('tabindex','0');dom.on(before,'focusin',generateOnFocus(domNode),{field:FOCUS_BEFORE});dom.on(after,'focusin',generateOnFocus(domNode),{field:FOCUS_AFTER});if(domNode.children.length>0){domNode.insertBefore(before,domNode.firstChild);domNode.appendChild(after);}
if(typeof firstFocus==='undefined'||firstFocus===true){var elements=getVisibleElements(domNode);firstFocus=elements[0];}
if(firstFocus&&firstFocus.focus){firstFocus.focus();}}};});Box.Application.addService('reachability',function(application){'use strict';var hostInfo={};var cookiesService=application.getService('cookies');return{getHostValue:function(ip,host,cookie){if(!hostInfo[cookie]){var fromCookie=cookiesService.get(cookie);hostInfo[cookie]=(fromCookie)?JSON.parse(fromCookie):null;}
if(hostInfo[cookie]===null||hostInfo[cookie][ip]===null||hostInfo[cookie][ip][host]===null){return null;}
return hostInfo[cookie][ip][host];},setHostValue:function(ip,host,value,cookie)
{if(!hostInfo[cookie]){var fromCookie=cookiesService.get(cookie);hostInfo[cookie]=(fromCookie)?JSON.parse(fromCookie):null;}
if(!hostInfo[cookie]){hostInfo[cookie]={};}
if(!hostInfo[cookie][ip]){hostInfo[cookie][ip]={};}
hostInfo[cookie][ip][host]=value;var hostInfoSerialized=JSON.stringify(hostInfo[cookie]);cookiesService.set(cookie,hostInfoSerialized,(new Date()).getTime()+1000*(7*86400));},getHostInfo:function(cookie)
{return hostInfo[cookie];}};});Box.Application.addService('cookies',function(application){'use strict';var doc=application.getGlobal('document');return{get:function(name){var cookies=doc.cookie.split('; '),pair,i,len;for(i=0,len=cookies.length;i<len;i++){pair=cookies[i].split('=');if(pair[0]===name){if(pair[1]){return decodeURIComponent(pair[1]);}else{return'';}}}
return'';},remove:function(name){this.set(name,'',new Date(0));},set:function(name,value,expires,path,domain){var expiresDate=new Date();var cookie;if(typeof expires=='undefined'){expires=expiresDate.getTime()+(1000*3600*24*60);}
expiresDate.setTime(expires);path=path||'/';var configCookieDomain=application.getGlobalConfig('cookieDomain');if(!domain&&configCookieDomain){domain=configCookieDomain;}else if(!domain&&typeof application.getGlobal('cookie_domain')!=='undefined'){if(typeof(Tombstone)!=='undefined'){Tombstone.marker('./js/common/services/cookies.js:82','2014-02-10','need to weed out usage of cookie_domain and move it over to globalconfig');}
domain=application.getGlobal('cookie_domain');}
cookie=name+'='+encodeURIComponent(value);if(expires!==0){cookie+='; expires='+expiresDate.toGMTString();}
cookie+='; path='+path;if(domain){cookie+='; domain='+domain;}
cookie+='; secure';doc.cookie=cookie;},isEnabled:function(){return!!(doc.cookie&&doc.cookie.length>0);},setOnRootDomain:function(name,value,expires,path,secure){var configCookieDomain=application.getGlobalConfig('cookieRootDomain');this.set(name,value,expires,path,configCookieDomain,secure);}};});Box.Application.addService('assets',function(application){'use strict';var browser=application.getService('browser');var IE_STYLESHEET_LIMIT=31;var loadedJSPromises={},loadedCSSPromises={};function assetNormalize(_asset){return _asset?_asset.replace(/^\//,''):'';}
function numStylesheetsOnPage(){return $('link[rel="stylesheet"], style').length;}
function createStylesheet(url){var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href=url;return link;}
function createStylesheetOnLoadPromise(linkEl){var deferred=$.Deferred();var resolve=function(){deferred.resolve();};var isBuggyBrowser=browser.isSafari()&&browser.getVersion()==='an unknown version';if('onload'in linkEl&&!isBuggyBrowser){linkEl.onload=resolve;}else{setTimeout(resolve,0);}
return deferred.promise();}
function createScriptOnLoadPromise(scriptEl){var deferred=$.Deferred();if(scriptEl.readyState){scriptEl.onreadystatechange=function(){if(scriptEl.readyState==='loaded'||scriptEl.readyState==='complete'){scriptEl.onreadystatechange=null;deferred.resolve();}};}else{scriptEl.onload=function(){deferred.resolve();};}
return deferred.promise();}
function loadStylesheets(hashToUrls){var head=document.getElementsByTagName('head')[0],linkEl,url,promises=[];for(var hash in hashToUrls){if(hashToUrls.hasOwnProperty(hash)){url=hashToUrls[hash];linkEl=createStylesheet(url);head.appendChild(linkEl);loadedCSSPromises[hash]=createStylesheetOnLoadPromise(linkEl);promises.push(loadedCSSPromises[hash]);}}
return promises;}
function importStylesheets(hashToUrls){var stylesheets=$('link[rel="stylesheet"]'),lastStylesheet=stylesheets[stylesheets.length-1],importDeferred=$.Deferred(),importPromise=importDeferred.promise(),numImported=0,url;for(var hash in hashToUrls){if(hashToUrls.hasOwnProperty(hash)){url=hashToUrls[hash];lastStylesheet.styleSheet.addImport(url);loadedCSSPromises[hash]=importPromise;numImported++;}}
if(numImported>0){var onLoadPromise=createStylesheetOnLoadPromise(lastStylesheet);onLoadPromise.done(function(){importDeferred.resolve();});return[importPromise];}else{return[$.Deferred().resolve().promise()];}}
function setInitialJS(){var initialJSHashes=application.getGlobalConfig('initialJSHashes')||[];for(var i=0,len=initialJSHashes.length;i<len;i++){loadedJSPromises[initialJSHashes[i]]=$.Deferred().resolve().promise();}}
function setInitialCSS(){var initialCSSHashes=application.getGlobalConfig('initialCSSHashes')||[];for(var i=0,len=initialCSSHashes.length;i<len;i++){loadedCSSPromises[initialCSSHashes[i]]=$.Deferred().resolve().promise();}}
return{boxCachedAssetIndex:{mini:null,full:null},_assetIndex:function(_type){if(this.boxCachedAssetIndex[_type]===null){var _assetsIndexFile=null;if(_type=='mini'){_assetsIndexFile=application.getGlobal('assets_index_mini_file');}else{_assetsIndexFile=application.getGlobal('assets_index_file');}
var me=this;$.ajax({type:'GET',url:'/'+_assetsIndexFile,dataType:'text',cache:true,async:false,no_context:true,success:function(data){me.boxCachedAssetIndex[_type]={};if(data){var lines=data.split('\n');for(var i=0,length=lines.length;i<length;i++){var parts=lines[i].split('\t');if(parts.length==2&&parts[0].length>0){me.boxCachedAssetIndex[_type][parts[0]]=parts[1];}}}},error:function(req){$.log('WARN: asset index loading failed with status %s',req.status);me.boxCachedAssetIndex[_type]=false;}});}
return this.boxCachedAssetIndex[_type];},_remoteAssetHash:function(_asset,_type){if(_type!='mini'){var logService=application.getService('logger');var event={'asset':_asset};logService.sendLog('asset_caching','remote_index_load',event);}
var index=this._assetIndex(_type);if(index===false){return false;}
if(!index[_asset]){if(_type!='mini'){$.log('WARN: unknown asset %s',_asset);}
return false;}
return index[_asset];},_assetHash:function(_asset){return this._remoteAssetHash(_asset,'mini')||this._remoteAssetHash(_asset,'full');},_assetPath:function(_asset){var asset=assetNormalize(_asset);var hash=this._assetHash(_asset);if(hash===false){return false;}
var file=asset.replace(/(\w+)(\.\w+)?$/,'$1-'+hash+'$2');return'/'+file;},getFlashAssetURL:function(){var flash_path='/static/flash/';return flash_path;},getAssetURL:function(dir,file,cdn){if(typeof file==='undefined'){file='';}
if(typeof cdn==='undefined'){cdn=true;}
var asset=assetNormalize(dir+file);var defaultResult='/'+asset;var Features=application.getService('v5').get('Features');if(Features.no_asset_caching){return defaultResult;}
var path=this._assetPath(asset);if(path===false){return defaultResult;}
var assetsBase;assetsBase=application.getGlobal('assets_base');var ASSETS_PREFIX='/'+assetsBase;return ASSETS_PREFIX+path;},loadJSByHash:function(hashToUrlMap,callback){var urlsToLoad=[],url,hash;if($.isEmptyObject(loadedJSPromises)){setInitialJS();}
var promises=[];var hashesToLoad=[];for(hash in hashToUrlMap){if(!loadedJSPromises.hasOwnProperty(hash)){hashesToLoad.push(hash);}else{promises.push(loadedJSPromises[hash]);}}
for(var i=0,len=hashesToLoad.length;i<len;i++){var script=document.createElement('script'),promise=createScriptOnLoadPromise(script);hash=hashesToLoad[i];url=hashToUrlMap[hash];script.src=url;document.body.appendChild(script);loadedJSPromises[hash]=promise;promises.push(loadedJSPromises[hash]);}
$.when.apply($,promises).done(callback);},loadCSSByHash:function(hashToUrlMap,callback){var hashesToLoad=[],promises=[],hash,url,i,len;if($.isEmptyObject(loadedCSSPromises)){setInitialCSS();}
for(var hash in hashToUrlMap){if(!loadedCSSPromises.hasOwnProperty(hash)){hashesToLoad.push(hash);}else{promises.push(loadedCSSPromises[hash]);}}
var ltIE10=browser.isIE()&&parseFloat(browser.getVersion())<10,hashToUrls={};if(ltIE10){var curNumStylesheets=numStylesheetsOnPage(),numRealLinks=Math.min(hashesToLoad.length,Math.max(0,IE_STYLESHEET_LIMIT-curNumStylesheets)),numImports=hashesToLoad.length-numRealLinks;var normalStylesheetHashes=hashesToLoad.slice(numImports);for(i=0,len=normalStylesheetHashes.length;i<len;i++){hash=normalStylesheetHashes[i];hashToUrls[hash]=hashToUrlMap[hash];}
$.merge(promises,loadStylesheets(hashToUrls));if(numImports){var importStylesheetHashes=hashesToLoad.slice(0,numImports),importHashToUrls={};for(i=0,len=importStylesheetHashes.length;i<len;i++){hash=importStylesheetHashes[i];importHashToUrls[hash]=hashToUrlMap[hash];}
$.merge(promises,importStylesheets(importHashToUrls));}}else{for(i=0,len=hashesToLoad.length;i<len;i++){hash=hashesToLoad[i];hashToUrls[hash]=hashToUrlMap[hash];}
$.merge(promises,loadStylesheets(hashToUrls));}
$.when.apply($,promises).done(callback);}};});(function(){var i,feature,featureMetaTags=document.querySelectorAll('meta[type="feature_flag"]'),len=featureMetaTags.length;window.Features=window.Features||{};for(i=0;i<len;i++){feature=featureMetaTags[i];window.Features[feature.getAttribute('name')]=true;}}());Box.Application.addService('nav-state',function(application){'use strict';var DEFAULT_NAV_STATE={firstResultClick:true,folderName:null,galleryId:null,gcmUserId:0,id:null,isGallery:false,lastType:null,page:0,searchFilters:null,searchString:null,singleFilePreview:false,sort:null,sortDirection:null,subId:null,tags:null,trashFilter:null,type:'f',updateType:null,wasGallery:false,lastNonGalleryUrl:'',policyId:null};var state={application:null,fileVersionId:null,firstResultClick:true,folderName:null,galleryId:null,gcmUserId:0,id:null,isGallery:false,lastType:null,page:0,searchFilters:null,searchString:null,singleFilePreview:false,sort:null,sortDirection:null,subId:null,tags:null,trashFilter:null,type:'',updateType:null,wasGallery:false,lastNonGalleryUrl:'',policyId:null};var v5=application.getService('v5'),urlService=application.getService('url'),win=v5.get('window'),item=v5.get('Item');function get(){var url=urlService.getCurrentWindowUrl(),queryParams=urlService.getQueryParams(url);return $.extend({},state,queryParams);}
function httpRoot(){return win.location.protocol+'//'+win.location.hostname;}
function set(newState){var url,currentUrl;for(var prop in newState){if(state.hasOwnProperty(prop)){state[prop]=newState[prop];}}}
function isPageType(pageType){return $('.body').attr('data-page-type')===pageType;}
function isPageLoadedInIFrame(){var returnVal=false;try{returnVal=win.top!==self;}catch(error){returnVal=true;}
return returnVal;}
function isEmbedWidget(){var embedFromConfig=!!application.getGlobalConfig('embed'),embedFromGlobal=!!application.getGlobal('is_embed_widget')||!!application.getGlobal('embed');return embedFromGlobal||embedFromConfig;}
(function(){if(isPageLoadedInIFrame()&&!isEmbedWidget()){try{var logParams={referer:document.referer||''};var logService=application.getService('logger');logService.sendLog('navigation','NON_WIDGET_IFRAME',logParams);}catch(error){}}})();return{galleryItem:function(){if(typeof item!=='undefined'){return item.find(get().galleryId);}
return null;},getSearchFiltersFromString:function(filterString){var queryParams,filterStringWithoutParams=filterString,rawFilters,filterParts,searchFilters=[],type,i,len;if(!filterString){return[];}
queryParams=urlService.getQueryParamString(filterString);if(queryParams){filterStringWithoutParams=filterString.split('?'+queryParams)[0];}
rawFilters=filterStringWithoutParams.split('|');for(i=0,len=rawFilters.length;i<len;i++){filterParts=rawFilters[i].split(':');type=filterParts.shift();searchFilters.push({type:type,value:filterParts.join(':')});}
return searchFilters;},getSearchStringFromFilters:function(filters){if(!$.isArray(filters)){return'';}
return $.map(filters,function(filter){return filter.type+':'+filter.value;}).join('|');},isShowingFiles:function(){return this.isFiles()||this.isSearch()||this.isTag();},isShowingSearchOrTag:function(){return this.isSearch()||this.isTag();},isRootFolder:function(){var id=get().id;if(this.isFiles()){if(typeof item!=='undefined'){return id==item.ROOT_FOLDER_ID||id==win.root_folder_id;}else{return id==win.root_folder_id||id==0;}}else{return false;}},isTrash:function(){var id=get().id;if(typeof item!=='undefined'){return id===item.TRASH_FOLDER_ID;}else{return id===1;}},isEmbedWidget:isEmbedWidget,isSharedPage:function(){return typeof win.shared_folder!=='undefined'&&typeof win.shared_name!=='undefined';},isGcm:function(){return isPageType('gcm');},isSharedFilePage:function(){return isPageType('shared-file');},isSharedFolderPage:function(){return isPageType('shared-folder');},isSharedPageOrEmbedWidget:function(){return this.isSharedFilePage()||this.isSharedFolderPage()||this.isEmbedWidget();},isFirstResultClick:function(){return get().firstResultClick;},isMovingOutOfSearch:function(){return!this.isSearch()&&this.wasSearch();},isMovingIntoSearch:function(){return this.isSearch()&&!this.wasSearch();},isMovingOutOfPreview:function(){var previewState=get();return previewState.wasGallery&&!previewState.isGallery;},isPreviewOpen:function(){var previewState=get();return previewState.isGallery;},isSortedBy:function(option){return get().sort===option;},isSingleFilePreview:function(){var currentState=get();return currentState.singleFilePreview;},getTypeSpecificId:function(type){var currentState=get();switch(type){case's':return currentState.searchString;case't':return currentState.tags;default:return currentState.id;}},getLastNonGalleryUrl:function(){var currentState=get();return currentState.lastNonGalleryUrl;},getLastType:function(){var currentState=get();return currentState.lastType;},setFirstResultClick:function(flag){set({firstResultClick:flag});},setCurrent:function(type){set({type:type,lastType:get().type});},setPrevious:function(){var currentState=get();set({lastType:currentState.type,wasGallery:currentState.isGallery});},setPage:function(page){set({page:page});},setNav:function(state){var currentState=get(),newState=$.extend({},state);newState.lastType=newState.lastType||currentState.type;newState.wasGallery=newState.wasGallery||currentState.isGallery;set(newState);},setSort:function(sort,sortDirection){var newState={sort:sort};if(sortDirection){newState.sortDirection=sortDirection;}
set(newState);},resetSort:function(){set({sort:null,sortDirection:null});},setPreviewItem:function(id){set({isGallery:true,galleryId:id,subId:id});},clearPreview:function(){set({isGallery:false,galleryId:0,subId:0});},setItemInFiles:function(id,folderName,page){var currentState=get(),newState={type:'f',lastType:currentState.type,isGallery:false,page:page||0,id:id};if(folderName){newState.folderName=folderName;}
set(newState);},setTagsNav:function(tags,page){tags=urlService.decodePathComponent(tags);set({type:'t',tags:tags,id:tags,page:page||0});},setSearchNav:function(query,page,filterString){set({page:page||0,id:query,searchString:query,searchFilters:filterString||''});},setSearchFilters:function(filterString){set({searchFilters:filterString});},setPreviewState:function(previewItemTypedId){if(!previewItemTypedId){this.clearPreview();return;}
if(parseInt(previewItemTypedId,10)){previewItemTypedId='f_'+previewItemTypedId;}
this.setPreviewItem(previewItemTypedId);},setSingleFilePreview:function(singleFilePreview){set({singleFilePreview:singleFilePreview});},isInFolder:function(){return this.isFiles()&&!this.isTrash()&&!this.isRootFolder();},isFiles:function(){return get().type==='f';},wasFiles:function(){return get().lastType==='f';},setCurrentAsFiles:function(){set({lastType:get().type,type:'f'});},isSearch:function(){return get().type==='s';},wasSearch:function(){return get().lastType==='s';},setCurrentAsSearch:function(){set({lastType:get().type,type:'s'});},isTag:function(){return get().type==='t';},wasTag:function(){return get().lastType==='t';},setCurrentAsTag:function(){set({lastType:get().type,type:'t'});},isGcmFiles:function(){return get().type==='gcm_files';},wasGcmFiles:function(){return get().lastType==='gcm_files';},setCurrentAsGcmFiles:function(){set({lastType:get().type,type:'gcm_files'});},isGcmSearch:function(){return get().type==='gcm_search';},wasGcmSearch:function(){return get().lastType==='gcm_search';},setCurrentAsGcmSearch:function(){set({lastType:get().type,type:'gcm_search'});},isGcmUsers:function(){return get().type==='gcm_users';},wasGcmUsers:function(){return get().lastType==='gcm_users';},setCurrentAsGcmUsers:function(){set({lastType:get().type,type:'gcm_users'});},isGcmQuarantine:function(){return get().type==='gcm_quarantine';},wasGcmQuarantine:function(){return get().lastType==='gcm_quarantine';},setCurrentAsGcmQuarantine:function(){set({lastType:get().type,type:'gcm_quarantine'});},isGcmQuarantinePreview:function(){return get().type==='gcm_quarantine_preview';},wasGcmQuarantinePreview:function(){return get().lastType==='gcm_quarantine_preview';},setCurrentAsGcmQuarantinePreview:function(){set({lastType:get().type,type:'gcm_quarantine_preview'});},isAutomation:function(){return get().type==='admin_automation';},wasAutomation:function(){return get().lastType==='admin_automation';},setCurrentAsAutomation:function(){set({lastType:get().type,type:'admin_automation'});},isPolicies:function(){return get().type==='admin_policies';},wasPolicies:function(){return get().lastType==='admin_policies';},setCurrentAsPolicies:function(){set({lastType:get().type,type:'admin_policies'});},isContacts:function(){return get().type==='contacts';},wasContacts:function(){return get().lastType==='contacts';},setCurrentAsContacts:function(){set({lastType:get().type,type:'contacts'});},isCorporateNetwork:function(){return get().type==='corporate_network';},wasCorporateNetwork:function(){return get().lastType==='corporate_network';},setCurrentAsCorporateNetwork:function(){set({lastType:get().type,type:'corporate_network'});},getCurrentPageName:function(){if(this.isPreviewOpen()){return'preview';}else if(this.isSearch()){return'search';}else if(this.isTrash()){return'trash';}else if(this.isTag()){return'tag';}else if(this.isFiles()){return'files';}else if(this.isContacts()){return'allcollaborators';}else if(this.isSharedFolderPage()){return'sharedfolderpage';}
return'';},createNavObject:function(params){return $.extend({},DEFAULT_NAV_STATE,params);},get:get,set:set};});Box.Application.addService('nav-url',function(application){'use strict';var url=application.getService('url'),navState=application.getService('nav-state');return{getSearchUrl:function(query,page,filters,metadataFilters){var queryString=url.encodePathComponent(query),filterStringPath='',metadataQueryObject={},searchUrl='',pathPrefix=application.getGlobal('path_prefix')||'',queryParams={};page=page||0;if(filters){filterStringPath='/'+url.encodePathComponent(filters);}
if(metadataFilters){queryParams.mdfilters=metadataFilters;}
searchUrl='/'+pathPrefix+'files/search/'+queryString+'/'+page+filterStringPath;return url.createUrl(searchUrl,queryParams);},getSearchUrlForCollaboratorsPage:function(query,page){return'/contacts/search/'+page+'?search='+encodeURIComponent(query);},getFileUrl:function(fileId,folderId,page,type){var pathPrefix=application.getGlobal('path_prefix')||'';if(!type){type=navState.get().type;}
return'/'+pathPrefix+'files/'+page+'/'+type+'/'+folderId+'/1/f_'+fileId;},getFileUrlForSharedPage:function(fileId,folderId,page,sharedName){var sharedPrefix=sharedName.length>=20?'s/':'shared/',pathPrefix=application.getGlobal('path_prefix')||'';return'/'+pathPrefix+sharedPrefix+sharedName+'/'+page+'/'+folderId+'/'+fileId+'/1';},getFileUrlForVanityPage:function(fileId,folderId,page,vanityName){return'/v/'+vanityName+'/'+page+'/'+folderId+'/'+fileId+'/1';},getFolderUrl:function(folderId,page,folderName){return'/files/'+page+'/f/'+folderId+(folderName?'/'+url.encodePathComponent(folderName):'');},getSharedFolderUrl:function(sharedName,page,folderId){var sharedPrefix=(sharedName.length>=20)?'s/':'shared/';return'/'+sharedPrefix+sharedName+'/'+page+'/'+folderId;},getVanityUrl:function(vanityName,page,folderId){return'/v/'+vanityName+'/'+page+'/'+folderId;},getTagsUrl:function(tags,page){return'/files/'+page+'/t/'+url.encodePathComponent(tags);},getContactsUrl:function(page){return'/contacts/'+page;},getCorporateNetworkUrl:function(page){return'/contacts/network/'+page;},getFileUrlForPreview:function(fileId,pageNum){var galleryPage=application.getGlobal('gallery_page'),state=navState.get(),newPageNum=pageNum||state.page,sharedName=application.getGlobal('shared_name'),vanityName=application.getGlobal('vanity_name');switch(galleryPage){case'files':var queryParams={};if(state.mdfilters){queryParams.mdfilters=state.mdfilters;}
return url.createUrl(this.getFileUrl(fileId,navState.getTypeSpecificId(state.type),newPageNum,state.type),queryParams);case'shared_folder':return this.getFileUrlForSharedPage(fileId,state.id,newPageNum,sharedName);case'vanity_url':return this.getFileUrlForVanityPage(fileId,state.id,newPageNum,vanityName);default:return false;}},getReturnUrlForPreview:function(){var galleryPage=application.getGlobal('gallery_page'),state=navState.get(),type=state.type,page=state.page,searchFilters=state.searchFilters,metadataFilters=state.mdfilters,policyId=state.policy_id||state.policyId,userId=state.user_id||state.userId,id=state.id,sharedName=application.getGlobal('shared_name'),vanityName=application.getGlobal('vanity_name'),urlForPreview='';switch(galleryPage){case'files':if(navState.isSearch()){urlForPreview=this.getSearchUrl(navState.getTypeSpecificId(type),page,searchFilters,metadataFilters);}else if(navState.isSingleFilePreview()){urlForPreview='/';}else{urlForPreview=this.getFolderUrl(navState.getTypeSpecificId(type),page);}
return urlForPreview;case'shared_folder':return this.getSharedFolderUrl(sharedName,page,id);case'vanity_url':return this.getVanityUrl(vanityName,page,id);}
if(navState.isGcmQuarantinePreview()){return this.getGcmUrlForQuarantine(page,policyId,userId);}else if(navState.isGcmSearch()){return this.getGcmUrlForSearch(state.searchString,page,searchFilters);}else if(navState.isGcm()){return this.getGcmUrlForFiles(state.gcmUserId,id,page);}
return false;},getGcmRootUrl:function(){return'/master/content';},getGcmUrlForFiles:function(userId,folderId,page){return this.getGcmRootUrl()+'/'+userId+'/'+folderId+'/'+page;},getGcmUrlForPreview:function(userId,folderId,page,fileId){return this.getGcmRootUrl()+'/'+userId+'/'+folderId+'/'+page+'/'+fileId;},getGcmUrlForQuarantine:function(page,policyId,userId,beforeId,afterId){return url.createUrl(this.getGcmRootUrl()+'/quarantine/'+page,{policy_id:policyId||null,user_id:userId||null,before_id:beforeId||null,after_id:afterId||null});},getGcmUrlForQuarantinePreview:function(fileVersionId){return url.createUrl(this.getGcmRootUrl()+'/quarantine/preview/'+fileVersionId);},getGcmUrlForSearch:function(query,page,filters){var queryString=url.encodePathComponent(query),filterStringPath=filters?'/'+url.encodePathComponent(filters):'';page=page||0;return this.getGcmRootUrl()+'/search/'+queryString+'/'+page+filterStringPath;},getGcmUrlForSearchPreview:function(query,page,fileId){var queryString=url.encodePathComponent(query);page=page||0;return this.getGcmRootUrl()+'/search/'+queryString+'/'+page+'/'+fileId;}};});Box.Application.addService('v5',function(application){'use strict';return{get:function(name){var object=null;object=application.getGlobal(name);if(object&&typeof object.get==='function'){object=object.get();}
return object;}};});Box.Application.addService('url',function(application){'use strict';var window=application.getGlobal('window');var PLUS_PATTERN=/\+/g,GET_PARAM_PATTERN=/([^&=]+)=?([^&]*)/g,QUERY_STRING_PATTERN=/\?(.*)/;function decodeGetComponent(component){return decodeURIComponent(component.replace(PLUS_PATTERN,' '));}
function isGlobalContentManager(){return window.location.pathname&&window.location.pathname.indexOf('/master/content')===0;}
return{getCurrentWindowUrl:function(){return(window.location.hash||window.location.href);},getHostDomain:function(){var hostnameSplit=window.location.hostname.split('.');var hostnameSplitLength=hostnameSplit.length;return hostnameSplit[hostnameSplitLength-2]+'.'+hostnameSplit[hostnameSplitLength-1];},getGcmCompatibleRm:function(rm){if(isGlobalContentManager()){rm='box_master_gcm_'+rm;}
return rm;},getGcmCompatibleRmUrl:function(rm){return'/index.php?rm='+this.getGcmCompatibleRm(rm);},updateQueryStringParameter:function(uri,key,value){var re=new RegExp('([?&])'+key+'=.*?(&|$)','i'),separator=uri.indexOf('?')!==-1?'&':'?',isEmptyValue=!value&&typeof value!=='number',isExistingParam=uri.match(re),encodedKey=encodeURIComponent(key),encodedValue=encodeURIComponent(value);if(isEmptyValue&&isExistingParam){return uri.replace(re,'');}else if(isEmptyValue){return uri;}else if(isExistingParam){return uri.replace(re,'$1'+encodedKey+'='+encodedValue+'$2');}
return uri+separator+encodedKey+'='+encodedValue;},createUrl:function(url,queryParams){var paramValue,paramName;if(url[url.length-1]==='?'){url=url.slice(0,url.length-1);}
for(paramName in queryParams){if(queryParams.hasOwnProperty(paramName)){paramValue=queryParams[paramName];url=this.updateQueryStringParameter(url,paramName,paramValue);}}
return url;},goToUrl:function(url){var openNewLinkInWindow=application.getGlobal('open_link_in_new_window'),windowPathPrefix=application.getGlobal('path_prefix');url=this.addAdditionalContext(url);if(openNewLinkInWindow&&url&&windowPathPrefix&&url.indexOf(windowPathPrefix)<0){window.open(url);return;}
window.location.href=url;},goToUrlInBackground:function(url){var dom=application.getService('dom'),document=application.getGlobal('document'),iframe=dom.query('#downloadiframe'),isNewIframeNeeded=false;if(!iframe){iframe=document.createElement('iframe');isNewIframeNeeded=true;}
url=this.addAdditionalContext(url);iframe.src=url;iframe.style.display='none';iframe.setAttribute('id','downloadiframe');if(isNewIframeNeeded){document.body.appendChild(iframe);}},openWindow:function(url,name,specs,replace){if(!url){return null;}
name=name||'';specs=specs||'';replace=replace||false;url=this.addAdditionalContext(url);return window.open(url,name,specs,replace);},addAdditionalContext:function(url){var additionalContext=application.getGlobal('additional_context');if(additionalContext&&url.indexOf('additional_context')<0){var query='additional_context='+encodeURIComponent(additionalContext);url+=(url.indexOf('?')>0?'&':'?')+query;}
return url;},formatLegacyQueryParams:function(params){function convertBooleanPropertiesToNumbers(param){for(var key in param){if(param.hasOwnProperty(key)){if(typeof param[key]==='object'){convertBooleanPropertiesToNumbers(param[key]);}else if(typeof param[key]==='boolean'){param[key]=(param[key]?1:0);}}}}
convertBooleanPropertiesToNumbers(params);return{q:params};},encodePathComponent:function(value){value=encodeURIComponent(value).replace(/%2F/g,'%252F').replace(/%23/g,'%2523').replace(/%26/g,'%2526');return value;},decodePathComponent:function(value){value=value.replace(/%2526/g,'%26').replace(/%2523/g,'%23').replace(/%252F/g,'%2F');return decodeGetComponent(value);},getQueryParams:function(url){var match,queryStringMatch=url.match(QUERY_STRING_PATTERN),queryString,urlParams={};if(queryStringMatch){queryString=queryStringMatch[1];while((match=GET_PARAM_PATTERN.exec(queryString))){urlParams[decodeGetComponent(match[1])]=decodeGetComponent(match[2]);}}
return urlParams;},getQueryParamString:function(url){var queryStringMatch=url.match(QUERY_STRING_PATTERN);if(queryStringMatch){return queryStringMatch[1];}
return'';}};});Box.Application.addService('ajax',function(application){'use strict';var promises=application.getService('promises');function abortRequest(jqXHR){if(jqXHR.readystate!==4){jqXHR.abort();}}
function formatSuccessResponse(data,jqXHR){return{status:jqXHR.status,data:data};}
function formatErrorResponse(jqXHR){var data;try{data=JSON.parse(jqXHR.responseText);}catch(e){data=jqXHR.responseText;}
return{status:jqXHR.status,data:data};}
function getErrorType(textStatus){return textStatus==='parsererror'?'JSON Parse Error':'Server Error';}
function loadResources(jsHashesToUrl,cssHashesToUrl){if($.isEmptyObject(jsHashesToUrl)&&$.isEmptyObject(cssHashesToUrl)){return promises.createResolved();}
var assetsService=application.getService('assets');var jsAssetsPromise=promises.create(function(resolve){assetsService.loadJSByHash(jsHashesToUrl,function(){resolve();});});var cssAssetsPromise=promises.create(function(resolve){assetsService.loadCSSByHash(cssHashesToUrl,function(){resolve();});});return promises.all([jsAssetsPromise,cssAssetsPromise]);}
function isLegacyEndpoint(responseData){return!('$ver'in responseData||'data'in responseData);}
function makeAjaxCall(httpMethod,responseType,runmode,data,params){var promise,$xhr,ajaxParams={type:httpMethod,dataType:responseType,url:'/index.php?rm='+runmode,data:data,dataFilter:function(data){if(data===''){return null;}
return data;}};function resolver(resolve,reject){function jqSuccessHandler(responseData,textStatus,jqXHR){var successResponse,successCallback=params.success,responseDataHasNoContent=responseData===null||typeof responseData==='undefined';function fireSuccessCallback(){if(typeof successCallback==='function'){if(params.context){successCallback.call(params.context,successResponse);}else{successCallback(successResponse);}}}
if(responseDataHasNoContent){responseData=null;}else if(!$.isPlainObject(responseData)){reject(new Error('Invalid Response Data. Response data must be a plain object.'));return;}else{if(responseData.type==='unidb'&&'params'in responseData){var uniDBService=application.hasService('unidb')?application.getService('unidb'):null;if(uniDBService){responseData=uniDBService.decode(responseData);}}}
if(responseDataHasNoContent||isLegacyEndpoint(responseData)){successResponse=formatSuccessResponse(responseData,jqXHR);fireSuccessCallback();resolve(successResponse);}else{successResponse=formatSuccessResponse(responseData.data,jqXHR);loadResources(responseData.js||{},responseData.css||{}).then(function(){fireSuccessCallback();resolve(successResponse);},function(){reject(new Error('Assets could not be loaded correctly'));});}}
function jqErrorHandler(jqXHR,textStatus,errorThrown){if(!(jqXHR.status===0&&textStatus==='abort'&&errorThrown==='abort')){var errorResponse=formatErrorResponse(jqXHR),errorCallback=params.error;if(typeof errorCallback==='function'){if(params.context){errorCallback.call(params.context,errorResponse);}else{errorCallback(errorResponse);}}
var serverError=new Error(getErrorType(textStatus));serverError.status=errorResponse.status;serverError.data=errorResponse.data;reject(serverError);}}
$xhr=$.ajax(ajaxParams).done(jqSuccessHandler).fail(jqErrorHandler);}
promise=promises.createCancellable(resolver).caught(promises.CancellationError,function(error){abortRequest($xhr);throw error;});if(typeof params.success==='function'||typeof params.error==='function'){promise.then(function(){},function(){});}
return promise;}
return{get:function(runmode,data,params){params=params||{};return makeAjaxCall('GET','json',runmode,data,{success:params.success,error:params.error,context:params.context});},post:function(runmode,data,params){params=params||{};data=data||{};if(data.request_token){application.reportError(new Error('Request token will be appended automatically and should not passed in manually'));}
data.request_token=application.getGlobalConfig('requestToken')||application.getGlobal('request_token');return makeAjaxCall('POST','json',runmode,data,{success:params.success,error:params.error,context:params.context});}};});Box.Application.addService('mention-selector',function(application){'use strict';var KEY={BACKSPACE:8,RETURN:13,LEFT:37,RIGHT:39,HOME:36,END:35},ZERO_WIDTH_CHAR='\u200B';var arrayUtils=application.getService('array-utils'),dom=application.getService('dom'),browser=application.getService('browser'),promises=application.getService('promises'),win=application.getGlobal('window'),document=application.getGlobal('document'),rangy=application.getGlobal('rangy');rangy.init();function isCursorInsideMentionEl(){var sel,containerNode;sel=rangy.getSelection();if(sel.getRangeAt&&sel.rangeCount){containerNode=sel.getRangeAt(0).startContainer;}
return containerNode&&containerNode.parentNode&&containerNode.parentNode.tagName==='A';}
function isNoActiveMention(ctx,mentionTrigger){return!(ctx.inputBuffer.length||mentionTrigger.length);}
function isNewMention(ctx,mentionTrigger){return((!ctx.inputBuffer.length||(ctx.inputBuffer.length&&!ctx.shouldContinueMentionLookup))&&mentionTrigger.length);}
function createMentionEl(mentionTrigger,id,href,text){var mentionEl=document.createElement('a'),mentionTextNode=document.createTextNode(mentionTrigger+text);mentionEl.appendChild(mentionTextNode);mentionEl.setAttribute('data-id',id);mentionEl.href=href;return mentionEl;}
function deleteInputtedMentionText(mentionText){var sel,range,lastMentionTriggerIndex,mentionSubstr='';sel=rangy.getSelection();if(!(sel.getRangeAt&&sel.rangeCount)){return;}
range=sel.getRangeAt(0);mentionSubstr=range.startContainer.nodeValue.substring(0,range.endOffset);lastMentionTriggerIndex=mentionSubstr.lastIndexOf(mentionText);range.setStart(range.startContainer,lastMentionTriggerIndex);range.deleteContents();sel.removeAllRanges();sel.addRange(range);}
function insertElementAtCursor(element,isCompleteMention){var sel,range,spaceTextNode=document.createTextNode('\u00A0');sel=rangy.getSelection();if(!(sel.getRangeAt&&sel.rangeCount)){return;}
range=sel.getRangeAt(0);range.insertNode(element);if(isCompleteMention){range.setStartAfter(element);range.insertNode(spaceTextNode);range.setStartAfter(spaceTextNode);}else{range.selectNodeContents(element);}
range.collapse(false);sel.removeAllRanges();sel.addRange(range);}
function addMention(ctx,id,href,text){var mentionEl=createMentionEl(ctx.mentionTrigger,id,href,text);deleteInputtedMentionText(ctx.inputBuffer);insertElementAtCursor(mentionEl,true);ctx.inputBuffer='';}
function getMentionTrigger(mentionTriggers,inputBuffer){return arrayUtils.filter(mentionTriggers,function(mentionTrigger){return inputBuffer.lastIndexOf(mentionTrigger)!==-1;});}
function parseMentionData(ctx){if(ctx.shouldContinueMentionLookup&&ctx.dataProvider&&ctx.inputBuffer.length>1&&ctx.inputBuffer.length<50&&!isCursorInsideMentionEl('a')){ctx.dataProvider(ctx.inputBuffer.substring(1)).then(function(data){if(data.length===0){ctx.shouldContinueMentionLookup=false;}
ctx.selectorDropdown.setItems(data);}).caught(function(error){if(!error instanceof promises.CancellationError){throw error;}});}else if(ctx.inputBuffer.length===1){ctx.selectorDropdown.setItems([{text:$t('Mention someone to notify them','mention_selector_enter_name'),isNotSelectable:true}]);}else{ctx.selectorDropdown.setItems([]);}}
function stopLookup(ctx){ctx.inputBuffer='';ctx.shouldContinueMentionLookup=false;ctx.mentionTrigger='';ctx.mentionTriggerIndex=-1;ctx.selectorDropdown.setItems([]);ctx.range=null;ctx.typedValue=[];}
function calculateResize(ctx){return function(){var contentEditableElBoundingRect=dom.getBoundingClientRect(ctx.contentEditableEl);if(ctx.contentEditableElClientHeight!==contentEditableElBoundingRect.height){ctx.fire('resize');ctx.contentEditableElClientHeight=contentEditableElBoundingRect.height;}};}
function keypressHandler(ctx){return function(event){var keyCode=event.which||event.keyCode,mentionTrigger,selection,range,br,typedValue,zeroWidthChar;if(keyCode===KEY.BACKSPACE){return;}
if(keyCode===KEY.RETURN&&browser.isIE()&&browser.getVersion()==='9'){range=document.selection.createRange();range.pasteHTML('<br> ');range.moveStart('character',0);range.moveEnd('character',-1);range.select();event.preventDefault();event.stopPropagation();}else if(keyCode===KEY.RETURN&&browser.isIE()){selection=win.getSelection();range=selection.getRangeAt(0);br=document.createElement('br');zeroWidthChar=document.createTextNode(ZERO_WIDTH_CHAR);range.deleteContents();range.insertNode(br);range.collapse(false);range.insertNode(zeroWidthChar);range.collapse(true);selection.removeAllRanges();selection.addRange(range);event.preventDefault();event.stopPropagation();}
calculateResize(ctx)();if(event.type==='compositionend'){typedValue=event.originalEvent.data;}else{typedValue=String.fromCharCode(keyCode);}
mentionTrigger=getMentionTrigger(ctx.mentionTriggers,typedValue);if(isNoActiveMention(ctx,mentionTrigger)){return;}else if(isNewMention(ctx,mentionTrigger)){ctx.inputBuffer='';ctx.mentionTrigger=mentionTrigger[0];ctx.range=null;ctx.shouldContinueMentionLookup=true;ctx.typedValue=[];}
if(!ctx.typedValue){ctx.typedValue=[];}
ctx.typedValue.push(typedValue);};}
function keydownHandler(ctx){return function(event){var keyCode=event.which||event.keyCode;if(keyCode===KEY.LEFT||keyCode===KEY.RIGHT||keyCode===KEY.HOME||keyCode===KEY.END){ctx.inputBuffer='';return;}
if(keyCode===KEY.BACKSPACE){ctx.inputBuffer=ctx.inputBuffer.slice(0,ctx.inputBuffer.length-1);ctx.shouldContinueMentionLookup=true;parseMentionData(ctx);}};}
function keyupHandler(ctx){return function(){if(ctx.typedValue&&ctx.typedValue.length&&ctx.mentionTrigger&&ctx.shouldContinueMentionLookup){var cursorPos=rangy.getSelection().getRangeAt(0);if(!ctx.range){ctx.range=cursorPos;ctx.mentionTriggerIndex=ctx.range.startOffset;}else if(cursorPos.startOffset<=ctx.mentionTriggerIndex||cursorPos.compareBoundaryPoints(Range.START_TO_END,ctx.range)<0){stopLookup(ctx);return;}
while(ctx.typedValue.length){ctx.inputBuffer+=ctx.typedValue.shift();}
parseMentionData(ctx);}
calculateResize(ctx);};}
function menuItemSelectHandler(ctx){return function(event){addMention(ctx,event.data.id,event.data.href,event.data.text);};}
function setPlaceholder(contentEditableEl){var placeholderEl=document.createElement('p'),placeholderText=contentEditableEl.getAttribute('data-placeholder'),placeholderTextEl=document.createTextNode(placeholderText);if(placeholderText){placeholderEl.className='placeholder';placeholderEl.appendChild(placeholderTextEl);contentEditableEl.insertBefore(placeholderEl,contentEditableEl.firstChild);}}
function blurHandler(ctx){return function(){var contentEditableEl=ctx.contentEditableEl,placeholderEl=contentEditableEl.querySelector('.placeholder'),contentEditableText=contentEditableEl.textContent||contentEditableEl.innerText;if(!placeholderEl&&(!contentEditableText||contentEditableText.length===0)){setPlaceholder(contentEditableEl);}
ctx.selectorDropdown.setItems([]);};}
function focusHandler(ctx){return function(){var placeholderEl=ctx.contentEditableEl.querySelector('.placeholder'),contentEditableElBoundingRect=dom.getBoundingClientRect(ctx.contentEditableEl);dom.removeClass(ctx.contentEditableEl,'has-error');ctx.contentEditableEl.removeAttribute('data-hover');ctx.contentEditableEl.removeAttribute('aria-label');ctx.contentEditableElClientHeight=contentEditableElBoundingRect.height;if(placeholderEl){ctx.contentEditableEl.removeChild(placeholderEl);insertElementAtCursor(document.createElement('div'));}};}
function processPaste(element,pastedContent){var pastedContentNode=document.createTextNode(pastedContent),sel=rangy.getSelection(),range;sel.deleteFromDocument();range=sel.getRangeAt(0);range.insertNode(pastedContentNode);range.collapseAfter(pastedContentNode);rangy.getSelection().setSingleRange(range);}
function pasteHandler(ctx){return function(event){var e=event.originalEvent,pastedContent;if(e.clipboardData||win.clipboardData){pastedContent=e.clipboardData?e.clipboardData.getData('text/plain'):win.clipboardData.getData('Text');}
if(pastedContent&&pastedContent.length>0){setTimeout(function(){processPaste(ctx.contentEditableEl,pastedContent);calculateResize(ctx)();},1);}
event.stopPropagation();event.preventDefault();};}
function getInnerText(el){var text='',sel=rangy.getSelection(),range;sel.removeAllRanges();range=document.createRange();range.selectNodeContents(el);sel.addRange(range);text=win.getSelection().toString();sel.removeAllRanges();return text;}
function MentionTextarea(mentionTriggers,contentEditableEl,dataProvider){var contactSelectorDropdownService=application.getService('contact-selector-dropdown');setPlaceholder(contentEditableEl);this.selectorDropdown=contactSelectorDropdownService.create(contentEditableEl);this.menuItemSelectHandlerRef=menuItemSelectHandler(this);this.keypressHandlerRef=keypressHandler(this);this.keydownHandlerRef=keydownHandler(this);this.keyupHandlerRef=keyupHandler(this);this.focusHandlerRef=focusHandler(this);this.pasteHandlerRef=pasteHandler(this);this.blurHandlerRef=blurHandler(this);this.contentEditableEl=contentEditableEl;this.mentionTriggers=mentionTriggers;this.mentionTrigger='';this.dataProvider=dataProvider;this.inputBuffer='';this.typedValue=[];this.shouldContinueMentionLookup=false;this.selectorDropdown.on('dropdownitemselect',this.menuItemSelectHandlerRef);dom.on(this.contentEditableEl,'keypress',this.keypressHandlerRef);dom.on(this.contentEditableEl,'keydown',this.keydownHandlerRef);dom.on(this.contentEditableEl,'focus',this.focusHandlerRef);dom.on(this.contentEditableEl,'blur',this.blurHandlerRef);dom.on(this.contentEditableEl,'keyup',this.keyupHandlerRef);dom.on(this.contentEditableEl,'paste',this.pasteHandlerRef);dom.on(this.contentEditableEl,'compositionend',this.keypressHandlerRef);$.extend(this,new Box.EventTarget());}
MentionTextarea.prototype={focus:function(){this.contentEditableEl.focus();},reset:function(){dom.setHTML(this.contentEditableEl,'');this.selectorDropdown.setItems([]);this.inputBuffer='';setPlaceholder(this.contentEditableEl);},getMessage:function(){var mentionElements,message={message:'',messageMentioned:''},i,zeroWidthCharRegex=new RegExp(ZERO_WIDTH_CHAR,'g'),messageStr=this.contentEditableEl.innerText||getInnerText(this.contentEditableEl),mentionElementsLen;messageStr=messageStr.replace(zeroWidthCharRegex,'');if(dom.query('.placeholder',this.contentEditableEl)||messageStr.length===0){return message;}else{mentionElements=this.contentEditableEl.querySelectorAll('a[data-id]');mentionElementsLen=mentionElements.length;message.message=messageStr;message.messageMentioned=messageStr;for(i=0;i<mentionElementsLen;i++){var mentionEl=mentionElements[i],mentionText=mentionEl.textContent||mentionEl.innerText,mentionName=mentionText.length>1?mentionText.slice(1):' ',formattedMention=this.mentionTriggers[0]+'['+mentionEl.getAttribute('data-id')+':'+mentionName+']';message.messageMentioned=message.messageMentioned.replace(mentionText,formattedMention);}
return message;}},setMessage:function(messageHtml){dom.setHTML(this.contentEditableEl,messageHtml);},initMentionAtCursor:function(){this.contentEditableEl.focus();var me=this;setTimeout(function(){me.mentionTrigger=me.mentionTriggers[0];var textNode=document.createTextNode(me.mentionTrigger);insertElementAtCursor(textNode,false);me.range=rangy.getSelection().getRangeAt(0);me.mentionTriggerIndex=me.range.startOffset-1;me.inputBuffer=me.mentionTrigger;me.shouldContinueMentionLookup=true;me.typedValue=[];parseMentionData(me);},0);},insertMentionAtCursor:function(id,href,text){var mentionEl=createMentionEl(this.mentionTriggers[0],id,href,text);win.setTimeout(function(){insertElementAtCursor(mentionEl,true);},0);},displayError:function(errorString){dom.addClass(this.contentEditableEl,'has-error');this.contentEditableEl.setAttribute('data-tooltip','');this.contentEditableEl.setAttribute('data-tooltip-theme','error');this.contentEditableEl.setAttribute('aria-label',errorString);},destroy:function(){dom.setHTML(this.contentEditableEl,'');this.selectorDropdown.off('dropdownitemselect',this.menuItemSelectHandlerRef);dom.off(this.contentEditableEl,'keypress',this.keypressHandlerRef);dom.off(this.contentEditableEl,'keydown',this.keydownHandlerRef);dom.off(this.contentEditableEl,'focus',this.focusHandlerRef);dom.off(this.contentEditableEl,'keyup',this.keyupHandlerRef);dom.off(this.contentEditableEl,'paste',this.pasteHandlerRef);dom.off(this.contentEditableEl,'blur',this.blurHandlerRef);dom.off(this.contentEditableEl,'compositionend',this.keypressHandlerRef);}};return{create:function(mentionTriggers,contentEditableEl,dataProvider){return new MentionTextarea(mentionTriggers,contentEditableEl,dataProvider);}};});Box.Application.addService('pill-selector',function(application){'use strict';var dom=application.getService('dom');var promises=application.getService('promises');var arrayUtils=application.getService('array-utils');var contactSelectorDropdownService=application.getService('contact-selector-dropdown');var stringService=application.getService('strings');var tooltipsService=application.getService('tooltips-amsterdam');var preventBlur=false;var INPUT_HAS_FOCUS_CLASS='input-has-focus';var INPUT_WRAPPER_CLASS='pill-selector-input-wrapper';var INPUT_CLASS='pill-selector-input';var PILL_CLASS='pill';var PILL_HIGHLIGHT_CLASS='pill-highlighted';var PILL_OPTION_HAS_FOCUS_CLASS='pill-option-has-focus';var PILL_REMOVER_CLASS='pill-remover';var WRAPPER_CLASS='pill-selector';var INVALID_CLASS='is-invalid';var HIDDEN_CLASS='hidden';var PILL_REMOVER_LABEL=$t('Remove','pill_selector_remove_pill_label');function getObjectIndexById(arr,id){var i;for(i=0;i<arr.length;i++){if(arr[i].id===id){return i;}}
return-1;}
function PillSelector(originalEl,dataProviderMethod){this.originalInput=originalEl;this.dataProviderMethod=dataProviderMethod;this.wrapperElement=null;this.inputElement=null;this.inputWrapperElement=null;this.inputWrapperElementHeight=0;this.pills=[];this.highlightedPill=null;$.extend(this,new Box.EventTarget());}
function setPlaceholder(originalInputEl,pillInputEl){if(originalInputEl&&pillInputEl){pillInputEl.placeholder=originalInputEl.getAttribute('data-placeholder')||'';}}
PillSelector.prototype.init=function(pills){this.wrapElement();this.bindEvents();setPlaceholder(this.originalInput,this.inputElement);if(pills&&pills.length){this.insertArrayOfPills(pills);}};PillSelector.prototype.destroy=function(){dom.removeClass(this.originalInput,HIDDEN_CLASS);this.wrapperElement.parentNode.removeChild(this.wrapperElement);};PillSelector.prototype.wrapElement=function(){var selectorWrapper=this.wrapperElement=document.createElement('div');selectorWrapper.className=WRAPPER_CLASS;var selectorInputWrapper=this.inputWrapperElement=document.createElement('div');selectorInputWrapper.className=INPUT_WRAPPER_CLASS;var selectorInput=this.inputElement=document.createElement('input');selectorInput.type='text';selectorInput.className=INPUT_CLASS+' '+this.originalInput.className;selectorInput.setAttribute('autocomplete','off');selectorInputWrapper.appendChild(selectorInput);selectorWrapper.appendChild(selectorInputWrapper);this.selectorDropdownWidget=contactSelectorDropdownService.create(selectorInputWrapper);this.originalInput.parentNode.insertBefore(selectorWrapper,this.originalInput);dom.addClass(this.originalInput,HIDDEN_CLASS);};PillSelector.prototype.bindEvents=function(){var me=this;dom.on(this.inputElement,'focus',function(){me.removeAllErrors();dom.addClass(me.inputWrapperElement,INPUT_HAS_FOCUS_CLASS);me.inputWrapperElementClientHeight=dom.getBoundingClientRect(me.inputWrapperElement).height;preventBlur=true;});dom.on(this.inputElement,'blur',function(){if(preventBlur){me.inputElement.focus();preventBlur=false;}else{me.removePillHighlight();me.selectorDropdownWidget.setItems([]);dom.removeClass(me.inputWrapperElement,INPUT_HAS_FOCUS_CLASS);}});dom.on(this.inputElement,'keyup',function(event){if(event.keyCode===37||event.keyCode===38||event.keyCode===39||event.keyCode===40){return;}
var val=me.inputElement.value;if(!val){me.clearResults();return;}
me.removePillHighlight();me.search(val);});dom.on(this.wrapperElement,'click',function(event){var target=event.target||event.srcElement;if(!dom.hasClass(target,PILL_REMOVER_CLASS)){return;}
var pill=dom.getNearest(target,'.'+PILL_CLASS);var id=pill.getAttribute('data-id');pill.parentNode.removeChild(pill);me.inputElement.focus();me.clearResults();me.removePillById(id);event.preventDefault();event.stopPropagation();});dom.on(this.wrapperElement,'keydown',function(event){event=$.event.fix(event);switch(event.keyCode){case 8:if(me.highlightedPill){me.deleteHighlightedPill();}else if(me.isCursorAtBeginning()){me.highlightLastPill();}
break;case 37:if(me.highlightedPill){me.movePillHighlightLeft();}else if(me.isCursorAtBeginning()){me.highlightLastPill();}
break;case 39:if(me.highlightedPill){me.movePillHighlightRight();}
break;}});dom.on(this.wrapperElement,'mousedown',function(event){var target=event.target||event.srcElement;if(dom.hasClass(target,INPUT_WRAPPER_CLASS)){preventBlur=false;}else if(dom.hasClass(target,PILL_OPTION_HAS_FOCUS_CLASS)){me.createPillBeforeInput(target);me.clearResults();preventBlur=true;}else if(dom.hasClass(target,PILL_CLASS)){me.movePillHighlight(target);preventBlur=true;}else{me.inputElement.focus();preventBlur=false;me.removePillHighlight();}
event.stopPropagation();});this.selectorDropdownWidget.on('dropdownitemselect',function(event){me.createPillBeforeInput(event.data);me.selectorDropdownWidget.setItems([]);});};PillSelector.prototype.search=function(query){var me=this;this.dataProviderMethod(query).then(function(data){var items=arrayUtils.filter(data,function(val){return arrayUtils.every(me.pills,function(pill){return(pill.id!==val.id)&&(!pill.data||!val.data||pill.data.id!==val.data.id);});});me.selectorDropdownWidget.setItems(items);}).caught(function(error){if(!error instanceof promises.CancellationError){throw error;}});};PillSelector.prototype.insertArrayOfPills=function(pillDataArray){var i,len=pillDataArray.length;for(i=0;i<len;i++){this.createPillBeforeInput(pillDataArray[i]);}};PillSelector.prototype.createPillBeforeInput=function(data){if(getObjectIndexById(this.pills,data.id)!==-1){this.inputElement.value='';return;}
var pillRemover=document.createElement('span');dom.addClass(pillRemover,PILL_REMOVER_CLASS);dom.setHTML(pillRemover,'&times;');pillRemover.setAttribute('title',PILL_REMOVER_LABEL);pillRemover.setAttribute('aria-label',PILL_REMOVER_LABEL);var span=document.createElement('span');dom.addClass(span,PILL_CLASS);dom.setText(span,data.text);span.setAttribute('data-id',data.id.toString());span.appendChild(pillRemover);if(data.data&&data.data.type==='group'){span.setAttribute('data-group','');}
this.inputWrapperElement.insertBefore(span,this.inputElement);this.inputElement.value='';this.inputElement.placeholder='';this.pills.push(data);this.fire('updated');this.calculateResize();};PillSelector.prototype.highlightLastPill=function(){var allThePills=dom.queryAll('.'+PILL_CLASS,this.wrapperElement);var lastPill=allThePills&&allThePills[allThePills.length-1];if(lastPill){this.highlightedPill=lastPill;dom.addClass(lastPill,PILL_HIGHLIGHT_CLASS);}};PillSelector.prototype.calculateResize=function(){var inputWrapperElementBoundingRect=dom.getBoundingClientRect(this.inputWrapperElement);if(this.inputWrapperElementClientHeight!==inputWrapperElementBoundingRect.height){this.fire('resize');this.inputWrapperElementClientHeight=inputWrapperElementBoundingRect.height;}};PillSelector.prototype.deletePills=function(idArr){if(!idArr||idArr.length===0){return;}
var idArrLen=idArr.length,pill,id,i;for(i=0;i<idArrLen;i++){id=idArr[i];pill=dom.query('.pill[data-id="'+id+'"]',this.inputWrapperElement);if(!pill){continue;}
this.inputWrapperElement.removeChild(pill);this.removePillById(id);}
if(this.getPills().length===0){setPlaceholder(this.originalInput,this.inputElement);}
this.inputElement.select(0);this.calculateResize();};PillSelector.prototype.deleteHighlightedPill=function(){if(!this.highlightedPill){return;}
var id=this.highlightedPill.getAttribute('data-id');if(id){this.deletePills([id]);this.highlightedPill=null;}};PillSelector.prototype.movePillHighlight=function(pill){if(this.highlightedPill){dom.removeClass(this.highlightedPill,PILL_HIGHLIGHT_CLASS);}
this.highlightedPill=pill||this.highlightedPill;dom.addClass(pill,PILL_HIGHLIGHT_CLASS);};PillSelector.prototype.movePillHighlightLeft=function(){var leftSibling=this.highlightedPill&&this.highlightedPill.previousSibling;if(leftSibling){this.movePillHighlight(leftSibling);}};PillSelector.prototype.movePillHighlightRight=function(){var rightSibling=this.highlightedPill&&this.highlightedPill.nextSibling;if(rightSibling&&dom.hasClass(rightSibling,PILL_CLASS)){this.movePillHighlight(rightSibling);}else{this.removePillHighlight();}};PillSelector.prototype.removePillHighlight=function(){if(this.highlightedPill){dom.removeClass(this.highlightedPill,PILL_HIGHLIGHT_CLASS);}
this.highlightedPill=null;};PillSelector.prototype.removePillById=function(id){this.pills.splice(getObjectIndexById(this.pills,id),1);this.fire('updated');};PillSelector.prototype.clearResults=function(){this.selectorDropdownWidget.setItems([]);};PillSelector.prototype.isCursorAtBeginning=function(){if(typeof this.inputElement.selectionStart==='undefined'){return false;}else{return!this.inputElement.selectionStart&&!this.inputElement.selectionEnd;}};PillSelector.prototype.getPills=function(){return this.pills;};PillSelector.prototype.displayError=function(errorString,params){params=params||{};dom.addClass(this.inputWrapperElement,'has-error');this.inputWrapperElement.setAttribute('data-tooltip','');if(params.tooltipPosition){this.inputWrapperElement.setAttribute('data-tooltip-position',params.tooltipPosition);}
if(params.tooltipRelative){this.inputWrapperElement.setAttribute('data-tooltip-relative',params.tooltipRelative);}
this.inputWrapperElement.setAttribute('data-tooltip-theme','error');this.inputWrapperElement.setAttribute('aria-label',errorString);tooltipsService.show(this.inputWrapperElement);};PillSelector.prototype.removeAllErrors=function(){if(dom.hasClass(this.inputWrapperElement,'has-error')){dom.removeClass(this.inputWrapperElement,'has-error');if(tooltipsService&&this.inputWrapperElement.hasAttribute('data-tooltip')){tooltipsService.hide(this.inputWrapperElement);}
this.inputWrapperElement.removeAttribute('data-tooltip');this.inputWrapperElement.removeAttribute('data-tooltip-position');this.inputWrapperElement.removeAttribute('data-tooltip-relative');this.inputWrapperElement.removeAttribute('data-tooltip-theme');this.inputWrapperElement.removeAttribute('aria-label');this.inputWrapperElement.removeAttribute('data-hover');}};PillSelector.prototype.reset=function(){var pillElements=this.inputWrapperElement.querySelectorAll('span[data-id]'),pillElementsLen=pillElements.length;for(var i=0;i<pillElementsLen;i++){this.inputWrapperElement.removeChild(pillElements[i]);}
this.pills=[];this.highlightedPill=null;this.inputElement.value='';this.selectorDropdownWidget.setItems([]);setPlaceholder(this.originalInput,this.inputElement);};PillSelector.prototype.createDataArrayFromString=function(str){var serializedArr=[];var emailRegex=/[^\s[\<(]+@[^\s<>@,\/\\]+\.[^\s\<>,;)]+/gi;var arr=str.match(emailRegex);if(!arr){return serializedArr;}
var elem,formattedElem,userName,data;for(var i=0,len=arr.length;i<len;i++){elem=arr[i];formattedElem=stringService.trim(elem);userName='';if(!formattedElem){continue;}
if(elem.indexOf(':')>=0){formattedElem=elem.split(':')[0];userName=elem.substr(elem.indexOf(':')+1);}
data={id:formattedElem,text:userName||formattedElem};serializedArr.push(data);}
return serializedArr;};PillSelector.prototype.validatePills=function(isPillValid,errorMessage){var allPillsValid=true;this.pills.forEach(function(pill){var pillEl=dom.query('.'+PILL_CLASS+'[data-id="'+pill.id+'"]',this.inputWrapperElement);if(!isPillValid(pill)){dom.addClass(pillEl,INVALID_CLASS);allPillsValid=false;}else{dom.removeClass(pillEl,INVALID_CLASS);}},this);if(errorMessage&&!allPillsValid){this.displayError(errorMessage);}
return allPillsValid;};PillSelector.prototype.getPillIDsByType=function(){var defaultIDs=[];var groupIDs=[];this.pills.forEach(function(pill){if(pill.data&&pill.data.type==='group'){groupIDs.push(pill.id);}else{defaultIDs.push(pill.id);}});return{defaultIDs:defaultIDs,groupIDs:groupIDs};};return{create:function(element,dataProvider){return new PillSelector(element,dataProvider);}};});Box.Application.addService('provider-contacts',function(application){'use strict';var RM_CONTACTS_GET='sham_contacts_get',UPLOADER_BADGE={title:$t('UPLOADER','contact_selector_uploader'),tooltip:$t('This user does not have permission to add comments or respond to tasks.','contact_selector_uploader_description')};var ajax=application.getService('ajax'),urlService=application.getService('url');var ongoingRequest;function formatContactsForContactsGetRunmode(data,options){var results=[],contacts,contact=null,i,len;if(data.hasOwnProperty('contacts')){contacts=data.contacts;for(i=0,len=contacts.length;i<len;i++){contact=contacts[i];results.push({data:{email:contact.email,id:contact.id,type:'user'},id:contact.email,text:contact.contact_name,email:contact.email});}}
if(data.hasOwnProperty('collabs_without_account')&&!options.excludeWithoutAccount){contacts=data.collabs_without_account;for(i=0,len=contacts.length;i<len;i++){contact=contacts[i];results.push({data:{email:contact.email,id:contact.email,type:'collab_without_account'},id:contact.email,text:contact.email,email:''});}}
if(data.hasOwnProperty('friends_without_account')&&!options.excludeWithoutAccount){contacts=data.friends_without_account;for(i=0,len=contacts.length;i<len;i++){contact=contacts[i];results.push({data:{email:contact.email,id:contact.email,type:'friend_without_account'},id:contact.email,text:contact.contact_name,email:contact.email});}}
if(data.hasOwnProperty('groups')){contacts=data.groups;for(i=0,len=contacts.length;i<len;i++){contact=contacts[i];results.push({data:{email:'',id:contact.id,type:'group'},id:contact.id,text:contact.contact_name,email:$t('Group','group_text')});}}
return results;}
function searchAllContactsWithOptions(typedId,options){return function(query){if(ongoingRequest){ongoingRequest.cancel();ongoingRequest=null;}
var runmode=urlService.getGcmCompatibleRm(RM_CONTACTS_GET);ongoingRequest=ajax.get(runmode,{searchString:query,itemTypedId:typedId,includeSelf:!!options.includeSelf,includeGroups:!!options.includeGroups});return ongoingRequest.then(function(response){ongoingRequest=null;return formatContactsForContactsGetRunmode(response.data,options);},function(){ongoingRequest=null;});};}
return{searchAllContacts:function(options){return searchAllContactsWithOptions('',options||{});},searchAllContactsExcludingItemCollaborators:function(typedId,options){if(typedId){return searchAllContactsWithOptions(typedId,options||{});}else{return this.searchAllContacts(options);}},searchWithItem:function(typedId){return function(query){if(ongoingRequest){ongoingRequest.cancel();ongoingRequest=null;}
ongoingRequest=ajax.get('sham_contacts_get_for_item',{search_string:query,item_typed_id:typedId||'',include_pending_collabs:false,include_self:false});return ongoingRequest.then(function(response){ongoingRequest=null;var ret=[],contactsLength=response.data.contacts.length;for(var i=0;i<contactsLength;i++){ret.push({text:response.data.contacts[i].contact_name,id:''+response.data.contacts[i].id,data:response.data.contacts[i],href:'/profile/'+response.data.contacts[i].id,email:response.data.contacts[i].email,isNotSelectable:response.data.is_uploader[response.data.contacts[i].id],badge:response.data.is_uploader[response.data.contacts[i].id]?UPLOADER_BADGE:null});}
return ret;},function(){ongoingRequest=null;});};}};});Box.Application.addService('contact-selector-dropdown',function(application){'use strict';var KEY={UP:38,DOWN:40,RETURN:13,TAB:9},IS_VISIBLE='is-visible';var DROPDOWN_ROW_HTML='<a class="<%= className %>" data-id="<%= id %>">'+'<span class="contact-selector-dropdown-text" title="<%= text %>"><%= text %></span>'+'<span class="contact-selector-dropdown-email" title="<%= secondaryText %>"><%= secondaryText %></span>'+'</a>';var DROPDOWN_ROW_WITH_BADGE_HTML='<a class="<%= className %>" data-id="<%= id %>">'+'<span class="contact-selector-dropdown-text" title="<%= text %>"><%= text %></span>'+'<span class="contact-selector-dropdown-email" title="<%= secondaryText %>"><%= secondaryText %></span>'+'<span data-hover="tooltip" aria-label="<%= badgeTooltip %>" class="badge role"><%= badgeTitle %></span>'+'</a>';var dom=application.getService('dom'),templates=application.getService('templates'),resinService=application.getService('resin'),itemsCache={};function setMenuScrollPositionForActiveElement(activeEl,menuEl){if(!(activeEl&&menuEl)){return;}
var menuHeight=menuEl.offsetHeight,menuScrollPosition=menuEl.scrollTop,expectedItemHeight=Math.floor(menuHeight/5),activeItemPosition=activeEl.offsetTop,position=0;position=(activeItemPosition+expectedItemHeight)-(menuScrollPosition+menuHeight);if(position>0){menuEl.scrollTop=menuScrollPosition+position;return;}
position=menuScrollPosition-activeItemPosition;if(position>0){menuEl.scrollTop=menuScrollPosition-position;}}
function moveFocusInDropdown(dropdown,menuitemEl){if(dropdown.activeMenuItemEl){dom.removeClass(dropdown.activeMenuItemEl,'hover');}
dropdown.activeMenuItemEl=menuitemEl;if(dropdown.activeMenuItemEl){dom.addClass(dropdown.activeMenuItemEl,'hover');}
setMenuScrollPositionForActiveElement(dropdown.activeMenuItemEl,dropdown.selectorDropdownMenu);}
function keydownHandler(dropdown){return function(event){var keyCode=event.which||event.keyCode,activeMenuItemEl=dropdown.activeMenuItemEl,selectorDropdownMenu=dropdown.selectorDropdownMenu,target,dataId,item;if(!dom.hasClass(selectorDropdownMenu,IS_VISIBLE)){return true;}
switch(keyCode){case KEY.DOWN:if(activeMenuItemEl){moveFocusInDropdown(dropdown,activeMenuItemEl.nextSibling);}else{moveFocusInDropdown(dropdown,selectorDropdownMenu.children[0]);}
break;case KEY.UP:if(activeMenuItemEl){moveFocusInDropdown(dropdown,activeMenuItemEl.previousSibling);}else{moveFocusInDropdown(dropdown,selectorDropdownMenu.children[dropdown.selectorDropdownMenu.children.length-1]);}
break;case KEY.RETURN:case KEY.TAB:if(!activeMenuItemEl||dom.hasClass(activeMenuItemEl,'disabled')){break;}
dataId=activeMenuItemEl.getAttribute('data-id');item=itemsCache[dataId]||{};resinService.recordActionFromElement(activeMenuItemEl,{target:'selectname',action:'keypress'});dropdown.fire('dropdownitemselect',{id:item.id,href:item.href,email:item.email,text:item.text,data:item.data});dom.removeClass(selectorDropdownMenu,IS_VISIBLE);break;default:return true;}
return false;};}
function mouseOverHandler(dropdown){return function(event){var target=event.target||event.srcElement;if(target.getAttribute('data-id')){moveFocusInDropdown(dropdown,target);}else if(target.parentNode.getAttribute('data-id')){moveFocusInDropdown(dropdown,target.parentNode);}};}
function mouseDownHandler(dropdown){return function(event){var target=event.target||event.srcElement,contactEl=target.nodeName==='SPAN'?target.parentNode:target,dataId=contactEl.getAttribute('data-id'),item=itemsCache[dataId]||{};if(!dataId||dom.hasClass(contactEl,'disabled')){return false;}
resinService.recordActionFromElement(contactEl,{target:'selectname',action:'click'});dropdown.fire('dropdownitemselect',{id:item.id,href:item.href,email:item.email,text:item.text,data:item.data});dom.removeClass(dropdown.selectorDropdownMenu,IS_VISIBLE);};}
function SelectorDropdown(inputEl){var selectorDropdownMenu=document.createElement('div');selectorDropdownMenu.className='contact-selector-dropdown';dom.insertAfter(selectorDropdownMenu,inputEl);this.keydownHandlerRef=keydownHandler(this);this.mousedownHandlerRef=mouseDownHandler(this);this.mouseoverHandlerRef=mouseOverHandler(this);dom.on(inputEl,'keydown',this.keydownHandlerRef);dom.on(selectorDropdownMenu,'mouseover',this.mouseoverHandlerRef);dom.on(selectorDropdownMenu,'mousedown',this.mousedownHandlerRef);this.inputEl=inputEl;this.selectorDropdownMenu=selectorDropdownMenu;$.extend(this,new Box.EventTarget());}
SelectorDropdown.prototype={setItems:function(items){var itemsLength=items.length,i,itemId,mentionTemplateFragment;dom.setHTML(this.selectorDropdownMenu,'');itemsCache={};if(itemsLength>0){for(i=0;i<itemsLength;i++){itemId=items[i].id;if(items[i].badge){mentionTemplateFragment=templates.createTemplateFragment(DROPDOWN_ROW_WITH_BADGE_HTML,{id:''+itemId,text:items[i].text,secondaryText:items[i].email||'',className:items[i].isNotSelectable?'disabled':'',badgeTitle:items[i].badge.title,badgeTooltip:items[i].badge.tooltip});}else{mentionTemplateFragment=templates.createTemplateFragment(DROPDOWN_ROW_HTML,{id:''+itemId,text:items[i].text,secondaryText:items[i].email||'',className:items[i].isNotSelectable?'disabled':''});}
this.selectorDropdownMenu.appendChild(mentionTemplateFragment);itemsCache[itemId]=items[i];}
moveFocusInDropdown(this,this.selectorDropdownMenu.children[0]);dom.addClass(this.selectorDropdownMenu,IS_VISIBLE);}else{dom.removeClass(this.selectorDropdownMenu,IS_VISIBLE);}},destroy:function(){dom.off(this.inputEl,'keydown',this.keydownHandlerRef);dom.off(this.selectorDropdownMenu,'mouseover',this.mouseoverHandlerRef);dom.off(this.selectorDropdownMenu,'mousedown',this.mousedownHandlerRef);}};return{create:function(inputEl){return new SelectorDropdown(inputEl);}};});Box.Application.addService('session-store',function(application){'use strict';var KEY_PREFIX='sessionStore';var SERVICE_VERSION='0';var memoryStore={};var sessionStorage;function buildKey(key){return KEY_PREFIX+'/'+SERVICE_VERSION+'/'+key;}
function canUseSessionStorage(){try{sessionStorage=application.getGlobal('sessionStorage');sessionStorage.setItem(buildKey('TestKey'),'testValue');sessionStorage.removeItem(buildKey('TestKey'));return true;}catch(e){return false;}}
var isSessionStorageAvailable=canUseSessionStorage();return{setItem:function(key,value){if(isSessionStorageAvailable){try{sessionStorage.setItem(buildKey(key),JSON.stringify(value));}catch(e){}}else{memoryStore[key]=value;}},getItem:function(key){if(isSessionStorageAvailable){try{return JSON.parse(sessionStorage.getItem(buildKey(key)));}catch(e){return null;}}else{return memoryStore[key];}},removeItem:function(key){if(isSessionStorageAvailable){try{sessionStorage.removeItem(buildKey(key));}catch(e){}}else if(memoryStore[key]){delete memoryStore[key];}},removeAll:function(){if(isSessionStorageAvailable){try{sessionStorage.clear();}catch(e){}}else if(Object.keys(memoryStore).length>0){memoryStore={};}}};});Box.Application.addService('tooltips-amsterdam',function(application){'use strict';var TOOLTIP_HTML='<div id="<%= id %>" class="tooltip-amsterdam <%= tooltipPosition %> <%= tooltipTheme %>" role="tooltip">'+'<div class="tooltip-arrow"></div>'+'<div class="tooltip-inner">'+'<%= text %>'+'</div>'+'</div>';var dom=application.getService('dom');var templates=application.getService('templates');var scrollEventAdded=false;var tooltipCache={};var numTooltips=0;var DEFAULTS={tooltipPosition:'right',tooltipTrigger:'hover focus',tooltipRelative:'body'};var ACTIONS={TOGGLE:'toggle',HIDE:'hide',SHOW:'show'};var TOOLTIP_ACTIVE_CLASS='tooltip-active';var TOOLTIP_SELECTOR='.tooltip-amsterdam';var TOOLTIP_PREFIX='data-tooltip';var POSITION_INVERTS={right:'left',left:'right',top:'bottom',bottom:'top'};function noop(){return;}
function getElementInfo(element,tooltipRelative){tooltipRelative=tooltipRelative||'body';var $element=$(element);var $tooltipRelative=$(tooltipRelative);var info=$.extend({},$element.offset(),{width:$element.outerWidth(),height:$element.outerHeight()});if(tooltipRelative!=='body'){info.left=$element.offset().left-$tooltipRelative.offset().left;info.top=$element.offset().top-$tooltipRelative.offset().top;}
info.right=info.left+info.width;info.bottom=info.top+info.height;return info;}
function isTooltipPositionAvailable(targetEl,tooltipEl,position){var targetDimensions=getElementInfo(targetEl);var tooltipDimensions=getElementInfo(tooltipEl);var $document=$(document);var documentHeight=$document.height();var documentWidth=$document.width();switch(position){case'top':return targetDimensions.top-tooltipDimensions.height>0;case'bottom':return targetDimensions.bottom+tooltipDimensions.height<documentHeight;case'left':return targetDimensions.left-tooltipDimensions.width>0;case'right':return targetDimensions.left+targetDimensions.width+tooltipDimensions.width<documentWidth;default:return false;}}
function updateTooltipPosition(tooltipEl,oldPosition,newPosition){dom.removeClass(tooltipEl,oldPosition);dom.addClass(tooltipEl,newPosition);}
function setTooltipCoords(element,position,offset){var arrow,difference,elementWidth=dom.getBoundingClientRect(element).width,left=offset.left,document=application.getGlobal('document'),innerwidth=document.body.clientWidth;if(position==='bottom'||position==='top'){arrow=dom.query('.tooltip-arrow',element);if(left<0){left=(elementWidth/2)+left;offset.left=0;arrow.style.left=left+'px';}else if((left+elementWidth)>innerwidth){difference=left+elementWidth-innerwidth;offset.left=left-difference;arrow.style.left=(elementWidth/2)+difference+'px';}}
element.style.left=offset.left+'px';element.style.top=offset.top+'px';}
function getTooltipTopOffset(targetOffset,tooltipOffset){return targetOffset.top+((targetOffset.height-tooltipOffset.height)/2);}
function getTooltipLeftOffset(targetOffset,tooltipOffset){return targetOffset.left+((targetOffset.width-tooltipOffset.width)/2);}
function getRightPosition(targetOffset,tooltipOffset){return{left:targetOffset.left+targetOffset.width,top:getTooltipTopOffset(targetOffset,tooltipOffset)};}
function getLeftPosition(targetOffset,tooltipOffset){return{left:targetOffset.left-tooltipOffset.width,top:getTooltipTopOffset(targetOffset,tooltipOffset)};}
function getTopPosition(targetOffset,tooltipOffset){return{left:getTooltipLeftOffset(targetOffset,tooltipOffset),top:targetOffset.top-tooltipOffset.height};}
function getBottomPosition(targetOffset,tooltipOffset){return{left:getTooltipLeftOffset(targetOffset,tooltipOffset),top:targetOffset.top+targetOffset.height};}
function getTooltipCoords(tooltipRelative,position,targetEl,tooltipEl){var tooltipDimensions=getElementInfo(tooltipEl,tooltipRelative);var targetDimensions=getElementInfo(targetEl,tooltipRelative);switch(position){case'right':return getRightPosition(targetDimensions,tooltipDimensions);case'left':return getLeftPosition(targetDimensions,tooltipDimensions);case'bottom':return getBottomPosition(targetDimensions,tooltipDimensions);case'top':return getTopPosition(targetDimensions,tooltipDimensions);default:return getRightPosition(targetDimensions,tooltipDimensions);}}
function hideTooltip(targetEl){var tooltipId=targetEl.getAttribute('aria-describedby');var tooltipEl=tooltipCache[tooltipId];if(tooltipEl){targetEl.removeAttribute('aria-describedby');dom.removeClass(targetEl,TOOLTIP_ACTIVE_CLASS);$(tooltipEl).fadeOut('fast').remove();delete tooltipCache[tooltipId];numTooltips--;}}
function clean(){$(TOOLTIP_SELECTOR).remove();}
function hideAllTooltips(){if(numTooltips){var tooltips=dom.queryAll('['+TOOLTIP_PREFIX+']');for(var i=0;i<tooltips.length;i++){hideTooltip(tooltips[i]);}
clean();}}
function initializeHideOnScroll(){var window=application.getGlobal('window');if(window.addEventListener){window.addEventListener('scroll',hideAllTooltips,true);}
scrollEventAdded=true;}
function createTooltip(options){var document=application.getGlobal('document');var tooltipTemplateFragment=templates.createTemplateFragment(TOOLTIP_HTML,options);var $tooltipRelativeEl=$(options.tooltipRelative);if(!$tooltipRelativeEl.length){throw new Error('Tooltip relative container does not exist');}
$tooltipRelativeEl.append(tooltipTemplateFragment);tooltipCache[options.id]=document.getElementById(options.id);numTooltips++;if(!scrollEventAdded){initializeHideOnScroll();}
return tooltipCache[options.id];}
function showTooltip(targetEl,options){if(!options.text){return null;}
if(!$(targetEl).is(':visible')){return null;}
var tooltipEl=tooltipCache[options.id]||createTooltip(options);if(options.tooltipRelative==='body'){tooltipEl.style.left=0;tooltipEl.style.top=0;}
if(!isTooltipPositionAvailable(targetEl,tooltipEl,options.tooltipPosition)){var originalPosition=options.tooltipPosition;options.tooltipPosition=POSITION_INVERTS[options.tooltipPosition];updateTooltipPosition(tooltipEl,originalPosition,options.tooltipPosition);}
targetEl.setAttribute('aria-describedby',options.id);setTooltipCoords(tooltipEl,options.tooltipPosition,getTooltipCoords(options.tooltipRelative,options.tooltipPosition,targetEl,tooltipEl));dom.addClass(targetEl,TOOLTIP_ACTIVE_CLASS);$(tooltipEl).show();return tooltipEl;}
function generateUID(prefix){do{prefix+=Math.floor((Math.random()*1000000));}while(document.getElementById(prefix));return prefix;}
function isTriggerConfigured(trigger,triggers){return $.inArray(trigger,triggers)>-1;}
function getAction(eventType,element,options){var triggers=options.tooltipTrigger.split(' ');if(isTriggerConfigured('click',triggers)&&eventType==='click'){return ACTIONS.TOGGLE;}
if(eventType==='focusin'&&isTriggerConfigured('focus',triggers)&&!dom.hasClass(element,TOOLTIP_ACTIVE_CLASS)){return ACTIONS.SHOW;}
if(eventType==='focusout'&&isTriggerConfigured('focus',triggers)&&dom.hasClass(element,TOOLTIP_ACTIVE_CLASS)){return ACTIONS.HIDE;}
if(eventType==='mouseover'&&isTriggerConfigured('hover',triggers)&&!dom.hasClass(element,TOOLTIP_ACTIVE_CLASS)){return ACTIONS.SHOW;}
if(eventType==='mouseout'&&isTriggerConfigured('hover',triggers)&&dom.hasClass(element,TOOLTIP_ACTIVE_CLASS)){if(element===document.activeElement&&isTriggerConfigured('focus')){return noop();}else{return ACTIONS.HIDE;}}
return noop();}
function extractDataAttributes(element){var $element=$(element);return{tooltip:$element.attr('data-tooltip'),tooltipTrigger:$element.attr('data-tooltip-trigger'),tooltipPosition:$element.attr('data-tooltip-position'),tooltipTheme:$element.attr('data-tooltip-theme'),tooltipText:$element.attr('data-tooltip-text'),tooltipRelative:$element.attr('data-tooltip-relative')};}
function validateOptions(element,options){if($(element).is($(options.tooltipRelative))){throw new Error('Tooltip cannot be configured relative to itself');}}
function getOptions(element,jsConfig){var options=$.extend({},DEFAULTS,extractDataAttributes(element),jsConfig);options.text=options.tooltipText||element.getAttribute(TOOLTIP_PREFIX+'-text')||element.getAttribute('aria-label');options.id=element.getAttribute('aria-describedby')||generateUID('tooltip');validateOptions(element,options);return options;}
return{handleEvent:function(event){var targetEl=dom.getNearest(event.target,'['+TOOLTIP_PREFIX+']');if(!targetEl){return;}
var options=getOptions(targetEl);switch(getAction(event.type,targetEl,options)){case ACTIONS.SHOW:this.show(targetEl,options);break;case ACTIONS.HIDE:this.hide(targetEl,options);break;case ACTIONS.TOGGLE:this.toggle(targetEl,options);break;default:return;}},show:function(targetEl,options){return showTooltip(targetEl,getOptions(targetEl,options));},hide:function(targetEl,options){hideTooltip(targetEl,getOptions(targetEl,options));},hideAll:function(){hideAllTooltips();},toggle:function(targetEl,options){if(dom.hasClass(targetEl,TOOLTIP_ACTIVE_CLASS)){this.hide(targetEl,options);}else{this.show(targetEl,options);}}};});Box.Application.addService('url-amsterdam',function(){'use strict';function getKeys(object){var keys=[];for(var key in object){if(object.hasOwnProperty(key)){keys.push(key);}}
return keys;}
function encodeURIComponent(uri){return window.encodeURIComponent(uri).replace(/%20/g,'+');}
function decodeURIComponent(uri){return window.decodeURIComponent(uri.replace(/\+/g,' '));}
function encode(obj){if(typeof obj==='string'||typeof obj==='number'){return encodeURIComponent(obj);}
var params=[];var keys=getKeys(obj).sort();for(var i=0;i<keys.length;i++){var key=keys[i];var value=obj[key];if(value===undefined){params.push(encodeURIComponent(key));}else{params.push(encodeURIComponent(key)
+'='
+encodeURIComponent(value));}}
return params.join('&');}
function decode(qs,exclUndefined){if(!qs||qs==='?'){return{};}
if(qs&&qs[0]==='?'){qs=qs.substr(1);}
var splitQS=qs.split('&');var output={};for(var i=0,len=splitQS.length;i<len;i++){var p=splitQS[i].split('=');if(!!p[0]&&(!exclUndefined||p[1]!==undefined)){output[decodeURIComponent(p[0])]=decodeURIComponent(p[1]);}}
return output;}
return{encode:encode,decode:decode};});Box.Application.addService('aria',function(application){'use strict';return{setRole:function(element,role){element.setAttribute('role',role);},setFocusable:function(node,focusable){node.tabIndex=focusable?0:-1;},clearState:function(element,state){element.removeAttribute('aria-'+state);},hasState:function(element,state){return element.hasAttribute('aria-'+state);},setState:function(element,state){element.setAttribute('aria-'+state,true);},hide:function(element){this.setState(element,'hidden');},show:function(element){this.clearState(element,'hidden');}};});Box.Application.addService('array-utils',function(){'use strict';function arrayMap(array,iteratee){var index=-1,length=array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array);}
return result;}
function arrayFilter(array,predicate){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[++resIndex]=value;}}
return result;}
function createReduce(arrayFunc){return function(collection,iteratee,accumulator){var initFromArray=arguments.length<3;return arrayFunc(collection,iteratee,accumulator,initFromArray);};}
function arrayReduce(array,iteratee,accumulator,initFromArray){var index=-1,length=array.length;if(initFromArray&&length){accumulator=array[++index];}
while(++index<length){accumulator=iteratee(accumulator,array[index],index,array);}
return accumulator;}
function arrayEvery(array,predicate){var index=-1,length=array.length;while(++index<length){if(!predicate(array[index],index,array)){return false;}}
return true;}
function arrayEach(array,iteratee){var index=-1,length=array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break;}}
return array;}
function arraySome(array,predicate){var index=-1,length=array.length;while(++index<length){if(predicate(array[index],index,array)){return true;}}
return false;}
function arrayIndexOf(array,value){return $.inArray(value,array);}
return{forEach:arrayEach,every:arrayEvery,some:arraySome,indexOf:arrayIndexOf,map:arrayMap,filter:arrayFilter,reduce:createReduce(arrayReduce)};});Box.Application.addService('browser',function(application){'use strict';var MINIMUM_FLASH_VERSION='9',MIME_H264_BASELINE='video/mp4; codecs="avc1.42E01E"',MIME_H264_MAIN='video/mp4; codecs="avc1.4D401E"',MIME_H264_HIGH='video/mp4; codecs="avc1.64001E"';var browserDetect,navigator=application.getGlobal('navigator'),document=application.getGlobal('document'),versionSearchString='',dataBrowser=[{string:navigator.userAgent,subString:'Edge',identity:'Edge'},{string:navigator.userAgent,subString:'Chrome',identity:'Chrome'},{string:navigator.userAgent,subString:'criOS',identity:'Chrome',versionSearch:'criOS'},{string:navigator.vendor,subString:'Apple',identity:'Safari',versionSearch:'Version'},{string:navigator.userAgent,subString:'Firefox',identity:'Firefox'},{string:navigator.userAgent,subString:'MSIE',identity:'Explorer',versionSearch:'MSIE'},{string:navigator.userAgent,subString:'Trident',identity:'Explorer',versionSearch:'rv'},{string:navigator.userAgent,subString:'Gecko',identity:'Mozilla',versionSearch:'rv'}],dataOS=[{string:navigator.platform,subString:'Win',identity:'Windows'},{string:navigator.userAgent,subString:'iPod',identity:'iOS',device:'iPod'},{string:navigator.userAgent,subString:'iPhone',identity:'iOS',device:'iPhone'},{string:navigator.userAgent,subString:'iPad',identity:'iOS',device:'iPad'},{string:navigator.platform,subString:'Mac',identity:'Mac'},{string:navigator.userAgent,subString:'Android',identity:'Android'},{string:navigator.platform,subString:'Linux',identity:'Linux'}];function getBrowserData(data){var i,len,dataString,identity=null,device=null;for(i=0,len=data.length;i<len;i++){dataString=data[i].string;versionSearchString=data[i].versionSearch||data[i].identity;if(dataString&&dataString.indexOf(data[i].subString)!==-1){identity=data[i].identity;device=data[i].device;break;}}
return{'identity':identity,'device':device};}
function getBrowserVersion(dataString){var index=dataString.indexOf(versionSearchString),versionArr;if(index===-1){return'';}
versionArr=dataString.substring(index+versionSearchString.length+1).match(/[0-9]+(?:\.[0-9]*)?/);if(versionArr&&versionArr.length){return versionArr[0];}}
function getMacOsVersion(){var versionString=navigator.userAgent.match(/Mac OS X (([\d]+)_([\d]+)_([\d]+))/i);if(!(versionString&&versionString[1])){return null;}
return{version:versionString[1].replace(/_/g,'.'),major:parseInt(versionString[2],10),minor:parseInt(versionString[3],10),maintenance:parseInt(versionString[4],10)};}
function getMacOSVersionName(){var version=getMacOsVersion();if(version){return version.version;}
return'Unknown';}
function getWinOSVersionName(){var versionString,versionArr=navigator.userAgent.match(/Windows NT (([\d]+).([\d]+))/i);if(!versionArr||!versionArr[1]){return null;}
versionString=versionArr[1];if(versionString==='5.1'||versionString==='5.2'){return'XP';}
if(versionString==='6.0'){return'Vista';}
if(versionString==='6.1'){return'7';}
if(versionString==='6.2'){return'8';}
if(versionString==='6.3'){return'8.1';}
return'Unknown';}
function canMacOsBeProblematicWithChrome(){var version;if(browserDetect.OS==='Mac'){version=getMacOsVersion();return version.major>10||(version.major===10&&version.minor>=7);}
return false;}
function isMacJavaPluginInstalled(){var plugins=navigator.plugins,i,length,plugin;if(!plugins){return false;}
if(plugins.refresh){plugins.refresh(false);}
for(i=0,length=plugins.length;i<plugins.length;i++){plugin=plugins[i];if(plugin&&plugin.name.match(/^Java/)){return true;}}
return false;}
function isActiveXObjectEnabledForIE(){var ActiveXObject=application.getGlobal('ActiveXObject'),enabled=false;try{if(ActiveXObject){enabled=!!new ActiveXObject('htmlfile');}}catch(exception){enabled=false;}
return enabled;}
function canPlayType(type,probability){var elem;if(type.indexOf('audio/')===0){elem=document.createElement('audio');}else if(type.indexOf('video/')===0){elem=document.createElement('video');}else{return false;}
return!!(elem.canPlayType&&elem.canPlayType(type).replace(/^no$/,'')===probability);}
function canPlayH264(mime){return canPlayType(mime,'maybe')||canPlayType(mime,'probably');}
browserDetect={init:function(){this.browser=getBrowserData(dataBrowser).identity||'an unknown browser';this.version=getBrowserVersion(navigator.userAgent)||getBrowserVersion(navigator.appVersion)||'an unknown version';var osInfo=getBrowserData(dataOS);this.OS=osInfo.identity||'an unknown OS';this.device=osInfo.device||'an unknown device';},getName:function(){return this.browser;},getVersion:function(){return this.version;},getOSName:function(){return this.OS;},getDeviceName:function(){return this.device;},getOSVersionName:function(){switch(this.getOSName()){case'Mac':return getMacOSVersionName();case'Windows':return getWinOSVersionName();default:return'Unknown';}},isMinBrowser:function(name,minVersion){return(this.browser.toLowerCase()===name.toLowerCase()&&parseFloat(this.version)>=parseFloat(minVersion));},isHtml5EnabledIE:function(){if(!this.isMinBrowser('explorer','10')||!document.documentMode){return false;}
return parseInt(document.documentMode,10)>=10;},isIncompatibleChromeMacCombination:function(){return(this.isChrome()&&canMacOsBeProblematicWithChrome()&&!isMacJavaPluginInstalled());},isIncompatibleSafariMacCombination:function(){if(browserDetect.OS==='Mac'&&this.isSafari()){return this.isMinBrowser('safari','6.1');}
return false;},isMobileOS:function(){return(this.getOSName()==='iOS'||this.getOSName()==='Android');},canUseFlash:function(){var swfobject=application.getGlobal('swfobject');if(this.isIE()&&swfobject){return swfobject.hasFlashPlayerVersion('9.28.0');}
return false;},canUseHtml5:function(){return(this.isMinBrowser('firefox','3.6')||this.isMinBrowser('chrome','5')||this.isHtml5EnabledIE()||this.isMinBrowser('safari','4'));},canPlayH264Baseline:function(){return canPlayH264(MIME_H264_BASELINE);},canPlayH264Main:function(){return canPlayH264(MIME_H264_MAIN);},canPlayH264High:function(){return canPlayH264(MIME_H264_HIGH);},canPlayMP3:function(){return canPlayType('audio/mpeg','maybe')||canPlayType('audio/mpeg','probably');},supportsDash:function(){var mse=application.getGlobal('MediaSource');if(mse){if(typeof mse.isTypeSupported==='function'){return mse.isTypeSupported(MIME_H264_HIGH);}else{return this.canPlayH264High();}}
return false;},supportsMSE:function(){return!!application.getGlobal('MediaSource');},supportsWebGL:function(){var gl,canvas=document.createElement('canvas');try{gl=canvas.getContext('webgl')||canvas.getContext('experimental-webgl');}catch(e){}
return gl!==null&&gl!==undefined;},canUseHtml5Dnd:function(){return(this.isMinBrowser('firefox','3.6')||this.isMinBrowser('chrome','10')||this.isHtml5EnabledIE()||this.isEdge()||this.isMinBrowser('safari','5'));},canUseSessionStorage:function(){var sessionStorage=application.getGlobal('sessionStorage');try{sessionStorage.setItem('testKey','testValue');sessionStorage.removeItem('testKey');return true;}catch(e){return false;}},isSafari:function(){return this.browser==='Safari';},isFirefox:function(){return this.browser==='Firefox';},isChrome:function(){return this.browser==='Chrome';},isIE:function(){return this.browser==='Explorer';},isEdge:function(){return this.browser==='Edge';},isBrowserPluginsSupported:function(){return(navigator&&typeof navigator.plugins==='object'&&navigator.plugins.length>0)||(this.isIE()&&isActiveXObjectEnabledForIE());},isTransformSupported:function(){return!this.isIE()||this.isMinBrowser('explorer','9');},canFolderUpload:function(){return this.isMinBrowser('chrome','21');},hasMinimumFlashVersion:function(){var swfobject=application.getGlobal('swfobject'),version=swfobject.getFlashPlayerVersion();return version.major>=parseInt(MINIMUM_FLASH_VERSION,10);},hasSVGSupport:function(){return document.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure','1.1');},getMinimumFlashVersion:function(){return MINIMUM_FLASH_VERSION;}};browserDetect.init();return browserDetect;});Box.Application.addService('datetime',function(application)
{'use strict';var bcp47Tag=null;var FORMAT_TYPES={SHORT_DATE:{year:'numeric',month:'2-digit',day:'2-digit'},MEDIUM_DATE:{year:'numeric',month:'short',day:'numeric'},LONG_DATE:{year:'numeric',month:'long',day:'numeric'},FULL_DATE:{weekday:'short',year:'numeric',month:'long',day:'numeric'},MONTH_DAY:{month:'short',day:'numeric'},MONTH_DAY_TIME:{month:'short',day:'numeric',hour:'numeric',minute:'numeric'},MEDIUM_DATE_TIME:{weekday:'short',year:'numeric',month:'short',day:'numeric',hour:'numeric',minute:'numeric'},FULL_DATE_TIME:{weekday:'short',year:'numeric',month:'long',day:'numeric',hour:'numeric',minute:'numeric'}};var ONE_DAY_IN_MILLISECONDS=(24*60*60*1000);function isToday(dateToTest){var currentDate=new Date();return(currentDate.getDate()==dateToTest.getDate()&&currentDate.getMonth()==dateToTest.getMonth()&&currentDate.getFullYear()==dateToTest.getFullYear());}
function isYesterday(dateToTest){return isToday(new Date(dateToTest.getTime()+24*60*60*1000));}
function convertToMilliseconds(seconds){return seconds*1000;}
function convertToSeconds(milliseconds){return parseInt(milliseconds/1000,10);}
function mapHardcodeDateFormatToIntlDateFormat(format){if(typeof format==='object'){return format;}
switch(format){case'M d, yy':return FORMAT_TYPES.MEDIUM_DATE;default:return FORMAT_TYPES.SHORT_DATE;}}
function getBcp47Tag(){if(!bcp47Tag){var htmlElList=document.getElementsByTagName('html'),htmlEl=(htmlElList.length>0)?htmlElList[0]:null;if(htmlEl){bcp47Tag=htmlEl.getAttribute('lang');}
if(!bcp47Tag){bcp47Tag='en-US';if(typeof(Tombstone)!='undefined'){Tombstone.marker('./js/services/datetime.js:184','2014-05-12','Language should always be defined as html tag attribute. Please let the Moji team know: moji@box.com.');}}}
return bcp47Tag;}
if(getBcp47Tag()==='en-US'){FORMAT_TYPES.SHORT_DATE={year:'2-digit',month:'numeric',day:'numeric'};}
function getDateWithServerTimezoneOffset(timestamp,timezoneOffset){var v5=application.getService('v5'),currentDate=new Date();if(isNaN(parseInt(timezoneOffset,10))){timezoneOffset=v5.get('user_timezone_offset');}
var userSystemOffset=currentDate.getTimezoneOffset()*60;var offsetFromUserSystem=timezoneOffset+userSystemOffset;var finalTimestampInMilli=convertToMilliseconds(offsetFromUserSystem+parseInt(timestamp,10));return new Date(finalTimestampInMilli);}
function getUserSystemTimeZoneOffsetInSeconds()
{var currentDate=new Date();return currentDate.getTimezoneOffset()*60;}
function getDateWithoutApplyingTimezoneOffset(timestampInSeconds)
{var inverseTimezoneOffset=-getUserSystemTimeZoneOffsetInSeconds();return getDateWithServerTimezoneOffset(timestampInSeconds,inverseTimezoneOffset);}
function getDateInUserTimezoneOffset(timestampInSeconds)
{var v5=application.getService('v5'),userTimezoneOffset=v5.get('user_timezone_offset'),date=getDateWithServerTimezoneOffset(timestampInSeconds,userTimezoneOffset);return date;}
function getTimeAttributesForFormat(intlDateType){var timeFormat={};if(intlDateType.hour!==undefined){timeFormat.hour=intlDateType.hour;}
if(intlDateType.minute!==undefined){timeFormat.minute=intlDateType.minute;}
if(intlDateType.second!==undefined){timeFormat.second=intlDateType.second;}
if(intlDateType.timeZoneName!==undefined){timeFormat.timeZoneName=intlDateType.timeZoneName;}
return timeFormat;}
function formatDateWithIntl(date,intlDateType){var finalDate='',bcp47LanguageTag=getBcp47Tag(),hasIntl=(window.Intl&&typeof Intl==='object'),hasDateTimeFormat=(hasIntl&&typeof Intl.DateTimeFormat==='function');if(!hasIntl||!hasDateTimeFormat){throw new Error('Internationalization API is missing');}else{finalDate=new Intl.DateTimeFormat(bcp47LanguageTag,intlDateType).format(date);}
return finalDate;}
function formatDate(date,format){var v5=application.getService('v5'),formattedDate='';format=format||FORMAT_TYPES.MEDIUM_DATE;try{formattedDate=formatDateWithIntl(date,mapHardcodeDateFormatToIntlDateFormat(format));}catch(e){formattedDate=$.datepicker.formatDate($.datepicker._defaults.dateFormat,date);}
return formattedDate;}
function formatRelativeDate(date,format){var formattedDate='',isRelativeDate=false;if(isToday(date)){formattedDate=$t('today','item_date_today');isRelativeDate=true;}else if(isYesterday(date)){formattedDate=$t('yesterday','item_date_yesterday');isRelativeDate=true;}else{formattedDate=formatDate(date,format);}
if(isRelativeDate&&format){var timeFormat=getTimeAttributesForFormat(format),isTimeFormatEmpty=isEmptyObject(timeFormat);if(!isTimeFormatEmpty){var formattedTime=formatDate(date,timeFormat);if(formattedTime){formattedDate+=', '+formattedTime;}}}
return formattedDate;}
function isEmptyObject(obj){for(var properties in obj){if(Object.prototype.hasOwnProperty.call(obj,properties)){return false;}}
return true;}
return{FORMAT_TYPES:FORMAT_TYPES,setTimeToEOD:function(date){date.setHours(23);date.setMinutes(59);date.setSeconds(0);return date;},setTimeToBOD:function(date){date.setHours(0);date.setMinutes(0);date.setSeconds(0);return date;},getTimestampInSecondsFromDate:function(date){return Math.floor(date.getTime()/1000);},getDateFromTimestampInSeconds:function(timestampInSeconds){return new Date(convertToMilliseconds(timestampInSeconds));},getCurrentTimestampInSeconds:function(){return Math.floor((new Date().getTime())/1000);},getTomorrowDate:function(){return new Date(new Date().getTime()+ONE_DAY_IN_MILLISECONDS);},parseShortDate:function(shortDateString){try{return $.datepicker.parseDate($.datepicker._defaults.dateFormat,shortDateString);}
catch($e){return null;}},parseShortDateToTimestampInSeconds:function(shortDateString,options){options=options||{};var correspondingDate=this.parseShortDate(shortDateString);if(correspondingDate&&options.setToEndOfDay){correspondingDate=this.setTimeToEOD(correspondingDate);}
var timestampSeconds=(correspondingDate)?this.getTimestampInSecondsFromDate(correspondingDate):null;return timestampSeconds;},parseRfc3339Date:function(rfc3339Date){var dateFormat=/\d\d\d\d-\d\d-\d\d/;if(!dateFormat.test(rfc3339Date)){return null;}
var date=new Date(rfc3339Date.replace(/\-/g,'\/'));return isNaN(date.getTime())?null:date;},parseRfc3339DateToSeconds:function(rfc3339Date){var date=this.parseRfc3339Date(rfc3339Date);return(date)?this.getTimestampInSecondsFromDate(date):null;},getUserSystemTimeZoneOffsetInSeconds:function(){return getUserSystemTimeZoneOffsetInSeconds();},convertSecondsToMilliseconds:function(seconds){return convertToMilliseconds(seconds);},convertMillisecondsToSeconds:function(milliseconds){return convertToSeconds(milliseconds);},formatInUserTimezone:function(timestampInSeconds,format){return formatDate(getDateInUserTimezoneOffset(timestampInSeconds),format);},formatRelativeDateInUserTimezone:function(timestampInSeconds,format){return formatRelativeDate(getDateInUserTimezoneOffset(timestampInSeconds),format);},formatWithoutApplyingTimezoneOffset:function(timestampInSeconds,format){return formatDate(getDateWithoutApplyingTimezoneOffset(timestampInSeconds),format);},formatRelativeDateWithoutApplyingTimezoneOffset:function(timestampInSeconds,format){return formatRelativeDate(getDateWithoutApplyingTimezoneOffset(timestampInSeconds),format);}};});Box.Application.addService('dom',function(application){'use strict';var ANIMATIONS_EVENT_NAMES={'transition':'transitionend','WebkitTransition':'webkitTransitionEnd','animation':'animationend','WebkitAnimation':'webkitAnimationEnd'},supportedAnimationEventNames=[],isAnimationsInit=false,hasDOM4ClassList=(typeof document!=='undefined'&&'classList'in document.documentElement);function on(target,eventType,handler,params){params=params||{};$(target).on(eventType,params,handler);}
function off(target,eventType,handler){$(target).off(eventType,handler);}
function callbackWrapper(element,callback){return function(event){window.setTimeout(function(){callback(element);event.data.detachHandler();},0);};}
function detachAnimationsCallbacksHandler(element,callback){return function(){for(var i=0,len=supportedAnimationEventNames.length;i<len;i++){off(element,supportedAnimationEventNames[i],callback);}};}
function attachAnimationsCallbacks(element,callback){var wrappedCallback=callbackWrapper(element,callback),detachHandler=detachAnimationsCallbacksHandler(element,wrappedCallback);for(var i=0,len=supportedAnimationEventNames.length;i<len;i++){on(element,supportedAnimationEventNames[i],wrappedCallback,{detachHandler:detachHandler});}}
function initAnimations(){var eventName,fakeEl=document.createElement('fakeelement');for(eventName in ANIMATIONS_EVENT_NAMES){if(typeof fakeEl.style[eventName]!=='undefined'){supportedAnimationEventNames.push(ANIMATIONS_EVENT_NAMES[eventName]);}}
isAnimationsInit=true;}
function jqueryClassOps(element,className,operation){if(operation==='add'){$(element).addClass(className);}else if(operation==='remove'){$(element).removeClass(className);}}
function nativeClassOps(element,className,operation){var i,len,classes,whiteSpace=/\s+/;if(hasDOM4ClassList&&typeof className==='string'){if(Array.isArray(element)){for(i=0,len=element.length;i<len;i++){nativeClassOps(element[i],className,operation);}}else if(element instanceof HTMLElement){classes=className.split(whiteSpace);for(i=0,len=classes.length;i<len;i++){element.classList[operation](classes[i].trim());}}else{jqueryClassOps(element,className,operation);}}else{jqueryClassOps(element,className,operation);}}
function handleAnimationsClass(element,className,operation,animationEndCallback){if(supportedAnimationEventNames.length>0){attachAnimationsCallbacks(element,animationEndCallback);nativeClassOps(element,className,operation);}else{nativeClassOps(element,className,operation);window.setTimeout(function(){animationEndCallback(element);},0);}}
return{query:function(selector,element){return $(element||document).find(selector)[0];},queryAll:function(selector,element){return $(element||document).find(selector).get();},setHTML:function(element,html){if(element&&element.nodeType===1){application.stopAll(element);$(element).html(html);application.startAll(element);}else{application.reportError(new Error('setHTML() requires a valid DOM element'));}},setText:function(element,text){if('textContent'in element){element.textContent=text;}else{element.innerText=text;}},insertAfter:function(elementToInsert,elementToInsertAfter){elementToInsertAfter.parentNode.insertBefore(elementToInsert,elementToInsertAfter.nextSibling);},remove:function(element){element.parentNode.removeChild(element);},addClass:function(element,className,animationEndCallback){if(!isAnimationsInit){initAnimations();}
if(typeof animationEndCallback==='function'){handleAnimationsClass(element,className,'add',animationEndCallback);}else{nativeClassOps(element,className,'add');}},hasClass:function(element,className){if(hasDOM4ClassList&&element instanceof HTMLElement){return element.classList.contains(className);}else{return $(element).hasClass(className);}},removeClass:function(element,className,animationEndCallback){if(!isAnimationsInit){initAnimations();}
if(typeof animationEndCallback==='function'){handleAnimationsClass(element,className,'remove',animationEndCallback);}else{nativeClassOps(element,className,'remove');}},getNearestUnbounded:function(element,selector){var $element=$(element);var $closest=$element.closest(selector);return $closest.length?$closest[0]:null;},getNearest:function(element,selector){var $element=$(element),found=$element.is(selector);while(!found&&$element.length&&!$element.is('[data-module]')){$element=$element.parent();found=$element.is(selector);}
return found?$element[0]:null;},getNearestTypeElement:function(target){return this.getNearest(target,'[data-type]');},getData:function(element,name){return $(element).data(name);},isVisible:function(element){return $(element).is(':visible');},on:on,off:off,createFragmentFromHtml:function(html){var container=document.createElement('div'),fragment=document.createDocumentFragment();$(container).html(html);while(container.firstChild){fragment.appendChild(container.firstChild);}
return fragment;},getComputedCSS:function(elementEl){var computedValues={},elementCssStyles,propertyName,$element=$(elementEl),getComputedStyle=application.getGlobal('getComputedStyle');if(getComputedStyle){elementCssStyles=getComputedStyle(elementEl,null);if(elementCssStyles){if(elementCssStyles.length){for(var i=0,len=elementCssStyles.length;i<len;i++){propertyName=elementCssStyles[i];computedValues[propertyName]=$element.css(propertyName);}}else{for(propertyName in elementCssStyles){if(elementCssStyles.hasOwnProperty(propertyName)){computedValues[propertyName]=$element.css(propertyName);}}}
return computedValues;}}
if(elementEl.currentStyle){elementCssStyles=elementEl.currentStyle;for(propertyName in elementCssStyles){computedValues[propertyName]=$element.css(propertyName);}}
return computedValues;},getBoundingClientRect:function(element){var clientRect=element.getBoundingClientRect();if(typeof clientRect.width==='number'){return clientRect;}
var boundingClientRect={left:clientRect.left,top:clientRect.top,right:clientRect.right,bottom:clientRect.bottom};var $elem=$(element);boundingClientRect.width=$elem.outerWidth();boundingClientRect.height=$elem.outerHeight();return boundingClientRect;},getFirstElementChild:function(element){var TEXT_NODE=3;var currChildEl=element.firstChild;while(currChildEl&&currChildEl.nodeType===TEXT_NODE){currChildEl=currChildEl.nextSibling;}
return currChildEl;}};});Box.Application.addService('popups',function(application){'use strict';var CONFIRM_DEFAULT_TEXT=$t('Okay','js_popup_button_okay'),CANCEL_DEFAULT_TEXT=$t('Cancel','js_popup_button_cancel'),ERROR_DEFAULT_TEXT=$t('An error has occurred while loading this feature','js_popup_failure_message'),POPUP_API_RUNMODE='box_popup',POPUP_GCM_API_RUNMODE='box_popup_gcm',IS_SHOWING_POPUP_CLASS='is-showing-popup',IS_BLOCKED_CLASS='is-blocked';var GCM_POPUP_IDS=['quarantined_file','collaborate','show_share_properties_for_item','show_multi_items_share','show_collabs_by_folder','show_collab_details_popup','mail_all_collaborators'];var popup={},container,overlay;function setPopupElements(){container=document.getElementById('popup-container');overlay=document.getElementById('popup-overlay');}
function setBlockingFlag(){popup.isBlocking=true;}
function hasTitle(){var $title=$(container).find('.popup-title h2');return!!$title.text().length;}
function hideTitle(){$(container).find('.popup-title').hide();}
function setContent(content){var dom=application.getService('dom');dom.setHTML(container,content);if(!hasTitle()){hideTitle();}}
function clearContent(){var dom=application.getService('dom');dom.setHTML(container,'');}
function focusFirstFormElement(){$(container).find('input, textarea, button, select').not('.popup-close-btn').first().focus();}
function focusLastFormElement(){$(container).find('input, textarea, button, select').not('.popup-close-btn').last().focus();}
function centerToWindow(){var $container=$(container),documentWidth=$(document).width(),popupWidth=$container.width(),marginLeft=(documentWidth-popupWidth)/2,marginTop=($(window).height()-$container.height())/2;if(marginTop<5){marginTop=5;}else if(marginTop>150){marginTop=150;}
var yOffset=(window.pageYOffset||(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop);marginTop+=yOffset;$container.css({top:marginTop,left:marginLeft});}
function unbindHandlers(){$(container.parentElement).off('keyup.popup');$(container).off('click.popup');$(overlay).off('click.popup');}
function show(){container.style.display='block';overlay.style.display='block';var dom=application.getService('dom');dom.addClass(document.body,IS_SHOWING_POPUP_CLASS);centerToWindow();focusFirstFormElement();}
function hide(){container.style.display='none';overlay.style.display='none';var dom=application.getService('dom');dom.removeClass(document.body,IS_SHOWING_POPUP_CLASS);clearContent();if(typeof popup.onclose==='function'){popup.onclose();popup.onclose=null;}
unbindHandlers();}
function setBlockedState(){$(container).addClass(IS_BLOCKED_CLASS);}
function clearBlockedState(){$(container).removeClass(IS_BLOCKED_CLASS);}
function bindConfirmHandler(){$(container).on('click.popup','[data-type="confirm-btn"]',function confirmCallback(){if(typeof popup.onconfirm==='function'){popup.onconfirm();}
if(popup.isBlocking){setBlockedState();}else{hide();}});}
function bindCancelHandler(){$(container).on('click.popup','[data-type="cancel-btn"]',function cancelCallback(){if(typeof popup.oncancel==='function'){popup.oncancel();}
hide();});}
function bindCloseHandlers(){$(container).on('click.popup','[data-type="close-btn"]',hide);$(overlay).on('click.popup',hide);}
function bindEscapeHandler(){$(container.parentElement).on('keyup.popup',function escapeKeyHandler(event){if(event.keyCode==27){hide();event.stopPropagation();event.preventDefault();}});}
function bindAccessibilityHelpers(){var $accessibilityTopHelper=$(container).find('.popup-accessibility-top-helper'),$accessibilityBottomHelper=$(container).find('.popup-accessibility-bottom-helper');$accessibilityTopHelper.off('focusin.popup').on('focusin.popup',focusLastFormElement);$accessibilityBottomHelper.off('focusin.popup').on('focusin.popup',focusFirstFormElement);}
function initPopup(){if(!container){setPopupElements();}
clearContent();clearBlockedState();unbindHandlers();hide();if($.popup&&typeof $.popup.close==='function'){$.popup.close();}
$('body').trigger('popup.open');popup={};}
function getRunmode(popupId){var navState=application.getService('nav-state');if(navState.isGcm()&&$.inArray(popupId,GCM_POPUP_IDS)>-1){return POPUP_GCM_API_RUNMODE+'_'+popupId;}else{return POPUP_API_RUNMODE+'_'+popupId;}}
return{alert:function(message,params){var templates=application.getService('templates'),fragment;params=params||{};initPopup();fragment=templates.getTemplateFragment('popup-alert',{title:params.title,message:message});setContent(fragment);popup.onclose=params.onclose;bindAccessibilityHelpers();bindCloseHandlers();bindEscapeHandler();show();},confirm:function(message,params){var templates=application.getService('templates'),fragment;params=params||{};if(!params.onconfirm&&!params.oncancel){throw new Error('No action specified for confirm dialog');}
initPopup();fragment=templates.getTemplateFragment('popup-confirm',{title:params.title,message:message,confirmText:params.confirmText||CONFIRM_DEFAULT_TEXT,cancelText:params.cancelText||CANCEL_DEFAULT_TEXT});setContent(fragment);popup.onconfirm=params.onconfirm;popup.oncancel=params.oncancel;popup.onclose=params.onclose;if(params.isBlocking){setBlockingFlag();}
bindAccessibilityHelpers();bindConfirmHandler();bindCancelHandler();show();},open:function(popupId,config){var ajaxService=application.getService('ajax'),data,runmode;config=config||{};data=config.data||{};runmode=getRunmode(popupId);initPopup();ajaxService.get(runmode,data,{success:function showPopupAfterModuleLoad(response){setContent(response.data.html);popup.onclose=config.onclose;bindAccessibilityHelpers();bindCloseHandlers();bindEscapeHandler();show();},error:function(response){this.alert(response.data||ERROR_DEFAULT_TEXT);},context:this});},close:function(){setPopupElements();hide();},block:function(){setPopupElements();setBlockedState();},unblock:function(){clearBlockedState();},wait:function(message){var templates=application.getService('templates'),fragment;initPopup();fragment=templates.getTemplateFragment('popup-wait',{message:message});setContent(fragment);bindAccessibilityHelpers();show();this.block();},isPopupShowing:function(){var dom=application.getService('dom');return!!dom.query('.'+IS_SHOWING_POPUP_CLASS);}};});Box.Application.addService('nav',function(application){'use strict';var SESSION_STORAGE_KEY='nav:state';var $=application.getGlobal('$'),document=application.getGlobal('document'),domFragment=application.getService('dom-fragment'),promises=application.getService('promises'),historyJS=application.getGlobal('History'),location=application.getGlobal('location'),sessionStorage=application.getGlobal('sessionStorage'),eventHandlers={intercept:[],beforeStateChange:[]},initialized=false,service;function getLastState(){var json=sessionStorage.getItem(SESSION_STORAGE_KEY);return json?JSON.parse(json):null;}
function NavState(url,data){this.toState={url:url,data:data};this.fromState=getLastState();this.continueNavigation=true;}
NavState.prototype.updateState=function(url,data){if(url){this.toState.url=url;}
if(data){this.toState.data=data;}};NavState.prototype.stopNavigation=function(){this.continueNavigation=false;};function createState(toURL,toData){if(!toURL){throw new TypeError('Invalid URL provided for Ajax navigation.');}
var relativeURL=service._getRelativeURL(toURL);return promises.create(function(resolve){var navState=new NavState(relativeURL,toData);var handlers=eventHandlers.beforeStateChange.map(function(listener){return listener(navState);});promises.all(handlers).then(function(){if(navState.continueNavigation){resolve(navState.toState);}});});}
function redirect(url){location.href=url;}
function getInterceptor(url){if(!url){return null;}
var interceptors=eventHandlers.intercept;var path=url.split('?')[0];for(var i=0,len=interceptors.length;i<len;i++){if(interceptors[i].regex.test(path)){return interceptors[i];}}
return null;}
function getSanitizedNavState(){var historyState=historyJS.getState()||{},navState={url:historyState.hash?historyState.hash.replace(/[?&]_suid=\d+/,''):location.pathname+location.search,data:historyState.data?historyState.data.data:null};navState.url=navState.url.replace(/\?$/,'');navState.title=historyState.title||document.title;return navState;}
function saveCurrentState(){sessionStorage.setItem(SESSION_STORAGE_KEY,JSON.stringify(getSanitizedNavState()));}
function normalizeInitialState(){var navState=getSanitizedNavState();historyJS.replaceState(navState,navState.title,navState.url);}
function navigationComplete(broadcastState){saveCurrentState();application.broadcast('navigationend',broadcastState);}
service={registerBeforeStateChange:function(fn){var handlers=eventHandlers.beforeStateChange;var alreadyExists=handlers.some(function(handler){return handler===fn;});if(!alreadyExists){handlers.push(fn);}else{throw new TypeError('beforeStateChange handler already registered: '+fn);}},unregisterBeforeStateChange:function(fn){var handlers=eventHandlers.beforeStateChange;for(var i=0,len=handlers.length;i<len;i++){if(handlers[i]===fn){handlers.splice(i,1);}}},_coreNavigate:function(toState,fromState){var toURL=toState.url,toInterceptor=getInterceptor(toURL),fromURL=fromState.url,fromInterceptor=getInterceptor(fromURL),shouldDoAjax=true,broadcastState={from:fromState,to:toState};application.broadcast('navigationstart',broadcastState);if(fromInterceptor&&fromInterceptor.exit){shouldDoAjax=fromInterceptor.exit(toState,fromState);}
if(toInterceptor&&toInterceptor.enter){shouldDoAjax=toInterceptor.enter(toState,fromState)&&shouldDoAjax;}
return promises.create(function(resolve){if(!shouldDoAjax){navigationComplete(broadcastState);resolve();return;}
$.ajax({method:'get',url:toURL,dataFilter:function(data){return data;}}).done(function(body,message,jqxhr){domFragment.update(jqxhr.responseText);navigationComplete(broadcastState);resolve();}).fail(function(){redirect(toURL);});});},_getRelativeURL:function(url){if(url.charAt(0)==='?'){url=location.pathname+url;}
var anchorEl=document.createElement('a');anchorEl.href=url;var pathname=(anchorEl.pathname.charAt(0)==='/')?anchorEl.pathname:'/'+anchorEl.pathname;return pathname+anchorEl.search;},init:function(){if(initialized){return;}
normalizeInitialState();historyJS.Adapter.bind(window,'statechange',function(){var historyState=historyJS.getState(),toState=historyState.data,fromState=getLastState();this._coreNavigate(toState,fromState);}.bind(this));saveCurrentState();initialized=true;},destroy:function(){$(window).unbind('statechange');initialized=false;},getState:function(){var historyState=historyJS.getState();return historyState&&historyState.data?historyState.data.data:null;},intercept:function(regex,listener){if(!listener.enter&&!listener.exit){application.reportError(new TypeError('Second argument missing enter and exit methods.'));}
eventHandlers.intercept.push({regex:regex,enter:listener.enter,exit:listener.exit});},removeInterceptor:function(regex){eventHandlers.intercept=eventHandlers.intercept.filter(function(interceptor){return interceptor.regex!==regex;});},navigate:function(url,data){createState(url,data).then(function(toState){historyJS.pushState(toState,document.title,toState.url);});},redirect:function(url){redirect(url);},replace:function(url,data){createState(url,data).then(function(toState){historyJS.replaceState(toState,document.title,toState.url);});},refresh:function(){var state=getLastState();return this._coreNavigate(state,state);},reload:function(fromServer){location.reload(fromServer);},navigateOrRefresh:function(url,data){var state=getLastState();if(state&&state.url===url){this._coreNavigate(state,state);}else{this.navigate(url,data);}}};return service;});Box.Application.addService('dom-fragment',function(application){'use strict';var domService=application.getService('dom');var tooltipsService=application.getService('tooltips-amsterdam');return{setContentFor:function(placeholders){var selector,destinationEl,placeholder;for(var i=0,len=placeholders.length;i<len;i++){placeholder=placeholders[i];selector=placeholder.getAttribute('data-content-for');destinationEl=domService.query(selector);if(!destinationEl){application.reportError('Could not find '+selector);return;}
application.stopAll(destinationEl);if(application.hasService('tooltips-amsterdam')){tooltipsService.hideAll();}
$(destinationEl).empty();if(destinationEl.tagName==='TITLE'){document.title=placeholder.firstChild.nodeValue;}else{while(placeholder.firstChild){destinationEl.appendChild(placeholder.firstChild);}}
application.startAll(destinationEl);}},addClassFor:function(placeholders){placeholders.forEach(function(dataEl){var selector=dataEl.getAttribute('data-add-class-for');var className=dataEl.getAttribute('data-class');var el=domService.query(selector);domService.addClass(el,className);});},removeClassFor:function(placeholders){placeholders.forEach(function(dataEl){var selector=dataEl.getAttribute('data-remove-class-for');var className=dataEl.getAttribute('data-class');var el=domService.query(selector);domService.removeClass(el,className);});},update:function(html){var operations={'[data-content-for]':this.setContentFor,'[data-add-class-for]':this.addClassFor,'[data-remove-class-for]':this.removeClassFor};var fragment=domService.createFragmentFromHtml(html);for(var selector in operations){if(!operations.hasOwnProperty(selector)){continue;}
var placeholders=Array.prototype.slice.call(fragment.querySelectorAll(selector));var operation=operations[selector];operation(placeholders);}}};});Box.Application.addService('download',function(application){'use strict';var datatimeService=application.getService('datetime'),popupService=application.getService('popups'),reachabilityService=application.getService('reachability');var HOST_INFO_COOKIE_NAME='download_host_info';function createDownloadForm(url,inputParams){var v5=application.getService('v5'),additionalContext=v5.get('additional_context'),requestToken=v5.get('request_token'),key,$form,$iframe;inputParams=inputParams||{};$iframe=$('#file_download_iframe');if($iframe.length===0){$iframe=$('<iframe id="file_download_iframe" name="box-download-target" style="display:none;"></iframe>').appendTo('body');}
$form=$('<form method="POST" style="display:none;" />').attr({action:url,id:'file_download_form',target:'box-download-target'}).appendTo('body');if(additionalContext){inputParams.additional_context=additionalContext;}
inputParams.request_token=requestToken;for(key in inputParams){$('<input type="hidden">').attr({name:key,value:inputParams[key]}).appendTo($form);}
return $form;}
function download(url){var urlService=application.getService('url');urlService.goToUrl(url);}
function getHostValue(ip,host){return reachabilityService.getHostValue(ip,host,HOST_INFO_COOKIE_NAME);}
function setHostValue(ip,host,value)
{reachabilityService.setHostValue(ip,host,value,HOST_INFO_COOKIE_NAME);}
function reachabilityTestAndDownload(downloadViaPostUrl,inputParams,downloadUrl,hostsToExclude,externalIp,hostUrl,timeoutMs){$.ajax({type:'HEAD',timeout:timeoutMs,url:downloadUrl,success:function(){setHostValue(externalIp,hostUrl,datatimeService.getCurrentTimestampInSeconds());download(downloadUrl);},error:function(){setHostValue(externalIp,hostUrl,-1*datatimeService.getCurrentTimestampInSeconds());var newHostsToExclude=hostsToExclude.concat([hostUrl]);downloadViaPostWithReachabilityTest(downloadViaPostUrl,inputParams,newHostsToExclude);},xhrFields:{withCredentials:true}});}
function determineReachableDownloadHostsAndDownload(downloadViaPostUrl,inputParams,downloadUrl,json,hostsToExclude){if(typeof(json)!=='object'){popupService.alert($t('Sorry, we couldn\'t download that file for you. Please try again.','determine_reachable_download_hosts_and_download'));return;}
var retestSeconds=json.retest_seconds;var externalIp=json.external_ip;var hostUrl=json.download_host_suggested;var hostValue=getHostValue(externalIp,hostUrl);var timeoutMs=json.timeout_ms;if(!hostValue||Math.abs(hostValue)<(datatimeService.getCurrentTimestampInSeconds())-retestSeconds){reachabilityTestAndDownload(downloadViaPostUrl,inputParams,downloadUrl,hostsToExclude,externalIp,hostUrl,timeoutMs);}else if(hostValue<0){var newHostsToExclude=hostsToExclude.concat([hostUrl]);downloadViaPostWithReachabilityTest(downloadViaPostUrl,inputParams,newHostsToExclude);}else{download(downloadUrl);}}
function prepareDownloadViaPostParams(inputParams,hostsToExclude){var v5=application.getService('v5'),additionalContext=v5.get('additional_context'),requestToken=v5.get('request_token'),key;inputParams=inputParams||{};if(additionalContext){inputParams.additional_context=additionalContext;}
inputParams.request_token=requestToken;for(key in hostsToExclude){inputParams['hosts_to_exclude[]']=hostsToExclude[key];}
return inputParams;}
function downloadViaPostWithReachabilityTest(url,inputParams,hostsToExclude){var postParams=prepareDownloadViaPostParams(inputParams,hostsToExclude);$.ajax({type:'POST',url:url,data:postParams,success:function(data){var jsonResponse=$.parseJSON(data);var downloadUrl=jsonResponse.box_location;if(jsonResponse.reachability_test){determineReachableDownloadHostsAndDownload(url,inputParams,downloadUrl,jsonResponse,hostsToExclude);}else{download(downloadUrl);}},error:function(){popupService.alert($t('There was an error with this file download, please try again.','download_via_post'));}});}
return{downloadViaPostWithReachabilityTest:downloadViaPostWithReachabilityTest,downloadViaPost:function(url,inputParams){var $downloadForm=createDownloadForm(url,inputParams);$downloadForm.submit();},downloadViaGet:function(url){var urlService=application.getService('url');urlService.goToUrlInBackground(url);}};});Box.Application.addService('function-utils',function(application){'use strict';function debounce(func,wait,immediate){var timeout,args,context,timestamp,result,later=function(){var last=(new Date().getTime())-timestamp;if(last<wait&&last>0){timeout=setTimeout(later,wait-last);}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout){context=args=null;}}}};return function(){var callNow=immediate&&!timeout;context=this;args=arguments;timestamp=(new Date().getTime());if(!timeout){timeout=setTimeout(later,wait);}
if(callNow){result=func.apply(context,args);context=args=null;}
return result;};}
function throttle(func,wait){var context,args,result,timeout=null,previous=0,later=function(){previous=(new Date().getTime());timeout=null;result=func.apply(context,args);if(!timeout){context=args=null;}};return function(){var now=(new Date().getTime()),remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);if(!timeout){context=args=null;}}else if(!timeout){timeout=setTimeout(later,remaining);}
return result;};}
function retryNumOfTimes(func,times,timeout,backoffFactor){var tries=0;timeout=timeout||0;backoffFactor=backoffFactor||1;var promises=application.getService('promises');return promises.create(function(resolve,hardReject){function doTry(){tries++;promises.create(function(tryResolve,tryReject){func(tryResolve,tryReject,hardReject);}).then(resolve,function(reason){if(tries<times){timeout*=backoffFactor;executeAfterTimeout(timeout);return;}
hardReject(reason);});}
function executeAfterTimeout(time){setTimeout(function(){doTry();},time);}
executeAfterTimeout(timeout);});}
return{debounce:debounce,throttle:throttle,retryNumOfTimes:retryNumOfTimes};});Box.Application.addService('fullscreen',function(application){'use strict';var publicAPI=$.extend({},new Box.EventTarget()),dom=application.getService('dom'),IS_FULLSCREEN_CLASS='is-fullscreen',FULL_SCREEN_ELEMENT=document.body;function isSupported(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled;}
function isFullScreen(){if(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled){return document.fullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement;}else{return dom.hasClass(FULL_SCREEN_ELEMENT,IS_FULLSCREEN_CLASS);}}
function fullscreenchangeHandler(){if(isFullScreen()){publicAPI.fire('enter');dom.addClass(FULL_SCREEN_ELEMENT,IS_FULLSCREEN_CLASS);}else{publicAPI.fire('exit');dom.removeClass(FULL_SCREEN_ELEMENT,IS_FULLSCREEN_CLASS);}}
function toggleFullScreen(options){if(isFullScreen()){dom.removeClass(FULL_SCREEN_ELEMENT,IS_FULLSCREEN_CLASS);if(document.exitFullscreen){document.exitFullscreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitExitFullscreen){document.webkitExitFullscreen();}}else{if(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen(options);}else if(document.documentElement.msRequestFullscreen){document.documentElement.msRequestFullscreen(options);}else if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen(options);}else if(document.documentElement.webkitRequestFullscreen){document.documentElement.webkitRequestFullscreen(options);}else if(document.documentElement.webkitRequestFullScreen){document.documentElement.webkitRequestFullScreen(options);}
dom.addClass(FULL_SCREEN_ELEMENT,IS_FULLSCREEN_CLASS);}}
$(document).on('webkitfullscreenchange mozfullscreenchange MSFullscreenChange fullscreenchange',fullscreenchangeHandler);return $.extend(publicAPI,{isSupported:isSupported,enter:toggleFullScreen,exit:toggleFullScreen,isFullScreen:isFullScreen});});Box.Application.addService('hotkeys',function(application){'use strict';var initialized=false,popupsService,popupsAmsterdamService,contextualMessageService,navState,previewNav,logger,hotkeyConfigs={},boundComboKeys={},currentConfigID=null,defaultConfigID=null,activeComboKey,activeComboTimeout,$document=$(application.getGlobal('document')),COMBO_KEY_TIMEOUT_MILLIS=1000;function logHotkey(key){var report={key:key};logger.sendBatchLog('hotkeys',currentConfigID,report);}
function getActiveBindingsIndexingKey(keyConfig){if(keyConfig.comboKey){return keyConfig.comboKey+keyConfig.key;}else{return keyConfig.key;}}
function hotkeyHandlerWrapper(keyConfig){return function(event){if(popupsAmsterdamService&&popupsAmsterdamService.anyPopupsOpen()){return;}
if(popupsService&&popupsService.isPopupShowing()){return;}
if(contextualMessageService&&contextualMessageService.shouldDisableHotkeys()){return;}
if(keyConfig.comboKey){if(activeComboKey===keyConfig.comboKey){keyConfig.handler(event);logHotkey(keyConfig.comboKey+'+'+keyConfig.key);}}else if(!activeComboKey){keyConfig.handler(event);logHotkey(keyConfig.key);}};}
function removeHotKey(keyConfig){var activeHotkeyHandlersIndexKey=getActiveBindingsIndexingKey(keyConfig),hotkeyConfig=hotkeyConfigs[currentConfigID][activeHotkeyHandlersIndexKey],wrappedHandler=hotkeyConfig?hotkeyConfig.wrappedHandler:null;if(wrappedHandler){$document.off('keydown.hotkeys',wrappedHandler);hotkeyConfigs[currentConfigID][activeHotkeyHandlersIndexKey].wrappedHandler=null;}}
function addHotkey(keyConfig){var activeHotkeyHandlersIndexKey=getActiveBindingsIndexingKey(keyConfig),wrappedHandler=hotkeyHandlerWrapper(keyConfig),hotkeyConfig=hotkeyConfigs[currentConfigID];if(hotkeyConfig&&hotkeyConfig[activeHotkeyHandlersIndexKey]&&typeof hotkeyConfig[activeHotkeyHandlersIndexKey].wrappedHandler==='function'){removeHotKey(keyConfig);}
if(!hotkeyConfigs[currentConfigID]){hotkeyConfigs[currentConfigID]={};}
hotkeyConfigs[currentConfigID][activeHotkeyHandlersIndexKey]={keyConfig:keyConfig,wrappedHandler:wrappedHandler};$document.on('keydown.hotkeys',null,keyConfig.key,wrappedHandler);}
function comboKeyHander(comboKey){return function(){activeComboKey=comboKey;clearTimeout(activeComboTimeout);activeComboTimeout=setTimeout(function(){if(activeComboKey===comboKey){activeComboKey=null;}},COMBO_KEY_TIMEOUT_MILLIS);};}
function hotkeysLegend(){var isSharedFilePageOrSharedFileEmbed=(navState&&navState.isSharedFilePage())||(previewNav&&previewNav.isSharedFilePageOrSharedFileEmbed());if(popupsService&&!isSharedFilePageOrSharedFileEmbed){popupsService.open('hotkeys_legend',{data:{hotkeyConfigId:currentConfigID}});}}
function init(){popupsService=application.getService('popups');popupsAmsterdamService=application.getService('popups-amsterdam');contextualMessageService=application.hasService('contextual-message')?application.getService('contextual-message'):null;navState=application.getService('nav-state');logger=application.getService('logger');previewNav=application.getService('preview-nav');initialized=true;}
function unbindHotkeyConfig(configID){var key,config=hotkeyConfigs[configID];for(key in config){if(config.hasOwnProperty(key)){removeHotKey(config[key].keyConfig);}}
boundComboKeys={};currentConfigID=null;if(configID!==defaultConfigID){delete hotkeyConfigs[configID];}}
function keyConfigBindingHandler(bindingHandler,keyConfig){var comboKey=keyConfig.comboKey,comboKeyConfig;if(comboKey&&!boundComboKeys[comboKey]){comboKeyConfig={key:comboKey,handler:comboKeyHander(comboKey)};bindingHandler(comboKeyConfig);boundComboKeys[comboKey]=true;}
bindingHandler(keyConfig);}
function rebindDefaultHotkeys(){var key,config=hotkeyConfigs[defaultConfigID];currentConfigID=defaultConfigID;addHotkey({key:'shift+/',handler:hotkeysLegend});for(key in config){if(config.hasOwnProperty(key)){keyConfigBindingHandler(addHotkey,config[key].keyConfig);}}}
function bindHotkeyConfig(configID,config){var i,length=config.length;if(currentConfigID!==configID){addHotkey({key:'shift+/',handler:hotkeysLegend});currentConfigID=configID;}
for(i=0;i<length;i++){keyConfigBindingHandler(addHotkey,config[i]);}}
return{setConfig:function(config,configID,isDefault){if(!initialized){init();}
if(currentConfigID&&configID!==currentConfigID){unbindHotkeyConfig(currentConfigID);}
isDefault=!!isDefault;if(isDefault){defaultConfigID=configID;}
bindHotkeyConfig(configID,config);},unsetConfig:function(configID){if(hotkeyConfigs[configID]&&currentConfigID===configID){unbindHotkeyConfig(currentConfigID);if(defaultConfigID){rebindDefaultHotkeys();}}},setHotkeyForConfig:function(keyConfig,configID){if(hotkeyConfigs[configID]&&currentConfigID===configID){addHotkey(keyConfig);}},unsetHotkeyForConfig:function(key,configID){if(hotkeyConfigs[configID]&&currentConfigID===configID){removeHotKey({key:key});}}};});Box.Application.addService('logger',function(application){'use strict';var LOG_URL='/gen204',LOG_BATCH_PATH='/index.php?rm=box_gen204_batch_record',BATCH_TIMEOUT_MS=5000,BATCH_QUEUE_KEY='LOGGER_SERVICE_QUEUE';var sessionStore=application.getService('session-store'),batchTimeoutId;function getXMLHttpRequest(){var XMLHttpRequest=application.getGlobal('XMLHttpRequest');var ActiveXObject=application.getGlobal('ActiveXObject');if(XMLHttpRequest){return new XMLHttpRequest();}else if(ActiveXObject){return new ActiveXObject('Microsoft.XMLHTTP');}else{return null;}}
function sendLogAjaxCall(requestData,callback,sync){var logUrl=LOG_URL+'?'+$.param(requestData);var xmlhttp=getXMLHttpRequest();if(xmlhttp!==null){if(typeof callback==='function'){xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState!=4){return;}
if(xmlhttp.status===200||xmlhttp.status===204||xmlhttp.status===1223){callback();}};}
xmlhttp.open('GET',logUrl,!sync);xmlhttp.send();}}
function postJSONLog(url,data){var xmlhttp=getXMLHttpRequest();if(xmlhttp!==null){xmlhttp.open('POST',url,true);xmlhttp.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF-8');xmlhttp.send('data='+JSON.stringify(data));}}
function pushToBatchQueue(item){var queue=sessionStore.getItem(BATCH_QUEUE_KEY)||[];queue.push(item);sessionStore.setItem(BATCH_QUEUE_KEY,queue);}
function submitBatchLog(){var batchQueue=sessionStore.getItem(BATCH_QUEUE_KEY);sessionStore.removeItem(BATCH_QUEUE_KEY);clearTimeout(batchTimeoutId);postJSONLog(LOG_BATCH_PATH,batchQueue);batchTimeoutId=null;}
function getSplitTestConversionContent(experiment,event,additionalParams){var data=[];data.push('experiment='+encodeURIComponent(experiment));data.push('event='+encodeURIComponent(event));if(additionalParams){data.push('additional_params='+encodeURIComponent(JSON.stringify(additionalParams)));}
data.push('request_token='+encodeURIComponent(application.getGlobal('request_token')));return data.join('&');}
return{sendLog:function(category,eventType,keysAndValues,callback,runmodeOptions,sync){keysAndValues=keysAndValues||{};runmodeOptions=runmodeOptions||{};var requestData={category:category,event_type:eventType,keys_and_values:keysAndValues,runmode_options:runmodeOptions};sendLogAjaxCall(requestData,callback,sync);},sendBatchLog:function(category,eventType,keysAndValues,immediate){keysAndValues.client_ds=Math.floor((new Date().getTime())/1000);pushToBatchQueue({event_type:eventType,category:category,events:[keysAndValues]});if(immediate){submitBatchLog();}else if(!batchTimeoutId){batchTimeoutId=setTimeout(submitBatchLog,BATCH_TIMEOUT_MS);}},sendMetric:function(name,keysAndValues){keysAndValues=keysAndValues||{};var requestData={category:'metrics',event_type:'metrics',keysAndValues:{name:name,value:'+1',type:'counter',tags:keysAndValues}};sendLogAjaxCall(requestData);},sendSplitTestLog:function(experiment,event,additionalParams){var requestData={category:'experiment',event_type:event,keys_and_values:{experiment:experiment,additional_params:additionalParams}};sendLogAjaxCall(requestData);},sendSplitTestConversion:function(experiment,event,additionalParams){var xmlhttp=getXMLHttpRequest();if(xmlhttp!==null){var content=getSplitTestConversionContent(experiment,event,additionalParams);xmlhttp.open('POST','/index.php?rm=experiment_convert',true);xmlhttp.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF-8');xmlhttp.send(content);}}};});Box.Application.addService('menu-toggle',function(context){'use strict';var TOGGLE_BUTTON='menu-toggle-button';var VISIBLE_CLASS='is-visible';var dom,focus;var activeMenuToggle=null;function fireEvent(eventName){if(activeMenuToggle){activeMenuToggle.events.fire(eventName);}}
function closeMenu(){if(!activeMenuToggle){return;}
var menuEl=activeMenuToggle.menuEl;var menuWrapper=dom.getNearestUnbounded(menuEl,'.menu-wrapper');dom.removeClass(menuWrapper,VISIBLE_CLASS);setTimeout(function(){menuEl.style.display='';},100);fireEvent('closed');activeMenuToggle=null;}
function showMenu(target,menuToggleInstance){var menuEl=target.nextElementSibling;if(!menuEl){return;}
while(menuEl.nodeName==='BUTTON'&&!dom.isVisible(menuEl)){menuEl=menuEl.nextSibling;if(!menuEl){return;}}
if(menuEl.nodeName!=='MENU'){menuEl=dom.queryAll('.menu',menuEl);if(!menuEl.length){return;}}
var menuWrapperEl=dom.getNearestUnbounded(menuEl,'.menu-wrapper');if(dom.hasClass(menuWrapperEl,VISIBLE_CLASS)){closeMenu();return;}
if(activeMenuToggle){closeMenu();}
activeMenuToggle=menuToggleInstance;activeMenuToggle.menuEl=menuEl;menuWrapperEl=dom.getNearestUnbounded(menuEl,'.menu-wrapper');focus.wrap(menuWrapperEl);menuEl.style.display='block';setTimeout(function(){dom.addClass(menuWrapperEl,VISIBLE_CLASS);},100);fireEvent('opened');}
function getTarget(event){var target=event.target||event.srcElement;if(!target){return null;}
if(target.getAttribute('data-type')===TOGGLE_BUTTON){return target;}
while(true){target=target.parentNode;if(!target||target===document.body||!target.getAttribute){return null;}else if(target.getAttribute('data-type')===TOGGLE_BUTTON){return target;}}}
function isTargetInMenu(event){var target=event.target||event.srcElement;return!!dom.getNearestUnbounded(target,'.menu');}
function globalClickHandler(event){if(!activeMenuToggle){return;}
var target=getTarget(event);if(target){var currMenuEl=target.nextElementSibling;if(!currMenuEl||currMenuEl===activeMenuToggle.menuEl){return;}}
if(isTargetInMenu(event)){return;}
fireEvent('lostfocus');closeMenu();}
function MenuToggle(shouldCloseMenuOnBlur){this.events=new Box.EventTarget();this.menuEl=null;this.shouldCloseMenuOnBlur=(typeof shouldCloseMenuOnBlur!=='undefined')?shouldCloseMenuOnBlur:true;this.wrappedGlobalClickHandler=function(event){globalClickHandler(event);};}
MenuToggle.prototype={init:function(){dom=context.getService('dom');focus=context.getService('focus');if(this.shouldCloseMenuOnBlur){dom.on(document.body,'mousedown',this.wrappedGlobalClickHandler);}},destroy:function(){if(this.shouldCloseMenuOnBlur){dom.off(document.body,'mousedown',this.wrappedGlobalClickHandler);}},showMenu:function(target){showMenu(target,this);},closeMenu:function(){closeMenu();},on:function(type,handler){this.events.on(type,handler);},off:function(type,handler){this.events.off(type,handler);}};return{create:function(shouldCloseMenuOnBlur){return new MenuToggle(shouldCloseMenuOnBlur);}};});Box.Application.addService('notifications',function(application){'use strict';var CONFIRM_TYPE='confirm',WARN_TYPE='warn',ERROR_TYPE='error',CONTAINER_ID='top_notification',NOTIFICATION_SELECTOR='.notification_container',ACTION_BUTTON_SELECTOR='.notification_action',CLOSE_BUTTON_SELECTOR='.notification_close',NEWLY_ADDED_NOTIFICATION_SELECTOR=NOTIFICATION_SELECTOR+':first-child',DISPLAY_OFFSET=93,DISPLAY_END_STATE_CLASS='is-open',CONFIRM_AUTO_HIDE_TIMEOUT=5000,PREVIEW_NOTIFICATION_CONTAINER='.preview-notification';var primaryContainerNode,alternateContainerNode,isInitiated=false,currentState=null,legacyConfirmationService=null,uniqueId=0,domService=null,isForceClose=true;function getContainer(isPrimaryContainerNode){if(alternateContainerNode&&!isPrimaryContainerNode){var $newNode=$(alternateContainerNode);if($newNode[0]){return $newNode;}}
if(!primaryContainerNode){primaryContainerNode=document.getElementById(CONTAINER_ID);}
return primaryContainerNode;}
function handleActionButtonClicked(event){event.preventDefault();if(currentState&&currentState.clickHandler){currentState.clickHandler();}}
function handleCloseButtionClicked(event){event.preventDefault();clearNotification();}
function bindEvents(isPrimaryContainerNode){var $container=$(getContainer(isPrimaryContainerNode));$container.delegate(ACTION_BUTTON_SELECTOR,'click',handleActionButtonClicked);$container.delegate(CLOSE_BUTTON_SELECTOR,'click',handleCloseButtionClicked);}
function unbindEvents(isPrimaryContainerNode){var $container=$(getContainer(isPrimaryContainerNode));$container.undelegate(ACTION_BUTTON_SELECTOR,'click');$container.undelegate(CLOSE_BUTTON_SELECTOR,'click');}
function init(){var $container=$(getContainer()),navState=application.hasService('nav-state')?application.getService('nav-state'):null,isStalkingEnabled=typeof($.fn.stalker)!='undefined'&&(navState&&!navState.isEmbedWidget());domService=application.getService('dom');legacyConfirmationService=application.getService('v5').get('Box_Confirmation_Message');bindEvents(true);if(isStalkingEnabled){$container.stalker({offset:DISPLAY_OFFSET,stopCallback:function(){unbindEvents(true);primaryContainerNode=null;bindEvents(true);}});}
isInitiated=true;}
function clearNotification(autoDismissNotificationId){var $containerEl,$messageEl;if(!isInitiated){init();}
if(legacyConfirmationService){legacyConfirmationService.hide(isForceClose);}
if(autoDismissNotificationId&&currentState&&autoDismissNotificationId!==currentState.notificationId){return;}
if(currentState&&currentState.timeoutId){window.clearTimeout(currentState.timeoutId);}
$containerEl=$(getContainer());if(alternateContainerNode){unbindEvents();alternateContainerNode=null;}
$messageEl=$containerEl.find(NOTIFICATION_SELECTOR);domService.removeClass($messageEl,DISPLAY_END_STATE_CLASS,function(){$messageEl.remove();});if(currentState&&currentState.hideHandler){currentState.hideHandler();currentState.hideHandler=null;}
currentState=null;}
function getTemplateDataFromState(){return{type:currentState.type,title:currentState.title,description:currentState.description,descriptionClass:currentState.description?'':'hidden',actionClass:currentState.hasAction?'':'hidden',actionText:currentState.actionText};}
function setState(type,notificationId,title,params){currentState={type:type,title:title,description:params?params.description:'',hasAction:params&&params.action,actionText:params&&params.action?params.action.text:'',clickHandler:params&&params.action?params.action.onclick:null,hideHandler:params?params.onhide:null,notificationId:notificationId,timeoutId:null};}
function getUniqueId(){return uniqueId++;}
function setupAutoDismissTimer(notificationId){currentState.timeoutId=window.setTimeout(function(){clearNotification(notificationId);},CONFIRM_AUTO_HIDE_TIMEOUT);}
function shouldSetupAutoDismiss(){return currentState.type===CONFIRM_TYPE&&!currentState.hasAction;}
function show(type,title,params){var templateService,fragment,$containerEl,notificationId,$messageEl,navState=application.hasService('nav-state')?application.getService('nav-state'):null,fullscreen=application.hasService('fullscreen')?application.getService('fullscreen'):null;if(!isInitiated){init();}
clearNotification();if(params&&params.containerNode){alternateContainerNode=params.containerNode;}else if(navState&&navState.isPreviewOpen()&&fullscreen&&!fullscreen.isFullScreen()){alternateContainerNode=PREVIEW_NOTIFICATION_CONTAINER;}else{alternateContainerNode=null;}
notificationId=getUniqueId();setState(type,notificationId,title,params);templateService=application.getService('templates');fragment=templateService.getTemplateFragment('notification',getTemplateDataFromState());$containerEl=$(getContainer());$containerEl.prepend(fragment);$messageEl=$containerEl.find(NEWLY_ADDED_NOTIFICATION_SELECTOR);window.setTimeout(function(){domService.addClass($messageEl,DISPLAY_END_STATE_CLASS);},0);if(shouldSetupAutoDismiss()){setupAutoDismissTimer(notificationId);}
if(alternateContainerNode){bindEvents();}}
return{confirm:function(title,params){show(CONFIRM_TYPE,title,params);},warn:function(title,params){show(WARN_TYPE,title,params);},error:function(title,params){show(ERROR_TYPE,title,params);},hide:function(){clearNotification();},destroy:function(){this.hide();unbindEvents();},displayServerNotification:function(){var containerEl,preRenderedEl,notificationId,messageEl;if(!isInitiated){init();}
containerEl=getContainer();preRenderedEl=domService.query('.pre_rendered',containerEl);if(preRenderedEl){notificationId=getUniqueId();var type;switch(preRenderedEl.getAttribute('data-type')){case'warn':type=WARN_TYPE;break;case'error':type=ERROR_TYPE;break;default:type=CONFIRM_TYPE;break;}
setState(type,notificationId);messageEl=domService.query(NOTIFICATION_SELECTOR,containerEl);domService.addClass(messageEl,DISPLAY_END_STATE_CLASS);if(shouldSetupAutoDismiss()){setupAutoDismissTimer(notificationId);}}}};});Box.Application.addService('office-online',function(application){'use strict';var RUNMODE_LOCK_DELETE='box_api_file_action_lock_delete',RUNMODE_URL_LOCK_CREATE='/index.php?rm=box_api_file_action_lock_create',SAVE_BACK_PROGRESS_BAR_EXPECTED_TIME=10000,SUPPORTED_FILE_EXTENSIONS={pptx:1,docx:1,xlsx:1},OFFICE_ONLINE_WOPI_ACTION_ID={live:'openbox_service4881',staging:'openbox_service2313',dev:'openbox_service2961'},OFFICE_ONLINE_WOPI_SERVICE_IDS={live:[129383],staging:[38277],dev:[24521]};var publicAPI={lockId:null};var $availabilityStatusDeferred=new $.Deferred();publicAPI=$.extend(publicAPI,new Box.EventTarget());return $.extend(publicAPI,{init:function(){var ajaxService=application.getService('ajax'),navState=application.getService('nav-state'),v5=application.getService('v5'),canvas=v5.get('Canvas');if(navState.isSharedFolderPage()||navState.isSharedFilePage()||(canvas&&canvas.user.is_anonymous())){$availabilityStatusDeferred.reject();return;}
if(application.getGlobalConfig('isOfficeOnlineAllowed')){var resin=application.getService('resin');resin.recordAction({application:'files',page:'explorer',component:'none',feature:'officeonline',target:'available',action:'programmatic'});$availabilityStatusDeferred.resolve();}else{$availabilityStatusDeferred.reject();}},showLaunchingModal:function(item){if(!item){return;}
var popups=application.getService('popups');popups.open('office_online_launch_app',{data:{typed_id:item.typed_id}});},isActionIdOfficeOnline:function(id){var serviceActionId=this.serviceActionId();return(id===serviceActionId);},serviceActionId:function(){var v5=application.getService('v5');var isLiveSite=v5.get('live_site');var isStaging=v5.get('is_staging_env');var idMap=OFFICE_ONLINE_WOPI_ACTION_ID;if(isLiveSite){return idMap.live;}else if(isStaging){return idMap.staging;}else{return idMap.dev;}},isServiceIdOfficeOnline:function(id){var arrayUtils=application.getService('array-utils');return arrayUtils.indexOf(this.serviceIds(),id)!==-1;},serviceIds:function(){var isLiveSite=application.getGlobal('live_site');var isStaging=application.getGlobal('is_staging_env');var idMap=OFFICE_ONLINE_WOPI_SERVICE_IDS;if(isLiveSite){return idMap.live;}else if(isStaging){return idMap.staging;}else{return idMap.dev;}},isExtensionSupported:function(ext){return!!(SUPPORTED_FILE_EXTENSIONS[ext]);},isOfficeOnlineEnabled:function(){return $availabilityStatusDeferred.state()==='resolved';},isOfficeOnlineAvailableAndSupportedForFile:function(file){return this.isExtensionSupported(file.extension)&&this.isOfficeOnlineEnabled();},runCallbackForOfficeOnlineAvailability:function(availableCallback,unavailableCallback){if(typeof unavailableCallback!=='function'){return;}
if(typeof availableCallback!=='function'){unavailableCallback();}
if($availabilityStatusDeferred.state()==='pending'){this.init();}
$availabilityStatusDeferred.done(availableCallback);$availabilityStatusDeferred.fail(unavailableCallback);},launchFileActionForItemWithTypedId:function(itemTypedId){var me=this,v5=application.getService('v5'),v5Item=v5.get('Item');if(!v5Item){return;}
var item=v5Item.find(itemTypedId);if(item){this.launchFileActionForItem(item);}else{v5Item.find_async(itemTypedId).then(function(foundItem){me.launchFileActionForItem(foundItem);});}},launchFileActionForItem:function(item){var openboxService=application.getService('openbox-service-actions');var openboxArgs={'action_name':'Edit with Office Online','uniq_name':'box_for_office_online','skip_popup':true};this.showLaunchingModal(item);openboxService.loadOpenboxActionOnItemAndExecute(item,openboxArgs);},establishLock:function(item){var expiration=new Date();expiration.setMinutes(expiration.getMinutes()+30);var templateString='openbox_service',navState=application.getService('nav-state'),officeServiceActionId=this.serviceActionId().slice(templateString.length),url=RUNMODE_URL_LOCK_CREATE,query={typed_id:item.typed_id,service_action_id:officeServiceActionId,expiration:expiration};var me=this;$.postJSON(url,query,function(json){if(json.success)
{me.lockId=json.lock_id;if(navState.isPreviewOpen()){application.broadcast('previewlock');}else{application.navigate('',{},{not_scroll:true});}}});},removeLock:function(){var rm=RUNMODE_LOCK_DELETE,ajaxService=application.getService('ajax'),navState=application.getService('nav-state'),query={lock_id:this.lockId};ajaxService.post(rm,query,{success:function successCallbackRemoveLock(){if(navState.isPreviewOpen()){application.broadcast('previewunlock');}else{application.navigate('',{},{not_scroll:true});}}});}});});Box.Application.addService('overlay',function(application){'use strict';var currentOverlay=null;function createOverlay(className){var dom=application.getService('dom'),overlay=document.createElement('div');dom.addClass(overlay,'overlay');dom.addClass(overlay,'hidden');dom.addClass(overlay,className);document.body.appendChild(overlay);return overlay;}
function Overlay(element,options){if(typeof element==='string'){throw new Error('HTML strings not allowed for Overlays - use an HTMLElement or DocumentFragment instead.');}
this.element=element;this.initialized=false;this.overlay=createOverlay(options.className);}
Overlay.prototype={_open:function(target,position,xOffset,yOffset){var dom=application.getService('dom');xOffset=xOffset||0;yOffset=yOffset||0;if(currentOverlay){currentOverlay.close();}
currentOverlay=this;if(!this.initialized){this.initialized=true;dom.setHTML(this.overlay,this.element);}else{application.startAll(this.overlay);}
var params={of:target,collision:'none'};if(position==='below'){params.my='center top';params.at='center+'+xOffset+' bottom+'+yOffset;}else if(position==='left'){params.my='right center';params.at='left+'+xOffset+' center+'+yOffset;}
dom.removeClass(this.overlay,'hidden');$(this.overlay).position(params);this.positionParams=$.extend({},params);},openBelow:function(target,xOffset,yOffset){this._open(target,'below',xOffset,yOffset);},openToLeft:function(target,xOffset,yOffset){this._open(target,'left',xOffset,yOffset);},freezePosition:function(top){this.overlay.style.position='fixed';this.overlay.style.top=top+'px';},unfreezePosition:function(){this.overlay.style.position='absolute';$(this.overlay).position(this.positionParams);},focusFirst:function(selector){$(this.overlay).find(selector).first().focus();},isOpen:function(){var dom=application.getService('dom');return!dom.hasClass(this.overlay,'hidden');},close:function(){if(currentOverlay==this){currentOverlay=null;}
if(this.isOpen()){var dom=application.getService('dom');application.stopAll(this.overlay);dom.addClass(this.overlay,'hidden');}},destroy:function(){if(currentOverlay==this){currentOverlay=null;}
this.overlay.parentNode.removeChild(this.overlay);}};return{create:function(element,options){return new Overlay(element,options||{});},close:function(){if(currentOverlay){currentOverlay.close();}}};});Box.Application.addService('promises',function(application){'use strict';Promise.longStackTraces();if(!Promise.customUnhandledRejectionHandlerDisabled){Promise.onPossiblyUnhandledRejection(function(error,context){var reason=context.reason();if(typeof reason==='undefined'){return;}
if(error.message==='[object Object]'){error.message='Missing an error or rejection handler for '+(reason.data||'a promise');}
application.reportError(error);});}
return{CancellationError:Promise.CancellationError,all:Promise.all,settle:Promise.settle,some:Promise.some,any:Promise.any,create:function(resolver){return new Promise(resolver);},createResolved:function(value){return Promise.resolve(value);},createRejected:function(reason){return Promise.reject(reason);},createCancellable:function(resolver){return new Promise(resolver).cancellable();}};});Box.Application.addService('resin',function(application){'use strict';var RESIN_TARGET_ATTRIBUTE='data-resin-target';var resin,resinTagTracker,browser,logger;var document;var active=false;function init(){browser=application.getService('browser');if(!active&&!(browser.isIE()&&!browser.isMinBrowser('explorer','10'))){var showTagTracker=application.getGlobalConfig('showResinTagTracker');resin=application.getGlobal('Resin');logger=application.getService('logger');document=application.getGlobal('document');if(showTagTracker){resinTagTracker=application.getService('resin-tag-tracker');resinTagTracker.trackTags();}else{resin.start(function(event){var eventType=event.data.client;delete event.data.client;if(event.data.data){event.data.data=JSON.stringify(event.data.data);}
logger.sendBatchLog('resin',eventType,event.data);},{events:{click:'mouseup',keypress:'keydown'}});}
active=true;}}
function extend(obj1,obj2){for(var key in obj2){if(obj2.hasOwnProperty(key)){obj1[key]=obj2[key];}}
return obj1;}
var Resin={recordAction:function(actionAttributes){if(active&&resin){actionAttributes.client='web';if(!actionAttributes.application){actionAttributes.application=document.body.getAttribute('data-resin-application');}
if(!actionAttributes.page){actionAttributes.page=document.body.getAttribute('data-resin-page');}
resin.recordAction(actionAttributes);}},recordActionFromElement:function(element,overrides){if(!active||element.getAttribute('data-resin-target')){return;}
var currentAttributes=this.getActionAttributes(element);this.recordAction({application:this.sanitize(overrides.application||currentAttributes.application),page:this.sanitize(overrides.page||currentAttributes.page),component:this.sanitize(overrides.component||currentAttributes.component),feature:this.sanitize(overrides.feature||currentAttributes.feature),target:this.sanitize(overrides.target||currentAttributes.target),action:this.sanitize(overrides.action||currentAttributes.action),data:extend(currentAttributes.data,overrides.data||{})});},getSessionId:function(){return sessionStorage.getItem('resin-session-id');},getActionAttributes:function(actionTargetEl){var hasResinTargetAttribute;var actionAttributes={};if(active&&resin){hasResinTargetAttribute=actionTargetEl.hasAttribute(RESIN_TARGET_ATTRIBUTE);if(!hasResinTargetAttribute){actionTargetEl.setAttribute(RESIN_TARGET_ATTRIBUTE,'');}
actionAttributes=resin.getActionAttributes(actionTargetEl);if(!hasResinTargetAttribute){actionTargetEl.removeAttribute(RESIN_TARGET_ATTRIBUTE);}}
return actionAttributes;},sanitize:function(unsanitizedValue){return(unsanitizedValue)?unsanitizedValue.toLowerCase().replace(/[^a-z0-9|]/g,''):'';}};init();return Resin;});Box.Application.addService('resin-tag-tracker',function(application){'use strict';var doc=application.getGlobal('document');var resin=application.getGlobal('Resin');var dom=application.getService('dom');var tooltips=application.getService('tooltips-amsterdam');var templates=application.getService('templates');var COLORS=['#26C281','#22A7F0','#DF6CE2','#FFDA04','#0EA5F3','#F03354'];var HUD_HTML='<div class="tag-tracker-hud">'+'<ul class="tag-tracker-events">'+'<li>Press \'r\' to refresh tags</li>'+'<li>Left click a tag to trigger the event</li>'+'<li>Right click a tag to hide it</li>'+'</ul>'+'</div>';var EVENT_HTML_BASE='<li style="color: <%= color %>">'+'<div>Application: <%= application %></div>'+'<div>Page: <%= page %></div>'+'<div>Component: <%= component %></div>'+'<div>Feature: <%= feature %></div>'+'<div>Target: <%= target %></div>';var initialized=false;var eventListEl;var allTargets;function isHidden(el){return(el.offsetParent===null);}
function colorize(str){var index=str.split('').reduce(function(prev,next){return(typeof prev==='string'?prev.charCodeAt(0):prev)+next.charCodeAt(0);})%COLORS.length;return COLORS[index];}
function tagTarget(el){if(isHidden(el)){return;}
var tooltipEl=tooltips.show(el,{tooltipText:'x',tooltipPosition:'bottom'});if(!tooltipEl){return;}
tooltipEl.style.cursor='pointer';dom.query('.tooltip-inner',tooltipEl).style.backgroundColor=colorize(el.getAttribute('data-resin-target'));dom.on(tooltipEl,'contextmenu',function(ev){ev.preventDefault();tooltips.hide(el);});dom.on(tooltipEl,'click',function(ev){ev.preventDefault();var trackerEv=new CustomEvent('tagtracker',{bubbles:true});el.dispatchEvent(trackerEv);});}
function handleReloadKeyPress(ev){var keyCode=ev.keyCode||ev.which;if(keyCode===114){ev.preventDefault();ev.stopPropagation();trackTags();}}
function init(){var hudTemplateFragment=templates.createTemplateFragment(HUD_HTML);doc.body.appendChild(hudTemplateFragment);eventListEl=dom.query('.tag-tracker-events',doc.body);dom.on(doc.body,'keypress',handleReloadKeyPress);resin.start(function(data){var eventHTML=EVENT_HTML_BASE;var templateData=$.extend(data.data,{color:colorize(data.data.target)});var customData=templateData.data;if(customData&&typeof customData==='object'&&Object.getOwnPropertyNames(customData).length){eventHTML+='<div>-----Custom Data-----</div>';templateData.data=Object.getOwnPropertyNames(customData).forEach(function(currKey){templateData[currKey]=customData[currKey];eventHTML+='<div>'+currKey+': <%= '+currKey+' %></div>';});}
eventHTML+='</li>';var eventTemplateFragment=templates.createTemplateFragment(eventHTML,templateData);eventListEl.insertBefore(eventTemplateFragment,eventListEl.firstChild);},{events:{click:'tagtracker'}});initialized=true;}
function trackTags(){if(!initialized){init();}
tooltips.hideAll();allTargets=dom.queryAll('[data-resin-target]',doc);[].forEach.call(allTargets,tagTarget);}
return{trackTags:trackTags,destroy:function(){if(initialized){dom.off(doc.body,'keypress',handleReloadKeyPress);resin.stop();}}};});Box.Application.addService('strings',function(application){'use strict';var URL_REGEX=/\b(ht|f)tps?:\/\/[\w\._\-]+(:\d+)?(\/[\w\-_\.~\+\/#\?&%=:\[\]@!\$'\(\)\*;,]*)?/igm,DATA_SIZE_UNITS=['B','KB','MB','GB','TB'],TAG_WHITE_LIST=['b','strong','i','em','u','a','span'];function createPlaceholderDivFromElement(element){var $temp=$('<div />').css({display:'block',left:0,position:'absolute',top:0,visibility:'hidden',whiteSpace:'nowrap'}).appendTo('body');if(element){var $element=$(element);$temp.css({fontFamily:$element.css('font-family'),fontSize:$element.css('font-size'),fontWeight:$element.css('font-weight')});}
return $temp[0];}
function isTextOutOfBounds(text,maxWidth,element){if(typeof element.innerText!=='undefined'){element.innerText=text;}else{element.textContent=text;}
return(element.offsetWidth<=maxWidth);}
function getMaximumTextForElement(text,maxWidth,element){var originalLength=text.length,minLength=0,maxLength=originalLength,position=originalLength,substring=text;while(maxLength-minLength>1){if(isTextOutOfBounds(substring,maxWidth,element)){minLength=position;}else{maxLength=position;}
position=Math.floor((minLength+maxLength)/2);if(minLength!==originalLength){substring=text.substr(0,position)+'...';}}
return substring;}
function escapeHtmlTags(tagArray,html){var okayTags='',escapeRegExp,regEx;for(var j=0;j<tagArray.length;j++){if(tagArray[j]==='a'){okayTags+='(?!/?'+tagArray[j]+'[^>]*>)';var anchorRegEx=new RegExp('<a\\s[^>]*(href="[^"]*")[^>]*>','g');html=html.replace(anchorRegEx,'<a $1 target="_blank">');anchorRegEx=new RegExp('<a\\s[^h][^>]*>','g');html=html.replace(anchorRegEx,'&lt;a>');}else{okayTags+='(?!/?'+tagArray[j]+'>)';regEx=new RegExp('<'+tagArray[j]+'\\s[^>]*>','g');html=html.replace(regEx,'<'+tagArray[j]+'>');}
regEx=new RegExp('</'+tagArray[j]+'\\s[^>]*>');html=html.replace(regEx,'</'+tagArray[j]+'>');}
try{escapeRegExp=new RegExp('<'+okayTags,'gi');}catch(e){$.log(e);return'';}
html=html.replace(escapeRegExp,'&lt;').replace(new RegExp('\n','g'),'<br>').replace(new RegExp('\r','g'),'<br>');return html;}
return{getFastShortString:function(text,length){if(!text||text.length===0){return'';}else if(text.length<=length){return text;}else{return text.substring(0,length-3)+'...';}},getShortString:function(text,maxWidth,element){if(!text||text.length===0){return text;}
var substring,placeholderElement;placeholderElement=createPlaceholderDivFromElement(element);substring=getMaximumTextForElement(text,maxWidth,placeholderElement);$(placeholderElement).remove();return substring;},getHyperlinkedString:function(text){return text.replace(URL_REGEX,function(url){return'<a href="'+url+'" target="_blank">'+url+'</a>';});},getHumanReadableSize:function(bytes,precision){var index,formattedNum;if(typeof precision==='undefined'){precision=1;}
bytes=parseInt(bytes,10);if(bytes<=0){return'0 '+DATA_SIZE_UNITS[0];}
index=Math.floor(Math.log(bytes)/Math.log(1024));index=Math.min(Math.max(index,0),DATA_SIZE_UNITS.length-1);formattedNum=bytes/Math.pow(1024,index);if(index>0){formattedNum=formattedNum.toFixed(precision);}
return formattedNum+' '+DATA_SIZE_UNITS[index];},capitalize:function(text){return(text+'').replace(/^([a-z])|\s+([a-z])|_([a-z])/g,function(word){return word.toUpperCase();});},escapeMarkupTags:function(html){return escapeHtmlTags(TAG_WHITE_LIST,html);},removeInvisibleCharacters:function(text){return(text+'').replace(/\u200e/g,'');},trim:function(text){var rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;return text.replace(rtrim,'');},isEmail:function(str){var emailRegex=/^[^\s<>@,]+@[^\s<>@,\/\\]+\.[^\s<>@,]+$/i;return(emailRegex.exec(str)!==null);},getEmail:function(str){var emailRegex=/[^\s<>@,]+@[^\s<>@,]+\.[^\s<>@,]+/i;var matches=emailRegex.exec(str);return matches?matches[0]:'';}};});Box.Application.addService('tabview',function(application){'use strict';var EMPTY_STATE_CLASS='tabview-empty-state',NO_TRANSITION_CLASS='no-transition',TABS_SELECTOR='.tabs',TAB_SELECTOR='.tab',PANELS_SELECTOR='.tab-panels',PANEL_SELECTOR='.tab-panel',SELECTED_CLASS='is-selected',TAB_ID_PREFIX='tab-id-',DYNAMIC_TABS_SELECTOR='.dynamic-tabs-bar',HIDDEN_CLASS='hidden',LEFT_ARROW_SELECTOR='.left-arrow',RIGHT_ARROW_SELECTOR='.right-arrow',AJAX_NAV_ATTRIBUTE='data-ajax',INDEX_ATTRIBUTE='data-index',SELECTED_INDEX_ATTRIBUTE='data-selected-index',LEFT=-1,RIGHT=1,INDEX_QUERY='['+INDEX_ATTRIBUTE+']';var tabCounterId=0,dom=application.getService('dom'),aria=application.getService('aria');function getSelectedIndex(element){return parseInt(element.getAttribute(SELECTED_INDEX_ATTRIBUTE),10);}
function setSelectedIndex(element,index){element.setAttribute(SELECTED_INDEX_ATTRIBUTE,index);}
function getTabsAndPanels(element){var tabHolderEl=dom.query(TABS_SELECTOR,element),panelHolderEl=dom.query(PANELS_SELECTOR,element);var tabs=dom.queryAll(TAB_SELECTOR,tabHolderEl),panels=Array.prototype.slice.call(panelHolderEl.children);var data={tabs:tabs,panels:panels,tabHolderEl:tabHolderEl,panelHolderEl:panelHolderEl,isDynamic:false};var emptyStateEl;data.panels=panels.filter(function(panelEl){if(dom.hasClass(panelEl,EMPTY_STATE_CLASS)){emptyStateEl=panelEl;return false;}else{return true;}});if(emptyStateEl){data.emptyStateEl=emptyStateEl;}
var dynamicTabsEl=dom.getNearest(tabHolderEl,DYNAMIC_TABS_SELECTOR);if(dynamicTabsEl){var leftArrowEl=dom.query(LEFT_ARROW_SELECTOR,dynamicTabsEl);var rightArrowEl=dom.query(RIGHT_ARROW_SELECTOR,dynamicTabsEl);data.isDynamic=true;data.leftArrowEl=leftArrowEl;data.rightArrowEl=rightArrowEl;}
return data;}
function getFarthestAnchorPoint(widget){var tabEls=widget.data.tabs;if(!tabEls.length){return 0;}
var lastTabEl=tabEls[tabEls.length-1];return lastTabEl.offsetLeft+lastTabEl.offsetWidth;}
function getViewportOffset(widget){var viewportEl=widget.data.tabHolderEl;var viewportOffset=parseInt(viewportEl.style.left,10)*-1;viewportOffset=viewportOffset||0;return viewportOffset;}
function resetArrowVisibility(widget){var viewportOffset=getViewportOffset(widget);var leftArrowEl=widget.data.leftArrowEl;var rightArrowEl=widget.data.rightArrowEl;var farthestAnchorPoint=getFarthestAnchorPoint(widget);if(viewportOffset===0||getSelectedIndex(widget.element)===0){dom.addClass(leftArrowEl,HIDDEN_CLASS);}else{dom.removeClass(leftArrowEl,HIDDEN_CLASS);}
if(viewportOffset+widget.viewportWidth>=farthestAnchorPoint){dom.addClass(rightArrowEl,HIDDEN_CLASS);}else{dom.removeClass(rightArrowEl,HIDDEN_CLASS);}}
function resetEmptyState(widget){var emptyStateEl=widget.data.emptyStateEl;if(!emptyStateEl){return;}
if(getSelectedIndex(widget.element)===-1){dom.addClass(emptyStateEl,SELECTED_CLASS);}else{dom.removeClass(emptyStateEl,SELECTED_CLASS);}}
function refreshDynamicState(widget){if(!widget.data.isDynamic){return;}
resetArrowVisibility(widget);resetEmptyState(widget);}
function scrollToTab(widget,tabIndex){if(!widget.data.isDynamic){return;}
var tabEl=widget.data.tabs[tabIndex];var anchorPosition=tabEl.offsetLeft;var viewportEl=widget.data.tabHolderEl;var viewportOffset=getViewportOffset(widget);var farthestAnchorPoint=getFarthestAnchorPoint(widget);if(farthestAnchorPoint<=widget.viewportWidth){viewportEl.style.left='0px';refreshDynamicState(widget);return;}
var newOffset=anchorPosition;newOffset=Math.min(farthestAnchorPoint-widget.viewportWidth,newOffset);viewportOffset=-1*newOffset;viewportEl.style.left=viewportOffset+'px';refreshDynamicState(widget);}
function changeTab(widget,index,isInit){if(index===-1){setSelectedIndex(widget.element,index);refreshDynamicState(widget);return;}
var element=widget.element,data=widget.data,tabs=data.tabs,panels=data.panels,selectedIndex=getSelectedIndex(element),nextTab=tabs[index],nextPanel=panels[index],prevTab,prevPanel;if(!isNaN(selectedIndex)){prevTab=tabs[selectedIndex];prevPanel=panels[selectedIndex];dom.removeClass([prevTab,prevPanel],SELECTED_CLASS);if(prevPanel){aria.hide(prevPanel);}}
dom.addClass([nextTab,nextPanel],SELECTED_CLASS);if(nextPanel){aria.show(nextPanel);}
setSelectedIndex(element,index);if(widget.data.isDynamic){scrollToTab(widget,index);}
if(!isInit){if(widget.data.isDynamic){var viewportEl=data.tabHolderEl;dom.on(viewportEl,'transitionend',function transitionEndHandler(){nextTab.focus();dom.off(viewportEl,'transitionend',transitionEndHandler);});}else{nextTab.focus();}}
widget.fire('tabchange',{tab:nextPanel?nextPanel.getAttribute('data-tab-name'):nextTab.getAttribute('data-tab-btn-name'),isInit:isInit});}
function initTabs(widget){var data=widget.data,tabs=data.tabs,panels=data.panels,selectedIndex=-1;if(data.isDynamic){var viewportEl=data.tabHolderEl;widget.viewportWidth=parseInt(viewportEl.offsetWidth,10);refreshDynamicState(widget);}
aria.setRole(data.tabHolderEl,'tablist');tabs.forEach(function(tab,i){var panel=panels[i],id=tab.id,selected=dom.hasClass(tab,SELECTED_CLASS);if(!id){tab.id=TAB_ID_PREFIX+tabCounterId++;id=tab.id;}
if(selected){selectedIndex=i;}
tab.setAttribute(INDEX_ATTRIBUTE,i);aria.setRole(tab,'tab');if(!tab.hasAttribute(AJAX_NAV_ATTRIBUTE)){tab.removeAttribute('href');}
if(panel){aria.setRole(panel,'tabpanel');panel.setAttribute('aria-labelledby',id);}});changeTab(widget,selectedIndex,true);}
function onclick(event){var target=event.target,tabElement;if(!dom.getNearest(target,TABS_SELECTOR)){return;}
event.stopPropagation();event.preventDefault();tabElement=dom.getNearest(target,INDEX_QUERY);if(target.getAttribute('data-type')==='tab-close'){this.fire('tabclose',{tab:tabElement.getAttribute('data-tab-btn-name')});return;}
if(tabElement&&!dom.hasClass(tabElement,'is-disabled')){changeTab(this,parseInt(tabElement.getAttribute(INDEX_ATTRIBUTE),10),false);}}
function arrowHandler(widget,direction){switch(direction){case RIGHT:return function(event){event.stopPropagation();event.preventDefault();widget.nextTab();};case LEFT:return function(event){event.stopPropagation();event.preventDefault();widget.previousTab();};}}
function TabView(targetElement){this.element=targetElement;this.data=getTabsAndPanels(this.element);this.isInit=false;$.extend(this,new Box.EventTarget());}
TabView.prototype.init=function(){initTabs(this);this.onclickHandler=onclick.bind(this);dom.on(this.data.tabHolderEl,'click.tabview',this.onclickHandler);if(this.data.isDynamic){this.leftArrowHandler=arrowHandler(this,LEFT);this.rightArrowHandler=arrowHandler(this,RIGHT);dom.on(this.data.leftArrowEl,'click',this.leftArrowHandler);dom.on(this.data.rightArrowEl,'click',this.rightArrowHandler);}
this.isInit=true;};TabView.prototype.reInit=function(){this.data=getTabsAndPanels(this.element);initTabs(this);};TabView.prototype.destroy=function(){dom.off(this.data.tabHolderEl,'click.tabview',this.onclickHandler);if(this.data.isDynamic){dom.off(this.data.leftArrowEl,'click',this.leftArrowHandler);dom.off(this.data.rightArrowEl,'click',this.rightArrowHandler);}};TabView.prototype.nextTab=function(){var data=this.data;var selectedIndex=getSelectedIndex(this.element);if(selectedIndex<data.tabs.length-1){changeTab(this,selectedIndex+1,false);return true;}
return false;};TabView.prototype.previousTab=function(){var selectedIndex=getSelectedIndex(this.element);if(selectedIndex>0){changeTab(this,selectedIndex-1,false);return true;}
return false;};TabView.prototype.goToTab=function(tabName){var tabEl=dom.query('[data-tab-btn-name="'+tabName+'"]',this.data.tabHolderEl);if(!tabEl){return;}
var tabElementIndex=parseInt(tabEl.getAttribute(INDEX_ATTRIBUTE),10);if(tabElementIndex===getSelectedIndex(this.element)){return;}
changeTab(this,tabElementIndex,false);};TabView.prototype.closeTab=function(tabName){var tabEl=dom.query('[data-tab-btn-name="'+tabName+'"]',this.data.tabHolderEl);if(!tabEl){return;}
var tabIndex=parseInt(tabEl.getAttribute(INDEX_ATTRIBUTE),10);var panelEl=this.data.panels[tabIndex];dom.remove(tabEl);dom.remove(panelEl);dom.addClass(this.data.tabHolderEl,NO_TRANSITION_CLASS);if(!this.nextTab()){this.previousTab();}
this.reInit();dom.removeClass(this.data.tabHolderEl,NO_TRANSITION_CLASS);};return{create:function(element){return new TabView(element);}};});Box.Application.addService('templates',function(application){'use strict';var HTML_CHARS_MATCHER=/[<>"&'\/`]/g,HTML_REPLACEMENTS={'<':'&lt;','>':'&gt;','"':'&quot;','&':'&amp;','\'':'&#x27;','/':'&#x2f;','`':'&#x60;'},doc=document;function escapeHTML(text){return text.replace(HTML_CHARS_MATCHER,function(c){return HTML_REPLACEMENTS[c];});}
function render(templateText,data){if(data){return templateText.replace(/<%=\s*(\w+)\s*%>/g,function(match,key){var value=data[key]||'';return value?escapeHTML(value):'';});}
return templateText;}
return{escapeHTML:escapeHTML,getTemplateHTML:function(templateID,data){var templateElement=doc.getElementById('jst-'+templateID),html='';if(templateElement){html=templateElement.text.replace(/^\s+|\s+$/g,'');if(html){return render(html,data);}else{throw new Error('Template "'+templateID+'" is an empty string.');}}else{throw new Error('Template "'+templateID+'" not found.');}},createTemplateFragment:function(templateText,data){if(typeof templateText!=='string'){throw new TypeError('Template text must be a string.');}
var dom=application.getService('dom'),html=render(templateText,data);return dom.createFragmentFromHtml(html);},getTemplateFragment:function(templateID,data){var dom=application.getService('dom'),html=this.getTemplateHTML(templateID,data);return dom.createFragmentFromHtml(html);}};});Box.Application.addService('urls-runmode',function(){'use strict';return{formatQuery:function(options){function toURIComponents(obj,prefix,data){prefix=prefix||'';data=data||[];if(typeof obj==='string'||typeof obj==='number'){data.push(prefix+'='+encodeURIComponent(obj));}else if(typeof obj==='boolean'){data.push(prefix+'='+(obj?1:0));}else{for(var p in obj){if(!obj.hasOwnProperty(p)){continue;}
data=toURIComponents(obj[p],prefix+'['+p+']',data);}}
return data;}
return toURIComponents(options,'q').join('&');},get:function(runmode,options){var url='/index.php?rm='+runmode;if(options){url+='&'+this.formatQuery(options);}
return url;}};});Box.Application.addService('xhr',function(application){'use strict';var promises=application.getService('promises');var config=application.getGlobalConfig();function send(method,url,data,options){options=options||{};var xhr;if(window.XMLHttpRequest){xhr=new XMLHttpRequest();}else if(window.ActiveXObject){xhr=new ActiveXObject('MSXML2.XMLHTTP.3.0');}else{return null;}
xhr.open(method,url,true);if(!options.corsRequest){xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');if(config.requestToken){xhr.setRequestHeader('X-Request-Token',config.requestToken);}}
if(typeof data==='string'){xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF-8');}
xhr.send(data||null);return xhr;}
return{send:function(method,url,data,options){var xhr=send(method,url,data,options);var isAborted=false;var resolution=promises.create(function(resolve,reject){xhr.onreadystatechange=function(){if(isAborted){return null;}
if(xhr.readyState===4){if((xhr.status/100|0)===2){resolve(xhr);}else{reject(xhr);}}};xhr.onerror=function(){if(isAborted){return null;}
reject(xhr);};});resolution.abort=function(){isAborted=true;xhr.abort();};return resolution;},parseJSONResponse:function(xhr){return promises.create(function(resolve,reject){var parsed;try{parsed=JSON.parse(xhr.responseText);}catch(e){reject(e);return;}
resolve(parsed);});},handleLegacyAJAXResponse:function(xhr){return promises.create(function(resolve,reject){var parsed;try{parsed=JSON.parse(xhr.responseText);}catch(e){reject(e);return;}
if(!('data'in parsed)){reject(parsed);return;}
resolve(parsed.data);});}};});Box.Application.addBehavior('menu-toggle',function(context){'use strict';var TOGGLE_BUTTON='menu-toggle-button';var VISIBLE_CLASS='is-visible';var dom;var menuToggle;function getTarget(event){var target=event.target||event.srcElement;if(!target){return null;}
if(target.getAttribute('data-type')===TOGGLE_BUTTON){return target;}
while(true){target=target.parentNode;if(!target||target===document.body||!target.getAttribute){return null;}else if(target.getAttribute('data-type')===TOGGLE_BUTTON){return target;}}}
var me={init:function(){var menuToggleService=context.getService('menu-toggle');dom=context.getService('dom');menuToggle=menuToggleService.create();menuToggle.init();dom.on(document.body,'keyup',this.keyupHandler);},destroy:function(){dom.off(document.body,'keyup',this.keyupHandler);menuToggle.destroy();},keyupHandler:function(event){if(event.keyCode===27){me.closeMenu();}},onclick:function(event,element,elementType){if(elementType===TOGGLE_BUTTON){this.showMenu(element);event.preventDefault();event.stopPropagation();}else if(dom.getNearest(event.target,'.menu-option')&&(element===null||!element.disabled)){this.closeMenu();}},onkeyup:function(event){if(event.keyCode!==32){return;}
var target=getTarget(event);if(target){me.showMenu(target);event.preventDefault();return;}
var node=(event.target||event.srcElement).parentNode;do{if(node.nodeName==='MENU'){event.stopPropagation();var menuWrapper=dom.getNearest(node,'.menu-wrapper');dom.removeClass(menuWrapper,VISIBLE_CLASS);setTimeout(me.closeMenu,100);return;}
node=node.parentNode;}while(node&&node!==document.body);},showMenu:function(target){menuToggle.showMenu(target);},closeMenu:function(){menuToggle.closeMenu();}};return me;});Box.Application.addBehavior('tooltips-amsterdam',function(context){'use strict';var tooltipsService;function _noop(){return null;}
return{messages:['contentrefreshed','formvalidatorerrorcleared','navigationstart'],onmessage:function(name,data){switch(name){case'formvalidatorerrorcleared':tooltipsService.hide(data);break;case'contentrefreshed':case'navigationstart':tooltipsService.hideAll();break;default:_noop();}},init:function(){tooltipsService=context.getService('tooltips-amsterdam');},onfocusin:function(event,element,elementType){if(tooltipsService){tooltipsService.handleEvent(event,element,elementType);}},onfocusout:function(event,element,elementType){if(tooltipsService){tooltipsService.handleEvent(event,element,elementType);}},onmouseover:function(event,element,elementType){if(tooltipsService){tooltipsService.handleEvent(event,element,elementType);}},onmouseout:function(event,element,elementType){if(tooltipsService){tooltipsService.handleEvent(event,element,elementType);}},onclick:function(event,element,elementType){if(tooltipsService){tooltipsService.handleEvent(event,element,elementType);}}};});Box.Application.addBehavior('contextual-messages-registration',function(context){'use strict';var ELIGIBLE_MESSAGES_CONFIG_KEY='eligibleMessages';var PREVIEW_OPEN_EVENT='previewopen';var PREVIEW_CLOSE_EVENT='previewclose';var PREVIEW_ACTION_EVENT='previewaction';var PREVIEW_SIDEBAR_TOGGLE='previewtogglesidebar';var PREVIEW_CHANGE_EVENTS=[PREVIEW_ACTION_EVENT,PREVIEW_CLOSE_EVENT,PREVIEW_OPEN_EVENT,PREVIEW_SIDEBAR_TOGGLE];var SHOW_ACTION='show';var CLOSE_ACTION='close';var HIDE_HELP_ICON_CLASS='help-icon-hidden';var ADVANCED_PREVIEW_VISIBLE_CLASS='is-preview-visible';var PREVIEW_SIDEBAR_VISIBLE_SELECTOR='.preview.is-preview-sidebar-visible[data-module="preview"]';var domService;var contextualMessageService;function isSupportedBrowser(){return!document.querySelector('body.lte_ie9');}
function isAdvancedPreviewPage(){return domService.hasClass(document.body,ADVANCED_PREVIEW_VISIBLE_CLASS);}
function getEligibleMessagesFromConfig(){var eligibleMessagesFromConfig=context.getConfig(ELIGIBLE_MESSAGES_CONFIG_KEY);if(!eligibleMessagesFromConfig){return[];}
var messageContext=eligibleMessagesFromConfig.messageContext;var eligibleMessagesList=eligibleMessagesFromConfig.messages;eligibleMessagesList.map(function(message){message.context=messageContext;});return eligibleMessagesList;}
function registerEligibleMessages(){var messages=getEligibleMessagesFromConfig();messages.map(function(message){contextualMessageService.registerMessage(message);});}
function unregisterEligibleMessages(){var messages=getEligibleMessagesFromConfig();messages.map(function(message){contextualMessageService.unregisterMessage(message.identifier,message.context,message.type);});}
function isContextalMessagingSupported(){return context.hasService('contextual-message')&&isSupportedBrowser();}
function addHideHelpIconClassToBodyEl(){if(!domService.hasClass(document.body,HIDE_HELP_ICON_CLASS)){domService.addClass(document.body,HIDE_HELP_ICON_CLASS);}}
function removeHideHelpIconClassFromBodyEl(){if(domService.hasClass(document.body,HIDE_HELP_ICON_CLASS)){domService.removeClass(document.body,HIDE_HELP_ICON_CLASS);}}
return{messages:['previewaction','previewopen','previewclose','previewtogglesidebar'],init:function(){if(!isContextalMessagingSupported()){return;}
domService=context.getService('dom');contextualMessageService=context.getService('contextual-message');if(isAdvancedPreviewPage()){return;}
registerEligibleMessages();},destroy:function(){if(!isContextalMessagingSupported()){return;}
unregisterEligibleMessages();},onmessage:function(name,data){if(!isContextalMessagingSupported()){return;}
if(PREVIEW_CHANGE_EVENTS.indexOf(name)<0){return;}
if(name===PREVIEW_SIDEBAR_TOGGLE){if(data.showSidebar){removeHideHelpIconClassFromBodyEl();}else{addHideHelpIconClassToBodyEl();}
return;}
if((name===PREVIEW_ACTION_EVENT&&data.action===SHOW_ACTION)||name===PREVIEW_OPEN_EVENT){if(!document.querySelector(PREVIEW_SIDEBAR_VISIBLE_SELECTOR)){addHideHelpIconClassToBodyEl();}
unregisterEligibleMessages();}else if((name===PREVIEW_ACTION_EVENT&&data.action===CLOSE_ACTION)||name===PREVIEW_CLOSE_EVENT){removeHideHelpIconClassFromBodyEl();registerEligibleMessages();}}};});Box.Application.addModule('notifications',function(context){'use strict';var v5,dom,$element,notificationsService;return{messages:['x-folderchangeafter'],init:function(){v5=context.getService('v5');dom=context.getService('dom');$element=$(context.getElement());notificationsService=context.getService('notifications');notificationsService.displayServerNotification();},onmessage:function(name,data){if(name==='x-folderchangeafter'){this.handleFolderChangeAfter(data.json);}},handleFolderChangeAfter:function(data){if(data.is_from_instant_login){notificationsService.confirm($t('Results owned by external collaborators have been omitted.','external_collab_content_omitted'));}}};});Box.Application.addService('autosize',function(){'use strict';return{init:function(element){$(element).autosize({append:false});},destroy:function(element){$(element).trigger('autosize.destroy');},resize:function(element){$(element).trigger('autosize.resize');}};});Box.Application.addService('fileop-movecopy-legacy',function(application){'use strict';return{showMoveCopyPopup:function(fileId){var Item=application.getGlobal('Item');if(!Item){return;}
Item.find_async('f_'+fileId).then(function(foundItem){if(foundItem){foundItem.move({'create_new_action_instance':true});}});}};});Box.Application.addService('notifications-amsterdam',function(application){'use strict';var INFO_TYPE='info';var WARN_TYPE='warn';var ERROR_TYPE='error';var ESC_KEY=27;var NOTIFICATION_DURATION=4000;var dom=application.getService('dom');var promises=application.getService('promises');var document=application.getGlobal('document');var notificationsWrapperEl;var activeNotificationCount=0;function getNotificationsWrapper(){if(notificationsWrapperEl){return notificationsWrapperEl;}
notificationsWrapperEl=document.createElement('div');notificationsWrapperEl.className='notifications-wrapper';document.body.appendChild(notificationsWrapperEl);return notificationsWrapperEl;}
function Notification(type,title,buttons){this.type=type;this.title=title;this.buttons=buttons;this.uniqueID='notification_'+(new Date()).getTime();this.shown=false;this.elem=null;this.promise=null;}
Notification.prototype.show=function(duration){if(this.shown){return this.promise;}
this.shown=true;var noteEl=this.elem=document.createElement('div');noteEl.className='notification is-hidden notification-type-'+this.type;noteEl.setAttribute('role','alert');noteEl.setAttribute('aria-labeledby',this.uniqueID+'_label');var nodeTextEl=document.createElement('span');nodeTextEl.id=this.uniqueID+'_label';dom.setText(nodeTextEl,this.title);noteEl.appendChild(nodeTextEl);var hideNotification=function(){this.hide();}.bind(this);this.promise=promises.create(function(resolve,reject){if(this.buttons){this.buttons.forEach(function(buttonText,i){var buttonEl=document.createElement('button');buttonEl.className='btn notification-btn';buttonEl.setAttribute('data-button-index',i);dom.setText(buttonEl,buttonText);noteEl.appendChild(buttonEl);noteEl.className+=' has-btn';dom.on(buttonEl,'click',resolve);});}
var closeBtnEl=document.createElement('button');closeBtnEl.className='notification-close-btn';dom.setHTML(closeBtnEl,'&#10005;');closeBtnEl.title=$t('Close','notification_close');noteEl.appendChild(closeBtnEl);dom.on(closeBtnEl,'click',reject);getNotificationsWrapper().appendChild(noteEl);setTimeout(function(){dom.removeClass(noteEl,'is-hidden');activeNotificationCount++;},100);if(duration!==-1){setTimeout(reject,duration);}}.bind(this));this.promise.then(hideNotification,hideNotification);dom.on(document.body,'keydown',function(e){if(e.which!==ESC_KEY){return;}
this.hide();}.bind(this));return this.promise;};Notification.prototype.hide=function(){if(!this.shown){return;}
this.elem.style.marginTop='-'+(this.elem.clientHeight+10)+'px';dom.addClass(this.elem,'is-hidden');setTimeout(function(){if(this.elem.parentNode){this.elem.parentNode.removeChild(this.elem);}
activeNotificationCount--;}.bind(this),250);};return{info:function(title,params){return this._show(INFO_TYPE,title,params);},confirm:function(title,params){return this.info(title,params);},warn:function(title,params){return this._show(WARN_TYPE,title,params);},error:function(title,params){params=params||{};params.duration=params.duration||-1;return this._show(ERROR_TYPE,title,params);},create:function(type,title,buttons){return new Notification(type,title,buttons);},_show:function(type,title,params){params=params||{};params.duration=params.duration||NOTIFICATION_DURATION;if(params.buttonText&&typeof params.buttonText==='string'){params.buttonText=[params.buttonText];}
var notification=this.create(type,title,params.buttonText||null);var promise=notification.show(params.duration);params.clickHandler=params.clickHandler||function(){};params.hideHandler=params.hideHandler||function(){};params.onhide=params.onhide||function(){};promise.then(params.clickHandler,params.hideHandler);promise.then(null,params.onhide);return promise;}};});Box.Application.addService('fileop-favorites',function(application){'use strict';var ADD_ITEM_TO_FAVORITES_RUNMODE='add_to_favorites';var REMOVE_ITEM_FROM_FAVORITES_RUNMODE='remove_from_favorites';var FAVORITES_RESIN_PRODUCT='favorites';var FAVORITE_ADD_SUCCESS_MESSAGE=$t('Item added to Favorites.','fileop_favorites_add_to_favorite');var FAVORITE_REMOVE_SUCCESS_MESSAGE=$t('Item removed from Favorites.','fileop_favorites_remove_from_favorite');var FAVORITE_ADD_ERROR_MESSAGE=$t('An error occurred adding this item to favorites.','favorites_add_to_favorite_error');var FAVORITE_REMOVE_ERROR_MESSAGE=$t('An error occurred removing this item from favorites.','favorites_removing_to_favorite_error');return{add:function(itemTypedID,refreshItem,resinTarget){var ajax=application.getService('ajax'),notifications=application.getService('notifications-amsterdam'),resin=application.getService('resin'),itemTypedIDData={itemTypedId:itemTypedID};if(resinTarget){resin.recordAction({application:'files',page:'explorer',component:'content',feature:FAVORITES_RESIN_PRODUCT,target:resinTarget,action:'click'});}
application.broadcast('favoritestarted');return ajax.post(ADD_ITEM_TO_FAVORITES_RUNMODE,itemTypedIDData).then(function addItemToFavoritesSuccessHandler(){application.broadcast('favoritesuccess',itemTypedIDData);if(refreshItem){application.broadcast('itemupdated',itemTypedIDData);}
notifications.info(FAVORITE_ADD_SUCCESS_MESSAGE);},function addItemToFavoritesErrorHandler(){application.broadcast('favoriteerror',itemTypedIDData);notifications.error(FAVORITE_ADD_ERROR_MESSAGE);});},remove:function(itemTypedID,refreshItem,resinTarget){var ajax=application.getService('ajax'),notifications=application.getService('notifications-amsterdam'),resin=application.getService('resin'),itemTypedIDData={itemTypedId:itemTypedID};if(resinTarget){resin.recordAction({application:'files',page:'explorer',component:'content',feature:FAVORITES_RESIN_PRODUCT,target:resinTarget,action:'click'});}
application.broadcast('unfavoritestarted');return ajax.post(REMOVE_ITEM_FROM_FAVORITES_RUNMODE,itemTypedIDData).then(function removeItemFromFavoritesSuccessHandler(){application.broadcast('unfavoritesuccess',itemTypedIDData);if(refreshItem){application.broadcast('itemupdated',itemTypedIDData);}
notifications.info(FAVORITE_REMOVE_SUCCESS_MESSAGE);},function removeItemFromFavoritesErrorHandler(){application.broadcast('unfavoriteerror',itemTypedIDData);notifications.error(FAVORITE_REMOVE_ERROR_MESSAGE);});}};});Box.Application.addService('fileop-download',function(application){'use strict';var DOWNLOAD_FOLDER_RUNMODE='box_v2_zip_folder';var DOWNLOAD_SHARED_FOLDER_RUNMODE='box_v2_zip_shared_folder';var DOWNLOAD_FILE_RUNMODE='box_v2_download_file';var DOWNLOAD_SHARED_FILE_RUNMODE='box_download_shared_file';var FOLDER_TOO_LARGE_MSG=$t('The download is greater than 5GB. Please download the files individually or group them into smaller folders.','popup_action_download_error_zip_folder_too_large');var ERR_FOLDER_GENERIC=$t('Problems downloading archive.','popup_action_download_folder_error');var ERR_FOLDER_PERMISSION=$t('You do not have the permission to download this folder. Please contact the folder owner.','popup_action_download_folder_permission_error');var ERR_FOLDER_ZIP=$t('We experienced problems in zipping your archive. If you think you are getting this message in error, please contact Box.','js_popup_action_download_folder_error_zip');var config=application.getGlobalConfig();var document=application.getGlobal('document');var ajax=application.getService('ajax');var notifications=application.getService('notifications-amsterdam');var popups=application.getService('popups-amsterdam');var promises=application.getService('promises');var urlsRunmode=application.getService('urls-runmode');var downloadTarget;function createDownloadTarget(){if(downloadTarget){return;}
downloadTarget=document.createElement('iframe');downloadTarget.style.display='none';downloadTarget.name='box-download-target';document.body.appendChild(downloadTarget);}
function downloadForm(url){createDownloadTarget();var form=document.createElement('form');form.method='post';form.action=url;form.target='box-download-target';form.style.display='none';var input=document.createElement('input');input.type='hidden';input.name='request_token';input.value=config.requestToken;form.appendChild(input);return form;}
return{download:function(typedIDs,data){data=data||{};if(config.zip_method!=='nginx'&&data.size&&data.size>config.file_size_download_limit){return popups.alert(FOLDER_TOO_LARGE_MSG);}
if(typedIDs.length===1&&typedIDs[0].substr(0,2)==='f_'){return this.downloadFile(typedIDs[0],data);}
return this.downloadBulk(typedIDs,data);},downloadBulk:function(typedIDs,data){var runmode=DOWNLOAD_FOLDER_RUNMODE;data=data||{};notifications.info($t('Your download will begin shortly.','amsterdam_download_start_notification'));var params;if(typedIDs.length===1&&typedIDs[0].substr(0,2)==='d_'){params={folder_id:typedIDs[0].substr(2)};}else if(data.parentFolderID){params={folder_id:data.parentFolderID,nodes:typedIDs.join(',')};}else{params={nodes:typedIDs.join(',')};}
if(data.vanityName){runmode=DOWNLOAD_SHARED_FOLDER_RUNMODE;params.q={shared_item:{vanity_name:data.vanityName}};}else if(data.sharedName){runmode=DOWNLOAD_SHARED_FOLDER_RUNMODE;params.q={shared_item:{shared_name:data.sharedName}};}
return ajax.get(runmode,params).then(function(response){var data=response.data||{};if(data.result==='permission'){return popups.alert(ERR_FOLDER_PERMISSION);}else if(data.result!=='success'){return promises.createRejected(data);}
createDownloadTarget();downloadTarget.src=data.download_url;}).then(null,function(errorMessage){return popups.alert(errorMessage||ERR_FOLDER_GENERIC);});},downloadFile:function(typedID,data){var url;var match=/(f_\d+)(?:_(\d+))?/.exec(typedID);data=data||{};if(data.vanityName){url=urlsRunmode.get(DOWNLOAD_SHARED_FILE_RUNMODE);url+='&vanity_name='+data.vanityName;}else if(data.sharedName){url=urlsRunmode.get(DOWNLOAD_SHARED_FILE_RUNMODE);url+='&shared_name='+data.sharedName;}else{url=urlsRunmode.get(DOWNLOAD_FILE_RUNMODE);}
url+='&file_id='+match[1];if(match[2]){url+='&file_version_id='+match[2];}
var form=downloadForm(url);document.body.appendChild(form);form.submit();document.body.removeChild(form);return promises.createResolved();}};});Box.Application.addService('fileop-upload-legacy',function(application){'use strict';var v5=application.getService('v5');return{uploadFileNewVersion:function(fileId){var Item=application.getGlobal('Item');if(!Item){return;}
Item.find_async('f_'+fileId).then(function(foundItem){if(foundItem){var uploadProcess=v5.get('Upload_Process'),uploadProcessService;if(uploadProcess.get_type()==='default'){uploadProcessService=application.getService('upload-process');if(uploadProcessService){uploadProcessService.showAjaxEolMessage();}}else{uploadProcess.show_upload_new_version_popup({file:foundItem,'show_toaster':true});}}});}};});Box.Application.addService('fileop-versions',function(application){'use strict';return{showVersionsPopup:function(fileId){var Item=application.getGlobal('Item');if(!Item){return;}
Item.find_async('f_'+fileId).then(function(foundItem){if(foundItem){foundItem.version_history();}});}};});Box.Application.addService('mention-selector',function(application){'use strict';var KEY={BACKSPACE:8,RETURN:13,LEFT:37,RIGHT:39,HOME:36,END:35},ZERO_WIDTH_CHAR='\u200B';var arrayUtils=application.getService('array-utils'),dom=application.getService('dom'),browser=application.getService('browser'),promises=application.getService('promises'),win=application.getGlobal('window'),document=application.getGlobal('document'),rangy=application.getGlobal('rangy');rangy.init();function isCursorInsideMentionEl(){var sel,containerNode;sel=rangy.getSelection();if(sel.getRangeAt&&sel.rangeCount){containerNode=sel.getRangeAt(0).startContainer;}
return containerNode&&containerNode.parentNode&&containerNode.parentNode.tagName==='A';}
function isNoActiveMention(ctx,mentionTrigger){return!(ctx.inputBuffer.length||mentionTrigger.length);}
function isNewMention(ctx,mentionTrigger){return((!ctx.inputBuffer.length||(ctx.inputBuffer.length&&!ctx.shouldContinueMentionLookup))&&mentionTrigger.length);}
function createMentionEl(mentionTrigger,id,href,text){var mentionEl=document.createElement('a'),mentionTextNode=document.createTextNode(mentionTrigger+text);mentionEl.appendChild(mentionTextNode);mentionEl.setAttribute('data-id',id);mentionEl.href=href;return mentionEl;}
function deleteInputtedMentionText(mentionText){var sel,range,lastMentionTriggerIndex,mentionSubstr='';sel=rangy.getSelection();if(!(sel.getRangeAt&&sel.rangeCount)){return;}
range=sel.getRangeAt(0);mentionSubstr=range.startContainer.nodeValue.substring(0,range.endOffset);lastMentionTriggerIndex=mentionSubstr.lastIndexOf(mentionText);range.setStart(range.startContainer,lastMentionTriggerIndex);range.deleteContents();sel.removeAllRanges();sel.addRange(range);}
function insertElementAtCursor(element,isCompleteMention){var sel,range,spaceTextNode=document.createTextNode('\u00A0');sel=rangy.getSelection();if(!(sel.getRangeAt&&sel.rangeCount)){return;}
range=sel.getRangeAt(0);range.insertNode(element);if(isCompleteMention){range.setStartAfter(element);range.insertNode(spaceTextNode);range.setStartAfter(spaceTextNode);}else{range.selectNodeContents(element);}
range.collapse(false);sel.removeAllRanges();sel.addRange(range);}
function addMention(ctx,id,href,text){var mentionEl=createMentionEl(ctx.mentionTrigger,id,href,text);deleteInputtedMentionText(ctx.inputBuffer);insertElementAtCursor(mentionEl,true);ctx.inputBuffer='';}
function getMentionTrigger(mentionTriggers,inputBuffer){return arrayUtils.filter(mentionTriggers,function(mentionTrigger){return inputBuffer.lastIndexOf(mentionTrigger)!==-1;});}
function parseMentionData(ctx){if(ctx.shouldContinueMentionLookup&&ctx.dataProvider&&ctx.inputBuffer.length>1&&ctx.inputBuffer.length<50&&!isCursorInsideMentionEl('a')){ctx.dataProvider(ctx.inputBuffer.substring(1)).then(function(data){if(data.length===0){ctx.shouldContinueMentionLookup=false;}
ctx.selectorDropdown.setItems(data);}).caught(function(error){if(!error instanceof promises.CancellationError){throw error;}});}else if(ctx.inputBuffer.length===1){ctx.selectorDropdown.setItems([{text:$t('Mention someone to notify them','mention_selector_enter_name'),isNotSelectable:true}]);}else{ctx.selectorDropdown.setItems([]);}}
function stopLookup(ctx){ctx.inputBuffer='';ctx.shouldContinueMentionLookup=false;ctx.mentionTrigger='';ctx.mentionTriggerIndex=-1;ctx.selectorDropdown.setItems([]);ctx.range=null;ctx.typedValue=[];}
function calculateResize(ctx){return function(){var contentEditableElBoundingRect=dom.getBoundingClientRect(ctx.contentEditableEl);if(ctx.contentEditableElClientHeight!==contentEditableElBoundingRect.height){ctx.fire('resize');ctx.contentEditableElClientHeight=contentEditableElBoundingRect.height;}};}
function keypressHandler(ctx){return function(event){var keyCode=event.which||event.keyCode,mentionTrigger,selection,range,br,typedValue,zeroWidthChar;if(keyCode===KEY.BACKSPACE){return;}
if(keyCode===KEY.RETURN&&browser.isIE()&&browser.getVersion()==='9'){range=document.selection.createRange();range.pasteHTML('<br> ');range.moveStart('character',0);range.moveEnd('character',-1);range.select();event.preventDefault();event.stopPropagation();}else if(keyCode===KEY.RETURN&&browser.isIE()){selection=win.getSelection();range=selection.getRangeAt(0);br=document.createElement('br');zeroWidthChar=document.createTextNode(ZERO_WIDTH_CHAR);range.deleteContents();range.insertNode(br);range.collapse(false);range.insertNode(zeroWidthChar);range.collapse(true);selection.removeAllRanges();selection.addRange(range);event.preventDefault();event.stopPropagation();}
calculateResize(ctx)();if(event.type==='compositionend'){typedValue=event.originalEvent.data;}else{typedValue=String.fromCharCode(keyCode);}
mentionTrigger=getMentionTrigger(ctx.mentionTriggers,typedValue);if(isNoActiveMention(ctx,mentionTrigger)){return;}else if(isNewMention(ctx,mentionTrigger)){ctx.inputBuffer='';ctx.mentionTrigger=mentionTrigger[0];ctx.range=null;ctx.shouldContinueMentionLookup=true;ctx.typedValue=[];}
if(!ctx.typedValue){ctx.typedValue=[];}
ctx.typedValue.push(typedValue);};}
function keydownHandler(ctx){return function(event){var keyCode=event.which||event.keyCode;if(keyCode===KEY.LEFT||keyCode===KEY.RIGHT||keyCode===KEY.HOME||keyCode===KEY.END){ctx.inputBuffer='';return;}
if(keyCode===KEY.BACKSPACE){ctx.inputBuffer=ctx.inputBuffer.slice(0,ctx.inputBuffer.length-1);ctx.shouldContinueMentionLookup=true;parseMentionData(ctx);}};}
function keyupHandler(ctx){return function(){if(ctx.typedValue&&ctx.typedValue.length&&ctx.mentionTrigger&&ctx.shouldContinueMentionLookup){var cursorPos=rangy.getSelection().getRangeAt(0);if(!ctx.range){ctx.range=cursorPos;ctx.mentionTriggerIndex=ctx.range.startOffset;}else if(cursorPos.startOffset<=ctx.mentionTriggerIndex||cursorPos.compareBoundaryPoints(Range.START_TO_END,ctx.range)<0){stopLookup(ctx);return;}
while(ctx.typedValue.length){ctx.inputBuffer+=ctx.typedValue.shift();}
parseMentionData(ctx);}
calculateResize(ctx);};}
function menuItemSelectHandler(ctx){return function(event){addMention(ctx,event.data.id,event.data.href,event.data.text);};}
function setPlaceholder(contentEditableEl){var placeholderEl=document.createElement('p'),placeholderText=contentEditableEl.getAttribute('data-placeholder'),placeholderTextEl=document.createTextNode(placeholderText);if(placeholderText){placeholderEl.className='placeholder';placeholderEl.appendChild(placeholderTextEl);contentEditableEl.insertBefore(placeholderEl,contentEditableEl.firstChild);}}
function blurHandler(ctx){return function(){var contentEditableEl=ctx.contentEditableEl,placeholderEl=contentEditableEl.querySelector('.placeholder'),contentEditableText=contentEditableEl.textContent||contentEditableEl.innerText;if(!placeholderEl&&(!contentEditableText||contentEditableText.length===0)){setPlaceholder(contentEditableEl);}
ctx.selectorDropdown.setItems([]);};}
function focusHandler(ctx){return function(){var placeholderEl=ctx.contentEditableEl.querySelector('.placeholder'),contentEditableElBoundingRect=dom.getBoundingClientRect(ctx.contentEditableEl);dom.removeClass(ctx.contentEditableEl,'has-error');ctx.contentEditableEl.removeAttribute('data-hover');ctx.contentEditableEl.removeAttribute('aria-label');ctx.contentEditableElClientHeight=contentEditableElBoundingRect.height;if(placeholderEl){ctx.contentEditableEl.removeChild(placeholderEl);insertElementAtCursor(document.createElement('div'));}};}
function processPaste(element,pastedContent){var pastedContentNode=document.createTextNode(pastedContent),sel=rangy.getSelection(),range;sel.deleteFromDocument();range=sel.getRangeAt(0);range.insertNode(pastedContentNode);range.collapseAfter(pastedContentNode);rangy.getSelection().setSingleRange(range);}
function pasteHandler(ctx){return function(event){var e=event.originalEvent,pastedContent;if(e.clipboardData||win.clipboardData){pastedContent=e.clipboardData?e.clipboardData.getData('text/plain'):win.clipboardData.getData('Text');}
if(pastedContent&&pastedContent.length>0){setTimeout(function(){processPaste(ctx.contentEditableEl,pastedContent);calculateResize(ctx)();},1);}
event.stopPropagation();event.preventDefault();};}
function getInnerText(el){var text='',sel=rangy.getSelection(),range;sel.removeAllRanges();range=document.createRange();range.selectNodeContents(el);sel.addRange(range);text=win.getSelection().toString();sel.removeAllRanges();return text;}
function MentionTextarea(mentionTriggers,contentEditableEl,dataProvider){var contactSelectorDropdownService=application.getService('contact-selector-dropdown');setPlaceholder(contentEditableEl);this.selectorDropdown=contactSelectorDropdownService.create(contentEditableEl);this.menuItemSelectHandlerRef=menuItemSelectHandler(this);this.keypressHandlerRef=keypressHandler(this);this.keydownHandlerRef=keydownHandler(this);this.keyupHandlerRef=keyupHandler(this);this.focusHandlerRef=focusHandler(this);this.pasteHandlerRef=pasteHandler(this);this.blurHandlerRef=blurHandler(this);this.contentEditableEl=contentEditableEl;this.mentionTriggers=mentionTriggers;this.mentionTrigger='';this.dataProvider=dataProvider;this.inputBuffer='';this.typedValue=[];this.shouldContinueMentionLookup=false;this.selectorDropdown.on('dropdownitemselect',this.menuItemSelectHandlerRef);dom.on(this.contentEditableEl,'keypress',this.keypressHandlerRef);dom.on(this.contentEditableEl,'keydown',this.keydownHandlerRef);dom.on(this.contentEditableEl,'focus',this.focusHandlerRef);dom.on(this.contentEditableEl,'blur',this.blurHandlerRef);dom.on(this.contentEditableEl,'keyup',this.keyupHandlerRef);dom.on(this.contentEditableEl,'paste',this.pasteHandlerRef);dom.on(this.contentEditableEl,'compositionend',this.keypressHandlerRef);$.extend(this,new Box.EventTarget());}
MentionTextarea.prototype={focus:function(){this.contentEditableEl.focus();},reset:function(){dom.setHTML(this.contentEditableEl,'');this.selectorDropdown.setItems([]);this.inputBuffer='';setPlaceholder(this.contentEditableEl);},getMessage:function(){var mentionElements,message={message:'',messageMentioned:''},i,zeroWidthCharRegex=new RegExp(ZERO_WIDTH_CHAR,'g'),messageStr=this.contentEditableEl.innerText||getInnerText(this.contentEditableEl),mentionElementsLen;messageStr=messageStr.replace(zeroWidthCharRegex,'');if(dom.query('.placeholder',this.contentEditableEl)||messageStr.length===0){return message;}else{mentionElements=this.contentEditableEl.querySelectorAll('a[data-id]');mentionElementsLen=mentionElements.length;message.message=messageStr;message.messageMentioned=messageStr;for(i=0;i<mentionElementsLen;i++){var mentionEl=mentionElements[i],mentionText=mentionEl.textContent||mentionEl.innerText,mentionName=mentionText.length>1?mentionText.slice(1):' ',formattedMention=this.mentionTriggers[0]+'['+mentionEl.getAttribute('data-id')+':'+mentionName+']';message.messageMentioned=message.messageMentioned.replace(mentionText,formattedMention);}
return message;}},setMessage:function(messageHtml){dom.setHTML(this.contentEditableEl,messageHtml);},initMentionAtCursor:function(){this.contentEditableEl.focus();var me=this;setTimeout(function(){me.mentionTrigger=me.mentionTriggers[0];var textNode=document.createTextNode(me.mentionTrigger);insertElementAtCursor(textNode,false);me.range=rangy.getSelection().getRangeAt(0);me.mentionTriggerIndex=me.range.startOffset-1;me.inputBuffer=me.mentionTrigger;me.shouldContinueMentionLookup=true;me.typedValue=[];parseMentionData(me);},0);},insertMentionAtCursor:function(id,href,text){var mentionEl=createMentionEl(this.mentionTriggers[0],id,href,text);win.setTimeout(function(){insertElementAtCursor(mentionEl,true);},0);},displayError:function(errorString){dom.addClass(this.contentEditableEl,'has-error');this.contentEditableEl.setAttribute('data-tooltip','');this.contentEditableEl.setAttribute('data-tooltip-theme','error');this.contentEditableEl.setAttribute('aria-label',errorString);},destroy:function(){dom.setHTML(this.contentEditableEl,'');this.selectorDropdown.off('dropdownitemselect',this.menuItemSelectHandlerRef);dom.off(this.contentEditableEl,'keypress',this.keypressHandlerRef);dom.off(this.contentEditableEl,'keydown',this.keydownHandlerRef);dom.off(this.contentEditableEl,'focus',this.focusHandlerRef);dom.off(this.contentEditableEl,'keyup',this.keyupHandlerRef);dom.off(this.contentEditableEl,'paste',this.pasteHandlerRef);dom.off(this.contentEditableEl,'blur',this.blurHandlerRef);dom.off(this.contentEditableEl,'compositionend',this.keypressHandlerRef);}};return{create:function(mentionTriggers,contentEditableEl,dataProvider){return new MentionTextarea(mentionTriggers,contentEditableEl,dataProvider);}};});Box.Application.addService('provider-contacts',function(application){'use strict';var RM_CONTACTS_GET='sham_contacts_get',UPLOADER_BADGE={title:$t('UPLOADER','contact_selector_uploader'),tooltip:$t('This user does not have permission to add comments or respond to tasks.','contact_selector_uploader_description')};var ajax=application.getService('ajax'),urlService=application.getService('url');var ongoingRequest;function formatContactsForContactsGetRunmode(data,options){var results=[],contacts,contact=null,i,len;if(data.hasOwnProperty('contacts')){contacts=data.contacts;for(i=0,len=contacts.length;i<len;i++){contact=contacts[i];results.push({data:{email:contact.email,id:contact.id,type:'user'},id:contact.email,text:contact.contact_name,email:contact.email});}}
if(data.hasOwnProperty('collabs_without_account')&&!options.excludeWithoutAccount){contacts=data.collabs_without_account;for(i=0,len=contacts.length;i<len;i++){contact=contacts[i];results.push({data:{email:contact.email,id:contact.email,type:'collab_without_account'},id:contact.email,text:contact.email,email:''});}}
if(data.hasOwnProperty('friends_without_account')&&!options.excludeWithoutAccount){contacts=data.friends_without_account;for(i=0,len=contacts.length;i<len;i++){contact=contacts[i];results.push({data:{email:contact.email,id:contact.email,type:'friend_without_account'},id:contact.email,text:contact.contact_name,email:contact.email});}}
if(data.hasOwnProperty('groups')){contacts=data.groups;for(i=0,len=contacts.length;i<len;i++){contact=contacts[i];results.push({data:{email:'',id:contact.id,type:'group'},id:contact.id,text:contact.contact_name,email:$t('Group','group_text')});}}
return results;}
function searchAllContactsWithOptions(typedId,options){return function(query){if(ongoingRequest){ongoingRequest.cancel();ongoingRequest=null;}
var runmode=urlService.getGcmCompatibleRm(RM_CONTACTS_GET);ongoingRequest=ajax.get(runmode,{searchString:query,itemTypedId:typedId,includeSelf:!!options.includeSelf,includeGroups:!!options.includeGroups});return ongoingRequest.then(function(response){ongoingRequest=null;return formatContactsForContactsGetRunmode(response.data,options);},function(){ongoingRequest=null;});};}
return{searchAllContacts:function(options){return searchAllContactsWithOptions('',options||{});},searchAllContactsExcludingItemCollaborators:function(typedId,options){if(typedId){return searchAllContactsWithOptions(typedId,options||{});}else{return this.searchAllContacts(options);}},searchWithItem:function(typedId){return function(query){if(ongoingRequest){ongoingRequest.cancel();ongoingRequest=null;}
ongoingRequest=ajax.get('sham_contacts_get_for_item',{search_string:query,item_typed_id:typedId||'',include_pending_collabs:false,include_self:false});return ongoingRequest.then(function(response){ongoingRequest=null;var ret=[],contactsLength=response.data.contacts.length;for(var i=0;i<contactsLength;i++){ret.push({text:response.data.contacts[i].contact_name,id:''+response.data.contacts[i].id,data:response.data.contacts[i],href:'/profile/'+response.data.contacts[i].id,email:response.data.contacts[i].email,isNotSelectable:response.data.is_uploader[response.data.contacts[i].id],badge:response.data.is_uploader[response.data.contacts[i].id]?UPLOADER_BADGE:null});}
return ret;},function(){ongoingRequest=null;});};}};});Box.Application.addService('url-amsterdam',function(){'use strict';function getKeys(object){var keys=[];for(var key in object){if(object.hasOwnProperty(key)){keys.push(key);}}
return keys;}
function encodeURIComponent(uri){return window.encodeURIComponent(uri).replace(/%20/g,'+');}
function decodeURIComponent(uri){return window.decodeURIComponent(uri.replace(/\+/g,' '));}
function encode(obj){if(typeof obj==='string'||typeof obj==='number'){return encodeURIComponent(obj);}
var params=[];var keys=getKeys(obj).sort();for(var i=0;i<keys.length;i++){var key=keys[i];var value=obj[key];if(value===undefined){params.push(encodeURIComponent(key));}else{params.push(encodeURIComponent(key)
+'='
+encodeURIComponent(value));}}
return params.join('&');}
function decode(qs,exclUndefined){if(!qs||qs==='?'){return{};}
if(qs&&qs[0]==='?'){qs=qs.substr(1);}
var splitQS=qs.split('&');var output={};for(var i=0,len=splitQS.length;i<len;i++){var p=splitQS[i].split('=');if(!!p[0]&&(!exclUndefined||p[1]!==undefined)){output[decodeURIComponent(p[0])]=decodeURIComponent(p[1]);}}
return output;}
return{encode:encode,decode:decode};});Box.Application.addService('urls-runmode',function(){'use strict';return{formatQuery:function(options){function toURIComponents(obj,prefix,data){prefix=prefix||'';data=data||[];if(typeof obj==='string'||typeof obj==='number'){data.push(prefix+'='+encodeURIComponent(obj));}else if(typeof obj==='boolean'){data.push(prefix+'='+(obj?1:0));}else{for(var p in obj){if(!obj.hasOwnProperty(p)){continue;}
data=toURIComponents(obj[p],prefix+'['+p+']',data);}}
return data;}
return toURIComponents(options,'q').join('&');},get:function(runmode,options){var url='/index.php?rm='+runmode;if(options){url+='&'+this.formatQuery(options);}
return url;}};});Box.Application.addService('xhr',function(application){'use strict';var promises=application.getService('promises');var config=application.getGlobalConfig();function send(method,url,data,options){options=options||{};var xhr;if(window.XMLHttpRequest){xhr=new XMLHttpRequest();}else if(window.ActiveXObject){xhr=new ActiveXObject('MSXML2.XMLHTTP.3.0');}else{return null;}
xhr.open(method,url,true);if(!options.corsRequest){xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');if(config.requestToken){xhr.setRequestHeader('X-Request-Token',config.requestToken);}}
if(typeof data==='string'){xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF-8');}
xhr.send(data||null);return xhr;}
return{send:function(method,url,data,options){var xhr=send(method,url,data,options);var isAborted=false;var resolution=promises.create(function(resolve,reject){xhr.onreadystatechange=function(){if(isAborted){return null;}
if(xhr.readyState===4){if((xhr.status/100|0)===2){resolve(xhr);}else{reject(xhr);}}};xhr.onerror=function(){if(isAborted){return null;}
reject(xhr);};});resolution.abort=function(){isAborted=true;xhr.abort();};return resolution;},parseJSONResponse:function(xhr){return promises.create(function(resolve,reject){var parsed;try{parsed=JSON.parse(xhr.responseText);}catch(e){reject(e);return;}
resolve(parsed);});},handleLegacyAJAXResponse:function(xhr){return promises.create(function(resolve,reject){var parsed;try{parsed=JSON.parse(xhr.responseText);}catch(e){reject(e);return;}
if(!('data'in parsed)){reject(parsed);return;}
resolve(parsed.data);});}};});Box.Application.addService('item-actions',function(application){'use strict';var GET_SHARE_LINK_POPUP_RUNMODE='sham_share_link_popup';return{share:function(typedID){var urlService=application.getService('url');var popupsService=application.getService('popups-amsterdam');var runmode=urlService.getGcmCompatibleRm(GET_SHARE_LINK_POPUP_RUNMODE);popupsService.open(runmode,{isPostRequest:true,resinName:'share',data:{itemTypedId:typedID}});}};});Box.Application.addService('popups-amsterdam',function(application){'use strict';var ALERT_POPUP_HTML='<button class="btn-plain popup-x-btn" title="<%=closeBtnText%>" data-event-type="close" data-resin-target="closebutton">'+'<span class="accessibility-hidden"><%=closeBtnText%></span>'+'&times;'+'</button>'+'<div class="popup-contents">'+'<h2 class="popup-heading"><%=heading%></h2>'+'<p class="mbn"><%=message%></p>'+'<div class="popup-btn-group">'+'<button class="btn btn-primary" data-event-type="close">'+
$t('Okay','alert_popup_button_title')+'</button>'+'</div>'+'</div>';var PROMPT_POPUP_HTML='<button class="btn-plain popup-x-btn" title="<%=closeBtnText%>" data-event-type="close" data-resin-target="closebutton">'+'<span class="accessibility-hidden"><%=closeBtnText%></span>'+'&times;'+'</button>'+'<div class="popup-contents">'+'<h2 class="popup-heading"><%=heading%></h2>'+'<p><%=message%></p>'+'<form>'+' <input class="popup-prompt-input" type="text" <%=required%> placeholder="<%=placeholder%>" value="<%=defaultValue%>" pattern="<%=pattern%>" title="<%=title%>">'+'<div class="popup-btn-group">'+'<button class="btn popup-cancel-btn" data-event-type="close" type="button">'+
$t('Cancel','popup_prompt_button_cancel')+'</button>'+'<button class="btn btn-primary" data-event-type="ok">'+
$t('Okay','alert_popup_button_title')+'</button>'+'</div>'+'</form>'+'</div>';var CONFIRM_POPUP_HTML='<button class="btn-plain popup-x-btn" title="<%=closeBtnText%>" data-event-type="close" data-resin-target="closebutton">'+'<span class="accessibility-hidden"><%=closeBtnText%></span>'+'&times;'+'</button>'+'<div class="popup-contents">'+'<h2 class="popup-heading"><%=heading%></h2>'+'<p class="mbn"><%=message%></p>'+'<div class="button-bar">'+'<button class="btn popup-cancel-btn" data-event-type="cancel"><%=cancelBtnText%></button>'+'<button class="btn btn-primary popup-confirm-btn" data-event-type="ok">'+'<span class="btn-text"><%=okBtnText%></span>'+'</button>'+'</div>'+'</div>';var MODAL_POPUP_HTML='<button class="btn-plain popup-x-btn" title="<%=closeBtnText%>" data-event-type="close" data-resin-target="closebutton">'+'<span class="accessibility-hidden"><%=closeBtnText%></span>'+'&times;'+'</button>'+'<div class="popup-contents"></div>';var CONFIRM_DEFAULT_TEXT=$t('Okay','popup_generic_button_okay');var CANCEL_DEFAULT_TEXT=$t('Cancel','popup_generic_button_cancel');var CLOSE_BUTTON_TITLE=$t('Close','popup_generic_button_close');var POPUP_GENERIC_REQUIRED_PARAMETER=$t('required','required_parameter');var ERROR_DEFAULT_TITLE_TEXT=$t('Error','popup_generic_failure_message_title');var ERROR_DEFAULT_TEXT=$t('An error has occurred while loading this feature.','popup_generic_failure_message');var DISABLED_CLASS='is-disabled';var LOADING_CLASS='is-loading';var dom=application.getService('dom');var focus=application.getService('focus');var nav=application.getService('nav');var promises=application.getService('promises');var templates=application.getService('templates');var tooltips=application.getService('tooltips-amsterdam');var isCloseDisabled=false;var openPopups=[];var numActivePopups=0;var reloadTimer;function attachDOMEventListeners(elem,wrapperElem){var eventTarget=new Box.EventTarget();this.on=function(){eventTarget.on.apply(eventTarget,arguments);};this.fire=function(){eventTarget.fire.apply(eventTarget,arguments);};setTimeout(function(){dom.on(wrapperElem,'click',function(event){eventTarget.fire('close',event);});},500);dom.on(elem,'click',function(event){event.stopPropagation();var targetEl=dom.getNearest(event.target||event.srcElement,'[data-event-type]');if(targetEl){eventTarget.fire(targetEl.getAttribute('data-event-type'),event);}});dom.on(elem,'keyup',function(event){if(event.keyCode!==27){return;}
eventTarget.fire('close',event);event.stopPropagation();event.preventDefault();});var me=this;eventTarget.on('close',function(){me.close();});}
function Popup(contents,className){var elem=this.elem=document.createElement('div');elem.className='popup-wrapper disable_selectable';elem.setAttribute('data-resin-page','popupsamsterdam');elem.setAttribute('data-resin-component','wrapper');elem.setAttribute('data-resin-feature','interactions');this.spinnerElem=templates.getTemplateFragment('spinner-light-large');var innerElem=this.innerElem=document.createElement('div');innerElem.className=className?('popup '+className):'popup';innerElem.setAttribute('tabindex','-1');if(contents instanceof Element){innerElem.appendChild(contents);elem.appendChild(innerElem);}else if(typeof contents==='string'){dom.setHTML(innerElem,contents);elem.appendChild(innerElem);}else{dom.addClass(elem,LOADING_CLASS);}
attachDOMEventListeners.call(this,innerElem,elem);}
Popup.prototype.show=function(){document.body.appendChild(this.elem);if(tooltips){tooltips.hideAll();}
numActivePopups++;dom.addClass(document.body,'has-active-popup');openPopups.push(this);};Popup.prototype.focus=function(){if(!this._focusActivated){focus.wrap(this.elem,true);this._focusActivated=true;}};Popup.prototype.resize=function(width){var children=this.innerElem.childNodes;var height=0;for(var i=0;i<children.length;i++){if(!children[i].offsetHeight||dom.hasClass(children[i],'popup-x-btn')){continue;}
var style=children[i].currentStyle;if(!style){style=getComputedStyle(children[i]);}
height+=children[i].offsetHeight+parseInt(style.marginTop,10)+parseInt(style.marginBottom,10);}
this.innerElem.style.height=height+'px';if(width){this.innerElem.style.width=width;}};Popup.prototype.close=function(){if(!this.elem.parentNode||isCloseDisabled){return;}
if(tooltips){tooltips.hideAll();}
application.stopAll(this.elem);this.elem.parentNode.removeChild(this.elem);numActivePopups--;if(!numActivePopups){dom.removeClass(document.body,'has-active-popup');}
for(var i=0;i<openPopups.length;i++){if(openPopups[i]!==this){continue;}
openPopups.splice(i,1);return;}};Popup.prototype.setContent=function(contents){dom.removeClass(this.elem,LOADING_CLASS);var contentsContainer=dom.query('.popup-contents',this.innerElem);dom.setHTML(contentsContainer,contents);};Popup.prototype.query=function(selector){return this.innerElem.querySelector(selector);};Popup.prototype.queryAll=Popup.prototype.$=function(selector){return this.innerElem.querySelectorAll(selector);};function triggerPageReload(){if(reloadTimer){return;}
reloadTimer=setTimeout(function(){reloadTimer=null;nav.refresh();},50);}
return{_triggerPageReload:triggerPageReload,create:function(contents,className){return new Popup(contents,className);},alert:function(message,title){var popup=this.create();return promises.create(function(resolve){var alertFragment=templates.createTemplateFragment(ALERT_POPUP_HTML,{closeBtnText:CLOSE_BUTTON_TITLE,heading:title,message:message});popup.innerElem.appendChild(alertFragment);popup.elem.appendChild(popup.innerElem);popup.show();popup.focus();popup.resize();popup.on('close',resolve);});},prompt:function(params){var popup=this.create();return promises.create(function(resolve){if(!params.closeBtnText){params.closeBtnText=CLOSE_BUTTON_TITLE;}
if(!params.isOptional){params.required=POPUP_GENERIC_REQUIRED_PARAMETER;}
var frag=templates.createTemplateFragment(PROMPT_POPUP_HTML,params);popup.innerElem.appendChild(frag);popup.elem.appendChild(popup.innerElem);var input=dom.query('input',popup.elem);popup.show();popup.focus();popup.resize();if(params.defaultValue){input.select();}
popup.on('ok',function(){if(input.checkValidity&&!input.checkValidity()){return;}
popup.close();resolve(input.value);});dom.query('form',popup.elem).addEventListener('submit',function(event){event.preventDefault();popup.fire('ok');});});},confirm:function(message,title,params){params=params||{};var popup=this.create();var resolver=promises.create(function(resolve,reject){var confirmFragment=templates.createTemplateFragment(CONFIRM_POPUP_HTML,{closeBtnText:CLOSE_BUTTON_TITLE,heading:title,message:message,okBtnText:params.confirmText||CONFIRM_DEFAULT_TEXT,cancelBtnText:params.cancelText||CANCEL_DEFAULT_TEXT});popup.innerElem.appendChild(confirmFragment);popup.elem.appendChild(popup.innerElem);var confirmBtnEl=popup.query('.popup-confirm-btn');var spinnerEl=templates.getTemplateFragment('spinner');confirmBtnEl.appendChild(spinnerEl);popup.show();popup.focus();popup.resize();popup.on('ok',function(){resolve();});popup.on('cancel',function(){reject();});});function close(){popup.close();}
if(!params.isBlocking){popup.on('ok',close);}
popup.on('cancel',close);return resolver;},open:function(runmode,params){params=params||{};var me=this;var ajaxService=application.getService('ajax');var popup=this.create();var modalFragment=templates.createTemplateFragment(MODAL_POPUP_HTML,{closeBtnText:CLOSE_BUTTON_TITLE});popup.innerElem.appendChild(modalFragment);popup.elem.appendChild(popup.spinnerElem);popup.show();popup.hasLoaded=false;popup.on('close',function(){if(popup.hasLoaded&&params.hasUnsafeSideEffects){me._triggerPageReload();}});var data=params.data||{};data['!popup']='yesplease';var requestFunction=params.isPostRequest?ajaxService.post:ajaxService.get;requestFunction(runmode,data).then(function showPopupAfterModuleLoad(response){popup.elem.appendChild(popup.innerElem);popup.setContent(response.data.html);popup.focus();popup.resize(params.width);dom.addClass(popup.innerElem,'is-active');popup.hasLoaded=true;},function popupErrorHandler(response){if(response.message==='JSON Parse Error'){application.reportError('Popup being retrieved is not configured with $this->setUpPopup();');}
popup.hasLoaded=true;popup.close();var errorData=response.data||{};me.alert(errorData.message||ERROR_DEFAULT_TEXT,ERROR_DEFAULT_TITLE_TEXT);});return popup;},resize:function(){var current;if(openPopups.length===0){return;}
for(var i=0;i<openPopups.length;i++){current=openPopups[i];if(current.hasLoaded){current.resize();}}},close:function(params){var current;var shouldRefresh=false;params=params||{};if(!openPopups.length){if(params.alternateDestination){nav.navigate(params.alternateDestination);}
return;}
if(params.enableClose){isCloseDisabled=false;}
do{current=openPopups.shift();if(current.hasLoaded){shouldRefresh=true;}
current.close();}while(openPopups.length);if(shouldRefresh&&!params.unsafeSkipRefresh){this._triggerPageReload();}},showConfirmBlockingState:function(){if(!openPopups.length){return;}
var currentPopup=openPopups[openPopups.length-1],confirmBtnEl=currentPopup.query('.popup-confirm-btn'),cancelBtnEl=currentPopup.query('.popup-cancel-btn');if(confirmBtnEl){dom.addClass(confirmBtnEl,LOADING_CLASS);dom.addClass(confirmBtnEl,DISABLED_CLASS);}
if(cancelBtnEl){dom.addClass(cancelBtnEl,DISABLED_CLASS);}
isCloseDisabled=true;},anyPopupsOpen:function(){return openPopups.length>0;}};});Box.Application.addService('notifications-amsterdam',function(application){'use strict';var INFO_TYPE='info';var WARN_TYPE='warn';var ERROR_TYPE='error';var ESC_KEY=27;var NOTIFICATION_DURATION=4000;var dom=application.getService('dom');var promises=application.getService('promises');var document=application.getGlobal('document');var notificationsWrapperEl;var activeNotificationCount=0;function getNotificationsWrapper(){if(notificationsWrapperEl){return notificationsWrapperEl;}
notificationsWrapperEl=document.createElement('div');notificationsWrapperEl.className='notifications-wrapper';document.body.appendChild(notificationsWrapperEl);return notificationsWrapperEl;}
function Notification(type,title,buttons){this.type=type;this.title=title;this.buttons=buttons;this.uniqueID='notification_'+(new Date()).getTime();this.shown=false;this.elem=null;this.promise=null;}
Notification.prototype.show=function(duration){if(this.shown){return this.promise;}
this.shown=true;var noteEl=this.elem=document.createElement('div');noteEl.className='notification is-hidden notification-type-'+this.type;noteEl.setAttribute('role','alert');noteEl.setAttribute('aria-labeledby',this.uniqueID+'_label');var nodeTextEl=document.createElement('span');nodeTextEl.id=this.uniqueID+'_label';dom.setText(nodeTextEl,this.title);noteEl.appendChild(nodeTextEl);var hideNotification=function(){this.hide();}.bind(this);this.promise=promises.create(function(resolve,reject){if(this.buttons){this.buttons.forEach(function(buttonText,i){var buttonEl=document.createElement('button');buttonEl.className='btn notification-btn';buttonEl.setAttribute('data-button-index',i);dom.setText(buttonEl,buttonText);noteEl.appendChild(buttonEl);noteEl.className+=' has-btn';dom.on(buttonEl,'click',resolve);});}
var closeBtnEl=document.createElement('button');closeBtnEl.className='notification-close-btn';dom.setHTML(closeBtnEl,'&#10005;');closeBtnEl.title=$t('Close','notification_close');noteEl.appendChild(closeBtnEl);dom.on(closeBtnEl,'click',reject);getNotificationsWrapper().appendChild(noteEl);setTimeout(function(){dom.removeClass(noteEl,'is-hidden');activeNotificationCount++;},100);if(duration!==-1){setTimeout(reject,duration);}}.bind(this));this.promise.then(hideNotification,hideNotification);dom.on(document.body,'keydown',function(e){if(e.which!==ESC_KEY){return;}
this.hide();}.bind(this));return this.promise;};Notification.prototype.hide=function(){if(!this.shown){return;}
this.elem.style.marginTop='-'+(this.elem.clientHeight+10)+'px';dom.addClass(this.elem,'is-hidden');setTimeout(function(){if(this.elem.parentNode){this.elem.parentNode.removeChild(this.elem);}
activeNotificationCount--;}.bind(this),250);};return{info:function(title,params){return this._show(INFO_TYPE,title,params);},confirm:function(title,params){return this.info(title,params);},warn:function(title,params){return this._show(WARN_TYPE,title,params);},error:function(title,params){params=params||{};params.duration=params.duration||-1;return this._show(ERROR_TYPE,title,params);},create:function(type,title,buttons){return new Notification(type,title,buttons);},_show:function(type,title,params){params=params||{};params.duration=params.duration||NOTIFICATION_DURATION;if(params.buttonText&&typeof params.buttonText==='string'){params.buttonText=[params.buttonText];}
var notification=this.create(type,title,params.buttonText||null);var promise=notification.show(params.duration);params.clickHandler=params.clickHandler||function(){};params.hideHandler=params.hideHandler||function(){};params.onhide=params.onhide||function(){};promise.then(params.clickHandler,params.hideHandler);promise.then(null,params.onhide);return promise;}};});Box.Application.addService('preview-cache',function(){'use strict';var cache={},memory={},MAX_CACHED_PREVIEWS=30,STATUS_PENDING='pending';function limitCaching(){var lruEntry,arrayOfPreviews=Object.keys(cache);if(arrayOfPreviews.length>MAX_CACHED_PREVIEWS){lruEntry=arrayOfPreviews.reduce(function(a,b){return cache[a].lastAccessed>cache[b].lastAccessed?b:a;});delete cache[lruEntry];}}
return{add:function(previewToCache,status){var fileId,shouldPreviewBeCached=!!(previewToCache.content&&previewToCache.header&&previewToCache.sidebar&&!previewToCache.file.isPreviewWatermarked);if(Object.keys){fileId=previewToCache.file.id;if(status!==STATUS_PENDING&&shouldPreviewBeCached){cache[fileId]=previewToCache;}else{delete cache[fileId];}
limitCaching();}},memorize:function(key,value){memory[key]=value;},remove:function(fileId){delete cache[fileId];},fetch:function(fileId){return cache[fileId];},recall:function(key){return memory[key];},has:function(fileId){return!!cache[fileId];},reset:function(){cache={};},touch:function(fileId){if(this.has(fileId)){cache[fileId].lastAccessed=(new Date()).getTime();}}};});Box.Application.addService('fileop-lock-preview',function(application){'use strict';var LOCKING_RM='box_services_execute_action',NOTIFICATION_RM='box_services_add_locking_notification_request',UNLOCKING_RM='box_unlock_request',UNLOCKING_GCM_RM='box_master_gcm_unlock_request',CLASS_BTN_OK='.btn-fileop-ok',CLASS_BTN_CANCEL='.btn-fileop-cancel';var LOCK_ACTION_STRING='lock';var overlayWidget,okButtonHandlerFunc,ajax=application.getService('ajax'),notifications=application.getService('notifications'),lockConfig=application.getGlobalConfig('lockConfig'),dom=application.getService('dom'),templates=application.getService('templates'),overlay=application.getService('overlay'),urlService=application.getService('url');if(!lockConfig){lockConfig={lockActionId:application.getGlobal('locking_action_id'),unlockActionId:application.getGlobal('unlocking_action_id'),lockActionAsct:application.getGlobal('locking_action_asct'),unlockActionAsct:application.getGlobal('unlocking_action_asct')};}
function generateParams(action,options){options=options||{};if(action===LOCK_ACTION_STRING){return{node_id:options.id,node_type:'file',action_id:lockConfig.lockActionId,file_id_hash:lockConfig.lockActionAsct?options.hash+'.'+lockConfig.lockActionAsct:options.hash,'name[0]':'duration','value[0]':options.duration||0,'name[1]':'generate_update','value[1]':(!options.download_and_lock?1:0),'name[2]':'prevent_download','value[2]':options.preventDownload||0};}else{return{node_id:options.id,node_type:'file',action_id:lockConfig.unlockActionId,file_id_hash:lockConfig.unlockActionAsct?options.hash+'.'+lockConfig.unlockActionAsct:options.hash};}}
function lockingServiceRejectionHandler(error){notifications.error(error);}
function keyDownHandler(event){if(event.keyCode===27){destroyOverlay();event.stopPropagation();}}
function destroyOverlay(){if(overlayWidget){dom.off(overlayWidget.overlay.querySelector(CLASS_BTN_OK),'click',okButtonHandlerFunc);dom.off(overlayWidget.overlay.querySelector(CLASS_BTN_CANCEL),'click',destroyOverlay);dom.off(overlayWidget.overlay,'keydown',keyDownHandler);overlayWidget.destroy();overlayWidget=null;okButtonHandlerFunc=null;}}
function toggleLock(action,options){ajax.get(LOCKING_RM,generateParams(action,options)).then(function(response){var data=response.data,message=data.message;if(data.result==='success'){notifications.confirm(message);application.broadcast(action===LOCK_ACTION_STRING?'filelocked':'fileunlocked',{fileId:options.id});application.broadcast('itemupdated',{itemTypedId:'f_'+options.id});}else{if(!message){message=$t('There was an error when %1ing this file. Please try again.','toggle_lock_error_notification',action);}
lockingServiceRejectionHandler(message);}},lockingServiceRejectionHandler).caught(lockingServiceRejectionHandler);}
function requestUnlock(options){var location=application.getGlobal('location'),path=location.pathname,runmode=UNLOCKING_RM;if(options.notify){ajax.post(NOTIFICATION_RM,{q:{locks:{0:{'file_id':options.id}}}}).caught(function(){});}
if(path.indexOf('/master/')===0){runmode=UNLOCKING_GCM_RM;}
ajax.post(runmode,{q:{item_id:options.id,message:options.message,lock_id:options.lockInfo.id}}).then(function(response){var data=response.data;if(data.result==='success'){notifications.confirm(data.message);}else{lockingServiceRejectionHandler(data.message);}});}
function okButtonHandler(type,options){if(!okButtonHandlerFunc){switch(type){case'lock':okButtonHandlerFunc=function(){options.duration=overlayWidget.overlay.querySelector('select').value-0;options.preventDownload=overlayWidget.overlay.querySelector('input').checked-0;destroyOverlay();toggleLock('lock',options);};break;case'unlock':okButtonHandlerFunc=function(){destroyOverlay();toggleLock('unlock',options);};break;case'request-unlock':okButtonHandlerFunc=function(){options.message=overlayWidget.overlay.querySelector('textarea').value;options.notify=overlayWidget.overlay.querySelector('input').checked;destroyOverlay();requestUnlock(options);};break;case'lock-upgrade':okButtonHandlerFunc=function(){urlService.goToUrl('/ref/upsell_file_lock');};break;}}
return okButtonHandlerFunc;}
function showOverlay(action,options){overlayWidget.openBelow(options.target,options.xOffset,options.yOffset);overlayWidget.focusFirst(CLASS_BTN_OK);dom.on(overlayWidget.overlay.querySelector(CLASS_BTN_OK),'click',okButtonHandler(action,options));dom.on(overlayWidget.overlay.querySelector(CLASS_BTN_CANCEL),'click',destroyOverlay);dom.on(overlayWidget.overlay,'keydown',keyDownHandler);}
function showLockOverlay(options){destroyOverlay();overlayWidget=overlay.create(templates.getTemplateFragment('fileop-lock',{fileName:options.name}));showOverlay('lock',options);}
function showUnlockOverlay(action,options){destroyOverlay();overlayWidget=overlay.create(templates.getTemplateFragment('fileop-lock-'+action,{fileName:options.name,fileLockerName:options.lockInfo.lockedBy.name,fileLockerAvatar:options.lockInfo.lockedBy.pic,lockedMessage:options.lockInfo.updated}));showOverlay(action,options);}
function showLockUpgradeOverlay(options){destroyOverlay();overlayWidget=overlay.create(templates.getTemplateFragment('fileop-lock-upgrade'));showOverlay('lock-upgrade',options);}
return{upgrade:function(positioning){showLockUpgradeOverlay(positioning||{});},lock:function(id,name,hash,positioning){var options=positioning||{};options.id=id;options.name=name;options.hash=hash;showLockOverlay(options);},unlock:function(id,name,hash,lockInfo,positioning){var options=positioning||{};options.id=id;options.name=name;options.hash=hash;options.lockInfo=lockInfo;if(lockInfo.canUnlock){if(lockInfo.lockedBy.me){toggleLock('unlock',options);}else{showUnlockOverlay('unlock',options);}}else{showUnlockOverlay('request-unlock',options);}}};});Box.Application.addService('preview-logger',function(application){'use strict';var countryCode,metrics={},logged=false,globalConfig=application.getGlobalConfig(),v5=application.getService('v5'),logger=application.getService('logger'),previewNav=application.getService('preview-nav'),caching=application.getService('preview-cache'),browserService=application.getService('browser'),browserInfo={'browser_name':browserService.getName(),'browser_version':browserService.getVersion(),'browser_swf':browserService.hasMinimumFlashVersion(),'browser_svg':browserService.hasSVGSupport(),'browser_mp3':browserService.canPlayMP3(),'browser_mse':browserService.supportsMSE(),'browser_dash':browserService.supportsDash(),'browser_h264_baseline':browserService.canPlayH264Baseline(),'browser_h264_main':browserService.canPlayH264Main(),'browser_h264_high':browserService.canPlayH264High(),'browser_webgl':browserService.supportsWebGL()};var PREVIEW='preview',TRUTHY='true',FALSY='false';function getUserCountryCode(){var cc,userLocation=v5?v5.get('user_location'):(globalConfig?globalConfig.userLocation:null);if(!countryCode){cc=userLocation||navigator.language||navigator.userLanguage||navigator.browserLanguage||'';cc=cc.split('-');cc=cc[cc.length-1];countryCode=cc.toUpperCase();}
return countryCode;}
function init(fileId){logged=false;if((fileId+'').indexOf('f_')===0){fileId=fileId.substr(2);}
metrics={typedId:'f_'+fileId,file_id:fileId,requestStart:(new Date()).getTime()};}
function log(){if(!logged){var previewSource='lightbox';if(previewNav.isSharedFileEmbed()){previewSource='shared_file_embed';}else if(previewNav.isSharedFolderEmbed()){previewSource='shared_folder_embed';}else if(previewNav.isSharedFilePage()){previewSource='shared_file_page';}else if(previewNav.isSharedFolderPage()){previewSource='shared_folder_page';}else if(previewNav.isGcm()){previewSource='gcm';}
var report=$.extend({typedId:metrics.typedId||'',file_id:metrics.file_id||'',cached:metrics.cached?TRUTHY:FALSY,uniq_name:metrics.uniqueName,extension:metrics.extension||'',contentType:metrics.contentType||'',error:metrics.error||'',interrupted:metrics.interrupted?TRUTHY:FALSY,interrupt_reason:metrics.interrupt_reason?metrics.interrupt_reason:'',isConversionNeeded:metrics.isConversionNeeded?TRUTHY:FALSY,isFreshOpenPreview:metrics.prevNextNavCount===0?TRUTHY:FALSY,navigation_count:metrics.prevNextNavCount,preview_count:metrics.previewCount,country_code:getUserCountryCode(),previewSource:previewSource},browserInfo);if(metrics.interrupted){report.interruption_time=(new Date()).getTime()-metrics.requestStart;}else{if(typeof metrics.rendered==='number'&&typeof metrics.requestStart==='number'){report.total_load_time=metrics.rendered-metrics.requestStart;}}
metrics={};logger.sendLog(PREVIEW,PREVIEW,report);logged=true;}}
function action(file,actionName){if(file){logger.sendLog(PREVIEW,'user_action',{typedId:'f_'+file.id,file_id:file.id,uniq_name:file.uniq_name||file.uniqueName,extension:file.extension,action:actionName,wasPreviewLoaded:logged?TRUTHY:FALSY});}}
function error(file,errorMessage){if(file){logger.sendLog(PREVIEW,'error',{typedId:'f_'+file.id,file_id:file.id,uniq_name:file.uniq_name||file.uniqueName,extension:file.extension,error:errorMessage,wasPreviewLoaded:logged?TRUTHY:FALSY});}}
function interrupt(reason){if(!logged){metrics.contentType='unknown';metrics.interrupt_reason=reason;metrics.interrupted=true;metrics.cached=caching.has(metrics.typedId);log();}}
function fail(response,retryCounter){var curTime=(new Date()).getTime();switch(response.status){case'none':metrics.error='File type not supported';metrics.rendered=curTime;log();break;case'error':metrics.error='Error, likely a permission issue.';metrics.rendered=curTime;log();break;}}
function add(key,value){metrics[key]=value;}
function fetch(key){return metrics[key];}
function hasLogged(){return logged;}
return{log:log,fail:fail,interrupt:interrupt,action:action,error:error,init:init,add:add,fetch:fetch,hasLogged:hasLogged};});Box.Application.addService('preview-nav',function(application){'use strict';function getPath(){var location=application.getGlobal('location');return location.pathname;}
return{getSharedName:function(){var sharedNameFromConfig=application.getGlobalConfig('sharedName'),sharedNameFromGlobal=application.getGlobal('shared_name');return sharedNameFromConfig||sharedNameFromGlobal||null;},getVanityName:function(){var vanityNameFromConfig=application.getGlobalConfig('vanityName'),vanityNameFromGlobal=application.getGlobal('vanity_name');return vanityNameFromConfig||vanityNameFromGlobal||null;},isShared:function(){return typeof this.getSharedName()==='string';},isSinglePage:function(){return!!application.getGlobalConfig('singlePage');},isSharedFolderSinglePage:function(){return!!application.getGlobalConfig('isSharedFolderPreview');},isEmbed:function(){var embedFromConfig=!!application.getGlobalConfig('embed'),embedFromGlobal=!!application.getGlobal('embed');return embedFromConfig||embedFromGlobal;},isSharedFilePage:function(){return this.isShared()&&this.isSinglePage()&&!this.isEmbed()&&!this.isSharedFolderSinglePage();},isSharedFolderPage:function(){return this.isShared()&&!this.isEmbed()&&(!this.isSinglePage()||this.isSharedFolderSinglePage());},isSharedFileEmbed:function(){return this.isShared()&&this.isSinglePage()&&this.isEmbed();},isSharedFolderEmbed:function(){return this.isShared()&&!this.isSinglePage()&&this.isEmbed();},isSharedFilePageOrSharedFileEmbed:function(){return this.isSharedFilePage()||this.isSharedFileEmbed();},isGcm:function(){return getPath().indexOf('/master/')===0;}};});Box.Application.addService('preview-realtime',function(application){'use strict';var $xhr,retryCount=0,RETRY_COUNT_LIMIT=2;function shouldContinuePollingRealtime(content){return content.status==='pending'||content.kind==='pdf'||content.kind==='filmstrip';}
function retryRealtime(fileId,subscriptionUrl){if(retryCount<RETRY_COUNT_LIMIT){retryCount++;fetchRealtimeUpdate(fileId,subscriptionUrl);}}
function fetchRealtimeUpdate(fileId,subscriptionUrl){$xhr=$.getJSON(subscriptionUrl);$xhr.then(function(response){var message;try{message=JSON.parse(response.message);}catch(ex){}
if(message&&message.content&&message.action==='representation'&&fileId===(message.content.file_id+'')){retryCount=0;application.broadcast('previewprogress',message.content);if(shouldContinuePollingRealtime(message.content)){fetchRealtimeUpdate(fileId,subscriptionUrl);}}else{retryRealtime(fileId,subscriptionUrl);}});}
return{poll:function(fileId,subscriptionUrl){if(fileId&&subscriptionUrl){retryCount=0;this.abort();fetchRealtimeUpdate(fileId,subscriptionUrl);}},abort:function(){if($xhr&&typeof $xhr.abort==='function'){$xhr.abort();}
$xhr=null;}};});Box.Application.addService('preview-api',function(application){'use strict';var browserService=application.getService('browser'),navState=application.getService('nav-state'),ajax=application.getService('ajax'),previewNav=application.getService('preview-nav'),cache=application.getService('preview-cache'),clientIsMobile=browserService.getOSName()==='iOS'||browserService.getOSName()==='Android',clientSupportsSWF=browserService.hasMinimumFlashVersion(),clientSupportsSVG=browserService.hasSVGSupport(),clientSupportsMP3=browserService.canPlayMP3(),clientSupportsH264Baseline=browserService.canPlayH264Baseline(),clientSupportsMSE=browserService.supportsMSE(),clientSupportsDash=browserService.supportsDash(),clientSupportsWebGL=browserService.supportsWebGL(),POST_TASK_COMPLETION_RM='box_tasks_complete_task_assignment',POST_TASK_REJECT_RM='box_tasks_delete_task_assignment',POST_TASK_DELETE_RM='box_tasks_delete_task',POST_TASK_EDIT_RM='box_tasks_edit_task',POST_TASK_CREATE_RM='box_tasks_create_task',POST_COMMENT_CREATE_RM='box_comments_create',POST_COMMENT_DELETE_RM='box_comments_delete',POST_INFO_UPDATE_RM='box_files_update_item_info',PREVIEW_RM='preview{pointOfView}',PREVIEW_PRINT_RM='preview_print_url{pointOfView}',PREVIEW_ACTIVITY_FEED_RM='preview_activity_feed{pointOfView}',PREVIEW_METADATA_RM='preview_metadata{pointOfView}',CROCODOC_STATUS_RM='crocodoc_status{pointOfView}',pendingRequests={};function getRunmodeWithContext(runmode){var pointOfView='';if(previewNav.isGcm()){pointOfView='_gcm';}else if(previewNav.isSharedFileEmbed()){pointOfView='_embed';}else if(previewNav.isSharedFilePage()||previewNav.isSharedFolderPage()||previewNav.isSharedFolderEmbed()){pointOfView='_shared';}
return runmode.replace('{pointOfView}',pointOfView);}
function deletePendingPromises(key){return function(){delete pendingRequests[key];};}
function cancelPromise(promise){if(promise&&promise.isPending()){promise.cancel();}}
function appendCommonParams(fileId,params){params=params||{};params.sharedName=previewNav.getSharedName();params.vanityName=previewNav.getVanityName();params.isSharedFilePage=previewNav.isSharedFilePage();params.isSharedFileEmbed=previewNav.isSharedFileEmbed();params.isSharedFolderPage=previewNav.isSharedFolderPage();params.isSharedFolderEmbed=previewNav.isSharedFolderEmbed();params.clientIsMobile=clientIsMobile;params.clientSupportsSWF=clientSupportsSWF;params.clientSupportsSVG=clientSupportsSVG;params.clientSupportsMP3=clientSupportsMP3;params.clientSupportsH264Baseline=clientSupportsH264Baseline;params.clientSupportsMSE=clientSupportsMSE;params.clientSupportsDash=clientSupportsDash;params.clientSupportsWebGL=clientSupportsWebGL;var state=navState.get();if(state){params.sortType=state.sort;params.sortDirection=state.sortDirection;}
if(fileId.indexOf('file_version_')===0){params.fileVersionId=fileId.substr(13);}else{params.fileId=fileId;}
return params;}
function makeGetRequest(fileId,runmode,params){fileId+='';runmode=getRunmodeWithContext(runmode);params=appendCommonParams(fileId,params);var key=params.isPrefetch?'prefetch_'+fileId:runmode,promise;cancelPromise(pendingRequests['prefetch_'+fileId]);cancelPromise(pendingRequests[key]);promise=ajax.get(runmode,params);promise.caught(deletePendingPromises(key)).lastly(deletePendingPromises(key));pendingRequests[key]=promise;return promise;}
return{getPrintUrl:function(){var currentFile=cache.recall('currentFile');return makeGetRequest(currentFile.id,PREVIEW_PRINT_RM,{fileVersionId:currentFile.versionId});},getCrocodocStatus:function(){var currentFile=cache.recall('currentFile');return makeGetRequest(currentFile.id,CROCODOC_STATUS_RM,{fileVersionId:currentFile.versionId});},getPreview:function(fileId,params){return makeGetRequest(fileId,PREVIEW_RM,params);},updatePreview:function(params){var currentFile=cache.recall('currentFile');params.fileVersionId=currentFile.versionId;return makeGetRequest(currentFile.id,PREVIEW_RM,params);},prefetchPreview:function(fileId){return makeGetRequest(fileId,PREVIEW_RM,{isPrefetch:true,ignoreFolderContents:true,referrerUrl:cache.recall('currentFile').referrerUrl});},getSidebarActivityFeed:function(fileId){return makeGetRequest(fileId,PREVIEW_ACTIVITY_FEED_RM);},getSidebarMetadata:function(fileId){return makeGetRequest(fileId,PREVIEW_METADATA_RM);},task:{remove:function(taskId){var params={task_id:taskId,is_from_sidebar:true};return ajax.post(POST_TASK_DELETE_RM,params);},reject:function(itemTypedId,taskAssignmentId){var params={item_typed_id:itemTypedId,task_assignment_id:taskAssignmentId,is_from_sidebar:true};return ajax.post(POST_TASK_REJECT_RM,params);},complete:function(taskAssignmentId){var params={complete:'complete',task_assignment_id:taskAssignmentId,is_from_sidebar:true};return ajax.post(POST_TASK_COMPLETION_RM,params);},edit:function(taskId,itemTypedId,atMentionedResult,emails,submitDueDate){var params={task_id:taskId||null,item_typed_id:itemTypedId,is_from_sidebar:1,description:atMentionedResult.message,message_mentioned:atMentionedResult.messageMentioned,assignment_emails:emails,due:submitDueDate||0,action:'review'};return ajax.post(POST_TASK_EDIT_RM,params);},create:function(itemTypedId,atMentionedResult,emails,submitDueDate){var params={task_id:null,item_typed_id:itemTypedId,is_from_sidebar:1,description:atMentionedResult.message,message_mentioned:atMentionedResult.messageMentioned,assignment_emails:emails,action:'review'};if(submitDueDate){params.due=submitDueDate;}
return ajax.post(POST_TASK_CREATE_RM,params);},comment:function(taskAssignmentId,atMentionedResult){var params={task_assignment_id:taskAssignmentId,feedback:atMentionedResult.message,message_mentioned:atMentionedResult.messageMentioned,is_from_sidebar:true};return ajax.post(POST_TASK_COMPLETION_RM,params);}},comment:{create:function(itemTypedId,atMentionedResult,parentCommentId){var params={commentable_item_typed_id:itemTypedId,message:atMentionedResult.message,message_mentioned:atMentionedResult.messageMentioned,get_updated_list:true,show_all:false,exclude_tasks:false,is_from_sidebar:true};if(parentCommentId){params.parent_comment_id=parentCommentId;}
return ajax.post(POST_COMMENT_CREATE_RM,params);},reply:function(itemTypedId,parentCommentId,atMentionedResult){var params={commentable_item_typed_id:itemTypedId,parent_comment_id:parentCommentId,message:atMentionedResult.message,message_mentioned:atMentionedResult.messageMentioned,get_updated_list:true,show_all:false,exclude_tasks:false,is_from_sidebar:true};return ajax.post(POST_COMMENT_CREATE_RM,params);},remove:function(itemTypedId,commentId){var params={comment_id:commentId,commentable_item_typed_id:itemTypedId,is_from_sidebar:true};return ajax.post(POST_COMMENT_DELETE_RM,params);}},properties:{update:function(fileId,field,value){var params={item_id:fileId,item_type:'file',field:field,value:value};return ajax.post(POST_INFO_UPDATE_RM,params);}}};});Box.Application.addService('preview-crocodoc-wrapper',function(application){'use strict';var Crocodoc=application.getGlobal('Crocodoc'),scope={};Crocodoc.addPlugin('viewer-scope',function(internalScope){scope=internalScope;});return{create:function(node,options){var viewer;options.plugins={'viewer-scope':{}};viewer=Crocodoc.createViewer(node,options);viewer.broadcast=scope.broadcast;return viewer;}};});Box.Application.addService('preview-progress',function(application){'use strict';var dom=application.getService('dom'),templates=application.getService('templates'),realtime=application.getService('preview-realtime');var PREVIEW_PROGRESS_EXPIRE_TIMEOUT_MILLIS=5000,CONVERSION_TARGET_TIME_SECS=20,STATUS_MESSAGE_INITIAL='',STATUS_MESSAGE_PROGRESS=$t('Generating Preview...','preview_progress_converting'),PROGRESS_SERVICE_SELECTOR='.preview-progress',LOADING_CONTAINER_SELECTOR='.loading-container',HIDDEN_CLASS='hidden',LOADING_INDICATOR_VISIBILITY_CLASS='is-loading',LOADING_TEXT_SELECTOR='.loading-text',PROGRESS_DOWNLOAD_SELECTOR='.progress-download',PREVIEW_PROGRESS_BAR_CONTAINER_SELECTOR='.preview-progress-bar-container';function resetExpirationTimeout(progress,data){clearTimeout(progress.expireTimeoutId);progress.expireTimeoutId=setTimeout(function(){application.broadcast('previewcontentreload',data);},PREVIEW_PROGRESS_EXPIRE_TIMEOUT_MILLIS);}
function startProgressBar(progress){var previewProgressEl=dom.query(PROGRESS_SERVICE_SELECTOR,progress.containerEl),loadingIndicatorEl=dom.query(LOADING_CONTAINER_SELECTOR,previewProgressEl),loadingTextEl=dom.query(LOADING_TEXT_SELECTOR,previewProgressEl),progressBarEl=dom.query(PREVIEW_PROGRESS_BAR_CONTAINER_SELECTOR,previewProgressEl),progressIndicatorEl=dom.query('.preview-progress-bar',progressBarEl),targetDuration=CONVERSION_TARGET_TIME_SECS;progress.time=0;dom.removeClass(loadingIndicatorEl,LOADING_INDICATOR_VISIBILITY_CLASS);dom.removeClass(progressBarEl,HIDDEN_CLASS);dom.setText(loadingTextEl,STATUS_MESSAGE_PROGRESS);progress.progressBarIntervalId=setInterval(function(){progress.time+=((100-progress.time)/targetDuration);targetDuration++;progressIndicatorEl.style.width=Math.min(progress.time,100)+'%';},200);}
function Progress(containerEl){var fragment=templates.getTemplateFragment('preview-progress',{initialLoadingText:STATUS_MESSAGE_INITIAL});this.containerEl=containerEl;this.time=0;this.started=false;this.progressBarIntervalId=null;this.expireTimeoutId=null;dom.setHTML(this.containerEl,fragment);}
Progress.prototype={start:function(currentFile,data){if(this.started){resetExpirationTimeout(this,data);}else{this.started=true;startProgressBar(this);if(currentFile.realtimeUrl){realtime.poll(currentFile.id,currentFile.realtimeUrl);}else{resetExpirationTimeout(this,data);}
if(currentFile.permissions.download){dom.removeClass(dom.query(PROGRESS_DOWNLOAD_SELECTOR,this.containerEl),HIDDEN_CLASS);}}},end:function(){var previewProgressEl=dom.query(PROGRESS_SERVICE_SELECTOR,this.containerEl),loadingIndicatorEl=dom.query(LOADING_CONTAINER_SELECTOR,previewProgressEl),downloadLinkEl=dom.query(PROGRESS_DOWNLOAD_SELECTOR,previewProgressEl),progressBarEl=dom.query(PREVIEW_PROGRESS_BAR_CONTAINER_SELECTOR,previewProgressEl),loadingTextEl=dom.query(LOADING_TEXT_SELECTOR,previewProgressEl);clearTimeout(this.expireTimeoutId);clearInterval(this.progressBarIntervalId);dom.addClass(downloadLinkEl,HIDDEN_CLASS);dom.addClass(loadingIndicatorEl,LOADING_INDICATOR_VISIBILITY_CLASS);dom.addClass(progressBarEl,HIDDEN_CLASS);dom.setText(loadingTextEl,'');},destroy:function(){clearInterval(this.progressBarIntervalId);clearTimeout(this.expireTimeoutId);if(this.containerEl){dom.remove(dom.query(PROGRESS_SERVICE_SELECTOR,this.containerEl));}
this.started=false;delete this.containerEl;}};return{create:function(containerEl){return new Progress(containerEl);}};});Box.Application.addService('scrubber',function(application){'use strict';var MIN_VALUE=0,MAX_VALUE=1;var dom=application.getService('dom'),templates=application.getService('templates'),document=application.getGlobal('document');function mousePositionWithinScrubberRange(rect,pageX){return pageX>=rect.left&&pageX<=rect.right;}
function setScrubberValue(ctx,value){ctx.value=Math.max(Math.min(value,ctx.convertedValue),MIN_VALUE);var handleWidth=dom.getBoundingClientRect(ctx.handleEl).width||16,scrubberWidth=dom.getBoundingClientRect(ctx.scrubberEl).width,handlePosition=ctx.value*(scrubberWidth-handleWidth)*100/scrubberWidth;ctx.handleEl.style.left=handlePosition+'%';ctx.playedEl.style.width=ctx.value*100+'%';}
function setScrubberBufferedValue(ctx,value){ctx.bufferedValue=Math.max(Math.min(Math.max(value,ctx.bufferedValue),ctx.convertedValue),MIN_VALUE);ctx.bufferedEl.style.width=ctx.bufferedValue*100+'%';}
function setScrubberConvertedValue(ctx,value){ctx.convertedValue=Math.max(Math.min(Math.max(value,ctx.convertedValue),MAX_VALUE),MIN_VALUE);ctx.convertedEl.style.width=ctx.convertedValue*100+'%';}
function scrubbingHandler(ctx){return function(event){var rect=dom.getBoundingClientRect(ctx.scrubberEl),pageX=event.pageX;if(ctx.mouseDownOnScrubber&&mousePositionWithinScrubberRange(rect,pageX)){setScrubberValue(ctx,(pageX-rect.left)/rect.width);ctx.fire('slide');}};}
function mouseDownHandler(ctx){return function(event){if((typeof event.button!=='number'||event.button<2)&&!event.ctrlKey&&!event.metaKey){ctx.mouseDownOnScrubber=true;ctx.updateScrubberHandleRef(event);dom.on(document,'mouseup',ctx.mouseUpHandlerRef);dom.on(document,'mouseleave',ctx.mouseUpHandlerRef);dom.on(document,'mousemove',ctx.updateScrubberHandleRef);event.preventDefault();}};}
function mouseUpHandler(ctx){return function(){ctx.mouseDownOnScrubber=false;dom.off(document,'mouseup',ctx.mouseUpHandlerRef);dom.off(document,'mouseleave',ctx.mouseUpHandlerRef);dom.off(document,'mousemove',ctx.updateScrubberHandleRef);};}
function Scrubber(containerEl,value,bufferedValue,convertedValue,accessibilityText){var fragment=templates.getTemplateFragment('preview-scrubber',{accessibilityText:accessibilityText});dom.setHTML(containerEl,fragment);this.value=value||MIN_VALUE;this.convertedValue=typeof convertedValue==='number'?convertedValue:MAX_VALUE;this.bufferedValue=typeof bufferedValue==='number'?bufferedValue:convertedValue;this.scrubberEl=containerEl;this.mouseDownOnScrubber=false;this.bufferedEl=dom.query('.preview-scrubber-buffered',this.scrubberEl);this.convertedEl=dom.query('.preview-scrubber-converted',this.scrubberEl);this.playedEl=dom.query('.preview-scrubber-played',this.scrubberEl);this.handleEl=dom.query('.preview-scrubber-handle',this.scrubberEl);this.updateScrubberHandleRef=scrubbingHandler(this);this.mouseDownHandlerRef=mouseDownHandler(this);this.mouseUpHandlerRef=mouseUpHandler(this);setScrubberConvertedValue(this,this.convertedValue);setScrubberBufferedValue(this,this.bufferedValue);setScrubberValue(this,this.value);dom.on(this.convertedEl,'mousedown',this.mouseDownHandlerRef);dom.on(this.handleEl,'mousedown',this.mouseDownHandlerRef);$.extend(this,new Box.EventTarget());}
Scrubber.prototype={destroy:function(){dom.off(document,'mousemove',this.updateScrubberHandleRef);dom.off(document,'mouseup',this.mouseUpHandlerRef);dom.off(document,'mouseleave',this.mouseUpHandlerRef);dom.off(this.convertedEl,'mousedown',this.mouseDownHandlerRef);dom.off(this.handleEl,'mousedown',this.mouseDownHandlerRef);dom.setHTML(this.scrubberEl,'');this.convertedEl=undefined;this.bufferedEl=undefined;this.playedEl=undefined;this.handleEl=undefined;this.scrubberEl=undefined;},getValue:function(){return this.value;},setValue:function(value){setScrubberValue(this,value);this.fire('set');},setBufferedValue:function(value){setScrubberBufferedValue(this,value);},setConvertedValue:function(value){setScrubberConvertedValue(this,value);},getScrubberHandleEl:function(){return this.handleEl;},getConvertedBarEl:function(){return this.convertedEl;}};return{create:function(containerEl,value,bufferedValue,convertedValue,accessibilityText){return new Scrubber(containerEl,value,bufferedValue,convertedValue,accessibilityText);},destroy:function(scrubber){if(scrubber){scrubber.destroy();scrubber=undefined;}}};});Box.Application.addBehavior('popup-default-close',function(context){'use strict';var popupsService;return{init:function(){popupsService=context.getService('popups-amsterdam');},onclick:function(event,element,elementType){if(elementType!=='close-popup'){return;}
this.closePopup();event.preventDefault();event.stopPropagation();},closePopup:function(){popupsService.close({unsafeSkipRefresh:true});}};});Box.Application.addBehavior('share-access-menu-amsterdam',function(context){'use strict';var CHANGE_ACCESS_LEVEL_RUNMODE='sham_share_change_access_level',REMOVE_SHARED_LINK_RUNMODE='sham_share_remove_link';var ACCESS_OPEN='0',ACCESS_COMPANY='1',ACCESS_RESTRICTED='2',ACCESS_REMOVED='remove';var ajaxService,domService,popupsService,urlService,itemTypedId,displayContext;function changeAccessLevel(newAccessLevel){var url=urlService.getGcmCompatibleRm(CHANGE_ACCESS_LEVEL_RUNMODE);var queryParams={itemTypedId:itemTypedId,accessLevel:newAccessLevel};context.broadcast('sharedlinkchangeinitiated',{itemTypedId:itemTypedId,context:displayContext});ajaxService.post(url,queryParams).then(function changeAccessLevelSuccess(){context.broadcast('sharedlinkchanged',{newAccessLevel:newAccessLevel,itemTypedId:itemTypedId,context:displayContext});},function changeAccessLevelError(){context.broadcast('sharedlinkchangeerror',{itemTypedId:itemTypedId,context:displayContext});});}
function removeSharedLink(){var url=urlService.getGcmCompatibleRm(REMOVE_SHARED_LINK_RUNMODE);var queryParams={itemTypedId:itemTypedId};context.broadcast('sharedlinkchangeinitiated',{itemTypedId:itemTypedId,context:displayContext});ajaxService.post(url,queryParams).then(function removeSharedLinkSuccess(){context.broadcast('sharedlinkremoved',{itemTypedId:itemTypedId,context:displayContext});},function removeSharedLinkError(){context.broadcast('sharedlinkchangeerror',{itemTypedId:itemTypedId,context:displayContext});});}
return{init:function(){ajaxService=context.getService('ajax');domService=context.getService('dom');popupsService=context.getService('popups-amsterdam');urlService=context.getService('url');var moduleEl=context.getElement();itemTypedId=moduleEl.getAttribute('data-item-typed-id');if(context.getConfig()){displayContext=context.getConfig().context;}},onclick:function(event,element,elementType){var accessLevel;switch(elementType){case'share-access-menu-option':if(!domService.hasClass(element,'is-selected')){accessLevel=element.getAttribute('data-access-id');switch(accessLevel){case ACCESS_OPEN:case ACCESS_COMPANY:case ACCESS_RESTRICTED:this.changeAccessLevel(accessLevel);break;case ACCESS_REMOVED:this.showRemoveSharedLinkPopup();break;default:break;}}
break;default:return;}
event.preventDefault();event.stopPropagation();},changeAccessLevel:changeAccessLevel,showRemoveSharedLinkPopup:function(){popupsService.confirm($t('This will permanently remove the shared link. If this item is embedded on other sites it will also become inaccessible. Any custom properties, settings and expirations will be removed as well. Do you want to continue?','share_access_menu_remove_link_message'),$t('Remove Share Link','share_access_menu_remove_popup_title')).then(removeSharedLink);}};});Box.Application.addBehavior('sham-share-access-menu',function(context){'use strict';var CHANGE_ACCESS_LEVEL_RUNMODE='sham_share_change_access_level',REMOVE_SHARED_LINK_RUNMODE='sham_share_remove_link';var ACCESS_OPEN='0',ACCESS_COMPANY='1',ACCESS_RESTRICTED='2',ACCESS_REMOVED='remove';var ajaxService,domService,popupsService,urlService,itemTypedId,displayContext;function changeAccessLevel(newAccessLevel){var url=urlService.getGcmCompatibleRm(CHANGE_ACCESS_LEVEL_RUNMODE);var queryParams={itemTypedId:itemTypedId,accessLevel:newAccessLevel};context.broadcast('sharedlinkchangeinitiated',{itemTypedId:itemTypedId,context:displayContext});ajaxService.post(url,queryParams).then(function changeAccessLevelSuccess(){context.broadcast('sharedlinkchanged',{newAccessLevel:newAccessLevel,itemTypedId:itemTypedId,context:displayContext});},function changeAccessLevelError(){context.broadcast('sharedlinkchangeerror',{itemTypedId:itemTypedId,context:displayContext});});}
function removeSharedLink(){var url=urlService.getGcmCompatibleRm(REMOVE_SHARED_LINK_RUNMODE);var queryParams={itemTypedId:itemTypedId};context.broadcast('sharedlinkchangeinitiated',{itemTypedId:itemTypedId,context:displayContext});ajaxService.post(url,queryParams).then(function removeSharedLinkSuccess(){context.broadcast('sharedlinkremoved',{itemTypedId:itemTypedId,context:displayContext});},function removeSharedLinkError(){context.broadcast('sharedlinkchangeerror',{itemTypedId:itemTypedId,context:displayContext});});}
return{init:function(){ajaxService=context.getService('ajax');domService=context.getService('dom');popupsService=context.getService('popups-amsterdam');urlService=context.getService('url');var moduleEl=context.getElement();itemTypedId=moduleEl.getAttribute('data-item-typed-id');if(context.getConfig()){displayContext=context.getConfig().context;}},onclick:function(event,element,elementType){var accessLevel;switch(elementType){case'share-access-menu-option':if(!domService.hasClass(element,'is-selected')){accessLevel=element.getAttribute('data-access-id');switch(accessLevel){case ACCESS_OPEN:case ACCESS_COMPANY:case ACCESS_RESTRICTED:this.changeAccessLevel(accessLevel);break;case ACCESS_REMOVED:this.showRemoveSharedLinkPopup();break;default:break;}}
break;default:return;}
event.preventDefault();event.stopPropagation();},changeAccessLevel:changeAccessLevel,showRemoveSharedLinkPopup:function(){popupsService.confirm($t('This will permanently remove the shared link. If this item is embedded on other sites it will also become inaccessible. Any custom properties, settings and expirations will be removed as well. Do you want to continue?','share_access_menu_remove_link_message'),$t('Remove Share Link','share_access_menu_remove_popup_title')).then(removeSharedLink);}};});Box.Application.addBehavior('preview-edit',function(context){'use strict';var DISABLED_BUTTON_TIMEOUT=2000;var currentFile,debouncedEdit,cachingService;function editFile(){var popupsService=context.getService('popups');var boxEditService=context.getService('box-edit');var openBoxService=context.getService('openbox-service-actions');var notificationService=context.getService('notifications');var functionUtilsService=context.getService('function-utils');if(!currentFile.permissions.edit){notificationService.error($t('Either this file is not editable or you do not have permission to edit this file.','preview_edit_no_permission_error'));return;}
if(!debouncedEdit){debouncedEdit=functionUtilsService.debounce(function(){var i,action,canEdit,editAction=null,openBoxActions=openBoxService.getActions(null,{type:'openbox',itemTypedId:currentFile.typedId}),len=openBoxActions.length;for(i=0;i<len;i++){action=openBoxActions[i].action;canEdit=$.inArray(currentFile.extension,action.extensions_editable_on_gallery)>-1;if(!editAction&&canEdit){editAction=openBoxActions[i];}}
if(editAction){editAction.execute();}else if(boxEditService.isBoxEditDisabledByAdmin()){notificationService.error($t('Box Edit is removed or not available.','preview_edit_not_available_error'));}else if(boxEditService.isBoxEditInstalled()){if(boxEditService.canUserOpenFileOnDesktop(currentFile)){boxEditService.executeBoxEdit(currentFile.id,currentFile.typedId);}else{notificationService.error($t('Box Edit does not support this file type.','preview_edit_unsupported_filetype_error'));}}else{popupsService.open('box_edit_download',{data:{action:'edit','typed_id':currentFile.typedId,extension:currentFile.extension}});}},DISABLED_BUTTON_TIMEOUT,true);}
debouncedEdit();}
return{messages:['previewedit'],onmessage:function(name){if(name==='previewedit'){editFile();}},init:function(){cachingService=context.getService('preview-cache');currentFile=cachingService.recall('currentFile');},onclick:function(event,element,elementType){if(element&&!element.disabled&&elementType==='preview-edit'){editFile();event.preventDefault();event.stopPropagation();}}};});Box.Application.addBehavior('preview-lock',function(context){'use strict';var LOCK_POPUP_XOFFSET=-250,LOCK_POPUP_YOFFSET=5;var dom,currentFile,cachingService,lockingService;function toggleLock(upgrade){var anchorElement=dom.query('.btn-preview-header-overflow')||dom.query('[data-module="preview"]');if(upgrade){lockingService.upgrade({target:anchorElement,yOffset:LOCK_POPUP_YOFFSET,xOffset:LOCK_POPUP_XOFFSET});}else if(currentFile.locked){lockingService.unlock(currentFile.id,currentFile.fullName,currentFile.hash,currentFile.locked,{target:anchorElement,yOffset:LOCK_POPUP_YOFFSET,xOffset:LOCK_POPUP_XOFFSET});}else{lockingService.lock(currentFile.id,currentFile.fullName,currentFile.hash,{target:anchorElement,yOffset:LOCK_POPUP_YOFFSET,xOffset:LOCK_POPUP_XOFFSET});}}
return{init:function(){dom=context.getService('dom');cachingService=context.getService('preview-cache');lockingService=context.getService('fileop-lock-preview');currentFile=cachingService.recall('currentFile');},onclick:function(event,element,elementType){if(!element||!elementType||element.disabled){return;}
switch(elementType){case'preview-lock':toggleLock(false);break;case'preview-lock-upgrade':toggleLock(true);break;default:return;}
event.preventDefault();event.stopPropagation();}};});Box.Application.addBehavior('preview-print',function(context){'use strict';var MAX_RETRY=40;var caching,notificationService,previewApi,retryCount=0,useFreshDownloadUrl,downloadUrlTimeoutId;function print(){var currentFile=caching.recall('currentFile');if(currentFile){if(currentFile.permissions.print){if(useFreshDownloadUrl||!currentFile.printUrl){previewApi.getPrintUrl().then(openWindowOrRetry);}else{openWindowOrRetry({data:{url:currentFile.printUrl}});}}else{notificationService.error($t('Either this file is not printable or you do not have permission to print this file.','preview_print_no_permission_error'));}}}
function openWindowOrRetry(response){if(response.data&&response.data.url){context.getGlobal('window').open(response.data.url);retryCount=0;}else if(response.status===202&&retryCount<MAX_RETRY){retryCount++;setTimeout(print,3000);}}
return{messages:['previewprint'],onmessage:function(name){if(name==='previewprint'){print();}},init:function(){notificationService=context.getService('notifications');caching=context.getService('preview-cache');previewApi=context.getService('preview-api');useFreshDownloadUrl=false;downloadUrlTimeoutId=setTimeout(function(){useFreshDownloadUrl=true;},840000);},destroy:function(){clearTimeout(downloadUrlTimeoutId);},onclick:function(event,element,elementType){if(element&&!element.disabled&&elementType==='preview-print'){print();event.preventDefault();event.stopPropagation();}}};});Box.Application.addBehavior('preview-share',function(context){'use strict';var urlService,currentFile,cachingService,notificationService;function shareFile(){if(currentFile.permissions.share){var itemActionsService=context.getService('item-actions');itemActionsService.share(currentFile.typedId);context.broadcast('sharedlinkcreated',{itemTypedId:currentFile.typedId,context:'preview'});}else{notificationService.error($t('You do not have permission to share this file.','preview_share_no_permission_error'));}}
return{messages:['previewshare'],onmessage:function(name){if(name==='previewshare'){shareFile();}},init:function(){urlService=context.getService('url');cachingService=context.getService('preview-cache');notificationService=context.getService('notifications');currentFile=cachingService.recall('currentFile');},onclick:function(event,element,elementType){if(element&&!element.disabled&&elementType==='preview-share'){shareFile();event.preventDefault();event.stopPropagation();}}};});Box.Application.addBehavior('preview-controls',function(context){'use strict';var dom,funcUtils,throttledMouseMoveHandler,moduleNode,controlsNode,inputNode,blockHiding,controlDisplayTimeoutId;var SHOW_PREVIEW_CONTROLS_CLASS='show-preview-controls',PREVIEW_CONTROLS_SELECTOR='.preview-controls',CONTROLS_AUTO_HIDE_TIMEOUT_IN_MILLIS=1500;function resetTimeout(){clearTimeout(controlDisplayTimeoutId);controlDisplayTimeoutId=setTimeout(function(){clearTimeout(controlDisplayTimeoutId);if(blockHiding){resetTimeout();}else{dom.removeClass(moduleNode,SHOW_PREVIEW_CONTROLS_CLASS);if(dom.getNearest(document.activeElement,PREVIEW_CONTROLS_SELECTOR)){document.activeElement.blur();}}},CONTROLS_AUTO_HIDE_TIMEOUT_IN_MILLIS);}
function isPreviewControlButton(element){return dom.hasClass(element,'preview-controls-btn')||dom.hasClass(element,'preview-controls-document-page-selector');}
function mouseMoveHandler(){if(!throttledMouseMoveHandler){throttledMouseMoveHandler=funcUtils.throttle(function(){dom.addClass(moduleNode,SHOW_PREVIEW_CONTROLS_CLASS);resetTimeout();},CONTROLS_AUTO_HIDE_TIMEOUT_IN_MILLIS-500,true);}
return throttledMouseMoveHandler;}
function mouseEnterHandler(){blockHiding=true;}
function mouseLeaveHandler(){blockHiding=false;}
return{init:function(){dom=context.getService('dom');funcUtils=context.getService('function-utils');moduleNode=context.getElement();controlsNode=dom.query(PREVIEW_CONTROLS_SELECTOR,moduleNode);inputNode=dom.query('input',controlsNode);dom.on(moduleNode,'mousemove',mouseMoveHandler());if(controlsNode){dom.on(controlsNode,'mouseenter',mouseEnterHandler);dom.on(controlsNode,'mouseleave',mouseLeaveHandler);}
if(inputNode){dom.on(inputNode,'focus',mouseEnterHandler);}},destroy:function(){dom.off(moduleNode,'mousemove',mouseMoveHandler());if(controlsNode){dom.off(controlsNode,'mouseenter',mouseEnterHandler);dom.off(controlsNode,'mouseleave',mouseLeaveHandler);}
if(inputNode){dom.off(inputNode,'focus',mouseEnterHandler);}
context.getService('tooltips-amsterdam').hideAll();clearTimeout(controlDisplayTimeoutId);},onfocusin:function(event,element){if(isPreviewControlButton(element)){dom.addClass(moduleNode,SHOW_PREVIEW_CONTROLS_CLASS);}},onfocusout:function(event,element){if(isPreviewControlButton(element)&&!isPreviewControlButton(event.relatedTarget)){dom.removeClass(moduleNode,SHOW_PREVIEW_CONTROLS_CLASS);}}};});Box.Application.addBehavior('preview-download',function(context){'use strict';var caching,notificationService,previewNavService,downloadService;function downloadSharedFile(fileId,sharedName){sharedName=sharedName||previewNavService.getSharedName();downloadService.downloadViaGet('/index.php?rm=box_download_shared_file&shared_name='+sharedName+'&file_id=f_'+fileId);}
function downloadFile(fileId,fileVersionId){var postParams={'file_id':'f_'+fileId};if(fileVersionId){postParams.file_version_id=fileVersionId;}
if(previewNavService.isGcm()){downloadService.downloadViaPost('/index.php?rm=box_master_gcm_box_download_file_via_post',postParams);}else{downloadService.downloadViaPost('/index.php?rm=box_download_file_via_post',postParams);}}
function download(){var currentFile=caching.recall('currentFile');if(currentFile){if(currentFile.permissions.download){if(previewNavService.isShared()){downloadSharedFile(currentFile.id,currentFile.sharedName);}else if(context.getGlobalConfig('isAmsterdam')){context.getService('fileop-download').downloadFile(currentFile.typedId);}else{downloadFile(currentFile.id,currentFile.versionId);}}else{notificationService.error($t('Either this file is not downloadable or you do not have permission to download this file.','preview_download_no_permission_error'));}}}
return{messages:['previewdownload'],onmessage:function(name){if(name==='previewdownload'){download();}},init:function(){notificationService=context.getService('notifications');downloadService=context.getService('download');caching=context.getService('preview-cache');previewNavService=context.getService('preview-nav');},onclick:function(event,element,elementType){if(element&&!element.disabled&&elementType==='preview-download'){download();event.preventDefault();event.stopPropagation();}}};});Box.Application.addBehavior('preview-download-watermarked-rep',function(context){'use strict';var caching;var notificationService;var previewNavService;var downloadService;function downloadSharedFile(fileId,sharedName){sharedName=sharedName||previewNavService.getSharedName();downloadService.downloadViaGet('/index.php?rm=preview_download_watermarked_rep_shared&sharedName='+sharedName+'&fileId='+fileId);}
function downloadFile(fileId){downloadService.downloadViaGet('/index.php?rm=preview_download_watermarked_rep&fileId='+fileId);}
function download(){var currentFile=caching.recall('currentFile');if(currentFile){if(currentFile.permissions.preview){if(previewNavService.isShared()){downloadSharedFile(currentFile.id,currentFile.sharedName);}else{downloadFile(currentFile.id);}}else{notificationService.error($t('Either this file is not downloadable or you do not have permission to download this file.','preview_download_watermarked_rep_no_permission_error'));}}}
return{messages:['previewdownloadwatermarkedrep'],onmessage:function(name){if(name==='previewdownloadwatermarkedrep'){download();}},init:function(){notificationService=context.getService('notifications');downloadService=context.getService('download');caching=context.getService('preview-cache');previewNavService=context.getService('preview-nav');},onclick:function(event,element,elementType){if(element&&!element.disabled&&elementType==='preview-download-watermarked-rep'){download();event.preventDefault();event.stopPropagation();}}};});Box.Application.addBehavior('preview-favorite',function(context){'use strict';var dom,currentFile,cachingService,favoritesService;function toggleFavorite(element){if(currentFile.isFavorited){favoritesService.remove(currentFile.typedId,true,'unfavoritefilepreview');dom.removeClass(element,'is-favorited');dom.setHTML(element,$t('Favorite','preview_favorite'));}else{favoritesService.add(currentFile.typedId,true,'favoritefilepreview');dom.addClass(element,'is-favorited');dom.setHTML(element,$t('Unfavorite','preview_unfavorite'));}}
return{init:function(){dom=context.getService('dom');cachingService=context.getService('preview-cache');favoritesService=context.getService('fileop-favorites');currentFile=cachingService.recall('currentFile');},onclick:function(event,element,elementType){if(element&&!element.disabled&&elementType==='preview-favorite'){toggleFavorite(element);event.preventDefault();event.stopPropagation();}}};});Box.Application.addBehavior('preview-embed-scrolling',function(context){'use strict';var dom=context.getService('dom'),funcUtils=context.getService('function-utils'),tooltips=context.getService('tooltips-amsterdam'),browser=context.getService('browser'),moduleEl,handlePageChange=false,isChromeVisible=false,isChromeFixed=false,scrollData={},eventsAttached=false,embedWidgetEl,screenTap=false,isTouchSupported=('ontouchstart'in window),IS_VISIBLE_CLASS='is-visible',IS_DISABLED_CLASS='is-disabled',IS_DISPLAYED_CLASS='is-displayed',HIDE_CHROME_DELAY=browser.isMobileOS()?4000:2000,SHOW_CHROME_DELAY=1000;function showEmbedWidgetChrome(){dom.addClass(embedWidgetEl,IS_VISIBLE_CLASS);}
function hideEmbedWidgetChrome(){tooltips.hideAll();dom.removeClass(embedWidgetEl,IS_VISIBLE_CLASS);}
function setChromeCSSClasses(){dom.removeClass(embedWidgetEl,IS_DISABLED_CLASS);dom.removeClass(embedWidgetEl,IS_DISPLAYED_CLASS);if(isChromeFixed){dom.addClass(embedWidgetEl,isChromeVisible?IS_DISPLAYED_CLASS:IS_DISABLED_CLASS);}
if(isChromeVisible){showEmbedWidgetChrome();}else{hideEmbedWidgetChrome();}}
function setTouchEventHandler(){dom.on(embedWidgetEl,'touchstart',function(){screenTap=true;dom.on(embedWidgetEl,'touchmove',function cleanupTouchMoveHandler(){screenTap=false;dom.off(embedWidgetEl,'touchmove',cleanupTouchMoveHandler);});});}
function setMouseEventHandlers(){dom.on(embedWidgetEl,'mouseover',funcUtils.throttle(showEmbedWidgetChrome,SHOW_CHROME_DELAY));dom.on(embedWidgetEl,'mousemove',funcUtils.throttle(showEmbedWidgetChrome,SHOW_CHROME_DELAY));dom.on(embedWidgetEl,'mousemove',funcUtils.debounce(hideEmbedWidgetChrome,HIDE_CHROME_DELAY));}
return{messages:['viewerscrollstarted','viewerscrollended','previewcontentupdated','embedsharepopupchanged','embedwidgetevent'],onmessage:function(name,data){switch(name){case'embedsharepopupchanged':if(data==='show'){isChromeVisible=true;isChromeFixed=true;}else if(data==='hide'){isChromeFixed=false;}
break;case'viewerscrollstarted':if(embedWidgetEl&&!handlePageChange){scrollData=isChromeVisible;isChromeVisible=false;isChromeFixed=true;}
break;case'viewerscrollended':if(embedWidgetEl){if(handlePageChange){handlePageChange=false;}else{isChromeFixed=isTouchSupported?screenTap:false;isChromeVisible=isTouchSupported?!scrollData:true;}}
break;case'previewcontentupdated':if(embedWidgetEl&&!eventsAttached){if(isTouchSupported){setTouchEventHandler();}
if(!browser.isMobileOS()){setMouseEventHandlers();}
eventsAttached=true;}
break;case'embedwidgetevent':if(data.type==='previouspage'||data.type==='nextpage'){handlePageChange=true;}else{return;}
break;}
setChromeCSSClasses();},init:function(){moduleEl=context.getElement();embedWidgetEl=dom.query('.preview-embed-widget',moduleEl);}};});Box.Application.addBehavior('preview-edit-office-online',function(context){'use strict';var DISABLED_BUTTON_TIMEOUT=2000;var currentFile,cachingService,officeOnlineService,functionUtilsService,debouncedEditWithOfficeOnline;function editFileWithOfficeOnline(){if(!officeOnlineService||!officeOnlineService.isOfficeOnlineAvailableAndSupportedForFile(currentFile)){return;}
if(!debouncedEditWithOfficeOnline){debouncedEditWithOfficeOnline=functionUtilsService.debounce(function(){officeOnlineService.launchFileActionForItemWithTypedId(currentFile.typedId);},DISABLED_BUTTON_TIMEOUT,true);}
debouncedEditWithOfficeOnline();}
return{messages:['previeweditofficeonline'],onmessage:function(name){if(name==='previeweditofficeonline'){editFileWithOfficeOnline();}},init:function(){cachingService=context.getService('preview-cache');officeOnlineService=context.getService('office-online');functionUtilsService=context.getService('function-utils');currentFile=cachingService.recall('currentFile');},onclick:function(event,element,elementType){if(element&&!element.disabled&&elementType==='preview-edit-office-online'){editFileWithOfficeOnline();event.preventDefault();event.stopPropagation();}}};});Box.Application.addModule('popup-share-link',function(context){'use strict';var CONF_IS_EMBED_WIDGET='isEmbedWidget',CONF_IS_NEW_SHARED_LINK='isNewSharedLink',RM_EMAIL_LINK='sham_email_share_link',RM_GET_SHARE_ACCESS_DETAILS_HTML='sham_item_share_link_popup_access_details',RM_SHARE_SETTINGS_POPUP='sham_item_share_settings',FAILED_ACCESS_ENTERPRISE=1,FAILED_ACCESS_FOLDER=2;var invalidEmailMessage=$t('Please enter a valid email address.','popup_share_link_error_notification');var RETURN_KEY=13;var SPACE_KEY=32;var CLASS_LOADING='is-loading',CLASS_DISABLED='is-disabled',CSS_SELECTOR_POPUP_WRAPPER='.popup-wrapper';var ajaxService,contactsProviderService,domService,notificationsService,pillSelectorService,popupsService,resinService,stringsService,urlService;var emailInputEl,linkInputEl,moduleEl,sendBtnEl;var contactSelector;var itemTypedID;var tooltipPosition;function getTooltipPosition(){if(!tooltipPosition){tooltipPosition=context.getConfig(CONF_IS_EMBED_WIDGET)?'top':'';}
return tooltipPosition;}
function showLoadingLink(){domService.addClass(linkInputEl,CLASS_DISABLED);domService.addClass(linkInputEl,CLASS_LOADING);}
function hideLoadingLink(){domService.removeClass(linkInputEl,CLASS_LOADING);domService.removeClass(linkInputEl,CLASS_DISABLED);}
function setLoadingState(){domService.addClass(sendBtnEl,CLASS_LOADING);domService.addClass(sendBtnEl,CLASS_DISABLED);sendBtnEl.disabled=true;}
function removeLoadingState(){sendBtnEl.disabled=false;domService.removeClass(sendBtnEl,CLASS_DISABLED);domService.removeClass(sendBtnEl,CLASS_LOADING);}
function selectLinkText(){setTimeout(function(){linkInputEl.select();},0);}
function initPillSelector(){var inputEl=domService.query('.contact-selector-input',moduleEl);var searchMethod=contactsProviderService.searchAllContacts({includeSelf:true,includeGroups:false});contactSelector=pillSelectorService.create(inputEl,searchMethod);contactSelector.init();}
function getValidAndInvalidEmails(pillData){var i,len=pillData.length,email,validEmails=[],invalidEmails=[];for(i=0;i<len;i++){email=pillData[i].id;if(stringsService.isEmail(email)){validEmails.push(email);}else{invalidEmails.push(email);}}
return{validEmails:validEmails,invalidEmails:invalidEmails};}
function getSendLinkSuccessMessage(emailsAndItems){if(!emailsAndItems||!emailsAndItems.length){return'';}
var i,len=emailsAndItems.length,emails=[],itemName=emailsAndItems[0].item_name;for(i=0;i<len;i++){emails.push(emailsAndItems[i].email);}
return $t('The link to %1 was sent to %2.','share_link_popup_success_message',itemName,emails.join(', '));}
function getSendLinkFailureMessage(emailsAndItems,invalidEmails){if(!emailsAndItems||!emailsAndItems.length){if(invalidEmails.length){return $t('The link was not sent to the following invalid email(s): %1.','share_link_popup_invalid_emails',invalidEmails.join(', '));}else{return'';}}
var i,len=emailsAndItems.length,emailAndItem,emails=[],failedAccessCode=0,failureMessage='',itemName=emailsAndItems[0].item_name,failedEmailsString;for(i=0;i<len;i++){emailAndItem=emailsAndItems[i];emails.push(emailAndItem.email);failedAccessCode=Math.max(failedAccessCode,emailAndItem.access);}
failedEmailsString=emails.join(', ');switch(failedAccessCode){case FAILED_ACCESS_ENTERPRISE:if(invalidEmails.length){failureMessage=$t('The link to %1 was not sent to %2 because at least one user is not a user in the folder owner\'s enterprise. The link was also not sent to the following invalid email(s): %3.','share_link_popup_send_link_not_in_enterprise_failure_with_invalid_emails',itemName,failedEmailsString,invalidEmails.join(', '));}else{failureMessage=$t('The link to %1 was not sent to %2 because at least one user is not a user in the folder owner\'s enterprise.','share_link_popup_send_link_not_in_enterprise_failure',itemName,failedEmailsString);}
break;case FAILED_ACCESS_FOLDER:if(invalidEmails.length){failureMessage=$t('The link to %1 was not sent to %2 because at least one user is not a collaborator in this folder. The link was also not sent to the following invalid email(s): %3.','share_link_popup_send_link_not_in_folder_failure_with_invalid_emails',itemName,failedEmailsString,invalidEmails.join(', '));}else{failureMessage=$t('The link to %1 was not sent to %2 because at least one user is not a collaborator in this folder.','share_link_popup_send_link_not_in_folder_failure',itemName,failedEmailsString);}
break;default:if(invalidEmails.length){failureMessage=$t('Sorry, there was an error and the link to %1 was not sent to %2. Please try again. The link was also not sent to the following invalid email(s): %3.','share_link_popup_send_link_generic_failure_with_invalid_emails',itemName,failedEmailsString,invalidEmails.join(', '));}else{failureMessage=$t('Sorry, there was an error and the link to %1 was not sent to %2. Please try again.','share_link_popup_send_link_generic_failure',itemName,failedEmailsString);}
break;}
return failureMessage;}
function showSendLinkNotification(responseData,invalidEmails){var successMessage=getSendLinkSuccessMessage(responseData.successful_emails_items),failureMessage=getSendLinkFailureMessage(responseData.failed_emails_items,invalidEmails);if(successMessage&&failureMessage){notificationsService.warn(successMessage+' '+failureMessage);}else if(failureMessage){notificationsService.error(failureMessage);}else if(successMessage){notificationsService.info(successMessage);}}
function sendEmailLinkRequest(itemTypedId,emailData,message){var runmode=urlService.getGcmCompatibleRm(RM_EMAIL_LINK),params={itemTypedId:itemTypedId,emails:emailData.validEmails,message:message};setLoadingState();ajaxService.post(runmode,params).then(function(response){popupsService.close({unsafeSkipRefresh:true});showSendLinkNotification(response.data,emailData.invalidEmails);}).catch(function(){removeLoadingState();var errorMessage=$t('There was a problem emailing the link. Please try again or refresh the page.','email_share_link_error_message');popupsService.alert(errorMessage);});}
function attachCopyHandler(){domService.on(linkInputEl,'copy',function(){resinService.recordActionFromElement(linkInputEl,{target:'copysharedlink',action:'click',data:{item_id:itemTypedID,custom_url:linkInputEl.value}});});}
return{behaviors:['menu-toggle','popup-default-close','share-access-menu-amsterdam','tooltips-amsterdam'],messages:['sharedlinkchanged','sharedlinkremoved'],init:function(){ajaxService=context.getService('ajax');contactsProviderService=context.getService('provider-contacts');domService=context.getService('dom');notificationsService=context.getService('notifications-amsterdam');pillSelectorService=context.getService('pill-selector');popupsService=context.getService('popups-amsterdam');resinService=context.getService('resin');stringsService=context.getService('strings');urlService=context.getService('url');moduleEl=context.getElement();linkInputEl=domService.query('.share-link-input',moduleEl);itemTypedID=moduleEl.getAttribute('data-item-typed-id');attachCopyHandler();selectLinkText();initPillSelector();emailInputEl=domService.query('.pill-selector-input',moduleEl);sendBtnEl=domService.query('.btn[data-type="send-btn"]',moduleEl);if(context.getConfig(CONF_IS_NEW_SHARED_LINK)){setTimeout(function(){context.broadcast('sharedlinkchanged');},0);}},destroy:function(){domService.off(linkInputEl,'copy');},onclick:function(event,element,elementType){if(!element||element.disabled){return;}
switch(elementType){case'share-link-input':this.focusAndSelectText(element);break;case'send-btn':var itemTypedId=element.getAttribute('data-item-typed-id');this.emailShareLink(itemTypedId);break;case'share-settings-btn':this.openSharedLinkSettingsPopup();break;default:return;}
event.preventDefault();event.stopPropagation();},onfocusin:function(event,element,elementType){var emailFieldsetEl=domService.query('.email-fieldset',moduleEl);if(elementType!=='contact-selector-input'||domService.hasClass(emailFieldsetEl,'is-email-expanded')){return;}
domService.addClass(emailFieldsetEl,'is-email-expanded');},onmessage:function(name,data){switch(name){case'sharedlinkchanged':if(!data){return;}
this.updateShareLinkAccessDetailsHTML(data.itemTypedId);break;case'sharedlinkremoved':popupsService.close({unsafeSkipRefresh:true});}},onkeydown:function(event,element,elementType){var keyCode=event.which||event.keyCode;if(!element||!elementType){return;}
if((keyCode===RETURN_KEY||keyCode===SPACE_KEY)&&elementType==='contact-selector-input'){var contactsString=domService.query('.pill-selector-input',moduleEl).value;var contactsData=contactSelector.createDataArrayFromString(contactsString);if(contactsData.length){contactSelector.removeAllErrors();contactSelector.insertArrayOfPills(contactsData);}else{contactSelector.displayError(invalidEmailMessage,{tooltipPosition:getTooltipPosition()});}
event.preventDefault();event.stopPropagation();}},focusAndSelectText:function(element){element.focus();element.select();},openSharedLinkSettingsPopup:function(){popupsService.close({unsafeSkipRefresh:true});var itemTypedId=moduleEl.getAttribute('data-item-typed-id');var url=urlService.getGcmCompatibleRm(RM_SHARE_SETTINGS_POPUP);popupsService.open(url,{data:{itemTypedId:itemTypedId,openBasicSettingsOnClose:true}});},emailShareLink:function(itemTypedId){var emailData,errorMessage,message,pillData;var contactsData=contactSelector.createDataArrayFromString(emailInputEl.value);contactSelector.insertArrayOfPills(contactsData);pillData=contactSelector.getPills();emailData=getValidAndInvalidEmails(pillData);if(emailData.validEmails.length){contactSelector.removeAllErrors();message=domService.query('.message-textarea',moduleEl).value;sendEmailLinkRequest(itemTypedId,emailData,message);}else{errorMessage=$t('Enter at least one valid email','share_properties_popup_no_emails');contactSelector.displayError(errorMessage,{tooltipPosition:getTooltipPosition(),tooltipRelative:CSS_SELECTOR_POPUP_WRAPPER});}},updateShareLinkAccessDetailsHTML:function(itemTypedId){var runmode=urlService.getGcmCompatibleRm(RM_GET_SHARE_ACCESS_DETAILS_HTML),params={itemTypedId:itemTypedId};showLoadingLink();ajaxService.get(runmode,params).then(function(response){hideLoadingLink();var accessLevelDetailsEl=domService.query('.share-link-access-details',moduleEl);domService.setHTML(accessLevelDetailsEl,response.data.html);var menuToggleButton=domService.query('[data-type="menu-toggle-button"]',accessLevelDetailsEl);if(menuToggleButton){menuToggleButton.focus();}}).catch(function(){popupsService.close({unsafeSkipRefresh:true});var itemActionsService=context.getService('item-actions');itemActionsService.share(itemTypedId);});}};});Box.Application.addModule('sham-share-link-popup',function(context){'use strict';var CONF_IS_EMBED_WIDGET='isEmbedWidget',RM_EMAIL_LINK='sham_email_share_link',RM_GET_SHARE_ACCESS_DETAILS_HTML='sham_item_share_link_popup_access_details',RM_SHARE_SETTINGS_POPUP='sham_item_share_settings',FAILED_ACCESS_ENTERPRISE=1,FAILED_ACCESS_FOLDER=2;var RETURN_KEY=13,COMMA_KEY=188;var CLASS_LOADING='is-loading',CLASS_DISABLED='is-disabled',CSS_SELECTOR_POPUP_WRAPPER='.popup-wrapper';var ajaxService,contactsProviderService,domService,notificationsService,pillSelectorService,popupsService,stringsService,urlService;var emailInputEl,linkInputEl,moduleEl,sendBtnEl;var contactSelector;function showLoadingLink(){domService.addClass(linkInputEl,CLASS_DISABLED);domService.addClass(linkInputEl,CLASS_LOADING);}
function hideLoadingLink(){domService.removeClass(linkInputEl,CLASS_LOADING);domService.removeClass(linkInputEl,CLASS_DISABLED);}
function setLoadingState(){domService.addClass(sendBtnEl,CLASS_LOADING);domService.addClass(sendBtnEl,CLASS_DISABLED);sendBtnEl.disabled=true;}
function removeLoadingState(){sendBtnEl.disabled=false;domService.removeClass(sendBtnEl,CLASS_DISABLED);domService.removeClass(sendBtnEl,CLASS_LOADING);}
function selectLinkText(){setTimeout(function(){linkInputEl.select();},0);}
function initPillSelector(){var inputEl=domService.query('.contact-selector-input',moduleEl);var searchMethod=contactsProviderService.searchAllContacts({includeSelf:true,includeGroups:false});contactSelector=pillSelectorService.create(inputEl,searchMethod);contactSelector.init();}
function createPillsFromString(contactsString){if(!contactsString){return;}
var contactsData=contactSelector.createDataArrayFromString(contactsString);contactSelector.insertArrayOfPills(contactsData);}
function getValidAndInvalidEmails(pillData){var i,len=pillData.length,email,validEmails=[],invalidEmails=[];for(i=0;i<len;i++){email=pillData[i].id;if(stringsService.isEmail(email)){validEmails.push(email);}else{invalidEmails.push(email);}}
return{validEmails:validEmails,invalidEmails:invalidEmails};}
function getSendLinkSuccessMessage(emailsAndItems){if(!emailsAndItems||!emailsAndItems.length){return'';}
var i,len=emailsAndItems.length,emails=[],itemName=emailsAndItems[0].item_name;for(i=0;i<len;i++){emails.push(emailsAndItems[i].email);}
return $t('The link to %1 was sent to %2.','share_link_popup_success_message',itemName,emails.join(', '));}
function getSendLinkFailureMessage(emailsAndItems,invalidEmails){if(!emailsAndItems||!emailsAndItems.length){if(invalidEmails.length){return $t('The link was not sent to the following invalid email(s): %1.','share_link_popup_invalid_emails',invalidEmails.join(', '));}else{return'';}}
var i,len=emailsAndItems.length,emailAndItem,emails=[],failedAccessCode=0,failureMessage='',itemName=emailsAndItems[0].item_name,failedEmailsString;for(i=0;i<len;i++){emailAndItem=emailsAndItems[i];emails.push(emailAndItem.email);failedAccessCode=Math.max(failedAccessCode,emailAndItem.access);}
failedEmailsString=emails.join(', ');switch(failedAccessCode){case FAILED_ACCESS_ENTERPRISE:if(invalidEmails.length){failureMessage=$t('The link to %1 was not sent to %2 because at least one user is not a user in the folder owner\'s enterprise. The link was also not sent to the following invalid email(s): %3.','share_link_popup_send_link_not_in_enterprise_failure_with_invalid_emails',itemName,failedEmailsString,invalidEmails.join(', '));}else{failureMessage=$t('The link to %1 was not sent to %2 because at least one user is not a user in the folder owner\'s enterprise.','share_link_popup_send_link_not_in_enterprise_failure',itemName,failedEmailsString);}
break;case FAILED_ACCESS_FOLDER:if(invalidEmails.length){failureMessage=$t('The link to %1 was not sent to %2 because at least one user is not a collaborator in this folder. The link was also not sent to the following invalid email(s): %3.','share_link_popup_send_link_not_in_folder_failure_with_invalid_emails',itemName,failedEmailsString,invalidEmails.join(', '));}else{failureMessage=$t('The link to %1 was not sent to %2 because at least one user is not a collaborator in this folder.','share_link_popup_send_link_not_in_folder_failure',itemName,failedEmailsString);}
break;default:if(invalidEmails.length){failureMessage=$t('Sorry, there was an error and the link to %1 was not sent to %2. Please try again. The link was also not sent to the following invalid email(s): %3.','share_link_popup_send_link_generic_failure_with_invalid_emails',itemName,failedEmailsString,invalidEmails.join(', '));}else{failureMessage=$t('Sorry, there was an error and the link to %1 was not sent to %2. Please try again.','share_link_popup_send_link_generic_failure',itemName,failedEmailsString);}
break;}
return failureMessage;}
function showSendLinkNotification(responseData,invalidEmails){var successMessage=getSendLinkSuccessMessage(responseData.successful_emails_items),failureMessage=getSendLinkFailureMessage(responseData.failed_emails_items,invalidEmails);if(successMessage&&failureMessage){notificationsService.warn(successMessage+' '+failureMessage);}else if(failureMessage){notificationsService.error(failureMessage);}else if(successMessage){notificationsService.info(successMessage);}}
function sendEmailLinkRequest(itemTypedId,emailData,message){var runmode=urlService.getGcmCompatibleRm(RM_EMAIL_LINK),params={itemTypedId:itemTypedId,emails:emailData.validEmails,message:message};setLoadingState();ajaxService.post(runmode,params).then(function sendLinkSuccessHandler(response){popupsService.close({unsafeSkipRefresh:true});showSendLinkNotification(response.data,emailData.invalidEmails);},function sendLinkErrorHandler(){removeLoadingState();var errorMessage=$t('There was a problem emailing the link. Please try again or refresh the page.','email_share_link_error_message');popupsService.alert(errorMessage);});}
return{behaviors:['menu-toggle','popup-default-close','sham-share-access-menu','tooltips-amsterdam'],messages:['sharedlinkchanged','sharedlinkremoved'],init:function(){ajaxService=context.getService('ajax');contactsProviderService=context.getService('provider-contacts');domService=context.getService('dom');notificationsService=context.getService('notifications-amsterdam');pillSelectorService=context.getService('pill-selector');popupsService=context.getService('popups-amsterdam');stringsService=context.getService('strings');urlService=context.getService('url');moduleEl=context.getElement();linkInputEl=domService.query('.share-link-input',moduleEl);selectLinkText();initPillSelector();emailInputEl=domService.query('.pill-selector-input',moduleEl);sendBtnEl=domService.query('.btn[data-type="send-btn"]',moduleEl);},onclick:function(event,element,elementType){if(!element||element.disabled){return;}
switch(elementType){case'share-link-input':this.focusAndSelectText(element);break;case'send-btn':var itemTypedId=element.getAttribute('data-item-typed-id');this.emailShareLink(itemTypedId);break;case'share-settings-btn':this.openSharedLinkSettingsPopup();break;default:return;}
event.preventDefault();event.stopPropagation();},onfocusin:function(event,element,elementType){var emailFieldsetEl=domService.query('.email-fieldset',moduleEl);if(elementType!=='contact-selector-input'||domService.hasClass(emailFieldsetEl,'is-email-expanded')){return;}
domService.addClass(emailFieldsetEl,'is-email-expanded');popupsService.resize();setTimeout(function(){domService.addClass(emailFieldsetEl,'is-visible');},100);},onmessage:function(name,data){switch(name){case'sharedlinkchanged':this.updateShareLinkAccessDetailsHTML(data.itemTypedId);break;case'sharedlinkremoved':popupsService.close({unsafeSkipRefresh:true});}},onkeydown:function(event,element,elementType){var keyCode=event.which||event.keyCode;if(!element||!elementType){return;}
if((keyCode===RETURN_KEY||keyCode===COMMA_KEY)&&elementType==='contact-selector-input'){var contactsString=domService.query('.pill-selector-input',moduleEl).value;createPillsFromString(contactsString);event.preventDefault();event.stopPropagation();}},focusAndSelectText:function(element){element.focus();element.select();},openSharedLinkSettingsPopup:function(){popupsService.close({unsafeSkipRefresh:true});var itemTypedId=moduleEl.getAttribute('data-item-typed-id');var url=urlService.getGcmCompatibleRm(RM_SHARE_SETTINGS_POPUP);popupsService.open(url,{data:{itemTypedId:itemTypedId,openBasicSettingsOnClose:true}});},emailShareLink:function(itemTypedId){var emailData,errorMessage,message,pillData,tooltipPosition;createPillsFromString(emailInputEl.value);pillData=contactSelector.getPills();emailData=getValidAndInvalidEmails(pillData);if(!emailData.validEmails.length){errorMessage=$t('Enter at least one valid email','share_properties_popup_no_emails');tooltipPosition=context.getConfig(CONF_IS_EMBED_WIDGET)?'top':'';contactSelector.displayError(errorMessage,{tooltipPosition:tooltipPosition,tooltipRelative:CSS_SELECTOR_POPUP_WRAPPER});return;}
message=domService.query('.message-textarea',moduleEl).value;sendEmailLinkRequest(itemTypedId,emailData,message);},updateShareLinkAccessDetailsHTML:function(itemTypedId){var runmode=urlService.getGcmCompatibleRm(RM_GET_SHARE_ACCESS_DETAILS_HTML),params={itemTypedId:itemTypedId};showLoadingLink();ajaxService.get(runmode,params).then(function replaceShareAccessDetailsHTML(response){hideLoadingLink();var accessLevelDetailsEl=domService.query('.share-link-access-details',moduleEl);domService.setHTML(accessLevelDetailsEl,response.data.html);var menuToggleButton=domService.query('[data-type="menu-toggle-button"]',accessLevelDetailsEl);if(menuToggleButton){menuToggleButton.focus();}},function handleGetShareAccessDetailsHTMLError(){popupsService.close({unsafeSkipRefresh:true});var itemActionsService=context.getService('item-actions');itemActionsService.share(itemTypedId);});}};});Box.Application.addModule('preview',function(context){'use strict';var STATUS_SUCCESS='success',STATUS_PENDING='pending',STATUS_ERROR='error',STATUS_NONE='none',PREVIEW='preview',KEYPRESS='keypress',HIDDEN_CLASS='hidden',NAVIGATION_VISIBILITY_CLASS='is-preview-navigation-visible',IRM_VISUAL_INDICATOR_CLASS='preview-irm-visual-indicator-is-showing',TIMEOUT_PAGE_RESIZE=500,MOUSEMOVE_THROTTLE=1500,FOCUSABLE_ELEMENTS_SELECTOR='input, textarea, button, select, a[href]';var dom,win,document,resin,contentEl,representationEl,progressEl,leftNavArrowEl,rightNavArrowEl,funcUtils,resizeHandler,mousemoveHandler,sidebarEl,headerEl,footerEl,filesInCurrentPage=[],currentFile,currentFolder,isPreviewOpen,longDwellTimeout,navState,arrayUtils,progressService,progressWidget,notificationService,hotkeysService,previewApiService,tooltipService,navService,previewNav,officeOnline,logger,navUrl,promises,realtime,moduleEl,prefetchCount=0,prevNextNavCount=0,previewCount=0,searchFilters,caching,wasPreviousArrowUsed=false,bodyEl,documentTitle;function getResizeHandler(){if(!resizeHandler){resizeHandler=funcUtils.debounce(function(){context.broadcast('previewresized');},TIMEOUT_PAGE_RESIZE);}
return resizeHandler;}
function updateDocumentTitle(){if(previewNav.isSharedFilePage()){document.title=$t('%1 - File Shared from Box','preview_document_title_shared',currentFile.fullName);}else{document.title=$t('%1 - Box','preview_document_title',currentFile.fullName);}}
function hideAllTooltips(){if(tooltipService){tooltipService.hideAll();}}
function hideAllOverlays(){if($.popup){$.popup.close();}
if($.datepicker){$.datepicker._hideDatepicker();}
if(notificationService){notificationService.hide();}}
function getMouseMoveHandler(){var timeoutHandler;if(!mousemoveHandler){mousemoveHandler=funcUtils.throttle(function(){clearTimeout(timeoutHandler);dom.addClass(moduleEl,NAVIGATION_VISIBILITY_CLASS);timeoutHandler=setTimeout(function(){dom.removeClass(moduleEl,NAVIGATION_VISIBILITY_CLASS);},MOUSEMOVE_THROTTLE);},MOUSEMOVE_THROTTLE-500,true);}
return mousemoveHandler;}
function destroyProgressWidget(){if(progressWidget){progressWidget.destroy();progressWidget=null;}}
function openPreview(){dom.removeClass(moduleEl,'hidden');dom.addClass(bodyEl,'no_scroll has_lightbox');dom.on(win,'resize',getResizeHandler());dom.on(contentEl,'mousemove',getMouseMoveHandler());documentTitle=document.title;caching.memorize('currentFile',undefined);isPreviewOpen=true;}
function closePreview(){if(isPreviewOpen){hideAllTooltips();hideAllOverlays();dom.addClass(moduleEl,'hidden');dom.removeClass(bodyEl,'no_scroll has_lightbox');dom.off(win,'resize',getResizeHandler());dom.off(representationEl,'mousemove',getMouseMoveHandler());if(searchFilters){navState.setSearchFilters(searchFilters);searchFilters=null;}
logger.interrupt('close');prevNextNavCount=0;if(hotkeysService){hotkeysService.unsetConfig(PREVIEW);}
destroyProgressWidget();dom.setHTML(representationEl,'');dom.setHTML(sidebarEl,'');document.title=documentTitle;caching.memorize('currentFile',undefined);clearTimeout(longDwellTimeout);isPreviewOpen=false;}}
function closePreviewAndNavigateToUrl(url,reloadUnderlyingPage){if(previewNav.isSharedFilePageOrSharedFileEmbed()){return;}
if(!url){url='/files';}
closePreview();if(context.hasService('navigation')){var navigationService=context.getService('navigation');if(reloadUnderlyingPage){navigationService.navigate(url,null,{reload_page_after_preview:true});}else{navigationService.navigate(url);}}else{navService.redirect(url);}}
function isNonFolderView(){return context.getGlobalConfig('singlePage')||navState.isGcmQuarantinePreview()||navState.isSearch()||navState.isGcmSearch()||previewNav.isSharedFilePageOrSharedFileEmbed();}
function updateNavigationArrows(fileId){var folderContents,currentFileIndexInFolder,currentFileIndexInPage;if(isNonFolderView()){folderContents=filesInCurrentPage;}else{folderContents=currentFolder.files;}
dom.addClass(leftNavArrowEl,HIDDEN_CLASS);dom.addClass(rightNavArrowEl,HIDDEN_CLASS);currentFileIndexInFolder=$.inArray(fileId,folderContents);currentFileIndexInPage=$.inArray(fileId,filesInCurrentPage);if(currentFileIndexInPage>-1&&folderContents&&folderContents.length>0){if(currentFileIndexInFolder!==0){dom.removeClass(leftNavArrowEl,HIDDEN_CLASS);}
if(currentFileIndexInFolder!==folderContents.length-1){dom.removeClass(rightNavArrowEl,HIDDEN_CLASS);}}}
function updateContentHandler(preview,params){return function(){hideAllTooltips();if(typeof preview.header==='string'&&params.updateHeader){dom.setHTML(headerEl,preview.header);}
if(typeof preview.footer==='string'){dom.setHTML(footerEl,preview.footer);if(preview.status===STATUS_NONE){dom.addClass(footerEl,'has-large-logo');}}
if(typeof preview.content==='string'&&params.updateContent){dom.setHTML(representationEl,preview.content);context.broadcast('previewcontentupdated');}
if(typeof preview.sidebar==='string'&&params.updateSidebar){dom.setHTML(sidebarEl,preview.sidebar);}
updateNavigationArrows(preview.file.id);};}
function updateLightboxContent(preview,params){if(params.prefetching){return;}
var postload=context.hasService('postload')?context.getService('postload'):null,postloadPromise;if(postload){postloadPromise=postload.getCompletionPromise();if(postloadPromise.isFulfilled()){updateContentHandler(preview,params)();}else{postloadPromise.then(updateContentHandler(preview,params));}}else{updateContentHandler(preview,params)();}}
function clearContentAndInitializeProgressWidget(){if(!progressWidget){progressWidget=progressService.create(progressEl);}
dom.setHTML(representationEl,'');}
function cacheAndUpdateLightboxContent(data,params){var file=data.file,cachedPreview=caching.fetch(file.id)||{},newPreview={file:file,content:data.content_html||cachedPreview.content,header:data.header_html||cachedPreview.header,footer:data.footer_html,sidebar:data.sidebar_html||cachedPreview.sidebar,lastAccessed:(new Date()).getTime(),status:data.status||cachedPreview.status};params.updateContent=!params.prefetching&&(!cachedPreview.file||cachedPreview.file.uniqueName!==newPreview.file.uniqueName||cachedPreview.status!==newPreview.status||cachedPreview.file.isPreviewWatermarked!==newPreview.file.isPreviewWatermarked);params.updateHeader=!params.prefetching&&(cachedPreview.header!==newPreview.header);params.updateSidebar=!params.prefetching&&(cachedPreview.sidebar!==newPreview.sidebar);if(params.updateContent&&cachedPreview.content){if(cachedPreview.status===STATUS_SUCCESS&&(newPreview.status===STATUS_SUCCESS||newPreview.status===STATUS_PENDING)){notificationService.warn($t('A new version of this file is available. Would you like to refresh the page?','item_notification_new_version_refresh'),{containerNode:'.preview-notification',action:{text:$t('Yes','js_Yes'),onclick:function(){hideAllOverlays();context.broadcast('previewcontentreload');}}});params.updateContent=false;}}
if(params.prefetching&&data.imgUrl&&!cachedPreview.content){document.createElement('img').src=data.imgUrl;}
if(newPreview.file.isCurrent&&(params.fileId?params.fileId.indexOf('file_version_')===-1:true)){caching.add(newPreview,data.status);}
updateLightboxContent(newPreview,params);}
function errorHandler(isPrefetch){var message=$t('An error occurred while loading Preview. Please try again later.','preview_server_error');return function(reason){if(!isPrefetch&&!(reason instanceof promises.CancellationError)){destroyProgressWidget();if(context.getGlobalConfig('debug')){message=reason.data||reason.message||'Unknown Error';}
closePreviewAndNavigateToUrl();notificationService.error(message,{action:{text:$t('Reload page','preview_error_reload'),onclick:function(){context.getService('navigation').navigate('');}}});}};}
function prefetchResolutionHandler(response){cacheAndUpdateLightboxContent(response.data,{prefetching:true});}
function fetchUnderlyingFileList(fileId,cachedFolderContents){var itemList=dom.queryAll('[data-module="item-list"] [data-type="item-row"]'),itemListLength=itemList.length,hasListChanged=false,itemListCount=0,currentFileIndexInFolder,oldFilesInCurrentPage=filesInCurrentPage,item,index;if(itemListLength===0){itemList=dom.queryAll('[data-module="item-list-gcm"] [data-type="item-row"]');itemListLength=itemList.length;}
filesInCurrentPage=[];for(index=0;index<itemListLength;index++){item=itemList[index];if(item.getAttribute('data-typed-id').indexOf('f_')===0){filesInCurrentPage.push(item.getAttribute('data-typed-id').substr(2));hasListChanged=hasListChanged||filesInCurrentPage[itemListCount]!==oldFilesInCurrentPage[itemListCount];itemListCount++;}}
currentFileIndexInFolder=$.inArray(fileId,cachedFolderContents);if(currentFileIndexInFolder<0){hasListChanged=true;}
return hasListChanged;}
function shouldIgnoreParentFolderContents(fileId,cachedPreview){var cachedFolderContents=cachedPreview?caching.recall('d_'+cachedPreview.file.folder.id):[],hasFileListChanged=fetchUnderlyingFileList(fileId,cachedFolderContents),ignoreFolderContents=!hasFileListChanged;return ignoreFolderContents||isNonFolderView();}
function prefetch(){var i,nextFileId,prevFileId,currentFileIndexInPage=$.inArray(currentFile.id,filesInCurrentPage),prefetchRejectionHandler=errorHandler(true);if(Object.keys&&!previewNav.isSharedFilePageOrSharedFileEmbed()&&filesInCurrentPage.length>1&&currentFileIndexInPage>-1){for(i=1;i<=prefetchCount;i++){nextFileId=filesInCurrentPage[currentFileIndexInPage+i];if(nextFileId&&!caching.has(nextFileId)){previewApiService.prefetchPreview(nextFileId).then(prefetchResolutionHandler,prefetchRejectionHandler).caught(prefetchRejectionHandler);}}
for(i=1;i<=prefetchCount&&wasPreviousArrowUsed;i++){prevFileId=filesInCurrentPage[currentFileIndexInPage-i];if(prevFileId&&!caching.has(prevFileId)){previewApiService.prefetchPreview(prevFileId).then(prefetchResolutionHandler,prefetchRejectionHandler).caught(prefetchRejectionHandler);}}}}
function conditionallyShowIRMIndicator(){if(currentFile.irmIndicator&&currentFile.irmIndicator.hasIndicator){dom.addClass(moduleEl,IRM_VISUAL_INDICATOR_CLASS);var irmTitleEl=dom.query('.preview-irm-visual-indicator-title',moduleEl);var irmBodyEl=dom.query('.preview-irm-visual-indicator-body',moduleEl);dom.setText(irmTitleEl,currentFile.irmIndicator.title);dom.setText(irmBodyEl,currentFile.irmIndicator.body);}else{dom.removeClass(moduleEl,IRM_VISUAL_INDICATOR_CLASS);}}
function previewResolutionsHandler(fileId,params){return function(resolvedValue){var response=resolvedValue.data;currentFile=response.file;currentFolder=currentFile.folder;currentFile.referrerUrl=params.referrerUrl||undefined;caching.memorize('currentFile',currentFile);if(currentFolder.files&&currentFolder.files.length>0){currentFolder.files=arrayUtils.map(currentFolder.files,function(entry){return entry+'';});caching.memorize('d_'+currentFolder.id,currentFolder.files);}else{currentFolder.files=caching.recall('d_'+currentFolder.id);}
if(params.firstLoad){logger.add('isConversionNeeded',response.status===STATUS_PENDING);}
cacheAndUpdateLightboxContent(response,params);switch(response.status){case STATUS_SUCCESS:if(progressWidget){progressWidget.end();}
break;case STATUS_PENDING:if(progressWidget){progressWidget.start(currentFile,params);}
break;case STATUS_ERROR:case STATUS_NONE:context.broadcast('previewloaded',{contentType:response.status});break;}
if(params.firstLoad){updateDocumentTitle();prefetch();}
conditionallyShowIRMIndicator();};}
function getUrlForCurrentItemPosition(id){var url,state=navState.get();if(navState.isGcmSearch()){url=navUrl.getGcmUrlForSearchPreview(state.searchString,state.page,id);}else if(navState.isGcm()){url=navUrl.getGcmUrlForPreview(state.gcmUserId,state.id,state.page,id);}else{url=navUrl.getFileUrlForPreview(id);}
return url;}
function getUrlForItemOnSiblingPage(id,pageOffset){var url,state=navState.get(),pageNum=parseInt(state.page,10)+pageOffset;pageNum=(pageNum<0)?0:pageNum;if(navState.isGcmSearch()){url=navUrl.getGcmUrlForSearchPreview(state.searchString,pageNum,id);}else if(navState.isGcm()){url=navUrl.getGcmUrlForPreview(state.gcmUserId,state.id,pageNum,id);}else{url=navUrl.getFileUrlForPreview(id,pageNum);}
return url;}
function navigate(offset){logger.interrupt('prev_next');var url,currentFileIndexInPage,newFileIndex,newFileId,totalNumFilesInCurrentPage,filesInCurrentFolder,firstFileOnCurrentPage,lastFileOnCurrentPage,firstFileOnCurrentPageRelativeToCurrentFolder,lastFileOnCurrentPageRelativeToCurrentFolder,fileIdOfFirstFileOnNextPage,fileIdOfLastFileOnPreviousPage,switchUnderlyingPage=false;clearTimeout(longDwellTimeout);totalNumFilesInCurrentPage=filesInCurrentPage.length;currentFileIndexInPage=currentFile?$.inArray(currentFile.id,filesInCurrentPage):-1;if(totalNumFilesInCurrentPage>0&&currentFileIndexInPage!==-1){firstFileOnCurrentPage=filesInCurrentPage[0];lastFileOnCurrentPage=filesInCurrentPage[totalNumFilesInCurrentPage-1];newFileIndex=currentFileIndexInPage+offset;filesInCurrentFolder=currentFolder.files;if(filesInCurrentFolder){firstFileOnCurrentPageRelativeToCurrentFolder=$.inArray(firstFileOnCurrentPage,filesInCurrentFolder);lastFileOnCurrentPageRelativeToCurrentFolder=$.inArray(lastFileOnCurrentPage,filesInCurrentFolder);fileIdOfFirstFileOnNextPage=filesInCurrentFolder[lastFileOnCurrentPageRelativeToCurrentFolder+1];fileIdOfLastFileOnPreviousPage=filesInCurrentFolder[firstFileOnCurrentPageRelativeToCurrentFolder-1];}
if(newFileIndex<0&&!fileIdOfLastFileOnPreviousPage){newFileIndex=0;}else if(newFileIndex>=totalNumFilesInCurrentPage&&!fileIdOfFirstFileOnNextPage){newFileIndex=totalNumFilesInCurrentPage-1;}
if((offset<0&&newFileIndex>=0)||(offset>0&&newFileIndex<totalNumFilesInCurrentPage)){newFileId=filesInCurrentPage[newFileIndex];url=getUrlForCurrentItemPosition(newFileId);}else{if(offset<0){newFileId=fileIdOfLastFileOnPreviousPage;}else{newFileId=fileIdOfFirstFileOnNextPage;}
url=getUrlForItemOnSiblingPage(newFileId,offset);if(!currentFile||currentFile.id!==newFileId){filesInCurrentPage=[];switchUnderlyingPage=true;}}
if(!currentFile||currentFile.id!==newFileId){dom.removeClass(moduleEl,'is-scrollbar-visible');wasPreviousArrowUsed=offset<0;prevNextNavCount++;caching.memorize('currentFile',undefined);context.getService('navigation').navigate(url,null,{switchUnderlyingPage:switchUnderlyingPage});}}}
function getHotkeysConfig(){var baseConfig=[];if(!previewNav.isSharedFilePageOrSharedFileEmbed()){baseConfig=baseConfig.concat([{key:'j',handler:function(){navigate(-1);resin.recordAction({application:'files',page:PREVIEW,component:'',feature:'hotkeys',target:'prevpreview',action:KEYPRESS});}},{key:'k',handler:function(){navigate(1);resin.recordAction({application:'files',page:PREVIEW,component:'',feature:'hotkeys',target:'nextpreview',action:KEYPRESS});}},{key:'left',handler:function(){navigate(-1);resin.recordAction({application:'files',page:PREVIEW,component:'',feature:'hotkeys',target:'prevpreview',action:KEYPRESS});}},{key:'right',handler:function(){navigate(1);resin.recordAction({application:'files',page:PREVIEW,component:'',feature:'hotkeys',target:'nextpreview',action:KEYPRESS});}}]);}
return baseConfig;}
function setNavigationHotkeys(){hotkeysService.setConfig([{key:'right',handler:function(){navigate(1);resin.recordAction({application:'files',page:PREVIEW,component:'',feature:'nextpreview',target:'close',action:KEYPRESS});}},{key:'left',handler:function(){navigate(-1);resin.recordAction({application:'files',page:PREVIEW,component:'',feature:'prevpreview',target:'close',action:KEYPRESS});}}],PREVIEW);}
function getActiveElement(){var activeEl=null;try{activeEl=document.activeElement;}catch(err){activeEl=document.body;}
return activeEl;}
function bindAccessibilityHelpers(){var accessibilityHelperTopEl=dom.query('[data-type="accessibility-helper-top"]'),accessibilityHelperBottomEl=dom.query('[data-type="accessibility-helper-bottom"]');dom.on(accessibilityHelperBottomEl,'focus',function accessibilityHelperBottom(){var firstFocusableHeaderEl=dom.query(FOCUSABLE_ELEMENTS_SELECTOR,headerEl);if(firstFocusableHeaderEl){firstFocusableHeaderEl.focus();}});dom.on(accessibilityHelperTopEl,'focus',function accessibilityHelperTop(){var lastFocusableEl=$(moduleEl).find(FOCUSABLE_ELEMENTS_SELECTOR).filter(':not([data-type="accessibility-helper-bottom"]):visible:last')[0];if(lastFocusableEl){lastFocusableEl.focus();}});}
function show(fileId,data){if(!fileId){closePreviewAndNavigateToUrl();notificationService.error($t('This file cannot be found or you do not have access to this file.','preview_error_file_not_found'));return;}
data=data||{};var previewRejectionHandler=errorHandler(),activeEl=getActiveElement(),cachedPreview,queryParams={fileId:fileId,referrerUrl:data.referrerUrl||undefined,firstLoad:true};logger.init(fileId);logger.add('previewCount',previewCount);logger.add('prevNextNavCount',prevNextNavCount);searchFilters=data.searchFilters||searchFilters||null;if(activeEl&&activeEl.nodeName!=='BODY'&&typeof activeEl.blur==='function'){activeEl.blur();}
clearContentAndInitializeProgressWidget();setNavigationHotkeys();if(!isPreviewOpen){openPreview();hotkeysService.setConfig(getHotkeysConfig(),PREVIEW,false);}
hideAllOverlays();if(caching.has(fileId)){logger.add('cached',true);caching.touch(fileId);cachedPreview=caching.fetch(fileId);currentFile=cachedPreview.file;currentFolder=currentFile.folder;caching.memorize('currentFile',currentFile);updateLightboxContent(cachedPreview,{updateContent:true,updateSidebar:true,updateHeader:true});}
queryParams.ignoreFolderContents=shouldIgnoreParentFolderContents(fileId,cachedPreview);previewApiService.getPreview(fileId,queryParams).then(previewResolutionsHandler(fileId,queryParams),previewRejectionHandler).caught(previewRejectionHandler);if(typeof headerEl.focus==='function'){headerEl.focus();}}
function handleFileUpdate(message,data){if(isPreviewOpen){data=data||{};var previewRejectionHandler=errorHandler(),params={referrerUrl:currentFile.referrerUrl,ignoreFolderContents:true};switch(message){case'previewfilenamechanged':case'favoritesuccess':case'unfavoritesuccess':case'favoriteerror':case'unfavoriteerror':params.ignoreContent=true;params.ignoreSidebar=true;break;case'filelocked':case'fileunlocked':params.ignoreContent=true;break;case'previewrefreshrequested':case'previewcontentreload':params.ignoreHeader=true;params.ignoreSidebar=true;params.isFlashFallback=data.isFlashFallback||undefined;params.isNativeVideoFallback=data.isNativeVideoFallback||undefined;clearContentAndInitializeProgressWidget();break;}
previewApiService.updatePreview(params).then(previewResolutionsHandler(currentFile.id,params),previewRejectionHandler).caught(previewRejectionHandler);}}
function toggleSidebar(showSidebar){function animationEnd(){context.broadcast('previewresized');}
if(showSidebar){dom.addClass(moduleEl,'is-preview-sidebar-visible',animationEnd);}else{dom.removeClass(moduleEl,'is-preview-sidebar-visible',animationEnd);}}
function recordLongDwell(contentType){function record(interval){resin.recordAction({application:'files',page:PREVIEW,component:'',feature:contentType,target:'longdwell'+interval,action:KEYPRESS});}
longDwellTimeout=setTimeout(function(){record(5);longDwellTimeout=setTimeout(function(){record(10);},5000);},5000);}
function finishPreviewLoading(contentType){destroyProgressWidget();previewCount++;logger.add('previewCount',previewCount);logger.add('contentType',contentType);logger.add('rendered',(new Date()).getTime());logger.add('uniqueName',currentFile.uniqueName);logger.add('extension',currentFile.extension);logger.log();resin.recordAction({application:'files',page:PREVIEW,component:'',feature:contentType,target:'loaded',action:KEYPRESS});recordLongDwell(contentType);}
return{behaviors:['tooltips-amsterdam','preview-download','preview-embed-scrolling'],messages:['previewloaded','previewaction','previewerror','previewready','previewshownext','previewfilenamechanged','previewcontentresized','previewcontentreload','previewcontentunload','previewtogglesidebar','previewcloseandnavigatetourl','filelocked','fileunlocked','favoritesuccess','unfavoritesuccess','favoriteerror','unfavoriteerror','previewrefreshrequested'],onmessage:function(name,data){var cachedPreview;switch(name){case'previewshownext':navigate(1);break;case'previewaction':this.handleUserAction(data);break;case'previewerror':logger.error(currentFile,data.errorType);break;case'previewrefreshrequested':if(!currentFile||currentFile&&!currentFile.id){break;}
case'previewcontentreload':cachedPreview=caching.fetch(currentFile.id);if(cachedPreview){cachedPreview.file=null;cachedPreview.content=null;}
handleFileUpdate(name,data);break;case'previewfilenamechanged':case'filelocked':case'fileunlocked':case'favoritesuccess':case'unfavoritesuccess':case'favoriteerror':case'unfavoriteerror':handleFileUpdate(name);break;case'previewloaded':finishPreviewLoading(data.contentType);break;case'previewready':destroyProgressWidget();break;case'previewcontentresized':if(data.isScrollbarVisible){dom.addClass(moduleEl,'is-scrollbar-visible');}else{dom.removeClass(moduleEl,'is-scrollbar-visible');}
break;case'previewcontentunload':realtime.abort();break;case'previewtogglesidebar':toggleSidebar(data.showSidebar);break;case'previewcloseandnavigatetourl':closePreviewAndNavigateToUrl(data.url,data.reloadUnderlyingPage);break;}},init:function(){var fileId,fileVersionId;win=context.getGlobal('window');document=win.document;moduleEl=context.getElement();navUrl=context.getService('nav-url');dom=context.getService('dom');resin=context.getService('resin');funcUtils=context.getService('function-utils');realtime=context.getService('preview-realtime');navState=context.getService('nav-state');notificationService=context.getService('notifications');logger=context.getService('preview-logger');hotkeysService=context.getService('hotkeys');progressService=context.getService('preview-progress');previewApiService=context.getService('preview-api');caching=context.getService('preview-cache');promises=context.getService('promises');tooltipService=context.getService('tooltips-amsterdam');previewNav=context.getService('preview-nav');navService=context.getService('nav');officeOnline=context.hasService('office-online')?context.getService('office-online'):null;arrayUtils=context.getService('array-utils');prefetchCount=context.getGlobalConfig('previewPrefetchCount');if(officeOnline&&!previewNav.isSharedFilePageOrSharedFileEmbed()){officeOnline.init();}
headerEl=dom.query('.preview-header-container',moduleEl)||dom.query('.preview-embed-widget-header-controls-wrapper',moduleEl);footerEl=dom.query('.preview-embed-widget-footer-controls-wrapper',moduleEl);contentEl=dom.query('.preview-content',moduleEl);representationEl=dom.query('.preview-representation',contentEl);sidebarEl=dom.query('.preview-sidebar',moduleEl);progressEl=dom.query('.progress-widget',contentEl);bodyEl=dom.query('body');leftNavArrowEl=dom.query('.preview-navigate-left',contentEl);rightNavArrowEl=dom.query('.preview-navigate-right',contentEl);bindAccessibilityHelpers();fileId=moduleEl.getAttribute('data-file-id');fileVersionId=moduleEl.getAttribute('data-file-version-id');if(fileVersionId){show('file_version_'+fileVersionId);}else if(fileId){show(fileId);}
if(dom.getBoundingClientRect(document.body).width>799){dom.addClass(moduleEl,'is-preview-sidebar-visible');}},handleUserAction:function(data){switch(data.action){case'show':show(data.fileId,data);break;case'close':closePreview();break;case'invalidatecache':caching.remove(data.fileId);break;}},onclick:function(event,element,elementType){if(!element||!elementType||element.disabled){return;}
hideAllTooltips();switch(elementType){case'preview-show-next':navigate(1);event.preventDefault();break;case'preview-show-previous':navigate(-1);event.preventDefault();break;}}};});Box.Application.addModule('preview-3dcg',function(context){'use strict';var CLASS_HIDDEN='hidden',CLASS_CURRENT_RENDER_MODE='current-render-mode',DEFAULT_SCENE_LIST=[{id:'CAMERA_ID',type:'camera',parentId:'SCENE_ID',parentAssetId:'SCENE_ID',properties:{position:{x:0.49,y:0.35,z:0.70},quaternion:{x:-0.185,y:0.294,z:0.058,w:0.936},near:0.02,far:20},components:{renderView:{enabled:true,scriptId:'render_view_component'},previewCameraController:{componentData:{orbitDistanceMin:0.2,orbitDistanceMax:10,useKeyboard:false,enablePan:true},enabled:true,scriptId:'preview_camera_controller'},previewCameraFocus:{componentData:{},enabled:true,scriptId:'preview_camera_focus'}}},{id:'ROOT_ID',type:'node',parentAssetId:'SCENE_ID',children:['CAMERA_ID','AMBIENT_LIGHT_ID']},{id:'SCENE_ID',type:'scene',parentAssetId:'SCENE_ID',properties:{rootObjectId:'ROOT_ID'}},{id:'AMBIENT_LIGHT_ID',type:'light',parentAssetId:'SCENE_ID',properties:{lightType:'ambient',color:{r:0,g:0,b:0}}},{id:'APP_ASSET_ID',type:'application',parentAssetId:'APP_ASSET_ID',properties:{startupScene:'SCENE_ID'},components:{veroldRenderer:{componentData:{antialias:true},scriptId:'box3d_renderer',isBuiltIn:true,enabled:true},inputController:{scriptId:'input_controller_component',isBuiltIn:true,enabled:true},renderModesComponent:{componentData:{},scriptId:'render_modes'}}},{id:'HDR_ENV_IMG_0',type:'image',properties:{name:'HDR Env Image 0',width:1024,height:512,stream:false,encoding:'linear'},representations:[{src:'/img/3dcgimages/HDR_Env0.png?'+Date.now(),isExternal:true,contentType:'image/png',contentEncoding:'identity',width:1024,height:512,compression:'zip',channels:['red','green','blue','exponent']}]},{id:'HDR_ENV_IMG_1',type:'image',properties:{name:'HDR Env Image 1',width:256,height:128,stream:false,encoding:'linear'},representations:[{src:'/img/3dcgimages/HDR_Env1.png?'+Date.now(),isExternal:true,contentType:'image/png',contentEncoding:'identity',width:256,height:128,compression:'zip',channels:['red','green','blue','exponent']}]},{id:'HDR_ENV_IMG_2',type:'image',properties:{name:'HDR Env Image 2',width:64,height:32,stream:false,encoding:'linear'},representations:[{src:'/img/3dcgimages/HDR_Env2.png?'+Date.now(),isExternal:true,contentType:'image/png',contentEncoding:'identity',width:64,height:32,compression:'zip',channels:['red','green','blue','exponent']}]},{id:'HDR_ENV_MAP_0',type:'texture2D',properties:{name:'HDR Env Map 0',imageId:'HDR_ENV_IMG_0',generateMipmaps:false,type:'halfFloat',minFilter:'linear',magFilter:'linear',vMapping:'clamp'}},{id:'HDR_ENV_MAP_CUBE_0',type:'renderTextureCube',properties:{name:'HDR Env Map Cube 0',type:'halfFloat',width:512,height:512,generateMipmaps:true,vMapping:'clamp',uMapping:'clamp',encoding:'linear'},components:{equirectToCubemap:{scriptId:'panorama_to_cubemap_script',enabled:true,componentData:{inputTexture:'HDR_ENV_MAP_0'}}}},{id:'HDR_ENV_MAP_1',type:'texture2D',properties:{name:'HDR Env Map 1',imageId:'HDR_ENV_IMG_1',type:'halfFloat',generateMipmaps:false,minFilter:'linear',magFilter:'linear',vMapping:'clamp'}},{id:'HDR_ENV_MAP_CUBE_1',type:'renderTextureCube',properties:{name:'HDR Env Map Cube 1',type:'halfFloat',width:128,height:128,generateMipmaps:true,vMapping:'clamp',uMapping:'clamp',encoding:'linear'},components:{equirectToCubemap:{scriptId:'panorama_to_cubemap_script',enabled:true,componentData:{inputTexture:'HDR_ENV_MAP_1'}}}},{id:'HDR_ENV_MAP_2',type:'texture2D',properties:{name:'HDR Env Map 2',imageId:'HDR_ENV_IMG_2',type:'halfFloat',minFilter:'linear',magFilter:'linear',vMapping:'clamp'}},{id:'HDR_ENV_MAP_CUBE_2',type:'renderTextureCube',properties:{name:'HDR Env Map Cube 2',type:'halfFloat',width:32,height:32,generateMipmaps:true,vMapping:'clamp',uMapping:'clamp',encoding:'linear'},components:{equirectToCubemap:{scriptId:'panorama_to_cubemap_script',enabled:true,componentData:{inputTexture:'HDR_ENV_MAP_2'}}}},{id:'MAT_CAP_IMG',type:'image',properties:{name:'Mat Cap Image',width:256,height:256,stream:false},representations:[{src:'/img/3dcgimages/matcap.png?'+Date.now(),isExternal:true,contentType:'image/png',contentEncoding:'identity',width:256,height:256,compression:'zip'}]},{id:'MAT_CAP_TEX',type:'texture2D',properties:{name:'Mat Cap Texture',imageId:'MAT_CAP_IMG',uMapping:'clamp',vMapping:'clamp'}}],ORIGIN_VECTOR={x:0,y:0,z:0},PROJECTION={orthorgraphic:'Orthographic',perspective:'Perspective'},RENDER_MODES={lit:{name:$t('Lit','default_render_mode_lit'),key:'lit',icon:'sprite_preview_17x17_rm_lit',renderMode:'Lit',elQuery:'.rm-lit',el:null},unlit:{name:$t('Unlit','default_render_mode_unlit'),key:'unlit',icon:'sprite_preview_17x17_rm_unlit',renderMode:'Unlit',elQuery:'.rm-unlit',el:null},normals:{name:$t('Normals','default_render_mode_normals'),key:'normals',icon:'sprite_preview_17x17_rm_normals',renderMode:'Normals',elQuery:'.rm-normals',el:null},shape:{name:$t('Shape','default_render_mode_shape'),key:'shape',icon:'sprite_preview_17x17_rm_normals',renderMode:'Shape',elQuery:'.rm-shape',el:null},wireframe:{name:$t('Wireframe','default_render_mode_wireframe'),key:'wireframe',icon:'sprite_preview_17x17_rm_wireframe',renderMode:'Wireframe',elQuery:'.rm-wireframe',el:null},flatwire:{name:$t('Untextured Wireframe','default_render_mode_untextured_wireframe'),key:'flatwire',icon:'sprite_preview_17x17_rm_untexturedwireframe',renderMode:'Untextured Wireframe',elQuery:'.rm-untexturedwireframe',el:null},uv:{name:$t('UV Overlay','default_render_mode_uv'),key:'uv',icon:'sprite_preview_17x17_rm_uvoverlay',renderMode:'UV Overlay',elQuery:'.rm-uvoverlay',el:null}},ROTATION_STEP=90;var assets,axisUp,axisForward,currentAxis='y',box3d,box3dContainerEl,boxSdk,cameraProjectionCurrent,cameraProjectionDefault,cameraProjectionSettingEl,cameraProjectionSettingListEl,dom,fileId,fullscreen,fullscreenEnableEl,fullscreenDisableEl,grid,axisDisplay,instances,isRotating=false,metadataClient,metadataTemplateType,modelInstance,moduleEl,notifications,renderModeCurrent,renderModeDefault,renderModesEl,renderModeMenuItemEl,renderModeIcon,renderModeSettingListEl,renderModeSettingEl,settingsEl,settingsButtonEl,THREE,Box3D;function getScene(){return box3d?box3d.getAssetById('SCENE_ID'):null;}
function getCamera(){return box3d?box3d.getObjectById('CAMERA_ID'):null;}
function getAspect(){var width=moduleEl.clientWidth,height=moduleEl.clientHeight;return width/height;}
function getRenderModeKeyFromValue(renderMode){var filteredModes=Object.keys(RENDER_MODES).filter(function isMatchingRenderMode(key){return RENDER_MODES[key].renderMode===renderMode;});return filteredModes[0];}
function setElementVisibility(el,visible){if(visible){dom.removeClass(el,CLASS_HIDDEN);}else{dom.addClass(el,CLASS_HIDDEN);}}
function toggleElement(el){setElementVisibility(el,dom.hasClass(el,CLASS_HIDDEN));}
function onMetadataSave(){notifications.confirm($t('Successfully saved scene defaults!','box3d_scene_defaults_save_success'));}
function onMetadataFail(){notifications.error($t('Box3D Settings not available. Please reupload model to be able to save scene defaults','box3d_scene_defaults_save_fail'));}
function saveMetadataValue(key,newVal,oldVal){if(!metadataTemplateType){return notifications.error($t('Not able to save scene defaults. Please reupload to allow saving of scene defaults','box3d_no_template_type'));}
if(!metadataClient){metadataClient=context.getService('metadata-client');}
metadataClient.set({itemTypedId:'f_'+fileId,key:key,oldValue:oldVal,value:newVal,type:metadataTemplateType},onMetadataSave,onMetadataFail);}
function saveSceneDefaults(){var menuOpen=true;if(renderModeDefault!==renderModeCurrent){saveMetadataValue('defaultRenderMode',renderModeCurrent,renderModeDefault);renderModeDefault=renderModeCurrent;menuOpen=false;}
if(cameraProjectionDefault!==cameraProjectionCurrent){saveMetadataValue('cameraProjection',cameraProjectionCurrent,cameraProjectionDefault);cameraProjectionDefault=cameraProjectionCurrent;menuOpen=false;}
box3d.trigger('get_axes',function getAxes(axes){if(axes.forward!==axisForward){saveMetadataValue('forwardAxis',axes.forward,axisForward);axisForward=axes.forward;menuOpen=false;}
if(axes.up!==axisUp){saveMetadataValue('upAxis',axes.up,axisUp);axisUp=axes.up;menuOpen=false;}
setElementVisibility(settingsEl,menuOpen);});}
function setRenderMode(mode){if(box3d){Box3D.globalEvents.trigger('setRenderMode',mode.renderMode);}
if(renderModeIcon){renderModeIcon.className=mode.icon;}
dom.addClass(renderModesEl,CLASS_HIDDEN);mode.el=mode.el||dom.query(mode.elQuery);dom.removeClass(renderModeMenuItemEl,CLASS_CURRENT_RENDER_MODE);dom.addClass(mode.el,CLASS_CURRENT_RENDER_MODE);renderModeMenuItemEl=mode.el;}
function setDefaultRenderMode(mode){renderModeCurrent=mode.renderMode;setRenderMode(mode);dom.setHTML(renderModeSettingEl,mode.name);dom.addClass(renderModeSettingListEl,CLASS_HIDDEN);}
function reset(){var camera=getCamera();if(Box3D){setRenderMode(RENDER_MODES[getRenderModeKeyFromValue(renderModeDefault||'Lit')]);}
if(camera){camera.trigger('resetOrbitCameraController');}}
function alignModelToOrigin(){if(!modelInstance){return;}
modelInstance.alignToPosition(ORIGIN_VECTOR,ORIGIN_VECTOR);}
function setAxisRotation(upAxis,forwardAxis,useTransition){if(!box3d){return;}
box3d.trigger('set_axes',upAxis||'+Y',forwardAxis||'+Z',useTransition);alignModelToOrigin();}
function setCurrentRotationAxis(axisKey){currentAxis=axisKey;}
function rotateOnCurrentAxis(direction){if(!modelInstance||!box3d||isRotating){return;}
var axis={};axis[currentAxis]=direction*ROTATION_STEP;box3d.trigger('rotate_on_axis',axis,true);box3d.on('postUpdate',alignModelToOrigin);modelInstance.once('axis_transition_complete',function onAxisTransitionComplete(){box3d.off('postUpdate',alignModelToOrigin);alignModelToOrigin();isRotating=false;});isRotating=true;}
function enableOrthographic(){var camera=getCamera(),aspect;if(camera&&camera.getProperty('cameraType')==='perspective'){aspect=getAspect();camera.setProperties({top:0.5,bottom:-0.5,left:-0.5*aspect,right:0.5*aspect,cameraType:'orthographic'});camera.trigger('resetOrbitCameraController');cameraProjectionCurrent=PROJECTION.orthorgraphic;}
if(cameraProjectionSettingEl){dom.setHTML(cameraProjectionSettingEl,$t('Orthographic Camera','projection_orthographic_camera'));}
if(cameraProjectionSettingListEl){dom.addClass(cameraProjectionSettingListEl,CLASS_HIDDEN);}}
function enablePerspective(){var camera=getCamera();if(camera&&camera.getProperty('cameraType')==='orthographic'){camera.setProperties({aspect:getAspect(),cameraType:'perspective'});camera.trigger('resetOrbitCameraController');cameraProjectionCurrent=PROJECTION.perspective;}
if(cameraProjectionSettingEl){dom.setHTML(cameraProjectionSettingEl,$t('Perspective Camera','projection_perspective_camera'));}
if(cameraProjectionSettingListEl){dom.addClass(cameraProjectionSettingListEl,CLASS_HIDDEN);}}
function resetSettingsPanel(){setAxisRotation(axisUp,axisForward,true);setDefaultRenderMode(RENDER_MODES[getRenderModeKeyFromValue(renderModeDefault||'Lit')]);if(cameraProjectionDefault===PROJECTION.orthorgraphic){enableOrthographic();}else{enablePerspective();}}
function addHelpersToScene(){var scene=getScene().runtimeData;grid=new THREE.GridHelper(5,10,0xaaaaaa,0xaaaaaa);scene.add(grid);grid.visible=false;axisDisplay=new THREE.AxisHelper(5);scene.add(axisDisplay);axisDisplay.visible=false;}
function toggleHelpers(show){var enable=false;if(show!==undefined){enable=!!show;}else{enable=!grid.visible;}
axisDisplay.visible=enable;grid.visible=enable;}
function addInstanceToScene(prefab,scene,callback){var instance=scene.createInstance(prefab);if(instance){instances.push(instance);instance.scaleToSize(1);instance.alignToPosition(ORIGIN_VECTOR,ORIGIN_VECTOR);if(callback){callback(instance);}
instance.componentRegistry.add('preview_axis_rotation',{},'axis_rotation_'+instance.id);scene.getRootObject().addChild(instance);modelInstance=instance;}}
function hideBox3d(){box3d.trigger('update');box3d.trigger('render');if(box3d.container){box3d.container.removeChild(box3d.canvas);box3d.container=null;}
box3d.pause();}
function showBox3d(){if(box3d){if(!box3d.container){box3d.container=box3dContainerEl;box3d.container.appendChild(box3d.canvas);}
box3d.unpause();}}
function playVideos(){if(!box3d){return;}
var videos=box3d.getAssetsByType('video');videos.forEach(function(video){video.when('load',function(){video.play();});});}
function finishLoadingScene(){var scene=getScene();if(!scene){return;}
scene.once('load',function sceneLoadCallback(){if(box3d){reset();setAxisRotation(axisUp,axisForward,false);playVideos();context.broadcast('previewloaded',{contentType:'3DCG'});}});}
function addIblToMaterials(){var materials=box3d.getAssetsByType('material');materials.forEach(function(material){material.setProperty('envMapRadiance','HDR_ENV_MAP_CUBE_0');material.setProperty('envMapRadianceHalfGloss','HDR_ENV_MAP_CUBE_1');material.setProperty('envMapIrradiance','HDR_ENV_MAP_CUBE_2');});}
function createPrefabInstances(entities){var prefabEntity;var geometryEntity;if(!box3d){return;}
entities.forEach(function checkForPrefab(entityDesc){if(entityDesc.type==='prefab'){prefabEntity=entityDesc;}else if(entityDesc.type==='meshGeometry'){geometryEntity=entityDesc;}});addIblToMaterials();var renderModes=box3d.getApplication().componentRegistry.getFirstByScriptId('render_modes');renderModes.setAttribute('shapeTexture','MAT_CAP_TEX');if(prefabEntity&&geometryEntity){var prefabAsset=box3d.getAssetById(prefabEntity.id);var geometryAsset=box3d.getAssetById(geometryEntity.id);geometryAsset.once('load',function(){addInstanceToScene(prefabAsset,getScene(),finishLoadingScene);},this);geometryAsset.load();}else{finishLoadingScene();}
addHelpersToScene();entities.forEach(function addAssetsForCleanup(entity){var asset=box3d.getAssetById(entity.id);if(asset){assets.push(asset);}});}
function onUnsupportedRepresentation(){notifications.error($t('This preview needs to be re-generated. To preview, reupload this file.','preview_out_of_date'));}
function loadBox3dFile(fileUrl){var loader=new Box3D.JSONLoader(box3d);loader.loadFromUrl(fileUrl).then(function(entities){createPrefabInstances(entities);},onUnsupportedRepresentation);}
function createBox3d(resourceLoader,callback){box3d=new Box3D.Engine();box3d.initialize({engineName:'Default',entities:DEFAULT_SCENE_LIST,resourceLoader:resourceLoader,container:box3dContainerEl},function loadApp(){var app=box3d.getAssetById('APP_ASSET_ID');app.load(callback);});}
function initBox3d(box3dJs,fileVersionId,sharedName,callback){var assetsService=context.getService('assets'),cache=context.getService('preview-cache');assetsService.loadJSByHash(box3dJs,function initRuntime(){var Box3DResourceLoader,BoxSDK,resourceLoader;Box3D=context.getGlobal('Box3D');THREE=context.getGlobal('THREE');Box3DResourceLoader=context.getGlobal('Box3DResourceLoader');BoxSDK=context.getGlobal('BoxSDK');if(!Box3D||!THREE||!Box3DResourceLoader||!BoxSDK){callback();return;}
boxSdk=new BoxSDK({apiBase:'',sharedName:sharedName?sharedName:undefined});resourceLoader=new Box3DResourceLoader(boxSdk);box3d=cache.recall('box3d');if(box3d){box3d.resourceLoader=resourceLoader;callback();return;}
createBox3d(resourceLoader,function cacheRuntime(){cache.memorize('box3d',box3d);callback();});});}
function cleanupScene(){var scene=getScene().runtimeData;if(grid){scene.remove(grid);grid.material.dispose();grid.geometry.dispose();grid=null;}
if(axisDisplay){scene.remove(axisDisplay);axisDisplay.material.dispose();axisDisplay.geometry.dispose();axisDisplay=null;}
instances.forEach(function removeInstance(instance){instance.destroy();});assets.forEach(function detroyPrefabAsset(asset){asset.destroy();});instances.length=0;assets.length=0;}
function cleanupIblMaps(){if(!box3d){return;}
var maps=[];maps.push(box3d.getEntityById('HDR_ENV_MAP_CUBE_0'));maps.push(box3d.getEntityById('HDR_ENV_MAP_CUBE_1'));maps.push(box3d.getEntityById('HDR_ENV_MAP_CUBE_2'));maps.push(box3d.getEntityById('HDR_ENV_MAP_0'));maps.push(box3d.getEntityById('HDR_ENV_MAP_1'));maps.push(box3d.getEntityById('HDR_ENV_MAP_2'));maps.push(box3d.getEntityById('HDR_ENV_IMG_0'));maps.push(box3d.getEntityById('HDR_ENV_IMG_1'));maps.push(box3d.getEntityById('HDR_ENV_IMG_2'));maps.forEach(function unloadHdrMap(map){if(map){map.unload();}});}
function resizeView(){var width,height;if(box3d){width=moduleEl.clientWidth;height=moduleEl.clientHeight;box3dContainerEl.style.width=width+'px';box3dContainerEl.style.height=height+'px';box3d.trigger('resize');box3d.needsRender=true;}}
function onFullscreenExit(){fullscreen.off('exit',onFullscreenExit);setElementVisibility(fullscreenEnableEl,true);setElementVisibility(fullscreenDisableEl,false);}
function toggleFullScreen(){var isFullscreen=fullscreen.isFullScreen();if(isFullscreen){fullscreen.exit();}else{fullscreen.enter();fullscreen.on('exit',onFullscreenExit);}
setElementVisibility(fullscreenEnableEl,isFullscreen);setElementVisibility(fullscreenDisableEl,!isFullscreen);}
function hideSettingsButton(){if(!settingsButtonEl){settingsButtonEl=dom.query('.preview-settings-wrapper',moduleEl);}
setElementVisibility(settingsButtonEl,false);}
return{messages:['previewresized','embedwidgetevent','togglefullscreen'],onmessage:function(name,data){if(name==='previewresized'){resizeView();}else if(name==='togglefullscreen'){toggleFullScreen();}else if(name==='embedwidgetevent'){if(data.type==='reset'){reset();}}},init:function(){var box3dJs=context.getConfig('box3dJs'),fileUrl=context.getConfig('fileUrl'),fileVersionId=context.getConfig('fileVersionId'),sharedName=context.getConfig('sharedName'),metadata=context.getConfig('metadata'),permissions=context.getConfig('permissions')||{};dom=context.getService('dom');fullscreen=context.getService('fullscreen');notifications=context.getService('notifications');fileId=context.getConfig('fileId');moduleEl=context.getElement();box3dContainerEl=dom.query('.box3d-container',moduleEl);fullscreenEnableEl=dom.query('.controls-fullscreen',moduleEl);fullscreenDisableEl=dom.query('.controls-minimize',moduleEl);settingsEl=dom.query('.settings-panel',moduleEl);renderModesEl=dom.query('.render-mode-selector',moduleEl);renderModeIcon=dom.query('.sprite_preview_17x17_rendermodes',moduleEl);renderModeMenuItemEl=dom.query(CLASS_CURRENT_RENDER_MODE,moduleEl);renderModeSettingListEl=dom.query('.render-mode-list',moduleEl);renderModeSettingEl=dom.query('.render-mode-selected',moduleEl);cameraProjectionSettingListEl=dom.query('.camera-projection-list',moduleEl);cameraProjectionSettingEl=dom.query('.camera-projection-selected',moduleEl);if(!permissions.delete||!permissions.upload){var settingsPanelEl=dom.query('.settings-panel',moduleEl);var saveButtonEl=dom.query('.save-btn',settingsPanelEl);setElementVisibility(saveButtonEl,false);}
box3d=null;instances=[];assets=[];if(!metadata){hideSettingsButton();}else{axisUp=metadata.axisUp;axisForward=metadata.axisForward;renderModeDefault=metadata.defaultRenderMode;cameraProjectionDefault=metadata.cameraProjection;metadataTemplateType=metadata.templateType;renderModeCurrent=renderModeDefault||'Lit';cameraProjectionCurrent=cameraProjectionDefault||'Perspective';var renderModeKey=getRenderModeKeyFromValue(renderModeCurrent);setRenderMode(RENDER_MODES[renderModeKey]);if(renderModeSettingEl){dom.setHTML(renderModeSettingEl,renderModeCurrent);}}
initBox3d(box3dJs,fileVersionId,sharedName,function initScene(){if(!box3d){notifications.error($t('Sorry, we were unable to preview this file.','unable_to_preview_file'));return;}
showBox3d();if(cameraProjectionDefault===PROJECTION.orthorgraphic){enableOrthographic();}else{enablePerspective();}
loadBox3dFile(fileUrl);});},destroy:function(){if(!box3d){return;}
hideBox3d();cleanupScene();cleanupIblMaps();if(box3d.resourceLoader){box3d.resourceLoader.destroy();box3d.resourceLoader=null;}
if(boxSdk){boxSdk.destroy();boxSdk=null;}
box3d=null;modelInstance=null;isRotating=false;},onclick:function(event,element,elementType){if(!element||!elementType||element.disabled){return;}
switch(elementType){case'3dcgcanvascontainer':setElementVisibility(renderModesEl,false);setElementVisibility(settingsEl,false);toggleHelpers(false);break;case'enterfullscreen':case'exitfullscreen':toggleFullScreen();break;case'rendermodelit':setRenderMode(RENDER_MODES.lit);break;case'rendermodeunlit':setRenderMode(RENDER_MODES.unlit);break;case'rendermodenormals':setRenderMode(RENDER_MODES.normals);break;case'rendermodeshape':setRenderMode(RENDER_MODES.shape);break;case'rendermodewireframe':setRenderMode(RENDER_MODES.wireframe);break;case'rendermodeuntexturedwireframe':setRenderMode(RENDER_MODES.flatwire);break;case'rendermodeuvoverlay':setRenderMode(RENDER_MODES.uv);break;case'rendermodes':toggleElement(renderModesEl);setElementVisibility(settingsEl,false);toggleHelpers(false);break;case'settingspanel':setElementVisibility(renderModesEl,false);setElementVisibility(renderModeSettingListEl,false);setElementVisibility(cameraProjectionSettingListEl,false);toggleElement(settingsEl);toggleHelpers();break;case'rotatenegativex':setCurrentRotationAxis('x');rotateOnCurrentAxis(-1);break;case'rotatepositivex':setCurrentRotationAxis('x');rotateOnCurrentAxis(1);break;case'rotatenegativey':setCurrentRotationAxis('y');rotateOnCurrentAxis(-1);break;case'rotatepositivey':setCurrentRotationAxis('y');rotateOnCurrentAxis(1);break;case'rotatenegativez':setCurrentRotationAxis('z');rotateOnCurrentAxis(1);break;case'rotatepositivez':setCurrentRotationAxis('z');rotateOnCurrentAxis(-1);break;case'reset':reset();break;case'defaultrendermodeselector':toggleElement(renderModeSettingListEl);break;case'defaultrendermodelit':setDefaultRenderMode(RENDER_MODES.lit);break;case'defaultrendermodeunlit':setDefaultRenderMode(RENDER_MODES.unlit);break;case'defaultrendermodenormals':setDefaultRenderMode(RENDER_MODES.normals);break;case'defaultrendermodeshape':setDefaultRenderMode(RENDER_MODES.shape);break;case'defaultrendermodewireframe':setDefaultRenderMode(RENDER_MODES.wireframe);break;case'defaultrendermodewireframeflat':setDefaultRenderMode(RENDER_MODES.flatwire);break;case'defaultrendermodeuv':setDefaultRenderMode(RENDER_MODES.uv);break;case'cameraprojectionselector':toggleElement(cameraProjectionSettingListEl);break;case'perspectivecamera':enablePerspective();break;case'orthographiccamera':enableOrthographic();break;case'setting-save':saveSceneDefaults();break;case'setting-reset':resetSettingsPanel();break;}}};});Box.Application.addModule('preview-dash',function(context){'use strict';var VOLUME_LEVEL_CLASS_NAMES=['preview-dash-volume-icon-mute','preview-dash-volume-icon-low','preview-dash-volume-icon-medium','preview-dash-volume-icon-high'],SHOW_CONTROLS_CLASS='box-preview-media-controls-is-visible',MOUSE_MOVE_TIMEOUT_IN_MILLIS=1000,CONTROLS_AUTO_HIDE_TIMEOUT_IN_MILLIS=3000,SEGMENT_SIZE=5,MAX_BUFFER=SEGMENT_SIZE*12;var shaka,player,videoEl,moduleEl,controlsEl,durationEl,timeCodeEl,filmstripTimeCodeEl,timeScrubberEl,volumeScrubberEl,filmstripEl,volumeBtnLvlEl,timeScrubber,volumeScrubber,scrubberService,cacheService,hotkeysService,autoHideTimeout,dom,funcUtils,fullscreen,mpdUrl,bufferedValue,videoHeight,videoWidth,bandwidth,mousemoveHandler,errorTimeout,aspect=16/9,isScrubbing=false,videoPreInitialized=false,videoInitialized=false,convertedFragmentIndex=-1,largestRepresentationId,allowedBuffer=SEGMENT_SIZE;function hide(){if(videoInitialized){moduleEl.classList.remove(SHOW_CONTROLS_CLASS);}}
function show(){if(!videoInitialized){return;}
moduleEl.classList.add(SHOW_CONTROLS_CLASS);clearTimeout(autoHideTimeout);autoHideTimeout=setTimeout(function(){hide();},CONTROLS_AUTO_HIDE_TIMEOUT_IN_MILLIS);}
function attachMouseMoveHandler(){if(!mousemoveHandler){mousemoveHandler=funcUtils.throttle(function(){show();},MOUSE_MOVE_TIMEOUT_IN_MILLIS);videoEl.addEventListener('mousemove',mousemoveHandler);}}
function formatTime(seconds){var h=Math.floor(seconds/3600);var m=Math.floor((seconds%3600)/60);var s=Math.floor((seconds%3600)%60);return(h>0?h.toString()+':':'')+(m<10?'0'+m.toString():m.toString())+':'+(s<10?'0'+s.toString():s.toString());}
function setDuration(time){durationEl.textContent=formatTime(time||0);}
function setTimeCode(time){timeCodeEl.textContent=formatTime(time||0);}
function timeupdateHandler(){var currentTime=videoEl.currentTime||0,duration=videoEl.duration,currentPos=duration?(currentTime/duration):0;setTimeCode(currentTime);timeScrubber.setValue(currentPos);}
function calculateVideoDimensions(){var videoTracks=player.getVideoTracks();if(videoTracks.length){var potentiallyCachedHDVideos=cacheService.recall('potentiallyCachedHDVideos')||{},currentFile=cacheService.recall('currentFile'),largestRepresentation=videoTracks.reduce(function(a,b){return a.width>b.width?a:b;});videoWidth=largestRepresentation.width;videoHeight=largestRepresentation.height;aspect=videoWidth/videoHeight;bandwidth=largestRepresentation.bandwidth;largestRepresentationId=largestRepresentation.id;if(potentiallyCachedHDVideos[currentFile.versionId]){player.configure({enableAdaptation:false});player.selectVideoTrack(largestRepresentationId);}}}
function resizeVideo(){if(!videoPreInitialized){return;}
var width=videoWidth||0,height=videoHeight||0,percentIncreaseInHeightToFitViewport,percentIncreaseInWidthToFitViewport,newWidthIfHeightUsed,newHeightIfWidthUsed,viewport=moduleEl.getBoundingClientRect();if(width<420){width=420;height=width/aspect;}
videoEl.style.width='';videoEl.style.height='';if(fullscreen.isFullScreen()){if(aspect>=1){videoEl.style.width=moduleEl.clientWidth+'px';}else{videoEl.style.height=moduleEl.clientHeight+'px';}}else if(width<=viewport.width&&height<=viewport.height){if(aspect>=1){videoEl.style.width=width+'px';}else{videoEl.style.height=height+'px';}}else{percentIncreaseInHeightToFitViewport=(viewport.height-height)/height;newWidthIfHeightUsed=width+(width*percentIncreaseInHeightToFitViewport);percentIncreaseInWidthToFitViewport=(viewport.width-width)/width;newHeightIfWidthUsed=height+(height*percentIncreaseInWidthToFitViewport);if(newHeightIfWidthUsed<=viewport.height){videoEl.style.width=viewport.width+'px';}else if(newWidthIfHeightUsed<=viewport.width){videoEl.style.height=viewport.height+'px';}}
controlsEl.style.width=videoEl.getBoundingClientRect().width+'px';}
function getVolumeLvlClassName(volume){return VOLUME_LEVEL_CLASS_NAMES[Math.ceil(volume*3)];}
function volumeSliderHandler(){var vol=volumeScrubber.getValue();cacheService.memorize('lastUnmutedVolume',vol||0.7);videoEl.volume=vol;dom.removeClass(volumeBtnLvlEl,VOLUME_LEVEL_CLASS_NAMES.join(' '));dom.addClass(volumeBtnLvlEl,getVolumeLvlClassName(vol));}
function timeSliderHandler(){videoEl.removeEventListener('timeupdate',timeupdateHandler);videoEl.currentTime=(timeScrubber.getValue()||0)*videoEl.duration;videoEl.addEventListener('timeupdate',timeupdateHandler);}
function filmstripShowHandler(event){var minLeft,maxLeft,rect=videoEl.getBoundingClientRect(),pageX=event.pageX,time=(pageX-rect.left)*videoEl.duration/rect.width,frame=Math.floor(time),frameWidth=filmstripEl.naturalWidth/100,left=-1*(frame%100)*frameWidth,top=-90*Math.floor((frame/100));if(!moduleEl.dataset.filmstripState){left=0;top=0;frameWidth=160;}
minLeft=Math.max(0,pageX-rect.left-(frameWidth/2));maxLeft=Math.min(minLeft,rect.width-frameWidth);filmstripEl.style.left=left+'px';filmstripEl.style.top=top+'px';filmstripEl.parentNode.style.display='block';filmstripEl.parentNode.style.left=maxLeft+'px';filmstripTimeCodeEl.textContent=formatTime(time);}
function filmstripHideHandler(){if(!isScrubbing){filmstripEl.parentNode.style.display='none';}}
function timeScrubbingStopHandler(event){isScrubbing=false;document.removeEventListener('mouseup',timeScrubbingStopHandler);document.removeEventListener('mousemove',filmstripShowHandler);if(!timeScrubberEl.contains(event.target)){filmstripEl.parentNode.style.display='none';}}
function timeScrubbingStartHandler(){isScrubbing=true;document.addEventListener('mouseup',timeScrubbingStopHandler);document.addEventListener('mousemove',filmstripShowHandler);}
function toggleHD(method,adaptation){if(method==='manual'){player.configure({enableAdaptation:false});var potentiallyCachedHDVideos=cacheService.recall('potentiallyCachedHDVideos')||{},currentFile=cacheService.recall('currentFile');if(moduleEl.classList.contains('is-hd')){player.selectVideoTrack(largestRepresentationId+1);delete potentiallyCachedHDVideos[currentFile.versionId];}else{player.selectVideoTrack(largestRepresentationId);potentiallyCachedHDVideos[currentFile.versionId]=true;}
cacheService.memorize('potentiallyCachedHDVideos',potentiallyCachedHDVideos);}else if(method==='auto'&&adaptation.contentType==='video'){if(adaptation.bandwidth===bandwidth){moduleEl.classList.add('is-hd');}else{moduleEl.classList.remove('is-hd');}}}
function playingHandler(){moduleEl.classList.add('is-playing');}
function pauseHandler(){moduleEl.classList.remove('is-playing');}
function togglePlayback(){if(moduleEl.classList.contains('is-playing')){videoEl.pause();}else{videoEl.play();}}
function endedHandler(){pauseHandler();setTimeCode(0);timeScrubber.setValue(0);}
function toggleMute(){if(moduleEl.classList.contains('is-muted')){var vol=cacheService.recall('lastUnmutedVolume');moduleEl.classList.remove('is-muted');volumeScrubber.setValue(vol);videoEl.volume=vol;dom.removeClass(volumeBtnLvlEl,VOLUME_LEVEL_CLASS_NAMES.join(' '));dom.addClass(volumeBtnLvlEl,getVolumeLvlClassName(vol));}else{moduleEl.classList.add('is-muted');volumeScrubber.setValue(0);videoEl.volume=0;dom.removeClass(volumeBtnLvlEl,VOLUME_LEVEL_CLASS_NAMES.join(' '));dom.addClass(volumeBtnLvlEl,'preview-dash-volume-icon-mute');}}
function toggleFullscreen(){if(fullscreen.isFullScreen()){fullscreen.exit();}else{fullscreen.enter();}}
function setFilmstrip(){var filmstripUrl='/representation/file_version_'+moduleEl.dataset.fileVersion+'/filmstrip.jpg';if(moduleEl.dataset.sharedName){filmstripUrl=filmstripUrl+'?'+'shared_name='+moduleEl.dataset.sharedName;}
filmstripEl.src=filmstripUrl;}
function initFilmstrip(){var filmstripContainer,frameWidth=90*aspect;filmstripContainer=filmstripEl.parentNode;timeScrubber.getScrubberHandleEl().addEventListener('mousedown',timeScrubbingStartHandler);timeScrubber.getConvertedBarEl().addEventListener('mousemove',filmstripShowHandler);timeScrubber.getConvertedBarEl().addEventListener('mouseleave',filmstripHideHandler);filmstripEl.onload=function(){filmstripContainer.style.width=frameWidth+2+'px';};if(moduleEl.dataset.filmstripState){setFilmstrip();}else{filmstripContainer.style.width='162px';}}
function calculateTimeScrubberValue(){var lastAvailableFragment=convertedFragmentIndex||-1;if(moduleEl.dataset.state==='done'){return 1;}else if(moduleEl.dataset.state==='stream'&&lastAvailableFragment<0){return 0;}
return lastAvailableFragment*SEGMENT_SIZE/videoEl.duration;}
function initControls(){timeScrubber=scrubberService.create(timeScrubberEl,0,0,calculateTimeScrubberValue(),$t('Duration Slider','preview_dash_time_slider'));timeScrubber.on('slide',timeSliderHandler);volumeScrubber=scrubberService.create(volumeScrubberEl,cacheService.recall('lastUnmutedVolume'),1,1,$t('Volume Slider','preview_dash_volume_slider'));volumeScrubber.on('slide',volumeSliderHandler);setDuration(videoEl.duration);controlsEl.style.width=videoEl.getBoundingClientRect().width+'px';attachMouseMoveHandler();}
function setHotkeys(){hotkeysService.setConfig([{key:'space',handler:togglePlayback},{key:'f',handler:toggleFullscreen}],'preview');}
function loadedmetadataHandler(){if(!videoInitialized){calculateVideoDimensions();initControls();setHotkeys();resizeVideo();initFilmstrip();moduleEl.classList.remove('invisible');context.broadcast('previewloaded',{contentType:'video'});videoInitialized=true;}}
function progressHandler(){var newBufferedValue,buffered=videoEl.buffered,bufferedLength=buffered.length;bufferedValue=bufferedValue||0;newBufferedValue=bufferedLength?buffered.end(bufferedLength-1):0;bufferedValue=Math.max(bufferedValue,newBufferedValue);timeScrubber.setBufferedValue(bufferedValue/videoEl.duration);}
function updateConvertBuffer(value){convertedFragmentIndex=value||-1;if(timeScrubber){timeScrubber.setConvertedValue(calculateTimeScrubberValue());}
allowedBuffer=Math.min(MAX_BUFFER,Math.max(allowedBuffer,convertedFragmentIndex*SEGMENT_SIZE));player.configure({'streamBufferSize':allowedBuffer});}
function requestInterceptor(){var query;if(moduleEl.dataset.sharedName){query='shared_name='+moduleEl.dataset.sharedName;}
return function(url){return(!query||url.indexOf(query)>-1)?url:url+'?'+query;};}
function initPlayer(){clearTimeout(errorTimeout);var estimator,source,interceptor=requestInterceptor();if(videoPreInitialized){return;}
player=new shaka.player.Player(videoEl);player.addEventListener('adaptation',function(adaptation){toggleHD('auto',adaptation);});videoEl.addEventListener('loadedmetadata',loadedmetadataHandler);videoEl.addEventListener('progress',progressHandler);videoEl.addEventListener('timeupdate',timeupdateHandler);videoEl.addEventListener('ended',endedHandler);videoEl.addEventListener('playing',playingHandler);videoEl.addEventListener('pause',pauseHandler);mpdUrl='/representation/file_version_'+moduleEl.dataset.fileVersion+'/dash/manifest.mpd';estimator=new shaka.util.EWMABandwidthEstimator();estimator.supportsCaching=function(){return true;};source=new shaka.player.DashVideoSource(mpdUrl,null,estimator);source.setNetworkCallback(interceptor);player.configure({streamBufferSize:allowedBuffer,enableAdaptation:true});player.load(source);cacheService.memorize('lastUnmutedVolume',cacheService.recall('lastUnmutedVolume')||0.7);videoPreInitialized=true;}
function preInitPlayer(){errorTimeout=setTimeout(function(){context.broadcast('previewcontentreload');},20000);shaka=context.getGlobal('shaka');scrubberService=context.getService('scrubber');cacheService=context.getService('preview-cache');dom=context.getService('dom');fullscreen=context.getService('fullscreen');hotkeysService=context.getService('hotkeys');funcUtils=context.getService('function-utils');moduleEl=context.getElement();controlsEl=dom.query('.preview-dash-controls-wrapper',moduleEl);durationEl=dom.query('.preview-dash-display-duration',controlsEl);timeCodeEl=dom.query('.preview-dash-display-timecode',controlsEl);timeScrubberEl=dom.query('.preview-dash-time-scrubber',controlsEl);volumeScrubberEl=dom.query('.preview-dash-volume-scrubber',controlsEl);volumeBtnLvlEl=dom.query('.preview-dash-volume-level',controlsEl);filmstripEl=dom.query('.preview-dash-filmstrip-image',moduleEl);filmstripTimeCodeEl=dom.query('.preview-dash-filmstrip-timecode',moduleEl);videoEl=dom.query('video',moduleEl);shaka.polyfill.installAll();var state=moduleEl.dataset.state;if(state==='done'){allowedBuffer=MAX_BUFFER;initPlayer();}else if(state==='stream'){initPlayer();}}
return{messages:['previewresized','previewprogress'],init:function(){var dashPlayerJS=context.getConfig('dashPlayerJS');var assetsService=context.getService('assets');assetsService.loadJSByHash(dashPlayerJS,preInitPlayer);},destroy:function(){videoInitialized=false;videoPreInitialized=false;videoEl.removeAttribute('src');videoEl.removeEventListener('timeupdate',timeupdateHandler);videoEl.removeEventListener('loadedmetadata',loadedmetadataHandler);videoEl.removeEventListener('progress',progressHandler);videoEl.removeEventListener('ended',endedHandler);videoEl.removeEventListener('playing',playingHandler);videoEl.removeEventListener('pause',pauseHandler);videoEl.removeEventListener('mousemove',mousemoveHandler);document.removeEventListener('mouseup',timeScrubbingStopHandler);document.removeEventListener('mousemove',filmstripShowHandler);if(timeScrubber){timeScrubber.getScrubberHandleEl().removeEventListener('mousedown',timeScrubbingStartHandler);timeScrubber.getConvertedBarEl().removeEventListener('mousemove',filmstripShowHandler);timeScrubber.getConvertedBarEl().removeEventListener('mouseleave',filmstripHideHandler);timeScrubber.off('slide',timeSliderHandler);scrubberService.destroy(timeScrubber);}
if(volumeScrubber){volumeScrubber.off('slide',volumeSliderHandler);scrubberService.destroy(volumeScrubber);}
if(player){player.destroy();}
if(videoEl.parentElement){videoEl.parentElement.removeChild(videoEl);}
context.broadcast('previewcontentunload');},onmessage:function(name,data){if(name==='previewresized'){resizeVideo();}else if(name==='previewprogress'){if(data.kind==='dash'){if(data.status==='success'||(data.status==='pending'&&data.dash_mpd!==0&&data.last_page>=1)){initPlayer();updateConvertBuffer(data.last_page);}}else if(data.kind==='filmstrip'&&data.status==='success'){moduleEl.dataset.filmstripState='1';setFilmstrip();}}},onclick:function(event,element,elementType){if(!element||!elementType||element.disabled){return;}
switch(elementType){case'play':videoEl.play();break;case'pause':videoEl.pause();break;case'toggle-mute':toggleMute();break;case'toggle-fullscreen':toggleFullscreen();break;case'toggle-hd':toggleHD('manual');break;case'toggle-playback':if(videoEl.paused){videoEl.play();}else{videoEl.pause();}
break;}}};});Box.Application.addModule('preview-iframe',function(context){'use strict';var config,$element,$iframe;return{init:function(){config=context.getConfig();$element=$(context.getElement());$iframe=$element.find('.preview-iframe');if(config.add_class){$iframe.addClass(config.add_class);}
$iframe[0].setAttribute('src',config.note_url);context.broadcast('previewloaded',{contentType:'iframe'});}};});Box.Application.addModule('preview-swf',function(context){'use strict';return{init:function(){var browserService=context.getService('browser'),swfobject=context.getGlobal('swfobject'),moduleEl=context.getElement(),url=moduleEl.getAttribute('data-url'),swfParams={allowfullscreen:'true',allowFullScreen:'true',allownetworking:'none',allowNetworking:'none',allowscriptaccess:'never',allowScriptAccess:'never',wmode:'transparent'},objectParams={'class':' preview-flash-content'};swfobject.embedSWF(url,'flash-player','100%','100%',browserService.getMinimumFlashVersion(),null,null,swfParams,objectParams,function(){context.broadcast('previewloaded',{contentType:'swf'});});}};});Box.Application.addModule('preview-image',function(context){'use strict';var CSS_CLASS_ZOOMABLE='zoomable',CSS_CLASS_PANNABLE='pannable',CSS_CLASS_PANNING='panning',PREVIEW='preview';var moduleEl,imageElement,images,imageTag,wrapperElement,currentRotationAngle=0,isZoomable=true,isPannable=false,isPanning=false,didPan=false,panStartX,panStartY,panStartScrollLeft,panStartScrollTop,fullscreen,dom,browser,hotkeysService,tooltipsService,imageLoaded=false,isPanAndZoomAllowed=true;function updateCursor(){if(isPannable){dom.addClass(imageElement,CSS_CLASS_PANNABLE);isZoomable=false;dom.removeClass(imageElement,CSS_CLASS_ZOOMABLE);}else{dom.removeClass(imageElement,CSS_CLASS_PANNABLE);isZoomable=true;dom.addClass(imageElement,CSS_CLASS_ZOOMABLE);}}
function updatePannability(){var imageDimensions=dom.getBoundingClientRect(imageElement),viewportDimensions=dom.getBoundingClientRect(wrapperElement);isPannable=imageDimensions.width>viewportDimensions.width||imageDimensions.height>viewportDimensions.height;didPan=false;if(imageDimensions.height>viewportDimensions.height){context.broadcast('previewcontentresized',{isScrollbarVisible:true});}else{context.broadcast('previewcontentresized',{isScrollbarVisible:false});}
updateCursor();}
function zoom(type){if(!imageLoaded){return;}
var temp,ratio=1,newWidth,newHeight,newMarginLeft,newMarginTop,viewport,widthDifference,heightDifference,overflowingWidth,overflowingHeight,modifyWidthInsteadOfHeight,isRotated=Math.abs(currentRotationAngle)%180===90,isMultipageTif=imageTag!=='IMG',imageCurrentDimensions=dom.getBoundingClientRect(imageElement),wrapperCurrentDimensions=dom.getBoundingClientRect(wrapperElement),width=imageCurrentDimensions.width,height=imageCurrentDimensions.height,aspect=width/height;modifyWidthInsteadOfHeight=aspect>=1||isMultipageTif;viewport={width:wrapperCurrentDimensions.width-(isMultipageTif?0:15),height:wrapperCurrentDimensions.height-(isMultipageTif?0:15)};switch(type){case'in':if(modifyWidthInsteadOfHeight){newWidth=width+100;}else{newHeight=height+100;}
break;case'out':if(modifyWidthInsteadOfHeight){newWidth=width-100;}else{newHeight=height-100;}
break;case'reset':imageElement.style.width='';imageElement.style.height='';zoom();return;default:if(width>viewport.width||height>viewport.height){ratio=Math.min(viewport.width/width,viewport.height/height);if(modifyWidthInsteadOfHeight){newWidth=width*ratio;}else{newHeight=height*ratio;}}else{var originalWidth=isRotated?imageElement.naturalHeight:imageElement.naturalWidth,originalHeight=isRotated?imageElement.naturalWidth:imageElement.naturalHeight;if(modifyWidthInsteadOfHeight){newWidth=Math.min(viewport.width,originalWidth);}else{newHeight=Math.min(viewport.height,originalHeight);}}}
if(isRotated){temp=newWidth;newWidth=newHeight;newHeight=temp;}
imageElement.style.width=newWidth?newWidth+'px':'';imageElement.style.height=newHeight?newHeight+'px':'';wrapperElement.scrollLeft=(wrapperElement.scrollWidth-viewport.width)/2;if(!isMultipageTif){wrapperElement.scrollTop=(wrapperElement.scrollHeight-viewport.height)/2;}
setTimeout(updatePannability,50);}
function pan(event){if(!isPanning){return;}
var offsetX=event.clientX-panStartX,offsetY=event.clientY-panStartY;wrapperElement.scrollLeft=panStartScrollLeft-offsetX;wrapperElement.scrollTop=panStartScrollTop-offsetY;didPan=true;}
function stopPanning(){isPanning=false;dom.off(document.body,'mousemove',pan);dom.off(document.body,'mouseup',stopPanning);dom.removeClass(imageElement,CSS_CLASS_PANNING);}
function startPanning(x,y){if(!isPannable){return;}
panStartX=x;panStartY=y;panStartScrollLeft=wrapperElement.scrollLeft;panStartScrollTop=wrapperElement.scrollTop;isPanning=true;dom.on(document.body,'mousemove',pan);dom.on(document.body,'mouseup',stopPanning);dom.addClass(imageElement,CSS_CLASS_PANNING);}
function elementToUseForImage(){return imageTag==='IMG'?imageElement:(imageElement.firstElementChild||imageElement.children[0]);}
function handleDragging(){return false;}
function disableButtons(){var message,button=dom.query('.preview-controls-btn-rotate-left');if(!browser.isTransformSupported()){message=$t('Your browser does not support rotation','preview_rotate_not_supported');}else if(imageTag!=='IMG'){message=$t('This file type does not support rotation','preview_file_rotate_not_supported');}
if(message&&button){dom.addClass(button,'disabled');button.setAttribute('aria-label',message);button.setAttribute('data-hover','tooltip');button.setAttribute('disabled','disabled');}}
function setHotkeys(){var config=[{key:'down',handler:function(){wrapperElement.scrollTop+=80;}},{key:'up',handler:function(){wrapperElement.scrollTop-=80;}},{key:'[',handler:function(){wrapperElement.scrollTop-=window.innerHeight/2;}},{key:']',handler:function(){wrapperElement.scrollTop+=window.innerHeight/2;}},{key:'f',handler:function(){if(!(browser.isIE()&&browser.isMinBrowser('explorer','11'))){if(fullscreen.isFullScreen()){fullscreen.exit();}else{fullscreen.enter();}}}}];if(isPanAndZoomAllowed){config=config.concat([{key:'shift+=',handler:function(){zoom('in');}},{key:'shift+-',handler:function(){zoom('out');}}]);}
hotkeysService.setConfig(config,PREVIEW);}
function handleRotateLeft(){if(imageTag==='IMG'){var angle=currentRotationAngle-90;currentRotationAngle=(angle===-3600)?0:angle;$(imageElement).css('transform','rotate('+currentRotationAngle+'deg)');}}
function handleImageLoad(){imageLoaded=true;context.broadcast('previewloaded',{contentType:'image'});images=dom.queryAll('img',wrapperElement);dom.on(images,'dragstart',handleDragging);zoom();dom.removeClass(moduleEl,'invisible');setHotkeys();}
return{messages:['previewresized'],behaviors:['preview-controls'],onmessage:function(name){if(name==='previewresized'){zoom();}},init:function(){var imgToUse;dom=context.getService('dom');browser=context.getService('browser');hotkeysService=context.getService('hotkeys');tooltipsService=context.getService('tooltips-amsterdam');fullscreen=context.getService('fullscreen');moduleEl=context.getElement();imageElement=moduleEl.querySelector('.preview-image-wrapper')||moduleEl.querySelector('.preview-image-content');wrapperElement=imageElement.parentNode;imageTag=imageElement.tagName;imgToUse=elementToUseForImage();isPanAndZoomAllowed=moduleEl.getAttribute('data-pan-and-zoom-allowed')!=='false';if(imgToUse.complete){handleImageLoad();}else{imgToUse.onload=handleImageLoad;}
disableButtons();},destroy:function(){hotkeysService.unsetHotkeyForConfig('down',PREVIEW);hotkeysService.unsetHotkeyForConfig('up',PREVIEW);hotkeysService.unsetHotkeyForConfig('[',PREVIEW);hotkeysService.unsetHotkeyForConfig(']',PREVIEW);dom.off(images,'dragstart',handleDragging);},onmousedown:function(event,targetElement,elementType){if(elementType==='preview-image'){if(!isPanAndZoomAllowed){return;}
didPan=false;if((typeof event.button!=='number'||event.button<2)&&!event.ctrlKey&&!event.metaKey){startPanning(event.clientX,event.clientY);event.preventDefault();}}},onmouseup:function(event,targetElement,elementType){if(elementType==='preview-image'){if(!isPanAndZoomAllowed){return;}
if((typeof event.button!=='number'||event.button<2)&&!event.ctrlKey&&!event.metaKey){if(!isPannable&&isZoomable){zoom('in');}else if(!didPan){zoom('reset');}
event.preventDefault();}}},oncontextmenu:function(event,targetElement,elementType){if(elementType==='preview-image'){if(dom.hasClass(moduleEl,'is-read-only')){event.preventDefault();}}},onclick:function(event,element,elementType){if(!element||!elementType||element.disabled){return;}
tooltipsService.hideAll();switch(elementType){case'zoomout':zoom('out');break;case'zoomin':zoom('in');break;case'enterfullscreen':fullscreen.enter();break;case'exitfullscreen':fullscreen.exit();break;case'rotateleft':handleRotateLeft();break;}}};});Box.Application.addModule('preview-media',function(context){'use strict';var AUTO_HIDE_TIMEOUT=2000,PAUSED_CLASS='is-paused',PLAYING_CLASS='is-playing',FORCE_SHOW_PLAY_CLASS='show-play',VISIBILITY_CLASS='invisible',PLAYING_CLASS_TIMEDOUT='is-timed-out',PREVIEW_EVENT_ERROR='previewerror',PREVIEW_EVENT_PLAY_ENDED='previewmediapaused',PREVIEW_EVENT_PLAY_STARTED='previewmediaplaying',MEDIA_EVENT_ERROR_PREFIX='media_err_',EVENT_MUTE='mute',EVENT_UNMUTE='unmute',EVENT_VOLUME='volume',EVENT_AUTOPLAY='autoplay',VOLUME_MUTE_CLASS='is-muted',AUTOPLAY_CLASS='is-auto-playing',HTML_MEDIA_EVENTS=['durationchange','timeupdate','playing','pause','ended','canplay','error','loadedmetadata'];var flashElement,htmlMediaElement,domNode,controls,fullscreen,funcUtils,throttledShowPause,browser,cache,hotkeysService,progressService,progressWidget,templates,durationNode,timecodeNode,playbackRateButton,$videoScrubber,$volumeScrubber,recovering=false,maxScrubber=0,isPlaying=false,iconControls,mediaType,iconControlsTimeoutHandler,playbackRates=[0.5,1,1.5,2],currentPlaybackRateIndex=1,dom,embed,mediaElementInitialized=false,videoWidth=100,videoHeight=100,aspect;function shouldPlayTheNextFile(){return cache.recall('autoplay');}
function setAutoPlay(){if(shouldPlayTheNextFile()){dom.addClass(controls,AUTOPLAY_CLASS);}else{dom.removeClass(controls,AUTOPLAY_CLASS);}}
function formatTime(seconds){var h=Math.floor(seconds/3600);var m=Math.floor((seconds%3600)/60);var s=Math.floor((seconds%3600)%60);return(h>0?h.toString()+':':'')+(m<10?'0'+m.toString():m.toString())+':'+(s<10?'0'+s.toString():s.toString());}
function togglePlay(){if(htmlMediaElement){if(isPlaying){htmlMediaElement.pause();}else{htmlMediaElement.play();}}else{flashElement.fire(isPlaying?'pause':'play',null);}}
function updateScrubber(handlePercent,loadedPercent){maxScrubber=Math.max(0.04,loadedPercent);if(embed){context.broadcast('previewmediatimeupdate',{'scrubber':$videoScrubber,'loaded':loadedPercent});$videoScrubber.setValue(handlePercent);}else{$videoScrubber.find('.loaded').css('left',Math.floor(100*loadedPercent)+'%');$videoScrubber.val(handlePercent);}}
function setDuration(time){dom.setText(durationNode,formatTime(time));}
function setTimecode(time){dom.setText(timecodeNode,formatTime(time));}
function getCurrentVolume(){return embed?$volumeScrubber.getValue():$volumeScrubber.val();}
function initFlash(){var assets=context.getService('assets'),browserService=context.getService('browser'),swfobject=context.getGlobal('swfobject');if(swfobject&&typeof swfobject.embedSWF==='function'){var flashvars={backgroundColor:'#ffffff',conversion_on_realtime:true,lightbox_preview:true};var params={allowfullscreen:'true',allowscriptaccess:'always',wmode:'transparent'};var flashPath=assets.getFlashAssetURL();var flashFile=assets.getAssetURL(flashPath,'preview.swf');swfobject.embedSWF(flashFile,'flash-player','2','2',browserService.getMinimumFlashVersion(),null,flashvars,params,{'class':' preview-flash-content'});}else{context.reportError(new Error('swf object undefined'));}}
function continueFlashInit(){isPlaying=false;var typedId=domNode.getAttribute('data-typed-id');flashElement=dom.query('object');templates=context.getService('templates');var flashXML=templates.getTemplateHTML('flash_xml');var itemContextDataToLoad=[];itemContextDataToLoad[0]={identifier:typedId,xml:flashXML};flashElement.updateFiles(itemContextDataToLoad,typedId);}
function resizeFlashObject(data){if(data.width){$(flashElement).css({width:data.width});}
$(flashElement).removeAttr('width').removeAttr('height');}
function delayHidePauseButton(){clearTimeout(iconControlsTimeoutHandler);iconControlsTimeoutHandler=setTimeout(function(){dom.addClass(iconControls,PLAYING_CLASS_TIMEDOUT);},AUTO_HIDE_TIMEOUT);}
function showPauseButton(){if(!throttledShowPause){throttledShowPause=funcUtils.throttle(function(){if(isPlaying){dom.removeClass(iconControls,PLAYING_CLASS_TIMEDOUT);delayHidePauseButton();}},AUTO_HIDE_TIMEOUT-500,true);}
return throttledShowPause;}
function startPlaying(){isPlaying=true;dom.addClass(controls,PLAYING_CLASS);dom.removeClass(iconControls,FORCE_SHOW_PLAY_CLASS);if(iconControls){dom.removeClass(iconControls,PAUSED_CLASS);dom.addClass(iconControls,PLAYING_CLASS);if(mediaType==='audio'){dom.on(domNode,'mousemove',showPauseButton());delayHidePauseButton();}}
context.broadcast(PREVIEW_EVENT_PLAY_STARTED);}
function stopPlaying(){isPlaying=false;dom.removeClass(controls,PLAYING_CLASS);if(iconControls){dom.removeClass(iconControls,PLAYING_CLASS);dom.addClass(iconControls,PAUSED_CLASS);if(mediaType==='audio'){dom.off(domNode,'mousemove',showPauseButton());clearTimeout(iconControlsTimeoutHandler);dom.removeClass(iconControls,PLAYING_CLASS_TIMEDOUT);}}
context.broadcast(PREVIEW_EVENT_PLAY_ENDED);}
function playBackEnded(){if(shouldPlayTheNextFile()){context.broadcast('previewshownext');}else{stopPlaying();setTimecode(0);updateScrubber(0,1);}}
function zoom(inOrOut){var newWidth=videoWidth,newHeight=videoHeight;if(htmlMediaElement){if(aspect>=1){if(inOrOut==='in'){newWidth=Math.min(100,videoWidth+10);videoWidth=newWidth;}else if(inOrOut==='out'){newWidth=Math.max(10,videoWidth-10);videoWidth=newWidth;}else if(inOrOut==='max'){newWidth=100;}
htmlMediaElement.style.width=newWidth+'%';}else{if(inOrOut==='in'){newHeight=Math.min(100,videoHeight+10);videoHeight=newHeight;}else if(inOrOut==='out'){newHeight=Math.max(10,videoHeight-10);videoHeight=newHeight;}else if(inOrOut==='max'){newHeight=100;}
htmlMediaElement.style.height=newHeight+'%';}}}
function maxZoom(){zoom('max');}
function revertZoom(){zoom();}
function initHtmlMediaElement(){var viewportDimensions;if(mediaElementInitialized){return;}
htmlMediaElement.volume=getCurrentVolume()||0.7;context.broadcast('previewloaded',{contentType:htmlMediaElement.tagName.toLowerCase()});if(shouldPlayTheNextFile()){htmlMediaElement.play();}
aspect=htmlMediaElement.videoWidth/htmlMediaElement.videoHeight;viewportDimensions=domNode.getBoundingClientRect();if(htmlMediaElement.videoWidth<viewportDimensions.width&&htmlMediaElement.videoHeight<viewportDimensions.height){if(aspect>=1){videoWidth=htmlMediaElement.videoWidth*100/viewportDimensions.width;htmlMediaElement.style.width=videoWidth+'%';}else{videoHeight=htmlMediaElement.videoHeight*100/viewportDimensions.height;htmlMediaElement.style.height=videoHeight+'%';}}
dom.removeClass(htmlMediaElement,VISIBILITY_CLASS);mediaElementInitialized=true;}
function updateMediaTimestamps(){var currentTime=htmlMediaElement.currentTime,duration=htmlMediaElement.duration,currentPos=duration?(currentTime/duration):0;setTimecode(currentTime);updateScrubber(currentPos,1);}
function setPlaybackRate(incrementer){if(playbackRateButton){currentPlaybackRateIndex=(currentPlaybackRateIndex+incrementer)%playbackRates.length;htmlMediaElement.playbackRate=playbackRates[currentPlaybackRateIndex];playbackRateButton.textContent=playbackRates[currentPlaybackRateIndex]+'x';}}
function seek(newTime){var currentTime=htmlMediaElement.currentTime;if(newTime==='next'){newTime=currentTime+0.03333333333;}else if(newTime==='prev'){newTime=currentTime-0.03333333333;}
var wasStopped=htmlMediaElement.paused||htmlMediaElement.ended;htmlMediaElement.currentTime=newTime;if(wasStopped){htmlMediaElement.pause();}}
function revertToFlash(errorType){context.broadcast(PREVIEW_EVENT_ERROR,{errorType:errorType});context.broadcast('previewcontentreload',{isFlashFallback:true});}
function addHtmlMediaEvents(element,event,handler){var i,length,events=event?[event]:HTML_MEDIA_EVENTS;handler=handler||htmlMediaElementEventHandler;element=element||htmlMediaElement;for(i=0,length=events.length;i<length;i++){element.addEventListener(events[i],handler,false);}
fullscreen.on('enter',maxZoom);fullscreen.on('exit',revertZoom);}
function removeHtmlMediaEvents(element,event,handler){var i,length,events=event?[event]:HTML_MEDIA_EVENTS;handler=handler||htmlMediaElementEventHandler;element=element||htmlMediaElement;for(i=0,length=events.length;i<length;i++){element.removeEventListener(events[i],handler,false);}
fullscreen.off('enter',maxZoom);fullscreen.off('exit',revertZoom);}
function releaseMediaResources(element){element=element||htmlMediaElement;try{element.removeAttribute('src');element.load();if(element.parentElement){element.parentElement.removeChild(element);}}catch(ex){}}
function handleMediaErrorNetwork(errorType){if(recovering){return;}
recovering=true;context.broadcast(PREVIEW_EVENT_ERROR,{errorType:MEDIA_EVENT_ERROR_PREFIX+errorType});var oldMediaNode,containerNode=htmlMediaElement.parentNode,newMediaNode=htmlMediaElement.cloneNode(false),currentTime=htmlMediaElement.currentTime,playbackRate=htmlMediaElement.playbackRate,wasStopped=htmlMediaElement.paused||htmlMediaElement.ended,volume=htmlMediaElement.volume,canPlayCallback=function(){newMediaNode.currentTime=currentTime;newMediaNode.playbackRate=playbackRate;},postSeekCallback=function(){oldMediaNode=containerNode.replaceChild(newMediaNode,htmlMediaElement);newMediaNode.volume=volume;progressWidget.destroy();removeHtmlMediaEvents(oldMediaNode);releaseMediaResources(oldMediaNode);removeHtmlMediaEvents(newMediaNode,'seeked',postSeekCallback);removeHtmlMediaEvents(newMediaNode,'canplay',canPlayCallback);htmlMediaElement=dom.query(mediaType,domNode);addHtmlMediaEvents();if(!wasStopped){htmlMediaElement.play();}
recovering=false;context.broadcast(PREVIEW_EVENT_ERROR,{errorType:MEDIA_EVENT_ERROR_PREFIX+errorType+'_recovered'});};newMediaNode.volume=0;addHtmlMediaEvents(newMediaNode,'seeked',postSeekCallback);if(newMediaNode.readyState>HTMLMediaElement.HAVE_METADATA){canPlayCallback();}else{addHtmlMediaEvents(newMediaNode,'canplay',canPlayCallback);}
progressWidget=progressService.create(dom.query('.progress-widget',domNode));}
function handleMediaError(){try{switch(htmlMediaElement.error.code){case MediaError.MEDIA_ERR_ABORTED:context.broadcast(PREVIEW_EVENT_ERROR,{errorType:MEDIA_EVENT_ERROR_PREFIX+'aborted'});break;case MediaError.MEDIA_ERR_NETWORK:handleMediaErrorNetwork('network');break;default:revertToFlash(MEDIA_EVENT_ERROR_PREFIX+'unsupported');break;}}catch(excep){revertToFlash(MEDIA_EVENT_ERROR_PREFIX+'fatal');}}
function htmlMediaElementEventHandler(event){var type=event.type;switch(type){case'click':togglePlay();break;case'playing':startPlaying();break;case'pause':stopPlaying();break;case'durationchange':if(isFinite(htmlMediaElement.duration)){setDuration(htmlMediaElement.duration);}else{revertToFlash(MEDIA_EVENT_ERROR_PREFIX+'metadata');}
break;case'canplay':initHtmlMediaElement();break;case'timeupdate':updateMediaTimestamps();break;case'ended':playBackEnded();break;case'error':handleMediaError();break;case'loadedmetadata':dom.removeClass(htmlMediaElement,VISIBILITY_CLASS);dom.addClass(iconControls,FORCE_SHOW_PLAY_CLASS);break;}}
function controlHandler(event){if(htmlMediaElement){switch(event.type){case'play':htmlMediaElement.play();setPlaybackRate(0);break;case'pause':htmlMediaElement.pause();break;case'volume':htmlMediaElement.volume=event.data;break;case'playbackrate':setPlaybackRate(1);break;case'zoomin':zoom('in');break;case'zoomout':zoom('out');break;case'seek':seek(event.data*htmlMediaElement.duration);break;}}else if(flashElement){return flashElement.fire(event.type,event.data);}}
function setHotkeys(){hotkeysService.setConfig([{key:'space',handler:function(){togglePlay();}},{key:'shift+=',handler:function(){zoom('in');}},{key:'shift+-',handler:function(){zoom('out');}},{key:'f',handler:function(){if(mediaType==='video'){if(!(browser.isIE()&&browser.isMinBrowser('explorer','11'))){if(fullscreen.isFullScreen()){fullscreen.exit();}else{fullscreen.enter();}}}}}],'preview');}
function addVideoScrubber(){$videoScrubber=$videoScrubber||$('.noUiSlider-video');if(!embed){$videoScrubber.noUiSlider({start:0,connect:'upper',range:{'min':0,'max':1},step:0.0001});}
var slideCallback=function(){var $this=embed?this:$(this),val=embed?this.getValue():($this.val()-0);if(val>maxScrubber){val=maxScrubber;if(embed){$this.setValue(val);}else{$this.val(val);}}
if(!htmlMediaElement||isFinite(htmlMediaElement.duration)){controlHandler({type:'seek',data:val});}};$videoScrubber.on('slide',slideCallback);if(!embed){$videoScrubber.find('.noUi-connect').append('<div class="loaded"></div>');}}
function volumeHandler(type,vol){var lastUnmutedVolume=cache.recall('lastUnmutedVolume');if(vol===lastUnmutedVolume){return;}
if(type===EVENT_MUTE){vol=0;}else if(type===EVENT_UNMUTE){vol=lastUnmutedVolume;}
if(vol===0){if(!embed){dom.addClass(controls,VOLUME_MUTE_CLASS);}}else{if(!embed){dom.removeClass(controls,VOLUME_MUTE_CLASS);}
cache.memorize('lastUnmutedVolume',vol);}
if(embed){if(vol!==$volumeScrubber.getValue()){$volumeScrubber.setValue(vol);}}else{$volumeScrubber.val(vol);}
controlHandler({type:EVENT_VOLUME,data:vol});}
function addVolumeScrubber(){$volumeScrubber=$volumeScrubber||$('.noUiSlider-volume');var slideCallback=function(){var val=embed?this.getValue():+($(this).val());volumeHandler(null,val);};var initialVolume=cache.recall('lastUnmutedVolume');if(embed){$volumeScrubber.setValue(initialVolume);}else{$volumeScrubber.noUiSlider({range:{'min':0,'max':1},start:initialVolume,step:0.1,orientation:'vertical',connect:'upper',direction:'rtl'});}
if(embed){$volumeScrubber.on('slide',slideCallback);$volumeScrubber.on('set',slideCallback);}else{$volumeScrubber.on({slide:slideCallback,set:slideCallback});}}
function cacheServicesAndNodes(){browser=context.getService('browser');fullscreen=context.getService('fullscreen');hotkeysService=context.getService('hotkeys');dom=context.getService('dom');cache=context.getService('preview-cache');progressService=context.getService('preview-progress');funcUtils=context.getService('function-utils');domNode=context.getElement();mediaType=domNode.getAttribute('data-media-type');embed=domNode.getAttribute('data-preview-format')==='embed';iconControls=dom.query('.preview-media-icon-controls',domNode);controls=embed?document.querySelector('.preview-embed-controls'):dom.query('.preview-controls',domNode);timecodeNode=embed?document.querySelector('.preview-embed-display-timecode'):dom.query('.preview-media-controls-timecode',controls);durationNode=embed?document.querySelector('.preview-embed-display-duration'):dom.query('.preview-media-controls-duration',controls);playbackRateButton=embed?null:dom.query('.preview-controls-btn-speed',controls);htmlMediaElement=dom.query(mediaType,domNode)||null;cache.memorize('lastUnmutedVolume',cache.recall('lastUnmutedVolume')||0.7);cache.memorize('autoplay',!!cache.recall('autoplay'));}
function initHtmlMedia(){addHtmlMediaEvents();if(playbackRateButton){setAutoPlay();}}
function initializeControls(data){$videoScrubber=data.time;addVideoScrubber();$volumeScrubber=data.volume;addVolumeScrubber();if(htmlMediaElement){initHtmlMedia();}else{initFlash();}}
return{messages:['flashevent','embedwidgetevent','togglefullscreen'],behaviors:['preview-controls'],onmessage:function(name,data){if(name==='flashevent'){switch(data.type){case'previewer_loaded':continueFlashInit();break;case'previewer_pagecount_determined':case'previewer_first_page_shown':if(data.duration){setDuration(data.duration);}
resizeFlashObject(data);context.broadcast('previewloaded',{contentType:'flash'});break;case'previewer_scrubber_update':setTimecode(data.timecode);updateScrubber(data.handle,data.loaded);break;case'previewer_media_state_changed':if(data.state==='playing'){startPlaying();}else{stopPlaying();}
break;}}else if(name==='embedwidgetevent'){switch(data.type){case'scrubbersinitialized':initializeControls(data);return;case'togglevolume':volumeHandler($volumeScrubber.getValue()?EVENT_MUTE:EVENT_UNMUTE);return;}
controlHandler(data);}else if(name==='togglefullscreen'){if(fullscreen.isFullScreen()){fullscreen.exit();}else{fullscreen.enter();}}},init:function(){cacheServicesAndNodes();setHotkeys();if(!embed){addVideoScrubber();addVolumeScrubber();}
if(htmlMediaElement){initHtmlMedia();}else{initFlash();}
context.broadcast('previewready');},destroy:function(){hotkeysService.unsetHotkeyForConfig('space','preview');if(mediaType==='audio'){clearTimeout(iconControlsTimeoutHandler);dom.off(domNode,'mousemove',showPauseButton());}
if(htmlMediaElement){removeHtmlMediaEvents();releaseMediaResources();}},oncontextmenu:function(event,targetElement,elementType){if(elementType==='mediacontent'){event.preventDefault();}},onclick:function(event,element,elementType){if(!element||!elementType||element.disabled){return;}
event=event||{};switch(elementType){case'mediacontent':togglePlay();break;case EVENT_MUTE:case EVENT_UNMUTE:volumeHandler(elementType);break;case EVENT_AUTOPLAY:cache.memorize('autoplay',!cache.recall('autoplay'));setAutoPlay();break;case'enterfullscreen':fullscreen.enter();break;case'exitfullscreen':fullscreen.exit();break;default:controlHandler({type:elementType,data:event.data});break;}}};});Box.Application.addModule('preview-header',function(context){'use strict';var dom,moduleEl,currentFile,resinService,uploadService,boxEditService,cachingService,hotkeysService,moveCopyService,tooltipsService,versionsService,fullscreenService,previewNavService;function modifyEditOptions(element){var menuWrapperEl=element.parentNode,boxEditInstalledOptionEl=dom.query('.box-edit-installed',menuWrapperEl),boxEditNotInstalledOptionEl=dom.query('.box-edit-not-installed',menuWrapperEl);if(boxEditService.isBoxEditDisabledByAdmin()){dom.addClass(boxEditNotInstalledOptionEl,'hidden');dom.addClass(boxEditInstalledOptionEl,'hidden');}else if(boxEditService.isBoxEditInstalled()){dom.removeClass(boxEditInstalledOptionEl,'hidden');dom.addClass(boxEditNotInstalledOptionEl,'hidden');}else{dom.removeClass(boxEditNotInstalledOptionEl,'hidden');dom.addClass(boxEditInstalledOptionEl,'hidden');}}
function updateFileNameWidth(){var headerFileNameEl=dom.query('.preview-header-file-name',moduleEl),headerRightContainerEl=dom.query('.preview-header-right',moduleEl);if(headerFileNameEl&&headerRightContainerEl){var visibleFileNameWidth=headerRightContainerEl.offsetLeft-headerFileNameEl.offsetLeft;headerFileNameEl.style.maxWidth=visibleFileNameWidth+'px';}}
function enableHeaderDownloadWatermarkedRepButton(){var headerDownloadWatermarkedRepButtonEl=dom.query('.btn-preview-header-download-watermarked-rep',moduleEl);if(headerDownloadWatermarkedRepButtonEl&&headerDownloadWatermarkedRepButtonEl.disabled){dom.removeClass(headerDownloadWatermarkedRepButtonEl,'is-disabled');headerDownloadWatermarkedRepButtonEl.removeAttribute('disabled');headerDownloadWatermarkedRepButtonEl.removeAttribute('title');var downloadWatermarkedRepButtonEnabledTooltip=$t('Download watermarked file','preview_header_download_watermarked_button_enabled_tip');headerDownloadWatermarkedRepButtonEl.setAttribute('aria-label',downloadWatermarkedRepButtonEnabledTooltip);}}
function closePreviewAndNavigateToUrl(url,reloadUnderlyingPage){if(!url){url=dom.query('.preview-header-close',moduleEl).getAttribute('href');}
context.broadcast('previewcloseandnavigatetourl',{url:url,reloadUnderlyingPage:!!reloadUnderlyingPage});}
function setHotkeys(){var isSharedFilePageOrSharedFileEmbed=previewNavService.isSharedFilePageOrSharedFileEmbed(),hotkeyConfig=[{key:'esc',handler:function(){if(fullscreenService.isFullScreen()){fullscreenService.exit();}else if(!isSharedFilePageOrSharedFileEmbed){closePreviewAndNavigateToUrl();resinService.recordAction({application:'files',page:'preview',component:'',feature:'hotkeys',target:'close',action:'keypress'});}}}];if(!isSharedFilePageOrSharedFileEmbed){hotkeyConfig=hotkeyConfig.concat([{key:'d',handler:function(){context.broadcast('previewdownload');resinService.recordAction({application:'files',page:'preview',component:'',feature:'hotkeys',target:'download',action:'keypress'});}},{key:'e',handler:function(){context.broadcast('previewedit');resinService.recordAction({application:'files',page:'preview',component:'',feature:'hotkeys',target:'edit',action:'keypress'});}},{key:'s',handler:function(){context.broadcast('previewshare');resinService.recordAction({application:'files',page:'preview',component:'',feature:'hotkeys',target:'share',action:'keypress'});}}]);}
hotkeysService.setConfig(hotkeyConfig,'preview');}
return{behaviors:['menu-toggle','tooltips-amsterdam','preview-edit','preview-lock','preview-share','preview-download','preview-download-watermarked-rep','preview-favorite','preview-edit-office-online'],messages:['previewloaded','previewresized'],init:function(){dom=context.getService('dom');moduleEl=context.getElement();resinService=context.getService('resin');uploadService=context.getService('fileop-upload-legacy');boxEditService=context.hasService('box-edit')?context.getService('box-edit'):null;cachingService=context.getService('preview-cache');hotkeysService=context.getService('hotkeys');moveCopyService=context.getService('fileop-movecopy-legacy');tooltipsService=context.getService('tooltips-amsterdam');versionsService=context.getService('fileop-versions');fullscreenService=context.getService('fullscreen');previewNavService=context.getService('preview-nav');currentFile=cachingService.recall('currentFile');updateFileNameWidth();},onclick:function(event,element,elementType){if(!element||!elementType||element.disabled){return;}
tooltipsService.hideAll();switch(elementType){case'preview-versions':versionsService.showVersionsPopup(currentFile.id);break;case'preview-move-copy':moveCopyService.showMoveCopyPopup(currentFile.id);break;case'preview-upload':uploadService.uploadFileNewVersion(currentFile.id);break;case'preview-show-sidebar':context.broadcast('previewtogglesidebar',{showSidebar:true});break;case'preview-hide-sidebar':context.broadcast('previewtogglesidebar',{showSidebar:false});break;case'preview-close-preview':closePreviewAndNavigateToUrl(element.getAttribute('href'),false);resinService.recordAction({application:'files',page:'preview',component:'header',feature:'interactions',target:'close',action:'click'});event.preventDefault();break;case'preview-open-parent':closePreviewAndNavigateToUrl(element.getAttribute('href'),true);resinService.recordAction({application:'files',page:'preview',component:'header',feature:'interactions',target:'closetoparent',action:'click'});event.preventDefault();break;case'menu-toggle-button':if(dom.hasClass(element,'has-office-online')){modifyEditOptions(element);}
break;}},onmessage:function(name){switch(name){case'previewloaded':setHotkeys();enableHeaderDownloadWatermarkedRepButton();break;case'previewresized':updateFileNameWidth();break;}}};});Box.Application.addModule('preview-sidebar',function(context){'use strict';var contextEl,tabviewWidget,tabviewService,cache;function cacheSelectedTab(event){cache.memorize('infoTabSelected',event.data.tab==='info');context.broadcast('previewactivityfeedadjustments');}
function initTabs(){tabviewWidget=tabviewService.create(contextEl.querySelector('.tab-view'));tabviewWidget.init();if(cache.recall('infoTabSelected')){tabviewWidget.nextTab();}
tabviewWidget.on('tabchange',cacheSelectedTab);}
return{behaviors:['contextual-messages-registration'],init:function(){contextEl=context.getElement();tabviewService=context.getService('tabview');cache=context.getService('preview-cache');initTabs();},destroy:function(){if(tabviewWidget){tabviewWidget.off('tabchange',cacheSelectedTab);tabviewWidget.destroy();}}};});Box.Application.addModule('preview-sidebar-activity-feed',function(context){'use strict';var AT_MENTION_TRIGGERS=['@','',''];var browser,dom,strings,datetime,notifications,previewApi,contactsProvider,pillSelectorService,mentionSelectorService,versionsService,tooltipsService,win;var moduleEl,activityFeedContainer,activityFeedItemsContainerEl,activityFeedInputContainerEl,commentInputContainerEl,taskInputContainerEl,commentSubmitBtnEl,taskSubmitBtnEl,$taskDueDateInput,commentMessageTextareaWidget,taskMessageTextareaWidget,taskAssigneeInputWidget,fileId,folderId;var LOADING_CLASS='is-loading',POST_SPINNER_CONTAINER_SELECTOR='.activity-feed-post-spinner',ITEM_SPINNER_CONTAINER_SELECTOR='.activity-feed-item-spinner';function getHtmlSuccessHandler(json){tooltipsService.hideAll();dom.setHTML(activityFeedItemsContainerEl,json.data.html);}
function getHtmlErrorHandler(){}
function getAndSetHtml(){previewApi.getSidebarActivityFeed(fileId).then(getHtmlSuccessHandler,getHtmlErrorHandler).caught(getHtmlErrorHandler);}
function displayRetryableError(errorString,clickHandler){notifications.error(errorString,{action:{text:$t('Try again?','activity_feed_try_again'),onclick:clickHandler}});}
function displayWarningNotification(confirmationString,clickHandler){notifications.warn(confirmationString,{action:{text:$t('Yes','activity_feed_yes'),onclick:function(){clickHandler();notifications.hide();}}});}
function adjustActivityFeedScrollContainerPosition(){var activityFeedInputContainerElBoundingRect;if(browser.isIE()&&!browser.isHtml5EnabledIE()&&activityFeedInputContainerEl&&activityFeedInputContainerEl.nodeType===1){activityFeedInputContainerElBoundingRect=dom.getBoundingClientRect(activityFeedInputContainerEl);activityFeedContainer.style.top=activityFeedInputContainerElBoundingRect.height+'px';}}
function resetInputs(){dom.removeClass(moduleEl,'comment-input-visible');commentMessageTextareaWidget.reset();dom.removeClass(moduleEl,'task-input-visible');taskMessageTextareaWidget.reset();$taskDueDateInput.datepicker('setDate',null);taskAssigneeInputWidget.reset();taskInputContainerEl.removeAttribute('data-task-edit-id');adjustActivityFeedScrollContainerPosition();dom.removeClass(dom.query(POST_SPINNER_CONTAINER_SELECTOR,commentSubmitBtnEl),LOADING_CLASS);dom.removeClass(dom.query(POST_SPINNER_CONTAINER_SELECTOR,commentSubmitBtnEl),LOADING_CLASS);}
function setupTaskInput(){var assigneeSelectorInputEl=taskInputContainerEl.querySelector('input.sidebar-activity-feed-task-assignee-input'),messageSelectorTextareaEl=taskInputContainerEl.querySelector('.sidebar-activity-feed-task-textarea'),dataProvider=fileId?contactsProvider.searchWithItem('f_'+fileId):null;$taskDueDateInput=$(taskInputContainerEl).find('.sidebar-activity-feed-task-due-date-input');taskAssigneeInputWidget=pillSelectorService.create(assigneeSelectorInputEl,dataProvider);taskMessageTextareaWidget=mentionSelectorService.create(AT_MENTION_TRIGGERS,messageSelectorTextareaEl,dataProvider);taskAssigneeInputWidget.init();$taskDueDateInput.datepicker($.extend({},$.DATEPICKER_DEFAULTS,{minDate:new Date(),showOn:'focus'}));taskMessageTextareaWidget.on('resize',adjustActivityFeedScrollContainerPosition);taskAssigneeInputWidget.on('resize',adjustActivityFeedScrollContainerPosition);}
function setupCommentInput(){var messageSelectorTextareaEl=commentInputContainerEl.querySelector('.sidebar-activity-feed-comment-textarea'),dataProvider=fileId?contactsProvider.searchWithItem('f_'+fileId):null;commentMessageTextareaWidget=mentionSelectorService.create(AT_MENTION_TRIGGERS,messageSelectorTextareaEl,dataProvider);commentMessageTextareaWidget.on('resize',adjustActivityFeedScrollContainerPosition);}
function isCommentInputValid(message){if(!message||strings.trim(message.message).length===0){commentMessageTextareaWidget.displayError($t('Please enter a comment.','comment_no_message_error'));return false;}else{return true;}}
function showCommentInput(parentCommentId){if(parentCommentId){commentInputContainerEl.setAttribute('data-parent-id',parentCommentId);}else{commentInputContainerEl.removeAttribute('data-parent-id');}
dom.removeClass(moduleEl,'task-input-visible');dom.addClass(moduleEl,'comment-input-visible');commentMessageTextareaWidget.focus();adjustActivityFeedScrollContainerPosition();}
function submitCommentErrorHandler(message){return function(){displayRetryableError($t('There was an error saving the comment.','activity_feed_submit_comment_error'),function(){submitComment(message);});};}
function submitComment(message){if(isCommentInputValid(message)){dom.addClass(dom.query(POST_SPINNER_CONTAINER_SELECTOR,commentSubmitBtnEl),LOADING_CLASS);commentSubmitBtnEl.disabled=true;var parentCommentId=commentInputContainerEl.getAttribute('data-parent-id'),errorHandler=submitCommentErrorHandler(message);previewApi.comment.create('f_'+fileId,message,parentCommentId).then(function(response){if(!response.data.result){errorHandler();}else{getHtmlSuccessHandler(response);resetInputs();}},errorHandler).caught(errorHandler).lastly(function(){dom.removeClass(dom.query(POST_SPINNER_CONTAINER_SELECTOR,commentSubmitBtnEl),LOADING_CLASS);commentSubmitBtnEl.disabled=false;});}}
function showTaskInput(taskId,taskDueDate,taskAssignees,taskMessage){if(taskId){taskInputContainerEl.setAttribute('data-task-edit-id',taskId);}
if(taskDueDate){$taskDueDateInput.datepicker('setDate',taskDueDate);}
if(taskAssignees){taskAssigneeInputWidget.insertArrayOfPills(taskAssignees);}
if(taskMessage){taskMessageTextareaWidget.setMessage(taskMessage);}
dom.removeClass(moduleEl,'comment-input-visible');dom.addClass(moduleEl,'task-input-visible');taskAssigneeInputWidget.inputElement.focus();adjustActivityFeedScrollContainerPosition();}
function getTaskAssigneeEmails(){var i,assignees=taskAssigneeInputWidget.getPills(),assigneesLen,ret='';if(!assignees){return'';}
assigneesLen=assignees.length;for(i=0;i<assigneesLen;i++){ret=ret+assignees[i].email+',';}
return ret;}
function getTaskAssignees(taskContentEl){var taskAssignees=taskContentEl.querySelectorAll('.activity-feed-assignee'),assigneesArr=[],i,taskAssigneesLen=taskAssignees.length,assignee;for(i=0;i<taskAssigneesLen;i++){assignee={id:taskAssignees[i].getAttribute('data-user-id'),email:taskAssignees[i].getAttribute('data-user-email'),text:taskAssignees[i].textContent||taskAssignees[i].innerText};assigneesArr.push(assignee);}
return assigneesArr;}
function initTaskEdit(element){var taskContentEl=dom.getNearest(element,'.activity-feed-task-content'),taskId=taskContentEl.getAttribute('data-task-id'),taskDueDate=taskContentEl.getAttribute('data-due-date'),taskDueDateTS=taskDueDate==='0'?null:datetime.getDateFromTimestampInSeconds(taskDueDate),taskMessageEl=taskContentEl.querySelector('.activity-feed-message'),taskMessage=$(taskMessageEl).html(),taskAssignees=getTaskAssignees(taskContentEl);showTaskInput(taskId,taskDueDateTS,taskAssignees,taskMessage);}
function isTaskInputValid(assignees,message){if(!assignees||strings.trim(assignees).length===0){taskAssigneeInputWidget.displayError($t('Please enter a valid task recipient','create_item_feed_object_no_valid_recipient_error'));return false;}else if(!message||strings.trim(message.message).length===0){taskMessageTextareaWidget.displayError($t('Please enter a task description.','tasks_js_message_error_no_description'));return false;}else{return true;}}
function submitTaskErrorHandler(dueDate,message,assignees,editTaskId){return function(response){var collabsNeedingUpgrade=response.data.error.collabs_needing_upgrade,invalidRecipients=[],i,length;if(collabsNeedingUpgrade){length=collabsNeedingUpgrade.length;for(i=0;i<length;i++){invalidRecipients.push(collabsNeedingUpgrade[i].email);}
notifications.error($t('Invalid task recipient(s): %1. Tasks may only be assigned to collaborators in this folder','create_item_feed_object_valid_recipients_error',invalidRecipients.join(', ')));}else{displayRetryableError($t('There was an error saving the task.','activity_feed_save_task_error'),function(){submitTask(dueDate,message,assignees,editTaskId);});}};}
function submitTask(dueDate,message,assignees,editTaskId){if(isTaskInputValid(assignees,message)){var submitPromise,errorHandler=submitTaskErrorHandler(dueDate,message,assignees,editTaskId);dom.addClass(dom.query(POST_SPINNER_CONTAINER_SELECTOR,taskSubmitBtnEl),LOADING_CLASS);taskSubmitBtnEl.disabled=true;if(editTaskId){submitPromise=previewApi.task.edit(editTaskId,'f_'+fileId,message,assignees,dueDate);}else{submitPromise=previewApi.task.create('f_'+fileId,message,assignees,dueDate);}
submitPromise.then(function(response){if(!response.data.result){errorHandler(response);}else{getHtmlSuccessHandler(response);resetInputs();}},errorHandler).caught(errorHandler).lastly(function(){dom.removeClass(dom.query(POST_SPINNER_CONTAINER_SELECTOR,taskSubmitBtnEl),LOADING_CLASS);taskSubmitBtnEl.disabled=false;});}}
function deleteComment(commentId,feedItemEl){dom.addClass(dom.query(ITEM_SPINNER_CONTAINER_SELECTOR,feedItemEl),LOADING_CLASS);previewApi.comment.remove('f_'+fileId,commentId).then(getAndSetHtml,function(){displayRetryableError($t('There was an error deleting this comment.','activity_feed_delete_comment_error'),function(){deleteComment(commentId);});}).lastly(function(){dom.removeClass(dom.query(ITEM_SPINNER_CONTAINER_SELECTOR,feedItemEl),LOADING_CLASS);});}
function declineTask(taskAssignmentId,feedItemEl){dom.addClass(dom.query(ITEM_SPINNER_CONTAINER_SELECTOR,feedItemEl),LOADING_CLASS);previewApi.task.reject('f_'+fileId,taskAssignmentId).then(getAndSetHtml,function(){displayRetryableError($t('There was an error declining this task.','activity_feed_decline_task_error'),function(){declineTask(taskAssignmentId);});}).lastly(function(){dom.removeClass(dom.query(ITEM_SPINNER_CONTAINER_SELECTOR,feedItemEl),LOADING_CLASS);});}
function completeTask(taskAssignmentId,feedItemEl){dom.addClass(dom.query(ITEM_SPINNER_CONTAINER_SELECTOR,feedItemEl),LOADING_CLASS);previewApi.task.complete(taskAssignmentId).then(getAndSetHtml,function(){displayRetryableError($t('There was an error completing this task.','activity_feed_completing_task_error'),function(){completeTask(taskAssignmentId);});}).lastly(function(){dom.removeClass(dom.query(ITEM_SPINNER_CONTAINER_SELECTOR,feedItemEl),LOADING_CLASS);});}
function deleteTask(taskId,feedItemEl){dom.addClass(dom.query(ITEM_SPINNER_CONTAINER_SELECTOR,feedItemEl),LOADING_CLASS);previewApi.task.remove(taskId).then(getAndSetHtml,function(){displayRetryableError($t('There was an error deleting this task.','activity_feed_deleting_task_error'),function(){deleteTask(taskId);});}).lastly(function(){dom.removeClass(dom.query(ITEM_SPINNER_CONTAINER_SELECTOR,feedItemEl),LOADING_CLASS);});}
return{behaviors:['menu-toggle','tooltips-amsterdam'],messages:['previewactivityfeedadjustments'],init:function(){previewApi=context.getService('preview-api');browser=context.getService('browser');dom=context.getService('dom');strings=context.getService('strings');datetime=context.getService('datetime');notifications=context.getService('notifications');contactsProvider=context.getService('provider-contacts');pillSelectorService=context.getService('pill-selector');mentionSelectorService=context.getService('mention-selector');versionsService=context.getService('fileop-versions');tooltipsService=context.getService('tooltips-amsterdam');win=context.getGlobal('window');moduleEl=context.getElement();activityFeedContainer=moduleEl.querySelector('.sidebar-activity-feed-container');activityFeedItemsContainerEl=moduleEl.querySelector('.sidebar-activity-feed-items-container');activityFeedInputContainerEl=moduleEl.querySelector('.sidebar-activity-feed-input-container');commentSubmitBtnEl=moduleEl.querySelector('button[data-type="submit-comment"]');taskSubmitBtnEl=moduleEl.querySelector('button[data-type="submit-task"]');fileId=moduleEl.getAttribute('data-file-id');folderId=moduleEl.getAttribute('data-folder-id');if(activityFeedInputContainerEl){commentInputContainerEl=activityFeedInputContainerEl.querySelector('.sidebar-activity-feed-comment-container');taskInputContainerEl=activityFeedInputContainerEl.querySelector('.sidebar-activity-feed-task-container');setupCommentInput();setupTaskInput();adjustActivityFeedScrollContainerPosition();}
getAndSetHtml();},onclick:function(event,element,elementType){if(!element||!elementType||element.disabled){return;}
var commentId,authorId,authorName,taskAssignmentId,parentCommentId,message,dueDate,assignees,editTaskId,feedItemEl;if(element){switch(elementType){case'preview-versions':versionsService.showVersionsPopup(fileId);break;case'menu-toggle-comment':case'activity-feed-placeholder-textarea':event.preventDefault();resetInputs();showCommentInput();break;case'menu-toggle-task':resetInputs();showTaskInput();break;case'cancel-comment':case'cancel-task':resetInputs();break;case'submit-comment':message=commentMessageTextareaWidget.getMessage();submitComment(message);break;case'submit-task':var shortDate=dom.query('.sidebar-activity-feed-task-due-date-input',taskInputContainerEl).value;dueDate=datetime.parseShortDateToTimestampInSeconds(shortDate,{setToEndOfDay:true});assignees=getTaskAssigneeEmails();message=taskMessageTextareaWidget.getMessage();editTaskId=taskInputContainerEl.getAttribute('data-task-edit-id');submitTask(dueDate,message,assignees,editTaskId);break;case'delete-comment':feedItemEl=dom.getNearest(element,'.activity-feed-item');commentId=element.getAttribute('data-comment-id');displayWarningNotification($t('Are you sure you want to delete this comment?','activity_feed_comment_delete_confirmation'),function(){deleteComment(commentId,feedItemEl);});break;case'reply-comment':authorId=element.getAttribute('data-comment-author-user-id');authorName=element.getAttribute('data-comment-author-name');parentCommentId=element.getAttribute('data-comment-id');resetInputs();showCommentInput(parentCommentId);commentMessageTextareaWidget.insertMentionAtCursor(authorId,'/preview/'+authorId,authorName);break;case'decline-task':feedItemEl=dom.getNearest(element,'.activity-feed-item');taskAssignmentId=element.getAttribute('data-task-assignment-id');declineTask(taskAssignmentId,feedItemEl);break;case'complete-task':feedItemEl=dom.getNearest(element,'.activity-feed-item');taskAssignmentId=element.getAttribute('data-task-assignment-id');completeTask(taskAssignmentId,feedItemEl);break;case'delete-task':var taskId=element.getAttribute('data-task-id');feedItemEl=dom.getNearest(element,'.activity-feed-item');displayWarningNotification($t('Are you sure you want to delete this task?','activity_feed_task_delete_confirmation'),function(){deleteTask(taskId,feedItemEl);});break;case'edit-task':resetInputs();initTaskEdit(element);break;case'add-comment-mention':commentMessageTextareaWidget.initMentionAtCursor();break;case'add-task-mention':taskMessageTextareaWidget.initMentionAtCursor();break;default:return true;}
event.preventDefault();}},onmessage:function(name){if(name==='previewactivityfeedadjustments'){adjustActivityFeedScrollContainerPosition();}}};});Box.Application.addModule('preview-sidebar-properties',function(context){'use strict';var dom,fileId,strings,oldValue='',autosize,contextEl,previewApi,fileExtension;var HAS_ERROR_CLASS='has-error',IS_BEING_EDITED_CLASS='is-being-edited',IS_VISIBLE_CLASS='is-visible',IS_LOADING_CLASS='is-loading',FILE_NAME_TEXTAREA_CLASS='file-name',ERROR_MESSAGE_DEFAULT=$t('There was an error, please try again','preview_sidebar_update_file_info_default_error');function initAutosize(){var textAreaEls=dom.queryAll('textarea',contextEl),i,len=textAreaEls.length;for(i=0;i<len;i++){autosize.init(textAreaEls[i]);}}
function destroyAutosize(){var textAreaEls=dom.queryAll('textarea',contextEl),i,len=textAreaEls.length;for(i=0;i<len;i++){autosize.destroy(textAreaEls[i]);}}
function makeTextAreaUneditable(textAreaEl){dom.removeClass(textAreaEl,IS_BEING_EDITED_CLASS);var saveValueButtonEl=dom.query('.btn-save-value',textAreaEl.parentNode);dom.removeClass(saveValueButtonEl,IS_VISIBLE_CLASS);if(fileExtension&&dom.hasClass(textAreaEl,FILE_NAME_TEXTAREA_CLASS)){textAreaEl.value+='.'+fileExtension;}}
function makeTextAreaEditable(textAreaEl){dom.addClass(textAreaEl,IS_BEING_EDITED_CLASS);var saveValueButtonEl=dom.query('.btn-save-value',textAreaEl.parentNode);dom.addClass(saveValueButtonEl,IS_VISIBLE_CLASS);if(fileExtension&&dom.hasClass(textAreaEl,FILE_NAME_TEXTAREA_CLASS)){var textAreaValue=textAreaEl.value;textAreaEl.value=textAreaValue.substring(0,textAreaValue.toLowerCase().lastIndexOf(fileExtension)-1);}
oldValue=textAreaEl.value;textAreaEl.focus();dom.off(textAreaEl,'blur',saveTextAreaChangesHandler);dom.on(textAreaEl,'blur',saveTextAreaChangesHandler);}
function showTextAreaError(textAreaEl,message){dom.addClass(textAreaEl,HAS_ERROR_CLASS);textAreaEl.setAttribute('data-hover','tooltip');textAreaEl.setAttribute('aria-label',message);}
function removeTextAreaError(textAreaEl){dom.removeClass(textAreaEl,HAS_ERROR_CLASS);textAreaEl.removeAttribute('data-hover');textAreaEl.removeAttribute('aria-label');}
function showTextAreaLoading(textAreaEl){var wrapperEl=textAreaEl.parentNode,saveButtonEl=dom.query('.btn-save-value',wrapperEl);dom.addClass(saveButtonEl,'hidden');dom.addClass(wrapperEl,IS_LOADING_CLASS);textAreaEl.disabled=true;}
function removeTextAreaLoading(textAreaEl){var wrapperEl=textAreaEl.parentNode,saveButtonEl=dom.query('.btn-save-value',wrapperEl);dom.removeClass(saveButtonEl,'hidden');dom.removeClass(wrapperEl,IS_LOADING_CLASS);textAreaEl.disabled=false;}
function updateFilePropertiesSuccessHandler(textAreaEl,field){return function(response){var errorMessage=response.data.error;if(errorMessage){removeTextAreaLoading(textAreaEl);showTextAreaError(textAreaEl,errorMessage);return;}
var savedValue=response.data.value;if(field==='name'){context.broadcast('previewfilenamechanged',{fileName:savedValue});}
context.broadcast('itemupdated',{itemTypedId:'f_'+fileId});removeTextAreaLoading(textAreaEl);makeTextAreaUneditable(textAreaEl);dom.off(textAreaEl,'blur',saveTextAreaChangesHandler);if(textAreaEl.value!==savedValue){textAreaEl.value=savedValue;}
autosize.resize(textAreaEl);};}
function updateFilePropertiesErrorHandler(textAreaEl){return function(response){var errorMessage=response.data.error||ERROR_MESSAGE_DEFAULT;removeTextAreaLoading(textAreaEl);showTextAreaError(textAreaEl,errorMessage);};}
function saveTextAreaChanges(textAreaEl){var updatedField='description',updatedValue,errorHandler=updateFilePropertiesErrorHandler(textAreaEl);removeTextAreaError(textAreaEl);if(dom.hasClass(textAreaEl,FILE_NAME_TEXTAREA_CLASS)&&strings.trim(textAreaEl.value)===''){textAreaEl.value=oldValue;autosize.resize(textAreaEl);}
updatedValue=textAreaEl.value;if(dom.hasClass(textAreaEl,FILE_NAME_TEXTAREA_CLASS)){updatedField='name';if(fileExtension){updatedValue+='.'+fileExtension;}}
showTextAreaLoading(textAreaEl);previewApi.properties.update(fileId,updatedField,updatedValue).then(updateFilePropertiesSuccessHandler(textAreaEl,updatedField),errorHandler).caught(errorHandler);}
function saveTextAreaChangesHandler(event){var textAreaEl=event.target;if(textAreaEl){saveTextAreaChanges(textAreaEl);}}
function cancelTextAreaChanges(textAreaEl){removeTextAreaError(textAreaEl);textAreaEl.value=oldValue;textAreaEl.blur();}
return{init:function(){dom=context.getService('dom');strings=context.getService('strings');autosize=context.getService('autosize');contextEl=context.getElement();previewApi=context.getService('preview-api');fileId=contextEl.getAttribute('data-file-id');fileExtension=contextEl.getAttribute('data-file-extension');initAutosize();},destroy:function(){destroyAutosize();},onclick:function(event,element,elementType){var textAreaEl,textAreaParentEl;switch(elementType){case'edit-value-btn':textAreaParentEl=element.parentNode;textAreaEl=dom.query('textarea',textAreaParentEl);if(!dom.hasClass(element,IS_BEING_EDITED_CLASS)){makeTextAreaEditable(textAreaEl);}
break;case'save-value-btn':textAreaParentEl=element.parentNode;textAreaEl=dom.query('textarea',textAreaParentEl);textAreaEl.blur();break;default:return;}
event.preventDefault();event.stopPropagation();},onfocusin:function(event,element,elementType){if(elementType==='edit-value'){var textAreaParentEl=element.parentNode,textAreaEl=dom.query('textarea',textAreaParentEl);if(!dom.hasClass(element,IS_BEING_EDITED_CLASS)){makeTextAreaEditable(textAreaEl);}}},onkeydown:function(event,element,elementType){if(elementType==='edit-value'&&!element.disabled){if(event.which===13&&!event.shiftKey){element.blur();event.preventDefault();event.stopPropagation();}else if(event.which===27){cancelTextAreaChanges(element);event.preventDefault();event.stopPropagation();}}}};});Box.Application.addModule('preview-sidebar-metadata',function(context){'use strict';var dom,fileId,moduleEl,previewApi,metadataContainerEl;function getHtmlSuccessHandler(json){dom.setHTML(metadataContainerEl,json.data.html);}
function getHtmlErrorHandler(){}
function getAndSetHtml(){previewApi.getSidebarMetadata(fileId).then(getHtmlSuccessHandler,getHtmlErrorHandler).caught(getHtmlErrorHandler);}
return{init:function(){dom=context.getService('dom');previewApi=context.getService('preview-api');moduleEl=context.getElement();metadataContainerEl=moduleEl.querySelector('.preview-sidebar-metadata-container');fileId=moduleEl.getAttribute('data-file-id');getAndSetHtml();}};});Box.Application.addModule('preview-svg',function(context){'use strict';var CLASS_HIDDEN='hidden',CLASS_SHOW_PAGE_NUMBER_INPUT='show-page-number-input',DISABLED='disabled',DOCUMENT_TYPE_PRESENTATION='presentation',KEYPRESS='keypress',PREVIEW='preview',STATUS_ERROR='error',STATUS_FATAL='fatal',STATUS_PENDING='pending',STATUS_SUCCESS='success';var browser,dom,document,fullscreen,hotkeysService,navState,resin,viewerService,previewApi;var statusPromise,controls,moduleEl,crocodocNode,viewer,config,updateStatusTID,totalPagesEl,currentPageEl,pageNumberInput,pageSelectorButton,pagePrevChevron,pageNextChevron,finishedConverting=false,viewerIsReady=false,pageIsReady=false,numPagesLoaded=0,totalPages=null,viewerOptions={},statusCheckIntervalInMillis=5000,progressIndicator,progressIndicatorBar,pagePrevControl,pageNextControl,embed,moduleControlsInitialized=false,clientSupportsSVG,hotkeysConfig=[{key:'right',handler:function(){nextpageHandler();}},{key:'left',handler:function(){previouspageHandler();}},{key:'down',handler:function(event){if(config.preview_type===DOCUMENT_TYPE_PRESENTATION){nextpageHandler();}else{viewer.scrollBy(0,80);event.preventDefault();}}},{key:'up',handler:function(event){if(config.preview_type===DOCUMENT_TYPE_PRESENTATION){previouspageHandler();}else{viewer.scrollBy(0,-80);event.preventDefault();}}},{key:'[',handler:function(){previouspageHandler();}},{key:']',handler:function(){nextpageHandler();}},{key:'shift+space',handler:function(){previouspageHandler();}},{key:'space',handler:function(){nextpageHandler();}},{key:'p',handler:function(){if(config.is_downloadable){context.broadcast('previewprint');resin.recordAction({application:'files',page:PREVIEW,component:'content',feature:'list',target:'print',action:KEYPRESS});}}},{key:'shift+=',handler:function(){zoomIn();}},{key:'shift+-',handler:function(){zoomOut();}},{key:'f',handler:function(){if(!(browser.isIE()&&browser.isMinBrowser('explorer','11'))){if(fullscreen.isFullScreen()){exitfullscreenHandler();}else{enterfullscreenHandler();}}}}];function updateConvertingIndicator(){if(!totalPages||totalPages<10){return;}
var percent=Math.round(100*numPagesLoaded/totalPages);if(!progressIndicator||!progressIndicatorBar){progressIndicator=dom.query('.page-progress-indicator',moduleEl);progressIndicatorBar=dom.query('.page-progress-indicator-bar',progressIndicator);}
progressIndicatorBar.style.width=percent+'%';if(percent===100){dom.addClass(progressIndicator,CLASS_HIDDEN);}else{dom.removeClass(progressIndicator,CLASS_HIDDEN);}}
function nextpageHandler(){if(viewer){viewer.scrollTo('next');}}
function previouspageHandler(){if(viewer){viewer.scrollTo('previous');}}
function zoomOut(){if(viewer){viewer.zoom('out');}}
function zoomIn(){if(viewer){viewer.zoom('in');}}
function setPageNumber(pageNum){if(viewer){viewer.scrollTo(pageNum);}}
function unsetHotkeys(){var i,length=hotkeysConfig.length;for(i=0;i<length;i++){hotkeysService.unsetHotkeyForConfig(hotkeysConfig[i].key,'preview');}}
function onMousewheel(event){if(config.preview_type===DOCUMENT_TYPE_PRESENTATION){var currentWheelDelta=event.originalEvent.wheelDelta||event.originalEvent.detail,isFromMouseWheel=(currentWheelDelta%120===0);if(isFromMouseWheel){if(currentWheelDelta<0){nextpageHandler();}else{previouspageHandler();}}}}
function finishedConvertingCallback(){numPagesLoaded=totalPages;viewer.broadcast('pageavailable',{all:true});updateConvertingIndicator();}
function pendingConvertingCallback(){if(numPagesLoaded>0){viewer.broadcast('pageavailable',{upto:numPagesLoaded});}
updateConvertingIndicator();}
function cancelStatusUpdate(){clearTimeout(updateStatusTID);}
function resetStatusUpdate(){cancelStatusUpdate();updateStatusTID=setTimeout(updateStatus,statusCheckIntervalInMillis);}
function updateStatus(){statusPromise=previewApi.getCrocodocStatus().then(pollingStatusHandler,resetStatusUpdate);}
function pageloadHandler(event){if(!pageIsReady&&event.data&&typeof event.data.page==='number'){pageIsReady=true;context.broadcast('previewloaded',{contentType:'document'});hotkeysService.setConfig(hotkeysConfig,'preview');}}
function linkclickHandler(event){if(event&&event.data&&event.data.uri){var uri=event.data.uri.replace(/"/g,'&quot;');event.data.uri='data:text/html;base64,'+btoa('<html><meta http-equiv="refresh" content="0; url='+uri+'"></html>');}}
function updateChevrons(pageNum){if(pageNum===1){if(pagePrevChevron){dom.addClass(pagePrevChevron,CLASS_HIDDEN);}
dom.addClass(pagePrevControl,DISABLED);pagePrevControl.setAttribute(DISABLED,'true');}else{dom.removeClass(pagePrevControl,DISABLED);if(pagePrevChevron){dom.removeClass(pagePrevChevron,CLASS_HIDDEN);}
pagePrevControl.removeAttribute(DISABLED);}
if(pageNum===totalPages){if(pageNextChevron){dom.addClass(pageNextChevron,CLASS_HIDDEN);}
dom.addClass(pageNextControl,DISABLED);pageNextControl.setAttribute(DISABLED,'true');}else{if(pageNextChevron){dom.removeClass(pageNextChevron,CLASS_HIDDEN);}
dom.removeClass(pageNextControl,DISABLED);pageNextControl.removeAttribute(DISABLED);}}
function updateControls(pageNum){pageNum=updateCurrentPage(pageNum);updateChevrons(pageNum);}
function pagefocusHandler(event){updateControls(event.data.page);}
function handlePreviewFailure(error){var message;context.broadcast('previewloaded',{contentType:'document'});finishedConverting=true;cancelStatusUpdate();if(viewer){viewer.destroy();}
if(typeof error==='object'){message=error.data.error;}else if(typeof error==='string'){message=error;}
message=message||$t('We\'re sorry, the server encountered an error while processing your document.','preview-svg-server-error-message');dom.setText(moduleEl.querySelector('.preview-error-message'),message);dom.addClass(crocodocNode,CLASS_HIDDEN);dom.removeClass(moduleEl.querySelector('.svg-converting-error-overlay'),CLASS_HIDDEN);}
function initViewer(callback){if(viewer){if(typeof callback==='function'){callback();}
return;}
viewerOptions.url=config.base_url+'crocodoc/';viewerOptions.queryParams=config.query_params;viewerOptions.enableTextSelection=config.is_downloadable===true;viewerOptions.autoloadFirstPage=false;viewerOptions.useSVG=config.use_svg===true;if(config.preview_type===DOCUMENT_TYPE_PRESENTATION){viewerOptions.layout=DOCUMENT_TYPE_PRESENTATION;dom.addClass(moduleEl,'preview-svg-presentation');dom.on(moduleEl,'mousewheel',onMousewheel);}else{viewerOptions.layout='vertical-single-column';}
viewerOptions.conversionIsComplete=finishedConverting;viewer=viewerService.create(crocodocNode,viewerOptions);viewer.on('ready',function(event){dom.removeClass(controls,'hidden');viewerIsReady=true;totalPages=event.data.numPages;updateTotalPages();updateControls(event.data.page);context.broadcast('previewready');if(typeof callback==='function'){callback();}});viewer.on('pagefocus',pagefocusHandler);viewer.on('pageload',pageloadHandler);viewer.on('fail',handlePreviewFailure);viewer.on('scrollstart',function(eventScrollStart){viewer.on('scrollend',function(eventScrollEnd){context.broadcast('viewerscrollended',eventScrollEnd.data);viewer.off('scrollend');});context.broadcast('viewerscrollstarted',eventScrollStart.data);});if(!browser.isIE()&&!browser.isEdge()){viewer.on('linkclick',linkclickHandler);}
viewer.on('zoom',function(event){context.broadcast('previewcontentresized',{isScrollbarVisible:event.data.isDraggable});});viewer.load();}
function pollingStatusHandler(response){var data=response.data;if(data.kind==='pdf'){return;}
cancelStatusUpdate();if(finishedConverting){return;}
switch(data.status){case STATUS_ERROR:case STATUS_FATAL:finishedConverting=true;handlePreviewFailure(data.message);break;case STATUS_SUCCESS:finishedConverting=true;initViewer(finishedConvertingCallback);if(data.fromRealTime&&!statusPromise){updateStatus();}
break;case STATUS_PENDING:default:if(data.crocodoc_css&&data.crocodoc_json){numPagesLoaded=Math.max(numPagesLoaded,data.last_page||0);initViewer(pendingConvertingCallback);}
resetStatusUpdate();break;}
if(!data.fromRealTime){statusPromise=null;}}
function pageNumInputBlurHandler(event){var target=event.target,pageNum=parseInt(target.value,10);if(!isNaN(pageNum)){setPageNumber(pageNum);updateCurrentPage(pageNum);}
hidePageNumInput();}
function pageNumInputKeydownHandler(event){switch(event.which){case 13:pageNumInputBlurHandler(event);break;case 27:hidePageNumInput();event.preventDefault();event.stopPropagation();break;}}
function hidePageNumInput(){dom.removeClass(controls,CLASS_SHOW_PAGE_NUMBER_INPUT);dom.off(pageNumberInput,'blur',pageNumInputBlurHandler);dom.off(pageNumberInput,'keydown',pageNumInputKeydownHandler);}
function showPageNumInput(){dom.addClass(controls,CLASS_SHOW_PAGE_NUMBER_INPUT);pageNumberInput.value=currentPageEl.textContent||currentPageEl.innerText;pageNumberInput.focus();pageNumberInput.select();dom.on(pageNumberInput,'blur',pageNumInputBlurHandler);dom.on(pageNumberInput,'keydown',pageNumInputKeydownHandler);}
function updateTotalPages(){dom.setText(totalPagesEl,totalPages);if(totalPages===1){hidePageNumInput();if(pageSelectorButton){dom.addClass(pageSelectorButton,DISABLED);pageSelectorButton.setAttribute(DISABLED,DISABLED);pageSelectorButton.removeAttribute('data-hover');}}}
function updateCurrentPage(pageNum){if(pageNum>totalPages){pageNum=totalPages;}else if(pageNum<1){pageNum=1;}
dom.setText(currentPageEl,pageNum);return pageNum;}
function enterfullscreenHandler(){fullscreen.enter();if(viewer&&config.preview_type===DOCUMENT_TYPE_PRESENTATION){viewer.disableTextSelection();}}
function exitfullscreenHandler(){fullscreen.exit();if(viewer&&config.preview_type===DOCUMENT_TYPE_PRESENTATION){viewer.enableTextSelection();}}
function handleEmbedWidgetEvents(data){switch(data.type){case'previouspage':previouspageHandler();break;case'nextpage':nextpageHandler();break;case'initialized':intializeElementsAndViewer();break;}}
function intializeElementsAndViewer(){if(embed){controls=document.querySelector('.preview-embed-document-controls');if(controls){pagePrevControl=controls.querySelector('.preview-embed-control-back');pageNextControl=controls.querySelector('.preview-embed-control-forward');totalPagesEl=controls.querySelector('.preview-embed-display-total-pages');currentPageEl=controls.querySelector('.preview-embed-display-current-page');moduleControlsInitialized=true;}}else{controls=moduleEl.querySelector('.preview-controls');if(controls){pagePrevControl=controls.querySelector('.preview-controls-document-prev');pageNextControl=controls.querySelector('.preview-controls-document-next');totalPagesEl=controls.querySelector('.preview-controls-document-total-pages');currentPageEl=controls.querySelector('.preview-controls-document-current-page');pageSelectorButton=controls.querySelector('.preview-controls-document-page-selector');pageNumberInput=controls.querySelector('.preview-controls-document-page-number-input');}
if(config.preview_type===DOCUMENT_TYPE_PRESENTATION){pagePrevChevron=moduleEl.querySelector('.preview-presentation-previous-arrow ');pageNextChevron=moduleEl.querySelector('.preview-presentation-next-arrow ');}}
if(!embed||moduleControlsInitialized){if(finishedConverting){initViewer(finishedConvertingCallback);}else{updateStatus();}
if(browser.isSafari()&&pageSelectorButton){pageSelectorButton.setAttribute('aria-label',$t('Click to enter page number. Does not work under full screen mode.','preview_enter_page_number_safari'));}}}
return{messages:['previewprogress','embedwidgetevent','togglefullscreen'],behaviors:['preview-controls','preview-print'],onmessage:function(name,data){switch(name){case'previewprogress':if(clientSupportsSVG){data.fromRealTime=true;pollingStatusHandler({data:data});}
break;case'embedwidgetevent':handleEmbedWidgetEvents(data);break;case'togglefullscreen':if(fullscreen.isFullScreen()){exitfullscreenHandler();}else{enterfullscreenHandler();}
break;}},onclick:function(event,element,elementType){if(!viewerIsReady){return;}
if(element&&elementType&&!element.disabled){switch(elementType){case'print':context.broadcast('previewprint');break;case'previouspage':previouspageHandler();break;case'nextpage':nextpageHandler();break;case'zoomout':zoomOut();break;case'zoomin':zoomIn();break;case'enterfullscreen':enterfullscreenHandler();break;case'exitfullscreen':exitfullscreenHandler();break;case'showpagenuminput':showPageNumInput();break;}}else if((!element||!elementType)&&config.preview_type===DOCUMENT_TYPE_PRESENTATION&&fullscreen.isFullScreen()&&event.which===1&&!dom.getNearest(event.target,'a')){nextpageHandler();}},init:function(){fullscreen=context.getService('fullscreen');navState=context.getService('nav-state');browser=context.getService('browser');viewerService=context.getService('preview-crocodoc-wrapper');previewApi=context.getService('preview-api');hotkeysService=context.getService('hotkeys');dom=context.getService('dom');resin=context.getService('resin');document=context.getGlobal('document');config=context.getConfig();finishedConverting=config.done;moduleEl=context.getElement();crocodocNode=dom.query('.preview-svg',moduleEl);embed=moduleEl.getAttribute('data-preview-format')==='embed';clientSupportsSVG=browser.hasSVGSupport();intializeElementsAndViewer();},destroy:function(){if(viewer){viewer.destroy();}
if(pageIsReady){unsetHotkeys();}
dom.off(moduleEl,'mousewheel',onMousewheel);cancelStatusUpdate();context.broadcast('previewcontentunload');}};});Box.Application.addService('contextual-message',function(application){'use strict';var MARK_MESSAGE_AS_SEEN_RUNMODE='contextual_message_mark_as_seen';var MARK_MESSAGE_AS_CLOSED_RUNMODE='contextual_message_mark_as_closed';var REFRESH_PREVIEW_CONTENT='previewrefreshrequested';var TYPE_BANNER='banner';var TYPE_FULLSCREENTOUR='fullscreentour';var TYPE_MODAL='modal';var TYPE_POPOUT='popout';var pigeon={};var needsPreviewRefresh=[TYPE_FULLSCREENTOUR];var needsHotkeysDisabled=[TYPE_MODAL,TYPE_FULLSCREENTOUR,TYPE_POPOUT];var canCoexistWithOtherTypes=[TYPE_BANNER];var shouldDisableHotkeys=false;function canMessageTypesCoexist(messageType1,messageType2){return(messageType1!==messageType2)&&(canCoexistWithOtherTypes.indexOf(messageType1)>-1||canCoexistWithOtherTypes.indexOf(messageType2)>-1);}
function canCoexistWithCurrentlyShownMessages(currentlyShownMessages,messageToBeShown){var currentlyShownMessageTypes=Object.keys(currentlyShownMessages);var length=currentlyShownMessageTypes.length;for(var i=0;i<length;i++){if(!canMessageTypesCoexist(currentlyShownMessageTypes[i],messageToBeShown.type)){return false;}}
return true;}
function requestPreviewRefresh(messageType){if(needsPreviewRefresh.indexOf(messageType)>-1){application.broadcast(REFRESH_PREVIEW_CONTENT);}}
function setShouldDisabledHotkeys(messageType,shouldDisable){if(needsHotkeysDisabled.indexOf(messageType)>-1){shouldDisableHotkeys=shouldDisable;}}
function startMessageModuleIfNeeded(messageEl){if(!messageEl){return;}
var moduleEl=application.getService('dom').query('[data-module]',messageEl);if(moduleEl&&!application.isStarted(moduleEl)){application.start(moduleEl);}}
function markMessageAsSeen(messageId,messageContext){application.getService('ajax').post(MARK_MESSAGE_AS_SEEN_RUNMODE,{id:messageId,context:messageContext});}
function markMessageAsClosed(messageId,messageContext,wasTriggeredByUserAction){application.getService('ajax').post(MARK_MESSAGE_AS_CLOSED_RUNMODE,{id:messageId,context:messageContext,wasTriggeredByUserAction:wasTriggeredByUserAction});}
function onMessageLoaded(){}
function onMessageShown(messageHolder){var message=messageHolder.message;requestPreviewRefresh(message.type);setShouldDisabledHotkeys(message.type,true);startMessageModuleIfNeeded(message.el);markMessageAsSeen(message.id,message.context);}
function onMessageClosed(messageHolder){var message=messageHolder.message;markMessageAsClosed(message.id,message.context,messageHolder.wasTriggeredByUserAction);requestPreviewRefresh(message.type);setShouldDisabledHotkeys(message.type,false);}
function addMessageRepresentationFactoryIfPossible(factoryName){if(application.hasService(factoryName)){pigeon.addMessageRepresentationFactory(factoryName,application.getService(factoryName));}}
function init(){if(!application.hasService('pigeon')){throw new Error('contextual-message.js#init : contextual-message service should be available for this service to work');}
pigeon=application.getService('pigeon');pigeon.registerGlobalOnLoadCallback(onMessageLoaded).registerGlobalOnShowCallback(onMessageShown).registerGlobalOnCloseCallback(onMessageClosed).setCanMessagesCoexistEvaluator(canCoexistWithCurrentlyShownMessages);addMessageRepresentationFactoryIfPossible(TYPE_BANNER);addMessageRepresentationFactoryIfPossible(TYPE_FULLSCREENTOUR);addMessageRepresentationFactoryIfPossible(TYPE_MODAL);addMessageRepresentationFactoryIfPossible(TYPE_POPOUT);}
init();return{registerMessage:function(message){pigeon.registerMessage(message);},unregisterMessage:function(messageIdentifier,messageContext,messageType){pigeon.unregisterMessage(messageIdentifier,messageContext,messageType);},createMessageRepresentation:function(messageName,messageType){return pigeon.createMessageRepresentation(messageName,messageType);},createMessageRepresentationWithContext:function(messageName,messageType,messageContext){return pigeon.createMessageRepresentationWithContext(messageName,messageType,messageContext);},shouldDisableHotkeys:function(){return shouldDisableHotkeys;}};});Box.Application.addService('fullscreentour',function(application){'use strict';var ACTION_NEXT_SLIDE='carousel-next';var ACTION_PREVIOUS_SLIDE='carousel-previous';var ACTION_END_SLIDESHOW='close-message';var ESC_KEY=27;var LEFT_ARROW_KEY=37;var RIGHT_ARROW_KEY=39;var TIME_TO_MAKE_TOUR_VISIBLE=600;var CLASS_DISABLE_SELECTABLE='disable_selectable';var CLASS_FULLSCREEN_TOUR_BODY='fullscreen-tour';var CLASS_HIDDEN='hidden';var CLASS_HIDE_OVERFLOW='hide-overflow';var CLASS_IS_ACTIVE='is-active';var CLASS_NO_TRANSITION='no-transition';var CLASS_TOUR_SHIM='fullscreen-tour-shim';var ajaxService=application.getService('ajax');var carouselFactory=application.getService('slide-carousel');var domService=application.getService('dom');var promisesService=application.getService('promises');var resinService=application.getService('resin');var screenService=application.getService('screen');var currentTour=null;var carousel;var fakeBodyEl;var window=application.getGlobal('window');var requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame;var resinActionAttributes;function noop(){}
function getCurrentTourName(){return(currentTour!==null)?currentTour.tourData.name:null;}
function getCurrentPageName(){return resinService.sanitize(resinActionAttributes.page);}
function recordUserActionProgrammatically(target,action){resinService.recordAction({application:resinService.sanitize(resinActionAttributes.application),page:currentTour.tourEl.getAttribute('data-resin-page'),component:'none',feature:'fullscreentour',target:resinService.sanitize(target),action:resinService.sanitize(action)});}
function updateResinPage(){var resinPage=getCurrentPageName()+'|'+getCurrentTourName()+'|'+(carousel.getCurrentSlideName());currentTour.tourEl.setAttribute('data-resin-page',resinService.sanitize(resinPage));}
function initResinAttributes(){currentTour.tourEl.removeAttribute('data-resin-page');var resinTarget=currentTour.tourEl.firstChild;resinActionAttributes=resinService.getActionAttributes(resinTarget);updateResinPage();}
function getVideoFromCurrentSlide(slideName){return(slideName)?domService.query('[data-slide-name="'+slideName+'"] video',currentTour.tourEl):null;}
function pauseVideo(slideName){var videoEl=getVideoFromCurrentSlide(slideName);if(videoEl&&videoEl.pause){videoEl.pause();videoEl.currentTime=0;}}
function startVideo(slideName){var videoEl=getVideoFromCurrentSlide(slideName);if(videoEl&&videoEl.play){videoEl.play();}}
function appendChild(el,parentTargetEl){parentTargetEl.appendChild(el);}
function makeTourVisible(){domService.removeClass(currentTour.tourEl,CLASS_HIDDEN);}
function moveTourElementInsideBody(){appendChild(currentTour.tourEl,document.body);}
function resetAndHideTour(){domService.removeClass(domService.query('.slide.is-active',currentTour.tourEl),CLASS_IS_ACTIVE);domService.addClass(currentTour.tourEl,CLASS_HIDDEN);}
function moveAllChildElements(fromEl,toEl){while(fromEl.childNodes.length>0){appendChild(fromEl.childNodes[0],toEl);}}
function resetSlidePosition(){carousel.goToSlide(0);}
function resizeFakeBodyEl(event,shouldAnimate){var transparentSlideEl=domService.query('.slide .transparent',currentTour.tourEl);if(!transparentSlideEl){return;}
var slideClientRect=domService.getBoundingClientRect(transparentSlideEl);if(!shouldAnimate){domService.addClass(fakeBodyEl,CLASS_NO_TRANSITION);}
fakeBodyEl.style.left=slideClientRect.left+'px';fakeBodyEl.style.top=slideClientRect.top+'px';fakeBodyEl.style.width=slideClientRect.width+'px';fakeBodyEl.style.height=slideClientRect.height+'px';if(!shouldAnimate){requestAnimationFrame(function(){domService.removeClass(fakeBodyEl,CLASS_NO_TRANSITION);});}}
function displayShimForTour(){var bodyShim=document.createElement('div');bodyShim.className=CLASS_TOUR_SHIM;appendChild(bodyShim,document.body);}
function hideShimAfterTour(){var bodyShim=domService.query('.'+CLASS_TOUR_SHIM);bodyShim.parentNode.removeChild(bodyShim);}
function preparePageForTour(shouldShowTourWithAnimation){if(!shouldShowTourWithAnimation){displayShimForTour();return;}
var tempFakeBodyContainerEl;tempFakeBodyContainerEl=document.createElement('div');tempFakeBodyContainerEl.className='tour-fullscreen-fake-body-container tour-flex-container tour-full-abs-pos';fakeBodyEl=document.createElement('div');fakeBodyEl.className='tour-fullscreen-fake-body tour-full-abs-pos '+CLASS_IS_ACTIVE;appendChild(fakeBodyEl,tempFakeBodyContainerEl);moveAllChildElements(document.body,fakeBodyEl);appendChild(tempFakeBodyContainerEl,document.body);}
function resetBodyAfterTour(shouldShowTourWithAnimation){if(!shouldShowTourWithAnimation){hideShimAfterTour();return;}
moveAllChildElements(fakeBodyEl,document.body);document.body.removeChild(fakeBodyEl.parentNode);fakeBodyEl=null;}
function registerTransitionEventCallbacks(transitioningEl,callback){function onTourStartTransitionEnd(){domService.off(transitioningEl,'transitionend',onTourStartTransitionEnd);callback();}
domService.on(transitioningEl,'transitionend',onTourStartTransitionEnd);}
function isTourBeingShownWithAnimation(){return currentTour&&currentTour.tourEl&&currentTour.tourEl.getAttribute('data-should-animate')!=='false';}
function setFakeBodyClass(isActive){if(!isTourBeingShownWithAnimation()){return;}
if(isActive){domService.addClass(fakeBodyEl,CLASS_IS_ACTIVE);}else{domService.removeClass(fakeBodyEl,CLASS_IS_ACTIVE);}}
function setDocumentBodyClasses(shouldShowTourWithAnimation){if(!shouldShowTourWithAnimation){domService.addClass(document.body,CLASS_HIDE_OVERFLOW);}
domService.addClass(document.body,CLASS_FULLSCREEN_TOUR_BODY);domService.addClass(document.body,CLASS_DISABLE_SELECTABLE);}
function removeDocumentBodyClasses(shouldShowTourWithAnimation){if(!shouldShowTourWithAnimation){domService.removeClass(document.body,CLASS_HIDE_OVERFLOW);}
domService.removeClass(document.body,CLASS_FULLSCREEN_TOUR_BODY);domService.removeClass(document.body,CLASS_DISABLE_SELECTABLE);}
function resizeBodyForTour(){resizeFakeBodyEl(null,true);}
function createTourShowAnimation(){setTimeout(function(){makeTourVisible();startVideo(carousel.getCurrentSlideName());},TIME_TO_MAKE_TOUR_VISIBLE);domService.addClass(domService.query('.'+CLASS_TOUR_SHIM),CLASS_IS_ACTIVE);}
function createAnimationScaffold(){var shouldShowTourWithAnimation=isTourBeingShownWithAnimation();preparePageForTour(shouldShowTourWithAnimation);moveTourElementInsideBody();if(shouldShowTourWithAnimation){domService.on(window,'resize',resizeFakeBodyEl);registerTransitionEventCallbacks(fakeBodyEl,resetSlidePosition);setDocumentBodyClasses(shouldShowTourWithAnimation);makeTourVisible();resizeBodyForTour();}else{resetSlidePosition();setDocumentBodyClasses(shouldShowTourWithAnimation);requestAnimationFrame(createTourShowAnimation);}}
function destroyAnimationScaffold(){var shouldShowTourWithAnimation=isTourBeingShownWithAnimation();if(shouldShowTourWithAnimation){domService.off(window,'resize',resizeFakeBodyEl);}
resetBodyAfterTour(shouldShowTourWithAnimation);resetAndHideTour();moveTourElementInsideBody();removeDocumentBodyClasses();}
function closeTour(){detachTourListeners();if(currentTour){pauseVideo(carousel.getCurrentSlideName());destroyAnimationScaffold();currentTour.tourEl=null;carousel.destroy();currentTour.onCloseCallback();}
currentTour=null;}
function goToNextSlide(){if(!currentTour){return;}
pauseVideo(carousel.getCurrentSlideName());carousel.goToNextSlide();if(carousel.currentSlideNum>0&&isTourBeingShownWithAnimation()){setFakeBodyClass(false);}
startVideo(carousel.getCurrentSlideName());recordUserActionProgrammatically('next','click');updateResinPage();recordUserActionProgrammatically('loaded','programmatic');}
function goToPreviousSlide(){if(!currentTour){return;}
pauseVideo(carousel.getCurrentSlideName());carousel.goToPrevSlide();if(carousel.currentSlideNum<=0&&isTourBeingShownWithAnimation()){setFakeBodyClass(true);}
startVideo(carousel.getCurrentSlideName());recordUserActionProgrammatically('previous','click');updateResinPage();recordUserActionProgrammatically('loaded','programmatic');}
function mouseUpHandler(event){var element=event.target||event.srcElement;var action=element.getAttribute('data-action');if(action===ACTION_PREVIOUS_SLIDE){goToPreviousSlide();}else if(action===ACTION_NEXT_SLIDE){goToNextSlide();}else if(action===ACTION_END_SLIDESHOW){closeTour();}}
function keyUpHandler(event){var key=event.keyCode;if(key===LEFT_ARROW_KEY){goToPreviousSlide();}else if(key===RIGHT_ARROW_KEY){goToNextSlide();}else if(key===ESC_KEY){recordUserActionProgrammatically('close|esc','keypress');closeTour();}}
function attachTourListeners(){domService.on(document.body,'mouseup',mouseUpHandler);domService.on(document.body,'keyup',keyUpHandler);}
function detachTourListeners(){domService.off(document.body,'mouseup',mouseUpHandler);domService.off(document.body,'keyup',keyUpHandler);}
function showTour(){attachTourListeners();carousel=carouselFactory.create(currentTour.tourEl);createAnimationScaffold();document.body.focus();initResinAttributes();recordUserActionProgrammatically('loaded','programmatic');var callbackData=$.extend({},currentTour.tourData,{el:currentTour.tourEl});currentTour.onShowCallback(callbackData);}
function loadTour(tour){var tourEl=domService.query('[data-fullscreentour-name="'+tour.tourData.name+'"]');var runmode=tour.tourData.templateFetchEndpoint;var params={id:tour.tourData.id,identifier:tour.tourData.identifier,isHighDensityDisplay:screenService.isHighDensity()};if(tourEl){tour.onLoadCallback(tour.tourData);return promisesService.createResolved();}
return ajaxService.get(runmode,params).then(function tourContentReceived(response){var tourFragment=domService.createFragmentFromHtml(response.data.html);document.body.appendChild(tourFragment);return;}).then(function executeLoadCallbacks(){tour.onLoadCallback(tour.tourData);return;});}
function FullscreenTour(tourData){this.tourData=tourData;this.tourEl=null;this.onLoadCallback=noop;this.onShowCallback=noop;this.onCloseCallback=noop;}
FullscreenTour.prototype={load:function(){return loadTour(this);},show:function(){var tourName=this.tourData.name;currentTour=this;this.load().then(function(){currentTour.tourEl=domService.query('[data-fullscreentour-name="'+tourName+'"]');showTour();});},unload:function(){},setOnLoadCallback:function(callback){if(typeof callback==='function'){this.onLoadCallback=callback;}},setOnShowCallback:function(callback){if(typeof callback==='function'){this.onShowCallback=callback;}},setOnCloseCallback:function(callback){if(typeof callback==='function'){this.onCloseCallback=callback;}},_close:closeTour};return{create:function(tourData){return new FullscreenTour(tourData);}};});Box.Application.addService('modal',function(application){'use strict';var ACTION_NEXT_SLIDE='carousel-next';var ACTION_PREVIOUS_SLIDE='carousel-previous';var ACTION_END_SLIDESHOW='close-message';var ACTION_LAUNCH_MESSAGE='launch-message';var ACTION_GOTO_URL='go-to-url';var ESC_KEY=27;var LEFT_ARROW_KEY=37;var RIGHT_ARROW_KEY=39;var DISABLE_SELECTABLE_CLASS='disable_selectable';var FINAL_SLIDE_CLASS='final-slide';var HIDDEN_CLASS='hidden';var NO_SCROLL_CLASS='no_scroll';var ajaxService=application.getService('ajax');var carouselFactory=application.getService('slide-carousel');var domService=application.getService('dom');var navService=application.getService('nav');var promisesService=application.getService('promises');var resinService=application.getService('resin');var screenService=application.getService('screen');var currentModal=null;var carousel;var backBtnEl;var resinActionAttributes;function noop(){}
function getCurrentModalName(){return(currentModal!==null)?currentModal.modalData.name:null;}
function getCurrentPageName(){return resinService.sanitize(resinActionAttributes.page);}
function recordUserActionProgrammatically(target,action){resinService.recordAction({application:resinService.sanitize(resinActionAttributes.application),page:currentModal.modalEl.getAttribute('data-resin-page'),component:'none',feature:'modal',target:resinService.sanitize(target),action:resinService.sanitize(action)});}
function updateResinPage(){var resinPage=getCurrentPageName()+'|'+getCurrentModalName()+'|'+(carousel.getCurrentSlideName());currentModal.modalEl.setAttribute('data-resin-page',resinService.sanitize(resinPage));}
function initResinAttributes(){currentModal.modalEl.removeAttribute('data-resin-page');var resinTarget=currentModal.modalEl.firstChild;resinActionAttributes=resinService.getActionAttributes(resinTarget);updateResinPage();}
function resetModalButtons(){if(carousel.isOnLastSlide()){domService.addClass(currentModal.modalEl,FINAL_SLIDE_CLASS);}else{domService.removeClass(currentModal.modalEl,FINAL_SLIDE_CLASS);}
if(carousel.currentSlideNum===0){domService.addClass(backBtnEl,HIDDEN_CLASS);}else{domService.removeClass(backBtnEl,HIDDEN_CLASS);}}
function doHideCurrentModal(){domService.addClass(currentModal.modalEl,HIDDEN_CLASS);domService.removeClass(currentModal.modalEl,DISABLE_SELECTABLE_CLASS);domService.removeClass(document.body,NO_SCROLL_CLASS);}
function doShowCurrentModal(){resetModalButtons();domService.removeClass(currentModal.modalEl,HIDDEN_CLASS);domService.addClass(currentModal.modalEl,DISABLE_SELECTABLE_CLASS);domService.addClass(document.body,NO_SCROLL_CLASS);}
function goToNextSlide(){if(!currentModal){return;}
carousel.goToNextSlide();resetModalButtons();recordUserActionProgrammatically('next','click');updateResinPage();recordUserActionProgrammatically('loaded','programmatic');}
function goToPreviousSlide(){if(!currentModal){return;}
carousel.goToPrevSlide();resetModalButtons();recordUserActionProgrammatically('previous','click');updateResinPage();recordUserActionProgrammatically('loaded','programmatic');}
function closeModal(){detachModalListeners();if(currentModal){doHideCurrentModal();carousel.destroy();currentModal.onCloseCallback();}
currentModal=null;}
function onLaunchMessageButtonClicked(messageName,messageType){if(!messageName||!messageType){return;}
closeModal();var contextualMessageService=application.getService('contextual-message');contextualMessageService.createMessageRepresentation(messageName,messageType).setIsTriggeredByUserAction(true).show();}
function onGoToUrlButtonClicked(goToUrl){if(!goToUrl){return;}
closeModal();navService.redirect(goToUrl);}
function mouseUpHandler(event){var element=event.target||event.srcElement;var action=element.getAttribute('data-action');switch(action){case ACTION_PREVIOUS_SLIDE:goToPreviousSlide();break;case ACTION_NEXT_SLIDE:goToNextSlide();break;case ACTION_END_SLIDESHOW:closeModal();break;case ACTION_LAUNCH_MESSAGE:var messageName=element.getAttribute('data-actiondata-messagename');var messageType=element.getAttribute('data-actiondata-messagetype');onLaunchMessageButtonClicked(messageName,messageType);break;case ACTION_GOTO_URL:var goToUrl=element.getAttribute('data-actiondata-url');onGoToUrlButtonClicked(goToUrl);break;}}
function keyUpHandler(event){var key=event.keyCode;if(key===LEFT_ARROW_KEY){goToPreviousSlide();}else if(key===RIGHT_ARROW_KEY){goToNextSlide();}else if(key===ESC_KEY){recordUserActionProgrammatically('close|esc','keypress');closeModal();}}
function attachModalListeners(){domService.on(document.body,'mouseup',mouseUpHandler);domService.on(document.body,'keyup',keyUpHandler);}
function detachModalListeners(){domService.off(document.body,'mouseup',mouseUpHandler);domService.off(document.body,'keyup',keyUpHandler);}
function showModal(){attachModalListeners();backBtnEl=domService.query('[data-action="'+ACTION_PREVIOUS_SLIDE+'"]',currentModal.modalEl);carousel=carouselFactory.create(currentModal.modalEl);carousel.goToSlide(0);doShowCurrentModal();initResinAttributes();recordUserActionProgrammatically('loaded','programmatic');var callbackData=$.extend({},currentModal.modalData,{el:currentModal.modalEl});currentModal.onShowCallback(callbackData);}
function loadHighResolutionImagesIfNeeded(fragmentOrElement){if(!screenService.isHighDensity()){return fragmentOrElement;}
var figureEls=fragmentOrElement.querySelectorAll('figure');for(var i=0;i<figureEls.length;i++){if(figureEls[i].hasAttribute('data-highres-img')){var image=new Image();image.onload=(function(){var figureEl=figureEls[i];var highResBackgroundImage=figureEl.getAttribute('data-highres-img');return function(){figureEl.style.backgroundImage='url('+highResBackgroundImage+')';figureEl.removeAttribute('data-highres-img');};}());image.src=figureEls[i].getAttribute('data-highres-img');}}
return fragmentOrElement;}
function loadModal(modal){var modalEl=domService.query('[data-modal-name="'+modal.modalData.name+'"]');var runmode=modal.modalData.templateFetchEndpoint;var params={id:modal.modalData.id,identifier:modal.modalData.identifier,isHighDensityDisplay:screenService.isHighDensity()};if(modalEl){loadHighResolutionImagesIfNeeded(modalEl);modal.onLoadCallback(modal.modalData);return promisesService.createResolved();}
return ajaxService.get(runmode,params).then(function modalContentReceived(response){var modalFragment=domService.createFragmentFromHtml(response.data.html);var updatedModalFragment=loadHighResolutionImagesIfNeeded(modalFragment);document.body.appendChild(updatedModalFragment);return;}).then(function executeLoadCallbacks(){modal.onLoadCallback(modal.modalData);return;});}
function Modal(modalData){this.modalData=modalData;this.modalEl=null;this.onLoadCallback=noop;this.onShowCallback=noop;this.onCloseCallback=noop;}
Modal.prototype={load:function(){return loadModal(this);},show:function(){var modalName=this.modalData.name;currentModal=this;this.load().then(function(){currentModal.modalEl=domService.query('[data-modal-name="'+modalName+'"]');showModal();});},unload:function(){},setOnLoadCallback:function(callback){if(typeof callback==='function'){this.onLoadCallback=callback;}},setOnShowCallback:function(callback){if(typeof callback==='function'){this.onShowCallback=callback;}},setOnCloseCallback:function(callback){if(typeof callback==='function'){this.onCloseCallback=callback;}},_close:closeModal};return{create:function(modalData){return new Modal(modalData);}};});Box.Application.addService('message-registration-desk',function(){'use strict';var registeredMessages={};function registerMessage(message){if(!(message.identifier in registeredMessages)){registeredMessages[message.identifier]={};}
registeredMessages[message.identifier][message.context]=message;}
function removeMessageFromRegisteredList(messageIdentifier,messageContext){if(messageIdentifier in registeredMessages){if(Object.keys(registeredMessages[messageIdentifier]).length===1){delete registeredMessages[messageIdentifier];}else{delete registeredMessages[messageIdentifier][messageContext];}}}
function getRegisteredMessage(messageIdentifier,messageContext){var registeredMessage;var registeredMessageContexts;if(!(messageIdentifier in registeredMessages)){return null;}
registeredMessage=registeredMessages[messageIdentifier];if(messageContext===null){registeredMessageContexts=Object.keys(registeredMessage);if(registeredMessageContexts.length>1){var errorMsg='Message context needs to be specified when a message has been registered with multiple contexts. ';errorMsg+='[identifier: '+messageIdentifier+']';throw new Error(errorMsg);}
return(registeredMessageContexts.length===1)?registeredMessage[registeredMessageContexts[0]]:null;}
return(messageContext in registeredMessage)?registeredMessage[messageContext]:null;}
function getAllRegisteredMessagesOfType(messageType){var messagesOfType=[];Object.keys(registeredMessages).map(function(identifier){Object.keys(registeredMessages[identifier]).map(function(context){var message=registeredMessages[identifier][context];if(message.type===messageType){messagesOfType.push(message);}});});return messagesOfType;}
return{register:registerMessage,unregister:removeMessageFromRegisteredList,get:getRegisteredMessage,getAllRegisteredMessagesOfType:getAllRegisteredMessagesOfType};});Box.Application.addService('message-factory-collection',function(){'use strict';var messageRepresentationFactories={};function isValidFactory(factory){if(factory.create){return true;}
throw new Error('[message-representation-factory] Should define create method');}
return{add:function(factoryName,factoryService){if(isValidFactory(factoryService)){messageRepresentationFactories[factoryName]=factoryService;}},get:function(factoryName){return messageRepresentationFactories[factoryName]||null;}};});Box.Application.addService('message-auctioneer',function(application){'use strict';var DEBOUNCE_PERIOD_IN_MS=50;var ONLOAD_KEY='onLoad';var ONSHOW_KEY='onShow';var ONCLOSE_KEY='onClose';var priorityQueueService=application.getService('priority-queue');var messagesToLoadQueues={};var messagesToShowQueue;var debouncedActionTimeout=null;var messagePreLoadCallbacks=[];var fnMessageEligibilityEvaluator=null;function compareMessagesByImportance(messageHolder1,messageHolder2){var message1=messageHolder1.message;var message2=messageHolder2.message;var priorityDiff=message2.priority-message1.priority;if(priorityDiff!==0){return priorityDiff;}
var exemptionDiff=(+message2.isExemptFromSuppression)-(+message1.isExemptFromSuppression);if(exemptionDiff!==0){return exemptionDiff;}
var recencyDiff=message2.createdDate-message1.createdDate;return recencyDiff;}
function isMessageEligible(message,messagesToBeShown){if(fnMessageEligibilityEvaluator===null){return true;}
return fnMessageEligibilityEvaluator(message,messagesToBeShown);}
function getEligibleMessageHolderWithHighestPriority(priorityQueue,messageHoldersToBeShown){if(!priorityQueue){return null;}
var messageHolder=null;var messagesToBeShown=messageHoldersToBeShown.map(function(messageHolderToBeShown){return messageHolderToBeShown.message;});do{messageHolder=priorityQueue.dequeue();}while(messageHolder!==null&&!isMessageEligible(messageHolder.message,messagesToBeShown));return messageHolder;}
function runAllOnMessagePreLoadCallbacks(message){var fnCallbacks=messagePreLoadCallbacks;for(var i=0,l=fnCallbacks.length;i<l;i++){fnCallbacks[i].call(null,message);}}
function loadMessages(messageHoldersToLoad){for(var i=0;i<messageHoldersToLoad.length;i++){runAllOnMessagePreLoadCallbacks(messageHoldersToLoad[i].message);messageHoldersToLoad[i].representation.load();}}
function showMessages(messageHoldersToShow){for(var i=0;i<messageHoldersToShow.length;i++){messageHoldersToShow[i].representation.show();}}
function processAllRequests(){var messageHoldersToLoad=[];var messageHoldersToShow=[];var messageTypesThatWillBeShown=[];var messageHolder;do{messageHolder=getEligibleMessageHolderWithHighestPriority(messagesToShowQueue,messageHoldersToShow);if(messageHolder!==null){messageHoldersToShow.push(messageHolder);messageTypesThatWillBeShown.push(messageHolder.message.type);}}while(messageHolder!==null);for(var messageType in messagesToLoadQueues){if(messageTypesThatWillBeShown.indexOf(messageType)===-1){messageHolder=getEligibleMessageHolderWithHighestPriority(messagesToLoadQueues[messageType],[]);if(messageHolder!==null){messageHoldersToLoad.push(messageHolder);}
messagesToLoadQueues[messageType].clear();}}
showMessages(messageHoldersToShow);loadMessages(messageHoldersToLoad);}
function queueThenProcessDebouncedRequest(queue,requestObject){queue.queue(requestObject);if(debouncedActionTimeout!==null){return;}
debouncedActionTimeout=setTimeout(function(){processAllRequests();debouncedActionTimeout=null;}.bind(this),DEBOUNCE_PERIOD_IN_MS);}
function DisplayableMessage(message,messageRepresentation){this.identifier=message.identifier;this.name=message.name;this.type=message.type;this.context=message.context;this.isTriggeredByUserAction=null;this._representation=messageRepresentation;var callbacks={onLoad:[],onShow:[],onClose:[]};function getMessageHolder(){return{message:message,representation:messageRepresentation};}
function addCallBackHandlerByEventType(type,callback){if(typeof callback!=='function'){return;}
callbacks[type].push(callback);}
function runAllCallBackHandlersByEventType(type,messageHolder){var fnCallbacks=callbacks[type];for(var i=0,l=fnCallbacks.length;i<l;i++){fnCallbacks[i].call(null,messageHolder);}}
this.setIsTriggeredByUserAction=function(isTriggeredByUserAction){this.isTriggeredByUserAction=isTriggeredByUserAction;return this;};this.load=function(){var messageHolder=getMessageHolder();messagesToLoadQueues[message.type]=messagesToLoadQueues[message.type]||priorityQueueService.create(compareMessagesByImportance);queueThenProcessDebouncedRequest(messagesToLoadQueues[message.type],messageHolder);};this.show=function(){if(this.isTriggeredByUserAction===null){throw new Error('setIsTriggeredByUserAction() needs to be called before calling show()');}
var messageHolder=getMessageHolder();messagesToShowQueue=messagesToShowQueue||priorityQueueService.create(compareMessagesByImportance);queueThenProcessDebouncedRequest(messagesToShowQueue,messageHolder);};this.registerOnLoadCallback=function(callback){addCallBackHandlerByEventType(ONLOAD_KEY,callback);return this;};this.registerOnShowCallback=function(callback){addCallBackHandlerByEventType(ONSHOW_KEY,callback);return this;};this.registerOnCloseCallback=function(callback){addCallBackHandlerByEventType(ONCLOSE_KEY,callback);return this;};messageRepresentation.setOnLoadCallback(function(){var messageHolder=getMessageHolder();runAllCallBackHandlersByEventType(ONLOAD_KEY,messageHolder);});messageRepresentation.setOnShowCallback(function(representationMessageData){var messageHolder=getMessageHolder();messageHolder.message.el=representationMessageData.el;runAllCallBackHandlersByEventType(ONSHOW_KEY,messageHolder);});var me=this;messageRepresentation.setOnCloseCallback(function(){var messageHolder=getMessageHolder();messageHolder.wasTriggeredByUserAction=me.isTriggeredByUserAction;runAllCallBackHandlersByEventType(ONCLOSE_KEY,messageHolder);});}
function NonDisplayableMessage(messageIdentifier,messageName,messageContext){this.identifier=messageIdentifier;this.name=messageName;this.type='non-displayable';this.context=messageContext;this.isTriggeredByUserAction=null;this.setIsTriggeredByUserAction=function(isTriggeredByUserAction){this.isTriggeredByUserAction=isTriggeredByUserAction;return this;};this.load=function(){};this.show=function(){if(this.isTriggeredByUserAction===null){throw new Error('setIsTriggeredByUserAction() needs to be called before calling show()');}};this.registerOnLoadCallback=function(){return this;};this.registerOnShowCallback=function(){return this;};this.registerOnCloseCallback=function(){return this;};}
return{createDisplayableMessageProxy:function(message,messageRepresentation){return new DisplayableMessage(message,messageRepresentation);},createNonDisplayableMessageProxy:function(message){var messageIdentifier=message?message.identifier:null;var messageName=message?message.name:null;var messageContext=message?message.context:null;return new NonDisplayableMessage(messageIdentifier,messageName,messageContext);},registerOnMessagePreLoadCallback:function(callback){messagePreLoadCallbacks.push(callback);return this;},setMessageEligibilityEvaluator:function(evaluator){if(typeof evaluator!=='function'){throw new Error('[message-auctioneer] param to setMessageEligibilityEvaluator should be function!');}
fnMessageEligibilityEvaluator=evaluator;return this;}};});Box.Application.addService('pigeon',function(application){'use strict';var ONLOAD_KEY='onLoad';var ONSHOW_KEY='onShow';var ONCLOSE_KEY='onClose';var publicApi;var messageFactoryCollectionService=application.getService('message-factory-collection');var messageRegistrationService=application.getService('message-registration-desk');var messageAuctioneerService=application.getService('message-auctioneer');var currentlyShownMessages={};var messagesSeenInCurrentSession={};var messageTypesSuppressedInCurrentSession={};var loadedMessages={};var globalCallbacks={onLoad:[],onShow:[],onClose:[]};var canCoexistWithCurrentlyShownMessagesEvaluator=null;function isShowingMessage(shownMessages){var shownMessageTypes=Object.keys(shownMessages);return shownMessageTypes.length!==0;}
function canCoexistWithShownAndToBeShownMessages(message,messagesAboutToBeShown){var currentlyAndAboutToBeShownMessages=$.extend({},currentlyShownMessages);messagesAboutToBeShown.map(function(messageAboutToBeShown){currentlyAndAboutToBeShownMessages[messageAboutToBeShown.type]=messageAboutToBeShown;});if(!isShowingMessage(currentlyAndAboutToBeShownMessages)){return true;}
if(canCoexistWithCurrentlyShownMessagesEvaluator!==null){return canCoexistWithCurrentlyShownMessagesEvaluator(currentlyAndAboutToBeShownMessages,message);}
return false;}
function getMessageIdentifier(messageName,messageType){return messageType+'_'+messageName;}
function wasMessageShownInCurrentSession(messageIdentifier,messageContext){return(messageIdentifier in messagesSeenInCurrentSession&&messageContext in messagesSeenInCurrentSession[messageIdentifier]);}
function wasMessageTypeSuppressedInCurrentSession(messageType){return(messageType in messageTypesSuppressedInCurrentSession);}
function shouldRegisterMessage(message){if((!message.canBeShownMultipleTimes&&wasMessageShownInCurrentSession(message.identifier,message.context))||(!message.isExemptFromSuppression&&wasMessageTypeSuppressedInCurrentSession(message.type))){return false;}
return true;}
function shouldApplySuppression(triggeringMessage,wasMessageTriggeredByUserAction){return(triggeringMessage.shouldStartSuppressionPeriod&&!wasMessageTriggeredByUserAction);}
function applySuppressionOnMessagesOfType(messageType){var registeredMessagesOfType=messageRegistrationService.getAllRegisteredMessagesOfType(messageType);var numMessages=registeredMessagesOfType.length;for(var i=0;i<numMessages;i++){var message=registeredMessagesOfType[i];if(!message.isExemptFromSuppression){messageRegistrationService.unregister(message.identifier,message.context);}}
messageTypesSuppressedInCurrentSession[messageType]=true;}
function isMessageLoaded(messageIdentifier,messageType){var loadedMessage=loadedMessages[messageType];return(loadedMessage&&loadedMessage.identifier===messageIdentifier);}
function unloadCurrentlyLoadedMessage(messageType){var loadedMessageRepresentationObject=loadedMessages[messageType];if(loadedMessageRepresentationObject){var representation=loadedMessageRepresentationObject.representation;loadedMessages[messageType]=null;representation.unload();}}
function getAllAutoLoadableMessagesOfType(messageType){var autoLoadableMessages=[];var registeredMessagesOfType=messageRegistrationService.getAllRegisteredMessagesOfType(messageType);var numMessages=registeredMessagesOfType.length;for(var i=0;i<numMessages;i++){var message=registeredMessagesOfType[i];if(message.shouldAutoLoad){autoLoadableMessages.push(message);}}
return autoLoadableMessages;}
function loadNextAutoLoadableMessageOfType(messageType){var autoLoadableMessages=getAllAutoLoadableMessagesOfType(messageType);autoLoadableMessages.map(function(message){var representationProxy=publicApi.createMessageRepresentationWithContext(message.name,message.type,message.context);representationProxy.load();});}
function isMessageRegistered(message){return message!==null&&messageRegistrationService.get(message.identifier,message.context)!==null;}
function canMessageBeShownNow(message,messagesAboutToBeShown){messagesAboutToBeShown=messagesAboutToBeShown||[];return(isMessageRegistered(message)&&canCoexistWithShownAndToBeShownMessages(message,messagesAboutToBeShown));}
function canShowMessageMultipleTimes(messageIdentifier,messageContext){var message=messageRegistrationService.get(messageIdentifier,messageContext);return(message)?message.canBeShownMultipleTimes:false;}
function runAllGlobalCallBackHandlersByEventType(type,messageHolder){var fnCallbacks=globalCallbacks[type];for(var i=0,l=fnCallbacks.length;i<l;i++){fnCallbacks[i].call(null,messageHolder);}}
function addGlobalCallbackHandlerByEventType(type,callback){if(typeof callback!=='function'){return;}
globalCallbacks[type].push(callback);}
function markMessageAsSeen(messageIdentifier,messageContext){if(!(messageIdentifier in messagesSeenInCurrentSession)){messagesSeenInCurrentSession[messageIdentifier]={};}
messagesSeenInCurrentSession[messageIdentifier][messageContext]=true;}
function addToCurrentlyShownMessages(message){currentlyShownMessages[message.type]=message;}
function removeFromCurrentlyShownMessages(message){delete currentlyShownMessages[message.type];}
function onMessageLoaded(messageHolder){var message=messageHolder.message;loadedMessages[message.type]={identifier:message.identifier,representation:messageHolder.representation};runAllGlobalCallBackHandlersByEventType(ONLOAD_KEY,messageHolder);}
function onMessageShown(messageHolder){var message=messageHolder.message;addToCurrentlyShownMessages(message);if(!canShowMessageMultipleTimes(message.identifier,message.context)){messageRegistrationService.unregister(message.identifier,message.context);}
markMessageAsSeen(message.identifier,message.context);runAllGlobalCallBackHandlersByEventType(ONSHOW_KEY,messageHolder);}
function onMessageClosed(messageHolder){var messageClosed=messageHolder.message;var isClosedMessageStillRegistered;removeFromCurrentlyShownMessages(messageClosed);if(shouldApplySuppression(messageClosed,messageHolder.wasTriggeredByUserAction)){applySuppressionOnMessagesOfType(messageClosed.type);}
isClosedMessageStillRegistered=isMessageRegistered(messageClosed);if(!isClosedMessageStillRegistered||!canShowMessageMultipleTimes(messageClosed.identifier,messageClosed.context)){unloadCurrentlyLoadedMessage(messageClosed.type);loadNextAutoLoadableMessageOfType(messageClosed.type);}
runAllGlobalCallBackHandlersByEventType(ONCLOSE_KEY,messageHolder);}
function onMessagePreLoad(message){if(!isMessageLoaded(message.identifier,message.type)){unloadCurrentlyLoadedMessage(message.type);}}
function init(){messageAuctioneerService.registerOnMessagePreLoadCallback(onMessagePreLoad).setMessageEligibilityEvaluator(canMessageBeShownNow);}
publicApi={registerMessage:function(message){var representationProxy;if(shouldRegisterMessage(message)){messageRegistrationService.register(message);if(message.shouldAutoShow){representationProxy=this.createMessageRepresentationWithContext(message.name,message.type,message.context);representationProxy.setIsTriggeredByUserAction(false).show();}else if(message.shouldAutoLoad){representationProxy=this.createMessageRepresentationWithContext(message.name,message.type,message.context);representationProxy.setIsTriggeredByUserAction(false).load();}}},unregisterMessage:function(messageIdentifier,messageContext,messageType){messageRegistrationService.unregister(messageIdentifier,messageContext);if(isMessageLoaded(messageIdentifier,messageType)){unloadCurrentlyLoadedMessage(messageType);loadNextAutoLoadableMessageOfType(messageType);}},createMessageRepresentation:function(messageName,messageType){var messageContext=null;return this.createMessageRepresentationWithContext(messageName,messageType,messageContext);},createMessageRepresentationWithContext:function(messageName,messageType,messageContext){var messageIdentifier=getMessageIdentifier(messageName,messageType);var message=messageRegistrationService.get(messageIdentifier,messageContext);if(!canMessageBeShownNow(message)){return messageAuctioneerService.createNonDisplayableMessageProxy(message);}
var messageRepresentationFactory=messageFactoryCollectionService.get(messageType);if(messageRepresentationFactory===null){return messageAuctioneerService.createNonDisplayableMessageProxy(message);}
var messageRepresentation=messageRepresentationFactory.create(message);var proxy=messageAuctioneerService.createDisplayableMessageProxy(message,messageRepresentation);proxy.registerOnLoadCallback(onMessageLoaded);proxy.registerOnShowCallback(onMessageShown);proxy.registerOnCloseCallback(onMessageClosed);return proxy;},addMessageRepresentationFactory:function(type,factory){messageFactoryCollectionService.add(type,factory);},registerGlobalOnLoadCallback:function(callback){addGlobalCallbackHandlerByEventType(ONLOAD_KEY,callback);return this;},registerGlobalOnShowCallback:function(callback){addGlobalCallbackHandlerByEventType(ONSHOW_KEY,callback);return this;},registerGlobalOnCloseCallback:function(callback){addGlobalCallbackHandlerByEventType(ONCLOSE_KEY,callback);return this;},setCanMessagesCoexistEvaluator:function(callback){if(typeof callback==='function'){canCoexistWithCurrentlyShownMessagesEvaluator=callback;}else{throw new Error('Invalid parameter callback passed in.');}
return this;},_getRegisteredMessage:function(messageIdentifier,messageContext){return messageRegistrationService.get(messageIdentifier,messageContext);}};init();return publicApi;});Box.Application.addService('popout',function(application){'use strict';var ACTION_TOGGLE_POPOUT='toggle-popout';var ACTION_LAUNCH_MESSAGE='launch-message';var ACTION_GOTO_URL='go-to-url';var ACTION_CLOSE_POPOUT='close-message';var CLASS_TOGGLE_POPOUT_BUTTON='popout-toggle-button';var ESC_KEY=27;var CLOSE_PRESS_ESC_KEY={target:'esc',action:'keypress'};var CLOSE_CLICK_TOGGLE_BUTTON={target:'helpbutton',action:'click'};var CLOSE_CLICK_PRIMARY_BUTTON={target:'cta1',action:'click'};var CLOSE_CLICK_SECONDARY_BUTTON={target:'cta2',action:'click'};var CLOSE_CLICK_OVERLAY={target:'overlay',action:'click'};var ajaxService=application.getService('ajax');var domService=application.getService('dom');var menuToggleService=application.getService('menu-toggle');var navService=application.getService('nav');var promisesService=application.getService('promises');var resinService=application.getService('resin');var screenService=application.getService('screen');var currentPopout={};var isPopoutShown=false;var menu;var resinActionAttributes;var closeTarget;function noop(){}
function getCurrentPageName(){return resinService.sanitize(resinActionAttributes.page);}
function updateResinPage(){var popoutName=currentPopout.popoutEl.getAttribute('data-popout-name');var resinPage=getCurrentPageName()+'|'+popoutName;currentPopout.popoutEl.setAttribute('data-resin-page',resinService.sanitize(resinPage));}
function initResinAttributes(){currentPopout.popoutEl.removeAttribute('data-resin-page');var resinFeatureTarget=domService.query('[data-resin-feature]',currentPopout.popoutEl);resinActionAttributes=resinService.getActionAttributes(resinFeatureTarget);updateResinPage();}
function recordUserActionProgrammatically(target,action){resinService.recordAction({application:resinService.sanitize(resinActionAttributes.application),page:currentPopout.popoutEl.getAttribute('data-resin-page'),component:'popout',feature:'popout',target:resinService.sanitize(target),action:resinService.sanitize(action)});}
function recordCloseAction(){var closeActionTarget=closeTarget||CLOSE_CLICK_OVERLAY;recordUserActionProgrammatically('close|'+closeActionTarget.target,closeActionTarget.action);closeTarget=null;}
function closePopout(){if(!isPopoutShown){return;}
menu.destroy();isPopoutShown=false;recordCloseAction();currentPopout.onCloseCallback(currentPopout.popoutData);}
function initNewMenuToggle(){var shouldCloseMenuOnBlur=true;var menuToggle=menuToggleService.create(shouldCloseMenuOnBlur);menuToggle.init();menuToggle.on('closed',closePopout);return menuToggle;}
function showPopout(){if(isPopoutShown){return;}
menu=initNewMenuToggle();var togglePopoutEl=domService.query('.'+CLASS_TOGGLE_POPOUT_BUTTON,currentPopout.popoutEl);menu.showMenu(togglePopoutEl);isPopoutShown=true;recordUserActionProgrammatically('loaded','programmatic');var callbackData=$.extend({},currentPopout.popoutData,{el:currentPopout.popoutEl});currentPopout.onShowCallback(callbackData);}
function onTogglePopoutButtonClicked(event){if(isPopoutShown){closeTarget=CLOSE_CLICK_TOGGLE_BUTTON;}else{event.stopPropagation();recordUserActionProgrammatically('open|helpbutton','click');var contextualMessageService=application.getService('contextual-message');contextualMessageService.createMessageRepresentationWithContext(currentPopout.popoutData.name,'popout',currentPopout.popoutData.context).setIsTriggeredByUserAction(true).show();}}
function onLaunchMessageButtonClicked(messageName,messageType){if(!messageName||!messageType){return;}
closeTarget=CLOSE_CLICK_PRIMARY_BUTTON;menu.closeMenu();var contextualMessageService=application.getService('contextual-message');contextualMessageService.createMessageRepresentation(messageName,messageType).setIsTriggeredByUserAction(true).show();}
function onGoToUrlButtonClicked(goToUrl){if(!goToUrl){return;}
closeTarget=CLOSE_CLICK_PRIMARY_BUTTON;menu.closeMenu();navService.redirect(goToUrl);}
function onClosePopoutButtonClicked(){closeTarget=CLOSE_CLICK_SECONDARY_BUTTON;menu.closeMenu();}
function mouseDownHandler(event){var element=event.target||event.srcElement;if(!element.hasAttribute('data-action')){element=domService.getNearest(event.target,'[data-action]');if(element===null){return;}}
if(!element){return;}
var action=element.getAttribute('data-action');switch(action){case ACTION_TOGGLE_POPOUT:onTogglePopoutButtonClicked(event);break;case ACTION_LAUNCH_MESSAGE:var messageName=element.getAttribute('data-actiondata-messagename');var messageType=element.getAttribute('data-actiondata-messagetype');onLaunchMessageButtonClicked(messageName,messageType);break;case ACTION_GOTO_URL:var goToUrl=element.getAttribute('data-actiondata-url');onGoToUrlButtonClicked(goToUrl);break;case ACTION_CLOSE_POPOUT:onClosePopoutButtonClicked();break;}}
function keyUpHandler(event){var element=event.target||event.srcElement;var action=element.getAttribute('data-action');if(action===ACTION_TOGGLE_POPOUT){if(event.keyCode===ESC_KEY&&isPopoutShown){closeTarget=CLOSE_PRESS_ESC_KEY;}}}
function attachPopoutListeners(){domService.on(currentPopout.popoutEl,'mousedown',mouseDownHandler);domService.on(currentPopout.popoutEl,'keyup',keyUpHandler);}
function detachPopoutListeners(){domService.off(currentPopout.popoutEl,'mousedown',mouseDownHandler);domService.off(currentPopout.popoutEl,'keyup',keyUpHandler);}
function removeCurrentPopout(){if(!currentPopout.popoutEl){return;}
detachPopoutListeners();domService.remove(currentPopout.popoutEl);currentPopout={};}
function finishPopoutLoadingSetupAndRunCallbacks(popout,popoutEl){detachPopoutListeners();currentPopout=popout;currentPopout.popoutEl=popoutEl||domService.query('.contextual-popout[data-popout-name="'+popout.popoutData.name+'"]');initResinAttributes();attachPopoutListeners();popout.onLoadCallback(popout.popoutData);}
function loadPopout(popout){var runmode=popout.popoutData.templateFetchEndpoint;var params={id:popout.popoutData.id,identifier:popout.popoutData.identifier,isHighDensityDisplay:screenService.isHighDensity()};var popoutEl=domService.query('.contextual-popout[data-popout-name="'+popout.popoutData.name+'"]');var popoutMountNode=domService.query('.contextual-popout-container')||document.body;if(popoutEl){finishPopoutLoadingSetupAndRunCallbacks(popout,popoutEl);return promisesService.createResolved();}
return ajaxService.get(runmode,params).then(function popoutContentReceived(response){var popoutFragment=domService.createFragmentFromHtml(response.data.html);popoutMountNode.appendChild(popoutFragment);finishPopoutLoadingSetupAndRunCallbacks(popout);return;});}
function Popout(popoutData){this.popoutData=popoutData;this.popoutEl=null;this.onLoadCallback=noop;this.onShowCallback=noop;this.onCloseCallback=noop;}
Popout.prototype={load:function(){return loadPopout(this);},show:function(){this.load().then(showPopout);},unload:function(){removeCurrentPopout();},setOnLoadCallback:function(callback){if(typeof callback==='function'){this.onLoadCallback=callback;}},setOnShowCallback:function(callback){if(typeof callback==='function'){this.onShowCallback=callback;}},setOnCloseCallback:function(callback){if(typeof callback==='function'){this.onCloseCallback=callback;}}};return{create:function(popoutData){return new Popout(popoutData);}};});Box.Application.addService('banner',function(application){'use strict';var ACTION_LAUNCH_MESSAGE='launch-message';var ACTION_GOTO_URL='go-to-url';var BANNER_ANCHOR_ELEMENT_ID='contextual-message-banner-anchor';var CLASS_HIDDEN='hidden';var CLASS_BANNER_VISIBLE='banner-visible';var ACTION_CLOSE_BANNER='close-message';var CLOSE_CLICK_PRIMARY_BUTTON={target:'cta1',action:'click'};var CLOSE_PRESS_ESC_KEY={target:'esc',action:'click'};var ajaxService=application.getService('ajax');var domService=application.getService('dom');var promisesService=application.getService('promises');var resinService=application.getService('resin');var screenService=application.getService('screen');var currentBanner=null;var bannerAnchorEl;var documentBodyEl=application.getGlobal('document').body;var resinActionAttributes;var closeTarget;function noop(){}
function getCurrentBannerName(){return(currentBanner!==null)?currentBanner.bannerData.name:null;}
function getCurrentPageName(){return resinService.sanitize(resinActionAttributes.page);}
function recordUserActionProgrammatically(target,action){resinService.recordAction({application:resinService.sanitize(resinActionAttributes.application),page:currentBanner.bannerEl.getAttribute('data-resin-page'),component:'banner',feature:'banner',target:resinService.sanitize(target),action:resinService.sanitize(action)});}
function recordCloseAction(){var closeActionTarget=closeTarget||CLOSE_PRESS_ESC_KEY;recordUserActionProgrammatically('close|'+closeActionTarget.target,closeActionTarget.action);closeTarget=null;}
function updateResinPage(){var resinPage=getCurrentPageName()+'|'+getCurrentBannerName();currentBanner.bannerEl.setAttribute('data-resin-page',resinService.sanitize(resinPage));}
function initResinAttributes(){currentBanner.bannerEl.removeAttribute('data-resin-page');var resinTarget=currentBanner.bannerEl.firstChild;resinActionAttributes=resinService.getActionAttributes(resinTarget);updateResinPage();}
function doHideCurrentBanner(){domService.addClass(currentBanner.bannerEl,CLASS_HIDDEN);domService.removeClass(documentBodyEl,CLASS_BANNER_VISIBLE);}
function doShowCurrentBanner(){domService.removeClass(currentBanner.bannerEl,CLASS_HIDDEN);domService.addClass(documentBodyEl,CLASS_BANNER_VISIBLE);}
function closeBanner(){if(currentBanner){detachBannerListeners();doHideCurrentBanner();recordCloseAction();currentBanner.onCloseCallback();}
currentBanner=null;}
function onLaunchMessageButtonClicked(messageName,messageType){if(!messageName||!messageType){return;}
closeTarget=CLOSE_CLICK_PRIMARY_BUTTON;closeBanner();var contextualMessageService=application.getService('contextual-message');contextualMessageService.createMessageRepresentation(messageName,messageType).setIsTriggeredByUserAction(true).show();}
function onGoToUrlButtonClicked(goToUrl){if(!goToUrl){return;}
closeTarget=CLOSE_CLICK_PRIMARY_BUTTON;closeBanner();var navService=application.getService('nav');navService.redirect(goToUrl);}
function mouseUpHandler(event){var element=domService.getNearest(event.target||event.srcElement,'[data-action]');if(!element){return;}
var action=element.getAttribute('data-action');switch(action){case ACTION_CLOSE_BANNER:closeTarget=CLOSE_PRESS_ESC_KEY;closeBanner();break;case ACTION_LAUNCH_MESSAGE:var messageName=element.getAttribute('data-actiondata-messagename');var messageType=element.getAttribute('data-actiondata-messagetype');onLaunchMessageButtonClicked(messageName,messageType);break;case ACTION_GOTO_URL:var goToUrl=element.getAttribute('data-actiondata-url');onGoToUrlButtonClicked(goToUrl);break;}}
function attachBannerListeners(){domService.on(currentBanner.bannerEl,'mouseup',mouseUpHandler);}
function detachBannerListeners(){domService.off(currentBanner.bannerEl,'mouseup',mouseUpHandler);}
function showBanner(){attachBannerListeners();doShowCurrentBanner();initResinAttributes();recordUserActionProgrammatically('loaded','programmatic');var callbackData=$.extend({},currentBanner.bannerData,{el:currentBanner.bannerEl});currentBanner.onShowCallback(callbackData);}
function getBannerAnchorEl(){if(!bannerAnchorEl){bannerAnchorEl=document.getElementById(BANNER_ANCHOR_ELEMENT_ID);}
return bannerAnchorEl?bannerAnchorEl:null;}
function loadBanner(banner){var bannerEl=domService.query('[data-banner-name="'+banner.bannerData.name+'"]');var runmode=banner.bannerData.templateFetchEndpoint;var params={id:banner.bannerData.id,identifier:banner.bannerData.identifier,isHighDensityDisplay:screenService.isHighDensity()};if(bannerEl){banner.onLoadCallback(banner.bannerData);return promisesService.createResolved();}
var anchorEl=getBannerAnchorEl();if(anchorEl===null){return promisesService.createRejected('No anchor element found on the page');}
return ajaxService.get(runmode,params).then(function bannerContentReceived(response){var bannerFragment=domService.createFragmentFromHtml(response.data.html);anchorEl.appendChild(bannerFragment);return;}).then(function executeLoadCallbacks(){banner.onLoadCallback(banner.bannerData);return;});}
function Banner(bannerData){this.bannerData=bannerData;this.bannerEl=null;this.onLoadCallback=noop;this.onShowCallback=noop;this.onCloseCallback=noop;}
Banner.prototype={load:function(){return loadBanner(this);},show:function(){var bannerName=this.bannerData.name;currentBanner=this;this.load().then(function(){currentBanner.bannerEl=domService.query('[data-banner-name="'+bannerName+'"]');showBanner();});},unload:function(){},setOnLoadCallback:function(callback){if(typeof callback==='function'){this.onLoadCallback=callback;}},setOnShowCallback:function(callback){if(typeof callback==='function'){this.onShowCallback=callback;}},setOnCloseCallback:function(callback){if(typeof callback==='function'){this.onCloseCallback=callback;}},_close:closeBanner};return{create:function(bannerData){return new Banner(bannerData);}};});Box.Application.addService('slide-carousel',function(application){'use strict';var domService=application.getService('dom');var ACTIVE_CLASS='is-active';var CHANGE_SLIDE_DELAY=300;var TRANSITION_LEFT_CLASS='transition-left';var TRANSISION_RIGHT_CLASS='transition-right';var SLIDE_NAME_ATTRIBUTE='data-slide-name';function generateIdsAndPagination(carousel){carousel.isNavigable=carousel.paginationContainerEl.getAttribute('data-navigable')!=='false';while(carousel.paginationContainerEl.firstChild){carousel.paginationContainerEl.removeChild(carousel.paginationContainerEl.firstChild);}
var paginationIcon;for(var i=0,len=carousel.slideEls.length;i<len;i++){var slideEl=carousel.slideEls[i];slideEl.setAttribute('data-slide-num',i);paginationIcon=document.createElement('li');paginationIcon.setAttribute('data-type','go-to-slide');paginationIcon.setAttribute('data-slide-num',i);if(domService.hasClass(slideEl,ACTIVE_CLASS)){paginationIcon.className=ACTIVE_CLASS;carousel.currentSlideNum=i;carousel.currentSlideName=slideEl.getAttribute(SLIDE_NAME_ATTRIBUTE);}
carousel.paginationContainerEl.appendChild(paginationIcon);}
carousel.paginationEls=carousel.paginationContainerEl.childNodes;}
function initProgressBar(carousel){var progressBarService=application.getService('progress-circle');carousel.progressBar=progressBarService.create({element:carousel.progressEl,total:carousel.slideEls.length});}
function resetSlidePositions(carousel){var slideEl;for(var i=0,len=carousel.slideEls.length;i<len;i++){slideEl=carousel.slideEls[i];domService.removeClass(slideEl,TRANSITION_LEFT_CLASS);domService.removeClass(slideEl,TRANSISION_RIGHT_CLASS);if(i<carousel.currentSlideNum){domService.addClass(slideEl,TRANSITION_LEFT_CLASS);}
if(i>carousel.currentSlideNum){domService.addClass(slideEl,TRANSISION_RIGHT_CLASS);}}}
function resetAnimatedGif(slideEl){var presentationContentEl=domService.query('.presentation-content',slideEl);if(presentationContentEl){var backgroundImage=domService.getComputedCSS(presentationContentEl)['background-image'];var gifURLPattern=/url\(['"]?(.+\.gif).*['"]?\)/;var matches;if((matches=gifURLPattern.exec(backgroundImage))!==null){presentationContentEl.style.backgroundImage='url('+matches[1]+'?rnd='+Math.random()+')';}}}
function mouseUpHandler(carousel){return function(event){var element=event.target||event.srcElement;var elementType=element.getAttribute('data-type');if(!elementType||!carousel.isNavigable){return;}
switch(elementType){case'go-to-slide':carousel.goToSlide(Number(element.getAttribute('data-slide-num')));break;case'next-slide':carousel.goToNextSlide();break;case'prev-slide':carousel.goToPrevSlide();break;default:return;}};}
function SlideCarousel(wrapperEl){this.wrapperEl=wrapperEl;this.isCurrentlyChangingSlides=false;this.isNavigable=true;this.slideContainerEl=domService.query('.slides',this.wrapperEl);this.slideEls=domService.queryAll('.slides > li',this.wrapperEl);this.paginationContainerEl=domService.query('.slides-pagination',this.wrapperEl);this.paginationEls=null;this.progressEl=domService.query('.progress',this.wrapperEl);this.currentSlideNum=0;this.currentSlideName=this.slideEls[0].getAttribute(SLIDE_NAME_ATTRIBUTE);generateIdsAndPagination(this);resetSlidePositions(this);this.mouseUpHandlerRef=mouseUpHandler(this);domService.on(this.paginationContainerEl,'mouseup',this.mouseUpHandlerRef);if(this.progressEl&&this.slideEls.length){initProgressBar(this);}}
SlideCarousel.prototype={goToSlide:function(incomingSlideNum){if(incomingSlideNum>=this.slideEls.length||incomingSlideNum<0||this.isCurrentlyChangingSlides){return false;}
this.isCurrentlyChangingSlides=true;var incomingPaginationEl=this.paginationEls[incomingSlideNum];var incomingSlideEl=this.slideEls[incomingSlideNum];var outgoingPaginationEl=this.paginationEls[this.currentSlideNum];var outgoingSlideEl=this.slideEls[this.currentSlideNum];domService.removeClass(incomingSlideEl,TRANSITION_LEFT_CLASS);domService.removeClass(incomingSlideEl,TRANSISION_RIGHT_CLASS);var outgoingClass=incomingSlideNum>this.currentSlideNum?TRANSITION_LEFT_CLASS:TRANSISION_RIGHT_CLASS;domService.addClass(outgoingSlideEl,outgoingClass);domService.removeClass(outgoingPaginationEl,ACTIVE_CLASS);domService.removeClass(outgoingSlideEl,ACTIVE_CLASS);domService.addClass(incomingPaginationEl,ACTIVE_CLASS);domService.addClass(incomingSlideEl,ACTIVE_CLASS);this.currentSlideNum=incomingSlideNum;this.currentSlideName=incomingSlideEl.getAttribute(SLIDE_NAME_ATTRIBUTE);resetSlidePositions(this);resetAnimatedGif(incomingSlideEl);var me=this;setTimeout(function(){me.isCurrentlyChangingSlides=false;},CHANGE_SLIDE_DELAY);if(this.progressBar){this.progressBar.updateProgress(this.currentSlideNum);}
return true;},goToNextSlide:function(rollover){var nextSlideNum=this.currentSlideNum+1;return this.goToSlide(rollover?nextSlideNum%this.slideEls.length:nextSlideNum);},goToPrevSlide:function(rollover){var nextSlideNum=this.currentSlideNum-1;this.goToSlide(rollover&&nextSlideNum<0?this.slideEls.length-1:nextSlideNum);},getCurrentSlideNum:function(){return this.currentSlideNum;},isOnLastSlide:function(){return(this.currentSlideNum===this.slideEls.length-1);},getCurrentSlideName:function(){return this.currentSlideName||'';},destroy:function(){domService.off(this.paginationContainerEl,'mouseup',this.mouseUpHandlerRef);}};return{create:function(wrapperEl){return new SlideCarousel(wrapperEl);}};});Box.Application.addService('priority-queue',function(){'use strict';function PriorityQueue(comparator){var queue=[];var needsSorting=false;function sortQueueIfNeeded(){if(needsSorting){queue.sort(comparator);needsSorting=false;}}
return{queue:function(value){queue.push(value);needsSorting=true;},peek:function(){sortQueueIfNeeded();return(queue.length!==0)?queue[0]:null;},dequeue:function(){sortQueueIfNeeded();return(queue.length!==0)?queue.shift():null;},clear:function(){queue=[];needsSorting=false;}};}
return{create:function(comparator){return new PriorityQueue(comparator);}};});Box.Application.addService('screen',function(){'use strict';return{isHighDensity:function(){return(window.devicePixelRatio>=2||(window.matchMedia&&window.matchMedia('(-webkit-min-device-pixel-ratio: 2),(min-resolution: 192dpi)').matches));}};});